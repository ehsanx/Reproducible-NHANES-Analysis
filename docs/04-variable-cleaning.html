<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Analyzing Early Smoking Initiation and Mortality - 6&nbsp; Variable Definitions and Cleaning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-cohort-definition.html" rel="next">
<link href="./03b-mortality-merge.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/ubc_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">NHANES Mortality Analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03a-download-merge.html">Data Preparation</a></li><li class="breadcrumb-item"><a href="./04-variable-cleaning.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Variable Definitions and Cleaning</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reproducing the Analysis: Early Smoking Initiation and Mortality</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction and Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Overview of the Study</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-nhanes-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NHANES Data Overview</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03a-download-merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Download and Merging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b-mortality-merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mortality and NHANES Merging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-variable-cleaning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Variable Definitions and Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-cohort-definition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cohort Definition</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Statistical Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-survey-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Survey Design Specification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-descriptive-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Descriptive Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-effect-modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Effect Modification Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-sensitivity-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sensitivity Analyses</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Discussion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Discussion of Results</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-limitations-future.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Limitations and Future Directions</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Appendices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#creating-key-analysis-variables" id="toc-creating-key-analysis-variables" class="nav-link active" data-scroll-target="#creating-key-analysis-variables"><span class="header-section-number">6.1</span> Creating Key Analysis Variables</a></li>
  <li><a href="#constructing-the-final-analytic-cohort" id="toc-constructing-the-final-analytic-cohort" class="nav-link" data-scroll-target="#constructing-the-final-analytic-cohort"><span class="header-section-number">6.2</span> Constructing the Final Analytic Cohort</a></li>
  <li><a href="#exporting-final-datasets" id="toc-exporting-final-datasets" class="nav-link" data-scroll-target="#exporting-final-datasets"><span class="header-section-number">6.3</span> Exporting Final Datasets</a></li>
  <li><a href="#chapter-summary-and-next-steps" id="toc-chapter-summary-and-next-steps" class="nav-link" data-scroll-target="#chapter-summary-and-next-steps"><span class="header-section-number">6.4</span> Chapter Summary and Next Steps</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Variable Definitions and Cleaning</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><hr>
<p>This section continues the data preparation process using the combined NHANES and mortality dataset created in the previous section, <code>dat.full.with.mortality</code>. Here, we will construct the final variables required for our survival analysis. This includes defining the exposure, outcome, and follow-up time, as well as creating the final analytic dataset by applying inclusion criteria and handling missing data.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/libraries_f12d16aa5dd0df7f112dbef85cfb3978">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(car)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(DataExplorer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 1: Load Complete Merged Data</li>
</ul>
<p>The following code begins by loading the <code>dat.full.with.mortality.RDS</code> file. This dataset is the complete, merged result from the previous chapter, containing the processed demographic, smoking, and mortality data for all participants. The <code><a href="https://rdrr.io/r/base/readRDS.html">readRDS()</a></code> function loads the file from the <code>data/</code> directory, and the <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> function is used to display the names of all its columns.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/readmerged_10e25569869129bf8ac4559b420f9268">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Load previous data file</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>dat.full.with.mortality <span class="ot">&lt;-</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">readRDS</span>(<span class="st">"data/dat.full.with.mortality.RDS"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="fu">colnames</span>(dat.full.with.mortality)</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  [1] "id"                 "age"                "sex"               </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;  [4] "race"               "born"               "smoking.age"       </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;  [7] "smoked.while.child" "smoking"            "psu"               </span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; [10] "strata"             "year"               "survey.weight.new" </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; [13] "mort_eligstat"      "mort_stat"          "mort_ucod_leading" </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; [16] "mort_diabetes"      "mort_hyperten"      "mort_permth_int"   </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; [19] "mort_permth_exm"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<section id="creating-key-analysis-variables" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="creating-key-analysis-variables">
<span class="header-section-number">6.1</span> Creating Key Analysis Variables</h2>
<ul>
<li>R Code Chunk 2: Variable Construction</li>
</ul>
<p>This section details the construction of the key variables essential for our survival analysis. This includes defining the exposure variable (age at smoking initiation), the survival outcome, and the follow-up time.</p>
<p><strong>1. Exposure Variable: Age at Smoking Initiation Categories (exposure.cat)</strong></p>
<p>The following code creates the primary exposure variable for our analysis, <code>exposure.cat</code>. The numeric <code>smoking.age</code> variable (<code>SMD030</code> from NHANES) is categorized into six levels based on age ranges used in the original paper. This categorization is based on established age ranges for smoking initiation used in previous research, and aims to capture distinct developmental and addiction risk profiles. We first inspect the raw distribution of <code>smoking.age</code> before using <code><a href="https://rdrr.io/pkg/car/man/recode.html">car::recode()</a></code> to create the new factor and explicitly setting the level order to ensure “Never smoked” is the reference category.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/var_construction_7f78efa06d3a8d39f31285c6b64ce84c">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Display initial distribution of raw smoking.age</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">table</span>(dat.full.with.mortality<span class="sc">$</span>smoking.age, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt;     0     5     6     7     8     9    10    11    12    13    14    15    16 </span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; 31915     4     3   106   100   157   261   240   841  1207  1597  2354  2973 </span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt;    17    18    19    20    21    22    23    24    25    26    27    28    29 </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt;  2399  3591  1510  1755   995   708   415   263   760   166   173   156    63 </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;    30    31    32    33    34    35    36    37    38    39    40    41    42 </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;   370    26    71    29    22   143    34    24    28    19    98     9    18 </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt;    43    44    45    46    47    48    49    50    51    52    53    54    55 </span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt;    14    11    44    11     7     6     5    25     4     2     1     4     8 </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt;    56    57    58    59    60    62    63    64    65    68    70    71    72 </span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt;     2     1     5     2     2     2     1     1     4     4     1     1     4 </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt;    74    76    77  &lt;NA&gt; </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt;     2     1     1 45537</span></span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co"># Recode smoking.age into categorical exposure.cat</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>dat.full.with.mortality<span class="sc">$</span>exposure.cat <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb3-19"><a href="#cb3-19"></a>dat.full.with.mortality<span class="sc">$</span>smoking.age, <span class="st">"</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="st">0 = 'Never smoked'; 1:9 = 'Started before 10'; </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="st">10:14 = 'Started at 10-14'; 15:17 = 'Started at 15-17'; </span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="st">18:20 = 'Started at 18-20'; 21:80 = 'Started after 20'; </span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="st">else = NA "</span>, <span class="at">as.factor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-24"><a href="#cb3-24"></a></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co"># Explicitly set the order of factor levels</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>dat.full.with.mortality<span class="sc">$</span>exposure.cat <span class="ot">&lt;-</span> </span>
<span id="cb3-27"><a href="#cb3-27"></a>  <span class="fu">factor</span>(dat.full.with.mortality<span class="sc">$</span>exposure.cat,</span>
<span id="cb3-28"><a href="#cb3-28"></a>         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never smoked"</span>, <span class="st">'Started before 10'</span>,</span>
<span id="cb3-29"><a href="#cb3-29"></a>                    <span class="st">'Started at 10-14'</span>, <span class="st">"Started at 15-17"</span>,</span>
<span id="cb3-30"><a href="#cb3-30"></a>                    <span class="st">"Started at 18-20"</span>, <span class="st">"Started after 20"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following tables are used to inspect the distribution of the newly created exposure variable, both overall and broken down by mortality status.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/tables_33f423ea8303e5e932bb389b85da022b">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Display distributions of the newly created exposure variable</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">table</span>(dat.full.with.mortality<span class="sc">$</span>exposure.cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; </span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;      Never smoked Started before 10  Started at 10-14  Started at 15-17 </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;             31915               370              4146              7726 </span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;  Started at 18-20  Started after 20              &lt;NA&gt; </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt;              6856              4766             45537</span></span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># Display distributions of exposure.cat level</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co"># broken down by mort_stat variable</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="fu">table</span>(dat.full.with.mortality<span class="sc">$</span>exposure.cat,</span>
<span id="cb4-13"><a href="#cb4-13"></a>      dat.full.with.mortality<span class="sc">$</span>mort_stat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;                    </span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt;                         0     1  &lt;NA&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt;   Never smoked      27823  3994    98</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt;   Started before 10   254   116     0</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt;   Started at 10-14   3217   922     7</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt;   Started at 15-17   6193  1522    11</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt;   Started at 18-20   5438  1405    13</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt;   Started after 20   3618  1140     8</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt;   &lt;NA&gt;               3272   150 42115</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>2. Outcome and Follow-up Time Variables</strong></p>
<p>The following code constructs the variables for the survival analysis. As noted in the original paper, the time of birth is designated as the baseline to prevent differential start times for exposed and unexposed participants. The primary survival outcome is therefore the time from birth to all-cause mortality. Specifically, this is calculated by combining the participant’s age at the interview (from the RIDAGEYR variable) with their mortality follow-up time from the interview date (from the PERMTH_INT variable). We also define the <code>status_all</code> variable from the raw mortality data to indicate the participant’s final mortality status.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/survivalVar_7660dbbdc73970597a65721bc509aae3">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Survival time Person-Months of Follow-up from Interview date</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># (PERMTH_INT)</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.interview <span class="ot">&lt;-</span> </span>
<span id="cb5-4"><a href="#cb5-4"></a>  dat.full.with.mortality<span class="sc">$</span>mort_permth_int </span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="sc">$</span>stime.since.interview) </span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt;     0.0    59.0   113.0   117.9   172.0   250.0   42252</span></span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co"># Age in month at NHANES interview </span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co"># (RIDAGEYR)</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>dat.full.with.mortality<span class="sc">$</span>age.month <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>age <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="sc">$</span>age.month)</span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt;     0.0   120.0   288.0   373.5   624.0  1020.0</span></span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co"># Survival time - Person-Months of Follow-up from birth = age at </span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co"># screening (months) + person-months of follow-up from interview.</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co"># This combines the age at interview with the time from interview </span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co"># to death or end of follow-up.</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.birth <span class="ot">&lt;-</span> </span>
<span id="cb5-23"><a href="#cb5-23"></a>  <span class="fu">with</span>(dat.full.with.mortality, age.month <span class="sc">+</span> stime.since.interview)</span>
<span id="cb5-24"><a href="#cb5-24"></a></span>
<span id="cb5-25"><a href="#cb5-25"></a></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="co"># Convert to years for consistent interpretation with age</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.birth <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>stime.since.birth<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb5-28"><a href="#cb5-28"></a></span>
<span id="cb5-29"><a href="#cb5-29"></a></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co"># Ensure NA values are consistent if stime.since.interview was NA</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.birth[</span>
<span id="cb5-32"><a href="#cb5-32"></a>  <span class="fu">is.na</span>(dat.full.with.mortality<span class="sc">$</span>stime.since.interview)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="sc">$</span>stime.since.birth)</span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">#&gt;   19.08   41.50   57.17   57.56   72.92  105.67   42252</span></span>
<span id="cb5-36"><a href="#cb5-36"></a></span>
<span id="cb5-37"><a href="#cb5-37"></a></span>
<span id="cb5-38"><a href="#cb5-38"></a><span class="co"># All-cause mortality status (PRIMARY outcome)</span></span>
<span id="cb5-39"><a href="#cb5-39"></a>dat.full.with.mortality<span class="sc">$</span>status_all <span class="ot">&lt;-</span> </span>
<span id="cb5-40"><a href="#cb5-40"></a>  dat.full.with.mortality<span class="sc">$</span>mort_stat</span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="fu">table</span>(dat.full.with.mortality<span class="sc">$</span>status_all, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="co">#&gt; </span></span>
<span id="cb5-43"><a href="#cb5-43"></a><span class="co">#&gt;     0     1  &lt;NA&gt; </span></span>
<span id="cb5-44"><a href="#cb5-44"></a><span class="co">#&gt; 49815  9249 42252</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>3. Final Variable Cleaning</strong></p>
<p>The following code drops mortality-related variables not needed for the final analytic dataset.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/dropVar_74396a772da70084dd3667925c9ee02a">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Remove unneeded columns</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>dat.full.with.mortality<span class="sc">$</span>mort_diabetes <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>dat.full.with.mortality<span class="sc">$</span>mort_hyperten <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>dat.full.with.mortality<span class="sc">$</span>mort_permth_int <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>dat.full.with.mortality<span class="sc">$</span>mort_permth_exm <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>dat.full.with.mortality<span class="sc">$</span>mort_ucod_leading <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>dat.full.with.mortality<span class="sc">$</span>mort_eligstat <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>4. Recoding Survey Year: year.cat</strong></p>
<p>The <code>year</code> variable, representing the NHANES survey cycle is recoded into a more descriptive categorical variable, <code>year.cat</code>.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/recoding_year_310e67259b3325767598fd72f1970dbd">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Recode year variable into a factor with descriptive labels</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>dat.full.with.mortality<span class="sc">$</span>year.cat <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>year</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>new_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="st">"1999-2000"</span>, <span class="st">"2001-2002"</span>, <span class="st">"2003-2004"</span>, </span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="st">"2005-2006"</span>, <span class="st">"2007-2008"</span>, <span class="st">"2009-2010"</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="st">"2011-2012"</span>, <span class="st">"2013-2014"</span>, <span class="st">"2015-2016"</span>,</span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="st">"2017-2018"</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>)</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="fu">levels</span>(dat.full.with.mortality<span class="sc">$</span>year.cat) <span class="ot">&lt;-</span> new_levels</span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co"># Display the unique levels of the new year.cat variable</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="fu">levels</span>(dat.full.with.mortality<span class="sc">$</span>year.cat)</span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt;  [1] "1999-2000" "2001-2002" "2003-2004" "2005-2006" "2007-2008" "2009-2010"</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt;  [7] "2011-2012" "2013-2014" "2015-2016" "2017-2018"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="constructing-the-final-analytic-cohort" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="constructing-the-final-analytic-cohort">
<span class="header-section-number">6.2</span> Constructing the Final Analytic Cohort</h2>
<ul>
<li>R Code Chunk 3: Final Analytic Dataset Construction</li>
</ul>
<p>The following code creates the final analytic dataset by applying the specific inclusion and exclusion criteria used in the published paper. The two main steps are restricting the participant age range to 20–79 years and performing a complete-case analysis by excluding observations with missing data for key variables.</p>
<p><strong>1. Apply Age and Variable Exclusions</strong></p>
<p>First, we apply the age restriction, keeping only participants between 20 and 79 years old. We also drop several intermediate or raw variables that are no longer needed for the final analysis. We will remove the <code>smoked.while.child</code> variable. While this variable was created as a simple binary indicator for early smoking, the final analysis relies on the more granular, multi-level <code>exposure.cat</code> variable.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>exposure.cat</code> variable (e.g., ‘Started before 10’, ‘Started at 10-14’) is superior for our research question because it allows us to investigate a dose-response relationship—that is, to see if the risk of mortality changes incrementally with different ages of initiation. A simple binary variable like <code>smoked.while.child</code> would only allow us to compare “early starters” to everyone else, masking the important nuances in risk across different age groups. Therefore, it is excluded from the final analytic dataset.</p>
</div>
</div>
<div class="cell" data-hash="04-variable-cleaning_cache/html/age_a34391143c0aa6f57556aa9538fe4292">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Drop the following column not being used</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>dat.full.with.mortality<span class="sc">$</span>smoked.while.child <span class="ot">&lt;-</span> <span class="cn">NULL</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="do">### Analytic Dataset - age 20 - 79</span></span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># Inclusion criteria: adults aged between 20 and 79 years</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>dat.analytic <span class="ot">&lt;-</span> <span class="fu">subset</span>(dat.full.with.mortality, age<span class="sc">&gt;=</span><span class="dv">20</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co"># Dimensions before age filtering</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="fu">dim</span>(dat.full.with.mortality)</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; [1] 101316     18</span></span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co"># Dimensions after age filtering</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="fu">dim</span>(dat.analytic)</span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt; [1] 50824    18</span></span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co"># Calculate number of participants dropped due to age restriction</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="fu">dim</span>(dat.full.with.mortality)[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">dim</span>(dat.analytic)[<span class="dv">1</span>]</span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt; [1] 50492</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Drop other variables that are not being used in the final analysis.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/drop_aeef822b14008743587851efa8baea6a">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>dat.analytic<span class="sc">$</span>born <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>dat.analytic<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>dat.analytic<span class="sc">$</span>age.month <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># Dimension</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="fu">dim</span>(dat.analytic) </span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; [1] 50824    15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>2. Apply Complete-Case Analysis</strong></p>
<p>Next, we exclude participants who have missing data for the primary outcome (survival time) or the primary exposure (smoking initiation category). This is consistent with the original paper, which notes that about 0.5% of the sample (275 observations) was discarded for this reason. Also, there were no missing values in the covariates variables considered in the main analysis.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/exposure/outcome_1747abb250e66e5575eac3db4ad680e6">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Participants with incomplete data on smoking status </span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># or mortality were excluded</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>dat.analytic1 <span class="ot">&lt;-</span> dat.analytic[</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">complete.cases</span>(dat.analytic<span class="sc">$</span>stime.since.birth),]</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="fu">dim</span>(dat.analytic1) <span class="co"># Dimension after removing missing survival time</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt; [1] 50690    15</span></span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a>dat.analytic2 <span class="ot">&lt;-</span> dat.analytic1[</span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">complete.cases</span>(dat.analytic1<span class="sc">$</span>exposure.cat),]</span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="fu">dim</span>(dat.analytic2) <span class="co"># Dimension after removing missing exposure var</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt; [1] 50549    15</span></span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co"># Complete case analysis: remove missing values in covariates</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>dat.complete <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat.analytic2) <span class="co"># No missing values</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="fu">dim</span>(dat.complete)</span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; [1] 50549    15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="04-variable-cleaning_cache/html/profile-missing_ecf6ab5056bbc8785f01af5cc1d1229e">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Profile missingness after initial filtering</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">profile_missing</span>(dat.analytic2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div data-pagedtable="false">

<script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature"],"name":[1],"type":["fct"],"align":["left"]},{"label":["num_missing"],"name":[2],"type":["int"],"align":["right"]},{"label":["pct_missing"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"id","2":"0","3":"0"},{"1":"sex","2":"0","3":"0"},{"1":"race","2":"0","3":"0"},{"1":"smoking.age","2":"0","3":"0"},{"1":"smoking","2":"0","3":"0"},{"1":"psu","2":"0","3":"0"},{"1":"strata","2":"0","3":"0"},{"1":"year","2":"0","3":"0"},{"1":"survey.weight.new","2":"0","3":"0"},{"1":"mort_stat","2":"0","3":"0"},{"1":"exposure.cat","2":"0","3":"0"},{"1":"stime.since.interview","2":"0","3":"0"},{"1":"stime.since.birth","2":"0","3":"0"},{"1":"status_all","2":"0","3":"0"},{"1":"year.cat","2":"0","3":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Profile of missing data after removing participants with missing outcome or exposure. This table confirms that no missing values remain in the key covariates.</p>
</div>
</div>
<p><strong>3. Reconcile Sample Sizes</strong> The following code calculates the number of participants dropped at each stage of the filtering process. This helps confirm that our data cleaning has resulted in the same final sample size as the original study.</p>
<div class="cell" data-hash="04-variable-cleaning_cache/html/num_dropped_63fbe36a64113e807cf99508bcc958bf">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Participants dropped - overall</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">nrow</span>(dat.full.with.mortality) <span class="sc">-</span> <span class="fu">nrow</span>(dat.complete)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt; [1] 50767</span></span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co"># Participants dropped - due to missing exposure or outcome</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="fu">nrow</span>(dat.analytic) <span class="sc">-</span> <span class="fu">nrow</span>(dat.analytic2)</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; [1] 275</span></span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co"># Participants dropped - due to missing covariates</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="fu">nrow</span>(dat.analytic2) <span class="sc">-</span> <span class="fu">nrow</span>(dat.complete)</span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt; [1] 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="exporting-final-datasets" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="exporting-final-datasets">
<span class="header-section-number">6.3</span> Exporting Final Datasets</h2>
<ul>
<li>R Code Chunk 4: Save Final Datasets</li>
</ul>
<p>The final step is to save our processed datasets. We save three different versions of the data to create useful checkpoints for the analysis:</p>
<ul>
<li>
<code>dat.full.with.mortality.RData</code>: The updated, merged dataset before any filtering was applied in this chapter.</li>
<li>
<code>dat.analytic2.RData</code>: The dataset after applying age restrictions and removing participants with missing outcome or exposure data.</li>
<li>
<code>dat.complete.RData</code>: The final, clean analytic dataset containing only complete cases.</li>
</ul>
<div class="cell" data-hash="04-variable-cleaning_cache/html/save_8c30377163114a99d80bf811a7386707">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Save</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">save</span>(dat.full.with.mortality, </span>
<span id="cb13-3"><a href="#cb13-3"></a>     <span class="at">file =</span> <span class="st">"data/dat.full.with.mortality.RData"</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="fu">save</span>(dat.analytic2, </span>
<span id="cb13-6"><a href="#cb13-6"></a>     <span class="at">file =</span> <span class="st">"data/dat.analytic2.RData"</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="fu">save</span>(dat.complete, </span>
<span id="cb13-9"><a href="#cb13-9"></a>     <span class="at">file =</span> <span class="st">"data/dat.complete.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This completes the variable definitions and cleaning part of the data preparation stage.</p>
</section><section id="chapter-summary-and-next-steps" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="chapter-summary-and-next-steps">
<span class="header-section-number">6.4</span> Chapter Summary and Next Steps</h2>
<p>In this chapter, we constructed the core variables for the analysis, including the categorized smoking initiation exposure (<code>exposure.cat</code>) and the survival outcome (time from birth to all-cause mortality). We then applied the study’s inclusion and exclusion criteria to create the final, complete-case analytic dataset with 50,549 participants, matching the sample size of the original paper.</p>
<p>With a clean dataset ready, the next chapter, “Cohort Definition,” will formally summarize the criteria used to define our study population.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03b-mortality-merge.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mortality and NHANES Merging</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-cohort-definition.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cohort Definition</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>