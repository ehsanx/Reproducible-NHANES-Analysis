<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Analyzing Early Smoking Initiation and Mortality - 12&nbsp; Sensitivity Analyses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-discussion.html" rel="next">
<link href="./09-effect-modification.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/ubc_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">NHANES Mortality Analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-survey-design.html">Statistical Analysis</a></li><li class="breadcrumb-item"><a href="./10-sensitivity-analysis.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sensitivity Analyses</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reproducing the Analysis: Early Smoking Initiation and Mortality</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction and Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Overview of the Study</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-nhanes-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NHANES Data Overview</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03a-download-merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Download and Merging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b-mortality-merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mortality and NHANES Merging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-variable-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Variable Definitions and Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-cohort-definition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cohort Definition</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Statistical Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-survey-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Survey Design Specification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-descriptive-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Descriptive Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-effect-modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Effect Modification Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-sensitivity-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sensitivity Analyses</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Discussion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Discussion of Results</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-limitations-future.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Limitations and Future Directions</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Appendices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sensitivity-analysis-1-adjustment-for-ses-proxies" id="toc-sensitivity-analysis-1-adjustment-for-ses-proxies" class="nav-link active" data-scroll-target="#sensitivity-analysis-1-adjustment-for-ses-proxies"><span class="header-section-number">12.1</span> Sensitivity Analysis 1: Adjustment for SES Proxies</a>
  <ul class="collapse">
<li><a href="#data-reprocessing-with-ses-variables" id="toc-data-reprocessing-with-ses-variables" class="nav-link" data-scroll-target="#data-reprocessing-with-ses-variables"><span class="header-section-number">12.1.1</span> Data Reprocessing with SES Variables</a></li>
  <li><a href="#analysis-with-ses-adjustment" id="toc-analysis-with-ses-adjustment" class="nav-link" data-scroll-target="#analysis-with-ses-adjustment"><span class="header-section-number">12.1.2</span> Analysis with SES Adjustment</a></li>
  <li><a href="#visualizing-the-ses-adjusted-results" id="toc-visualizing-the-ses-adjusted-results" class="nav-link" data-scroll-target="#visualizing-the-ses-adjusted-results"><span class="header-section-number">12.1.3</span> Visualizing the SES-Adjusted Results</a></li>
  </ul>
</li>
  <li>
<a href="#sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018" id="toc-sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018" class="nav-link" data-scroll-target="#sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018"><span class="header-section-number">12.2</span> Sensitivity Analysis 2: Effect Modification by Race/Ethnicity (2011-2018)</a>
  <ul class="collapse">
<li><a href="#data-reprocessing-for-the-2011-2018-sub-period" id="toc-data-reprocessing-for-the-2011-2018-sub-period" class="nav-link" data-scroll-target="#data-reprocessing-for-the-2011-2018-sub-period"><span class="header-section-number">12.2.1</span> Data Reprocessing for the 2011-2018 Sub-period</a></li>
  <li><a href="#analysis-of-the-2011-2018-sub-period" id="toc-analysis-of-the-2011-2018-sub-period" class="nav-link" data-scroll-target="#analysis-of-the-2011-2018-sub-period"><span class="header-section-number">12.2.2</span> Analysis of the 2011-2018 Sub-period</a></li>
  <li><a href="#visualizing-the-sub-period-results" id="toc-visualizing-the-sub-period-results" class="nav-link" data-scroll-target="#visualizing-the-sub-period-results"><span class="header-section-number">12.2.3</span> Visualizing the Sub-period Results</a></li>
  </ul>
</li>
  <li>
<a href="#appendix-b-exploratory-analysis-of-smoking-duration" id="toc-appendix-b-exploratory-analysis-of-smoking-duration" class="nav-link" data-scroll-target="#appendix-b-exploratory-analysis-of-smoking-duration"><span class="header-section-number">12.3</span> Appendix B: Exploratory Analysis of Smoking Duration</a>
  <ul class="collapse">
<li><a href="#data-preparation-for-duration-plots" id="toc-data-preparation-for-duration-plots" class="nav-link" data-scroll-target="#data-preparation-for-duration-plots"><span class="header-section-number">12.3.1</span> Data Preparation for Duration Plots</a></li>
  <li><a href="#visualizing-smoking-duration-by-initiation-age" id="toc-visualizing-smoking-duration-by-initiation-age" class="nav-link" data-scroll-target="#visualizing-smoking-duration-by-initiation-age"><span class="header-section-number">12.3.2</span> Visualizing Smoking Duration by Initiation Age</a></li>
  <li><a href="#interpretation-of-results" id="toc-interpretation-of-results" class="nav-link" data-scroll-target="#interpretation-of-results"><span class="header-section-number">12.3.3</span> Interpretation of Results</a></li>
  </ul>
</li>
  <li><a href="#chapter-summary-and-next-steps" id="toc-chapter-summary-and-next-steps" class="nav-link" data-scroll-target="#chapter-summary-and-next-steps"><span class="header-section-number">12.4</span> Chapter Summary and Next Steps</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sensitivity Analyses</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><hr>
<p>This chapter presents several analyses conducted to further assess and understand the primary findings regarding association between early-smoking initiation and mortality. It includes two sensitivity analyses and one exploratory analysis of a potential mediator.</p>
<ul>
<li><p><strong>Adjustment for Socioeconomic Status (SES) Proxies:</strong> This analysis investigates whether the observed associations are substantially influenced by socioeconomic factors. This is achieved by adjusting for additional variables, such as family poverty income ratio (PIR), which compares household income to the poverty threshold adjusted for household size and composition (NHANES variable INDFMPIR) , and the education level of the household head (NHANES variable DMDHREDU). These variables serve as proxies for family socioeconomic status.</p></li>
<li><p><strong>Effect Modification by Race/Ethnicity (2011-2018):</strong> This analysis examines how findings might vary when considering the “non-Hispanic Asian” racial classification, which was introduced in the 2011 survey cycle. It focuses on effect modification by race/ethnicity within the survey cycles spanning 2011 to 2018, which incorporate the Asian race/ethnicity category.</p></li>
<li><p><strong>Exploratory Analysis of Smoking Duration:</strong> This analysis investigates the relationship between the age of smoking initiation and the total duration of smoking, a potential mediator in the pathway to mortality.</p></li>
</ul>
<p>The key methods and the paper figures/tables they reproduce are summarized below:</p>
<table class="table">
<thead><tr class="header">
<th style="text-align: left;">Analysis</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Key Method</th>
<th style="text-align: left;">Reproduces</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Adjustment for SES Proxies</strong></td>
<td style="text-align: left;">To test if the main findings are robust to confounding by socioeconomic status.</td>
<td style="text-align: left;">Added <code>pir</code> (income) and <code>HHedu</code> (education) as covariates to the adjusted Cox model.</td>
<td style="text-align: left;"><a href="10-sensitivity-analysis.html#visualizing-the-ses-adjusted-results"><strong>Appendix Figure 5</strong></a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Effect Modification by Race (2011-2018)</strong></td>
<td style="text-align: left;">To specifically investigate the association within the non-Hispanic Asian population.</td>
<td style="text-align: left;">Subset the data to the 2011-2018 cycles and included the <code>race2</code> variable (with the ‘Asian’ category) in the effect modification model.</td>
<td style="text-align: left;">
<a href="10-sensitivity-analysis.html#analysis-of-the-2011-2018-sub-period"><strong>Appendix Table 3</strong></a> and <a href="10-sensitivity-analysis.html#visualizing-the-sub-period-results"><strong>Appendix Figure 4</strong></a>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Smoking Duration</strong></td>
<td style="text-align: left;">Explore if earlier initiation is linked to longer smoking duration.</td>
<td style="text-align: left;">Create boxplots of smoking duration stratified by initiation age.</td>
<td style="text-align: left;"><a href="10-sensitivity-analysis.html#visualizing-smoking-duration-by-initiation-age"><strong>Appendix Figures 1-3</strong></a></td>
</tr>
</tbody>
</table>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/libraries_56b0c07a4f7e25883a9db223a5f537a6">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(car)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(plyr)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(tableone)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(Publish)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">options</span>(<span class="at">survey.want.obsolete=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">require</span>(knitr)</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">require</span>(kableExtra)</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">require</span>(stringr) </span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">library</span>(ggplot2) </span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(expss) </span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu">library</span>(readxl) </span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="fu">library</span>(nhanesA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sensitivity-analysis-1-adjustment-for-ses-proxies" class="level2" data-number="12.1"><h2 data-number="12.1" class="anchored" data-anchor-id="sensitivity-analysis-1-adjustment-for-ses-proxies">
<span class="header-section-number">12.1</span> Sensitivity Analysis 1: Adjustment for SES Proxies</h2>
<section id="data-reprocessing-with-ses-variables" class="level3" data-number="12.1.1"><h3 data-number="12.1.1" class="anchored" data-anchor-id="data-reprocessing-with-ses-variables">
<span class="header-section-number">12.1.1</span> Data Reprocessing with SES Variables</h3>
<p>Our primary analysis did not include socioeconomic status (SES) variables because they had a high number of missing values. To ensure these factors were not confounding our results, we performed this sensitivity analysis. This required reprocessing the raw NHANES data to create a new dataset that includes the following 2 variables as well:</p>
<p>Demographics:</p>
<ul>
<li><strong>“INDFMPIR”: Ratio of family income to poverty (family SES)</strong></li>
<li><strong>“DMDHREDU”: Education level of the household head (family SES)</strong></li>
</ul>
<hr>
<ul>
<li>R Code Chunk 1: Data Reprocessing and Cleaning with SES Variables</li>
</ul>
<p>The code steps for data downloading, cleaning, and merging are nearly identical to the process in main analysis. The key new data preparation steps for this sensitivity analysis are the cleaning of the two SES proxy variables, pir and HHedu.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/load_2b5ed0ebd98b7c2acaa629ec1bd7e6b7">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># File Names</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>demo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DEMO"</span>, <span class="st">"DEMO_B"</span>, <span class="st">"DEMO_C"</span>, <span class="st">"DEMO_D"</span>, <span class="st">"DEMO_E"</span>, </span>
<span id="cb2-3"><a href="#cb2-3"></a>          <span class="st">"DEMO_F"</span>, <span class="st">"DEMO_G"</span>, <span class="st">"DEMO_H"</span>, <span class="st">"DEMO_I"</span>, <span class="st">"DEMO_J"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>smoking <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SMQ"</span>, <span class="st">"SMQ_B"</span>, <span class="st">"SMQ_C"</span>, <span class="st">"SMQ_D"</span>, <span class="st">"SMQ_E"</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>             <span class="st">"SMQ_F"</span>, <span class="st">"SMQ_G"</span>, <span class="st">"SMQ_H"</span>, <span class="st">"SMQ_I"</span>, <span class="st">"SMQ_J"</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># 10 Data Files</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>demo_data_files <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/demo_data_files.rds"</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a>smoking_data_files <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/smoking_data_files.rds"</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co"># Set Columns</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>demo_columns <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"SEQN"</span>, <span class="st">"RIDAGEYR"</span>, <span class="st">"RIAGENDR"</span>, <span class="st">"RIDRETH1"</span>,</span>
<span id="cb2-13"><a href="#cb2-13"></a>                   <span class="st">"INDFMPIR"</span>, <span class="st">"DMDHREDU"</span>, <span class="st">"DMDHREDZ"</span>, <span class="co"># *** these are new</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>                   <span class="st">"DMDBORN"</span>, <span class="st">"DMDBORN2"</span>, <span class="st">"DMDBORN4"</span>, <span class="st">"SDDSRVYR"</span>, </span>
<span id="cb2-15"><a href="#cb2-15"></a>                   <span class="st">"WTINT2YR"</span>, <span class="st">"WTMEC2YR"</span>, <span class="st">"SDMVPSU"</span>, <span class="st">"SDMVSTRA"</span>)</span>
<span id="cb2-16"><a href="#cb2-16"></a>smoking_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>, <span class="st">"SMQ020"</span>, <span class="st">"SMD030"</span>, <span class="st">"SMQ040"</span>, <span class="st">"SMD055"</span>)</span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co"># DEMOGRAPHICS</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>demo_data_files_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(demo_data_files), <span class="cf">function</span>(i) </span>
<span id="cb2-21"><a href="#cb2-21"></a>  {</span>
<span id="cb2-22"><a href="#cb2-22"></a>  current_cycle_data <span class="ot">&lt;-</span> demo_data_files[[i]]</span>
<span id="cb2-23"><a href="#cb2-23"></a>  original <span class="ot">&lt;-</span> demo[i] </span>
<span id="cb2-24"><a href="#cb2-24"></a>  </span>
<span id="cb2-25"><a href="#cb2-25"></a>  <span class="co"># Select Columns</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>  subset_data <span class="ot">&lt;-</span> current_cycle_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-27"><a href="#cb2-27"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">any_of</span>(demo_columns))</span>
<span id="cb2-28"><a href="#cb2-28"></a>  <span class="co"># Translate </span></span>
<span id="cb2-29"><a href="#cb2-29"></a>  translated_data <span class="ot">&lt;-</span> <span class="fu">nhanesTranslate</span>(original,</span>
<span id="cb2-30"><a href="#cb2-30"></a>                                     <span class="fu">names</span>(subset_data), </span>
<span id="cb2-31"><a href="#cb2-31"></a>                                     <span class="at">data =</span> subset_data)</span>
<span id="cb2-32"><a href="#cb2-32"></a>  <span class="co"># Return</span></span>
<span id="cb2-33"><a href="#cb2-33"></a>  <span class="fu">return</span>(translated_data) </span>
<span id="cb2-34"><a href="#cb2-34"></a>})</span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN2 SDDSRVYR</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN2 SDDSRVYR</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN4 SDDSRVYR</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN4 SDDSRVYR</span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN4 SDDSRVYR</span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDZ DMDBORN4 SDDSRVYR</span></span>
<span id="cb2-45"><a href="#cb2-45"></a></span>
<span id="cb2-46"><a href="#cb2-46"></a></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="co"># SMOKING</span></span>
<span id="cb2-48"><a href="#cb2-48"></a>smoking_data_files_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(smoking_data_files), <span class="cf">function</span>(i) </span>
<span id="cb2-49"><a href="#cb2-49"></a>  {</span>
<span id="cb2-50"><a href="#cb2-50"></a>  current_cycle_data <span class="ot">&lt;-</span> smoking_data_files[[i]]</span>
<span id="cb2-51"><a href="#cb2-51"></a>  original <span class="ot">&lt;-</span> smoking[i]</span>
<span id="cb2-52"><a href="#cb2-52"></a></span>
<span id="cb2-53"><a href="#cb2-53"></a>  <span class="co"># Select Columns</span></span>
<span id="cb2-54"><a href="#cb2-54"></a>  subset_data <span class="ot">&lt;-</span> current_cycle_data <span class="sc">%&gt;%</span></span>
<span id="cb2-55"><a href="#cb2-55"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">any_of</span>(smoking_columns))</span>
<span id="cb2-56"><a href="#cb2-56"></a>  <span class="co"># Translate</span></span>
<span id="cb2-57"><a href="#cb2-57"></a>  translated_data <span class="ot">&lt;-</span> <span class="fu">nhanesTranslate</span>(original, </span>
<span id="cb2-58"><a href="#cb2-58"></a>                                     <span class="fu">names</span>(subset_data), </span>
<span id="cb2-59"><a href="#cb2-59"></a>                                     <span class="at">data =</span> subset_data)</span>
<span id="cb2-60"><a href="#cb2-60"></a>  <span class="co"># Return</span></span>
<span id="cb2-61"><a href="#cb2-61"></a>  <span class="fu">return</span>(translated_data)</span>
<span id="cb2-62"><a href="#cb2-62"></a>})</span>
<span id="cb2-63"><a href="#cb2-63"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-64"><a href="#cb2-64"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-65"><a href="#cb2-65"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-66"><a href="#cb2-66"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-67"><a href="#cb2-67"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-68"><a href="#cb2-68"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-69"><a href="#cb2-69"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-70"><a href="#cb2-70"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-71"><a href="#cb2-71"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-72"><a href="#cb2-72"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb2-73"><a href="#cb2-73"></a></span>
<span id="cb2-74"><a href="#cb2-74"></a></span>
<span id="cb2-75"><a href="#cb2-75"></a><span class="co"># MERGE</span></span>
<span id="cb2-76"><a href="#cb2-76"></a>data_all <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(demo_data_files_2), <span class="cf">function</span>(i) {</span>
<span id="cb2-77"><a href="#cb2-77"></a>  demo_df <span class="ot">&lt;-</span> demo_data_files_2[[i]]</span>
<span id="cb2-78"><a href="#cb2-78"></a>  smoking_df <span class="ot">&lt;-</span> smoking_data_files_2[[i]]</span>
<span id="cb2-79"><a href="#cb2-79"></a>  </span>
<span id="cb2-80"><a href="#cb2-80"></a>  <span class="co"># Merge by SEQN</span></span>
<span id="cb2-81"><a href="#cb2-81"></a>  merged_df <span class="ot">&lt;-</span> <span class="fu">join_all</span>(<span class="fu">list</span>(demo_df, smoking_df), </span>
<span id="cb2-82"><a href="#cb2-82"></a>                        <span class="at">by =</span> <span class="st">"SEQN"</span>, </span>
<span id="cb2-83"><a href="#cb2-83"></a>                        <span class="at">type =</span> <span class="st">'full'</span>)</span>
<span id="cb2-84"><a href="#cb2-84"></a>  <span class="fu">return</span>(merged_df)</span>
<span id="cb2-85"><a href="#cb2-85"></a>})</span>
<span id="cb2-86"><a href="#cb2-86"></a></span>
<span id="cb2-87"><a href="#cb2-87"></a></span>
<span id="cb2-88"><a href="#cb2-88"></a><span class="co"># Rename </span></span>
<span id="cb2-89"><a href="#cb2-89"></a>data_all2 <span class="ot">&lt;-</span> data_all</span>
<span id="cb2-90"><a href="#cb2-90"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb2-91"><a href="#cb2-91"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(data_all2[[i]])</span>
<span id="cb2-92"><a href="#cb2-92"></a></span>
<span id="cb2-93"><a href="#cb2-93"></a>  <span class="cf">if</span> (<span class="st">"DMDBORN2"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb2-94"><a href="#cb2-94"></a>    <span class="fu">names</span>(df)[<span class="fu">names</span>(df) <span class="sc">==</span> <span class="st">"DMDBORN2"</span>] <span class="ot">&lt;-</span> <span class="st">"DMDBORN"</span></span>
<span id="cb2-95"><a href="#cb2-95"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"DMDBORN4"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb2-96"><a href="#cb2-96"></a>    <span class="fu">names</span>(df)[<span class="fu">names</span>(df) <span class="sc">==</span> <span class="st">"DMDBORN4"</span>] <span class="ot">&lt;-</span> <span class="st">"DMDBORN"</span></span>
<span id="cb2-97"><a href="#cb2-97"></a>  }</span>
<span id="cb2-98"><a href="#cb2-98"></a>  data_all2[[i]] <span class="ot">&lt;-</span> df</span>
<span id="cb2-99"><a href="#cb2-99"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/cleaning_eba67e9edcfe7607142cb4f0bfd5df3b">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="co"># Set Data</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb3-5"><a href="#cb3-5"></a>  </span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="do">## ID</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  dat2<span class="sc">$</span>id <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SEQN</span>
<span id="cb3-8"><a href="#cb3-8"></a>  </span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="do">## Demographic</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="do">### Age (for eligibility)</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>  dat2<span class="sc">$</span>age <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIDAGEYR</span>
<span id="cb3-12"><a href="#cb3-12"></a>  </span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="do">### Sex</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>  dat2<span class="sc">$</span>sex <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIAGENDR</span>
<span id="cb3-15"><a href="#cb3-15"></a>  </span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="do">### Race/Ethnicity</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>  dat2<span class="sc">$</span>race <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIDRETH1</span>
<span id="cb3-18"><a href="#cb3-18"></a>  dat2<span class="sc">$</span>race <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>race, <span class="at">recodes =</span> <span class="st">"</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="st">    'Non-Hispanic White'='White';</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="st">    'Non-Hispanic Black'='Black';</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="st">    c('Mexican American','Other Hispanic')='Hispanic';</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="st">    else='Others'"</span>)</span>
<span id="cb3-23"><a href="#cb3-23"></a>  dat2<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>race, </span>
<span id="cb3-24"><a href="#cb3-24"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Hispanic"</span>, <span class="st">"Others"</span>))</span>
<span id="cb3-25"><a href="#cb3-25"></a>  </span>
<span id="cb3-26"><a href="#cb3-26"></a>    <span class="do">### Country of birth</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>  dat2<span class="sc">$</span>born <span class="ot">&lt;-</span> dat2<span class="sc">$</span>DMDBORN</span>
<span id="cb3-28"><a href="#cb3-28"></a>  dat2<span class="sc">$</span>born <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>born, <span class="at">recodes =</span> <span class="st">"</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="st">    c('Born in Mexico','Born Elsewhere', 'Others') = 'Other place';</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="st">    c('Born in 50 US States or Washington, DC', 'Born in 50 US states or Washington, DC') = 'Born in US';</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="st">    else = NA"</span>)</span>
<span id="cb3-32"><a href="#cb3-32"></a>  dat2<span class="sc">$</span>born <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>born, </span>
<span id="cb3-33"><a href="#cb3-33"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Born in US"</span>, <span class="st">"Other place"</span>))</span>
<span id="cb3-34"><a href="#cb3-34"></a>  </span>
<span id="cb3-35"><a href="#cb3-35"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb3-36"><a href="#cb3-36"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Poverty Income Ratio:</strong> The poverty income ratio (INDFMPIR) is provided as a continuous variable. To make it easier to use in our models, the following code uses the <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> function to categorize the numeric ratio into five distinct, interpretable groups, from “Below Poverty Line” to “High Income.”</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/PIR_d331401f5829808793fb5e3775b92325">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="co"># Set Data</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb4-4"><a href="#cb4-4"></a>  </span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="co"># Set Poverty Income Ratio</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  dat2<span class="sc">$</span>pir <span class="ot">&lt;-</span> dat2<span class="sc">$</span>INDFMPIR</span>
<span id="cb4-7"><a href="#cb4-7"></a>  </span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="co"># Cut into five distinct groups</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  dat2<span class="sc">$</span>pir <span class="ot">&lt;-</span> <span class="fu">cut</span>(dat2<span class="sc">$</span>pir,</span>
<span id="cb4-10"><a href="#cb4-10"></a>                  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">1</span>, <span class="fl">1.99</span>, <span class="fl">3.99</span>, <span class="fl">4.99</span>, <span class="cn">Inf</span>),</span>
<span id="cb4-11"><a href="#cb4-11"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Below Poverty Line"</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>                             <span class="st">"Near Poverty Line"</span>,</span>
<span id="cb4-13"><a href="#cb4-13"></a>                             <span class="st">"Low to Middle Income"</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a>                             <span class="st">"Middle to High Income"</span>,</span>
<span id="cb4-15"><a href="#cb4-15"></a>                             <span class="st">"High Income"</span>),</span>
<span id="cb4-16"><a href="#cb4-16"></a>                  <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-17"><a href="#cb4-17"></a>  </span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="co"># Return</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb4-20"><a href="#cb4-20"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Household Head Education Level:</strong> The coding for household head education also changes over the survey years, with the 2017-2018 cycle using a different variable name (DMDHREDZ) and different text labels. The code below uses an if-else statement to handle this inconsistency. It applies one set of recoding rules for the first nine cycles and a different set for the final 2017-2018 cycle, ensuring the final HHedu variable is harmonized across all datasets.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/edu_39c53589333754e4900f3eba43593bb8">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="co"># Set Data</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb5-5"><a href="#cb5-5"></a>  </span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="co"># Set Education Level of the Household Head</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="co"># Now, use case_when() for robust recoding</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  dat2<span class="sc">$</span>HHedu <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>    dat2<span class="sc">$</span>DMDHREDU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Less Than 9th Grade"</span>, <span class="st">"9-11th Grade (Includes 12th grade with no diploma)"</span>, <span class="st">"Less than high school degree"</span>) <span class="sc">~</span> <span class="st">"Less than high school"</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>    dat2<span class="sc">$</span>DMDHREDU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"High School Grad/GED or equivalent"</span>, <span class="st">"Some College or AA degree"</span>, <span class="st">"High school grad/GED or some col"</span>) <span class="sc">~</span> <span class="st">"High school or college"</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>    dat2<span class="sc">$</span>DMDHREDU <span class="sc">==</span> <span class="st">"College Graduate or above"</span> <span class="sc">~</span> <span class="st">"College graduate or above"</span>,</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span> <span class="co"># This handles "Refused", "Don't know", and any other non-matches</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>    )</span>
<span id="cb5-14"><a href="#cb5-14"></a>  </span>
<span id="cb5-15"><a href="#cb5-15"></a>  <span class="co"># Convert to a factor with the correct levels</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>  dat2<span class="sc">$</span>HHedu <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>HHedu, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Less than high school'</span>,</span>
<span id="cb5-17"><a href="#cb5-17"></a>                                              <span class="st">'High school or college'</span>, </span>
<span id="cb5-18"><a href="#cb5-18"></a>                                              <span class="st">'College graduate or above'</span>))</span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="co"># Return</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb5-21"><a href="#cb5-21"></a>  }</span>
<span id="cb5-22"><a href="#cb5-22"></a>  </span>
<span id="cb5-23"><a href="#cb5-23"></a>  <span class="co"># For the 10th dataset (2017-2018)</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>  <span class="cf">else</span> { </span>
<span id="cb5-25"><a href="#cb5-25"></a>    dat2<span class="sc">$</span>HHedu <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dat2<span class="sc">$</span>DMDHREDZ)</span>
<span id="cb5-26"><a href="#cb5-26"></a>    dat2<span class="sc">$</span>HHedu <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>HHedu,</span>
<span id="cb5-27"><a href="#cb5-27"></a>                         <span class="st">`</span><span class="at">Less than high school degree</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'Less than high school'</span>,</span>
<span id="cb5-28"><a href="#cb5-28"></a>                         <span class="st">`</span><span class="at">High school grad/GED or some college/AA degree</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'High school or college'</span>,</span>
<span id="cb5-29"><a href="#cb5-29"></a>                         <span class="st">`</span><span class="at">College graduate or above</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'College graduate or above'</span>,</span>
<span id="cb5-30"><a href="#cb5-30"></a>                         <span class="at">.default =</span> <span class="cn">NA_character_</span> </span>
<span id="cb5-31"><a href="#cb5-31"></a>                         <span class="co">#`Refused` = NA_character_,</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>                         <span class="co">#`Don't know` = NA_character_</span></span>
<span id="cb5-33"><a href="#cb5-33"></a>                         )</span>
<span id="cb5-34"><a href="#cb5-34"></a>    dat2<span class="sc">$</span>HHedu <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>HHedu, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Less than high school'</span>,</span>
<span id="cb5-35"><a href="#cb5-35"></a>                                                <span class="st">'High school or college'</span>,</span>
<span id="cb5-36"><a href="#cb5-36"></a>                                                <span class="st">'College graduate or above'</span>))</span>
<span id="cb5-37"><a href="#cb5-37"></a>    </span>
<span id="cb5-38"><a href="#cb5-38"></a>    <span class="co"># Return</span></span>
<span id="cb5-39"><a href="#cb5-39"></a>    data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb5-40"><a href="#cb5-40"></a>    }</span>
<span id="cb5-41"><a href="#cb5-41"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/cleaning2_bac9a932c15ce3f616ccee0e6ed1f642">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Remaining Variables</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="co"># Set Data</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="do">## Smoking</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="do">### Status</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  dat2<span class="sc">$</span>smoking <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SMQ020</span>
<span id="cb6-9"><a href="#cb6-9"></a>  dat2<span class="sc">$</span>smoking <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>smoking, <span class="st">" 'Yes' = 'Current smoker'; 'No' = 'Never smoker'; else=NA  "</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a>  dat2<span class="sc">$</span>smoking <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>smoking, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never smoker"</span>, <span class="st">"Previous smoker"</span>, <span class="st">"Current smoker"</span>))</span>
<span id="cb6-11"><a href="#cb6-11"></a>  dat2<span class="sc">$</span>smoking[dat2<span class="sc">$</span>SMQ040 <span class="sc">==</span> <span class="st">"Not at all?"</span> <span class="sc">|</span> dat2<span class="sc">$</span>SMQ040 <span class="sc">==</span> <span class="st">"Not at all"</span>] <span class="ot">&lt;-</span> <span class="st">"Previous smoker"</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  </span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="do">### Age smoking started</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  dat2<span class="sc">$</span>smoking.age <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SMD030</span>
<span id="cb6-15"><a href="#cb6-15"></a>  dat2<span class="sc">$</span>smoking.age[dat2<span class="sc">$</span>smoking.age <span class="sc">==</span> <span class="dv">777</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>  dat2<span class="sc">$</span>smoking.age[dat2<span class="sc">$</span>smoking.age <span class="sc">==</span> <span class="dv">999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>  dat2<span class="sc">$</span>smoking.age[dat2<span class="sc">$</span>smoking <span class="sc">==</span> <span class="st">"Never smoker"</span>] <span class="ot">&lt;-</span> <span class="dv">99</span> <span class="co"># 99 means never smoker</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  </span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="do">### Whether smoking started age of 15 or before</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>  dat2<span class="sc">$</span>smoked.while.child <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>smoking.age, <span class="st">" 0 = 'No'; 1:15 = 'Yes'; else = NA "</span>, <span class="at">as.factor =</span> T)</span>
<span id="cb6-21"><a href="#cb6-21"></a>  </span>
<span id="cb6-22"><a href="#cb6-22"></a>  <span class="do">## Survey features</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>    <span class="do">### Weight</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>  dat2<span class="sc">$</span>survey.weight <span class="ot">&lt;-</span> dat2<span class="sc">$</span>WTINT2YR <span class="co">#WTMEC2YR # MEC weights</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>  </span>
<span id="cb6-26"><a href="#cb6-26"></a>    <span class="do">### PSU </span></span>
<span id="cb6-27"><a href="#cb6-27"></a>  dat2<span class="sc">$</span>psu <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat2<span class="sc">$</span>SDMVPSU)</span>
<span id="cb6-28"><a href="#cb6-28"></a>  </span>
<span id="cb6-29"><a href="#cb6-29"></a>    <span class="do">### Strata</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>  dat2<span class="sc">$</span>strata <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat2<span class="sc">$</span>SDMVSTRA)</span>
<span id="cb6-31"><a href="#cb6-31"></a>  </span>
<span id="cb6-32"><a href="#cb6-32"></a>  <span class="do">## Survey year</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>  dat2<span class="sc">$</span>year <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SDDSRVYR</span>
<span id="cb6-34"><a href="#cb6-34"></a>  </span>
<span id="cb6-35"><a href="#cb6-35"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb6-36"><a href="#cb6-36"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>NOTE:</strong> The following code chunk recodes the variable, <code>SMD055</code>, which stands for the age cigarettes were last smoked regularly. This variable is not available for the cycle 2017-2018, thus it is set as <code>NA</code>. This part is essential for the plots in section <a href="10-sensitivity-analysis.html#appendix-b-exploratory-analysis-of-smoking-duration">12.3 Appendix B: Exploratory Analysis of Smoking Duration</a> below.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/smoking.quit.age_cff7570be9195331ff9ebf206138b9ad">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="co"># Set Data</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="do">### Age smoking quit</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    dat2<span class="sc">$</span>smoking.quit.age <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SMD055</span>
<span id="cb7-7"><a href="#cb7-7"></a>    dat2<span class="sc">$</span>smoking.quit.age[dat2<span class="sc">$</span>smoking.quit.age <span class="sc">==</span> <span class="dv">777</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>    dat2<span class="sc">$</span>smoking.quit.age[dat2<span class="sc">$</span>smoking.quit.age <span class="sc">==</span> <span class="dv">999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  }</span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="cf">else</span> {</span>
<span id="cb7-11"><a href="#cb7-11"></a>    dat2<span class="sc">$</span>smoking.quit.age <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb7-14"><a href="#cb7-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 2: Save New Files</li>
</ul>
<p>After the same remaining data processing steps are taken, theses 10 new files are also saved with the selected variables saved in <code>vars</code>.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/save_85b3bbd7db490220217fac9891fb11cb">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>nhanes_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nhanes00"</span>, <span class="st">"nhanes01"</span>, <span class="st">"nhanes03"</span>, <span class="st">"nhanes05"</span>, </span>
<span id="cb8-2"><a href="#cb8-2"></a>                <span class="st">"nhanes07"</span>, <span class="st">"nhanes09"</span>, <span class="st">"nhanes11"</span>, </span>
<span id="cb8-3"><a href="#cb8-3"></a>                <span class="st">"nhanes13"</span>, <span class="st">"nhanes15"</span>, <span class="st">"nhanes17"</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"race"</span>, <span class="st">"born"</span>, <span class="st">"pir"</span>, <span class="st">"HHedu"</span>, </span>
<span id="cb8-6"><a href="#cb8-6"></a>          <span class="st">"smoking.age"</span>, <span class="st">"smoking.quit.age"</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>          <span class="st">"smoked.while.child"</span>, <span class="st">"smoking"</span>,</span>
<span id="cb8-8"><a href="#cb8-8"></a>          <span class="st">"survey.weight"</span>, <span class="st">"psu"</span>, <span class="st">"strata"</span>, <span class="st">"year"</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a>cycle_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1999-2000"</span>, <span class="st">"2001-2002"</span>, <span class="st">"2003-2004"</span>, <span class="st">"2005-2006"</span>, <span class="st">"2007-2008"</span>, </span>
<span id="cb8-12"><a href="#cb8-12"></a>                 <span class="st">"2009-2010"</span>, <span class="st">"2011-2012"</span>, <span class="st">"2013-2014"</span>, <span class="st">"2015-2016"</span>, <span class="st">"2017-2018"</span>)</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb8-15"><a href="#cb8-15"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb8-16"><a href="#cb8-16"></a>  </span>
<span id="cb8-17"><a href="#cb8-17"></a>  nhanes_i <span class="ot">&lt;-</span> nhanes_all[i]</span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="fu">assign</span>(nhanes_i, dat2[, vars], <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb8-19"><a href="#cb8-19"></a>  </span>
<span id="cb8-20"><a href="#cb8-20"></a>  analytic <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">get</span>(nhanes_i), age <span class="sc">&gt;=</span> <span class="dv">20</span>)</span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="fu">cat</span>(<span class="st">"Processing:"</span>, nhanes_i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">print</span>(<span class="fu">dim</span>(analytic))</span>
<span id="cb8-23"><a href="#cb8-23"></a>  </span>
<span id="cb8-24"><a href="#cb8-24"></a>  analytic_i <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"analytic"</span>, <span class="fu">substr</span>(nhanes_i, <span class="dv">7</span>, <span class="dv">8</span>))</span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="fu">assign</span>(analytic_i, analytic, <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb8-26"><a href="#cb8-26"></a>  </span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="co"># Create 'data2' directory if it does not exist</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">"data2"</span>)) {</span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="fu">dir.create</span>(<span class="st">"data2"</span>)</span>
<span id="cb8-30"><a href="#cb8-30"></a>  }</span>
<span id="cb8-31"><a href="#cb8-31"></a></span>
<span id="cb8-32"><a href="#cb8-32"></a>  <span class="co"># Save</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>  <span class="fu">save</span>(<span class="at">list =</span> <span class="fu">c</span>(nhanes_i, analytic_i),</span>
<span id="cb8-34"><a href="#cb8-34"></a>       <span class="at">file =</span> <span class="fu">file.path</span>(<span class="st">"data2"</span>, <span class="fu">paste0</span>(analytic_i, <span class="st">".RData"</span>)))</span>
<span id="cb8-35"><a href="#cb8-35"></a>}</span>
<span id="cb8-36"><a href="#cb8-36"></a></span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="co"># Bind all</span></span>
<span id="cb8-38"><a href="#cb8-38"></a>dat.full <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes00, nhanes01, nhanes03,</span>
<span id="cb8-39"><a href="#cb8-39"></a>                  nhanes05, nhanes07, nhanes09,</span>
<span id="cb8-40"><a href="#cb8-40"></a>                  nhanes11, nhanes13, nhanes15, </span>
<span id="cb8-41"><a href="#cb8-41"></a>                  nhanes17)</span>
<span id="cb8-42"><a href="#cb8-42"></a></span>
<span id="cb8-43"><a href="#cb8-43"></a><span class="co"># Corrected weights</span></span>
<span id="cb8-44"><a href="#cb8-44"></a>dat.full<span class="sc">$</span>survey.weight.new <span class="ot">&lt;-</span> dat.full<span class="sc">$</span>survey.weight<span class="sc">/</span><span class="fu">length</span>(<span class="fu">unique</span>(dat.full<span class="sc">$</span>year))</span>
<span id="cb8-45"><a href="#cb8-45"></a>dat.full<span class="sc">$</span>survey.weight <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="fu">names</span>(dat.full)</span>
<span id="cb8-47"><a href="#cb8-47"></a><span class="fu">dim</span>(dat.full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/loadMort_82962f005f4199f582520115cfbacdc9">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Mortality Data</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>mort2000 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2000.RData"</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>mort2001 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2001.RData"</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>mort2003 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2003.RData"</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a>mort2005 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2005.RData"</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>mort2007 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2007.RData"</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a>mort2009 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2009.RData"</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a>mort2011 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2011.RData"</span>)</span>
<span id="cb9-9"><a href="#cb9-9"></a>mort2013 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2013.RData"</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a>mort2015 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2015.RData"</span>)</span>
<span id="cb9-11"><a href="#cb9-11"></a>mort2017 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2017.RData"</span>)</span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co"># Merge</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>dat.mortality <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mort2000, mort2001, mort2003,</span>
<span id="cb9-15"><a href="#cb9-15"></a>                       mort2005, mort2007, mort2009, </span>
<span id="cb9-16"><a href="#cb9-16"></a>                       mort2011, mort2013, mort2015, </span>
<span id="cb9-17"><a href="#cb9-17"></a>                       mort2017)</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="fu">table</span>(dat.mortality<span class="sc">$</span>mort_eligstat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb9-19"><a href="#cb9-19"></a></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co"># Merging analytic and mortality data</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>dat.full.with.mortality <span class="ot">&lt;-</span> <span class="fu">merge</span>(dat.full, dat.mortality, <span class="at">by =</span> <span class="st">"id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="fu">dim</span>(dat.full.with.mortality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/recoding_f9fd862fea13ca70a872878651fe90c2">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Recoding</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>dat.full.with.mortality<span class="sc">$</span>exposure.cat <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat.full.with.mortality<span class="sc">$</span>smoking.age, <span class="st">" </span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">                                                    c(0,99) = 'Never smoked'; </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">                                                    1:9 = 'Started before 10';</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">                                                    10:14 = 'Started at 10-14';</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">                                                    15:17 = 'Started at 15-17';</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">                                                    18:20 = 'Started at 18-20';</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">                                                    21:80 = 'Started after 20';</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">                                                    else = NA "</span>, </span>
<span id="cb10-10"><a href="#cb10-10"></a>                                                    <span class="at">as.factor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-11"><a href="#cb10-11"></a>dat.full.with.mortality<span class="sc">$</span>exposure.cat <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat.full.with.mortality<span class="sc">$</span>exposure.cat, </span>
<span id="cb10-12"><a href="#cb10-12"></a>                                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never smoked"</span>,</span>
<span id="cb10-13"><a href="#cb10-13"></a>                                                          <span class="st">'Started before 10'</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a>                                                          <span class="st">'Started at 10-14'</span>,</span>
<span id="cb10-15"><a href="#cb10-15"></a>                                                          <span class="st">"Started at 15-17"</span>,</span>
<span id="cb10-16"><a href="#cb10-16"></a>                                                          <span class="st">"Started at 18-20"</span>,</span>
<span id="cb10-17"><a href="#cb10-17"></a>                                                          <span class="st">"Started after 20"</span>))</span>
<span id="cb10-18"><a href="#cb10-18"></a></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co"># Survival time - Person-Months of Follow-up from NHANES Interview date</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co"># changed to "Number of Person Months of Follow-up from NHANES Mobile Examination Center (MEC) date" from "Number of Person Months of Follow-up from NHANES interview date" as we are using MCQ data (not really changed it again!)</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.interview <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>mort_permth_int <span class="co"># mort_permth_exm </span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="sc">$</span>stime.since.interview) </span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">#&gt;     0.0    59.0   113.0   117.9   172.0   250.0   42252</span></span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co"># Age in month</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>dat.full.with.mortality<span class="sc">$</span>age.month <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>age <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="sc">$</span>age.month)</span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="co">#&gt;     0.0   120.0   288.0   373.5   624.0  1020.0</span></span>
<span id="cb10-31"><a href="#cb10-31"></a></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co"># Survival time - Person-Months of Follow-up from birth = birth to screening + screening to event/censor</span></span>
<span id="cb10-33"><a href="#cb10-33"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.birth <span class="ot">&lt;-</span> <span class="fu">with</span>(dat.full.with.mortality, age.month <span class="sc">+</span> stime.since.interview)</span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="co"># converted back to year so that KM plot is in years / HR results remain the same (added)</span></span>
<span id="cb10-35"><a href="#cb10-35"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.birth <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>stime.since.birth<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>dat.full.with.mortality<span class="sc">$</span>stime.since.birth[<span class="fu">is.na</span>(dat.full.with.mortality<span class="sc">$</span>stime.since.interview)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="sc">$</span>stime.since.birth)</span>
<span id="cb10-38"><a href="#cb10-38"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="co">#&gt;   19.08   41.50   57.17   57.56   72.92  105.67   42252</span></span>
<span id="cb10-40"><a href="#cb10-40"></a></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="co"># All-cause mortality status</span></span>
<span id="cb10-42"><a href="#cb10-42"></a>dat.full.with.mortality<span class="sc">$</span>status_all <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>mort_stat</span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="fu">table</span>(dat.full.with.mortality<span class="sc">$</span>status_all, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="co">#&gt; </span></span>
<span id="cb10-45"><a href="#cb10-45"></a><span class="co">#&gt;     0     1  &lt;NA&gt; </span></span>
<span id="cb10-46"><a href="#cb10-46"></a><span class="co">#&gt; 49815  9249 42252</span></span>
<span id="cb10-47"><a href="#cb10-47"></a></span>
<span id="cb10-48"><a href="#cb10-48"></a><span class="co"># Cause-specific mortality</span></span>
<span id="cb10-49"><a href="#cb10-49"></a>dat.full.with.mortality<span class="sc">$</span>mort_diabetes <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-50"><a href="#cb10-50"></a>dat.full.with.mortality<span class="sc">$</span>mort_hyperten <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-51"><a href="#cb10-51"></a>dat.full.with.mortality<span class="sc">$</span>mort_permth_int <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-52"><a href="#cb10-52"></a>dat.full.with.mortality<span class="sc">$</span>mort_permth_exm <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-53"><a href="#cb10-53"></a>dat.full.with.mortality<span class="sc">$</span>mort_ucod_leading <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-54"><a href="#cb10-54"></a>dat.full.with.mortality<span class="sc">$</span>mort_eligstat <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-55"><a href="#cb10-55"></a></span>
<span id="cb10-56"><a href="#cb10-56"></a><span class="co"># Recode year variable</span></span>
<span id="cb10-57"><a href="#cb10-57"></a>dat.full.with.mortality<span class="sc">$</span>year.cat <span class="ot">&lt;-</span> dat.full.with.mortality<span class="sc">$</span>year</span>
<span id="cb10-58"><a href="#cb10-58"></a></span>
<span id="cb10-59"><a href="#cb10-59"></a>new_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-60"><a href="#cb10-60"></a>  <span class="st">"1999-2000"</span>, <span class="st">"2001-2002"</span>, <span class="st">"2003-2004"</span>, <span class="st">"2005-2006"</span>, <span class="st">"2007-2008"</span>,</span>
<span id="cb10-61"><a href="#cb10-61"></a>  <span class="st">"2009-2010"</span>, <span class="st">"2011-2012"</span>, <span class="st">"2013-2014"</span>, <span class="st">"2015-2016"</span>, <span class="st">"2017-2018"</span></span>
<span id="cb10-62"><a href="#cb10-62"></a>)</span>
<span id="cb10-63"><a href="#cb10-63"></a><span class="fu">levels</span>(dat.full.with.mortality<span class="sc">$</span>year.cat) <span class="ot">&lt;-</span> new_levels</span>
<span id="cb10-64"><a href="#cb10-64"></a></span>
<span id="cb10-65"><a href="#cb10-65"></a><span class="co"># Display the unique levels of year.cat</span></span>
<span id="cb10-66"><a href="#cb10-66"></a><span class="fu">levels</span>(dat.full.with.mortality<span class="sc">$</span>year.cat)</span>
<span id="cb10-67"><a href="#cb10-67"></a><span class="co">#&gt;  [1] "1999-2000" "2001-2002" "2003-2004" "2005-2006" "2007-2008" "2009-2010"</span></span>
<span id="cb10-68"><a href="#cb10-68"></a><span class="co">#&gt;  [7] "2011-2012" "2013-2014" "2015-2016" "2017-2018"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/analyticSubset_6afb209c530abc539d6aac425aca361c">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Create the analytic subset</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>dat.full.with.mortality<span class="sc">$</span>smoked.while.child <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="do">### Analytic dataset - age 20 - 79</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>dat.analytic <span class="ot">&lt;-</span> <span class="fu">subset</span>(dat.full.with.mortality, age<span class="sc">&gt;=</span><span class="dv">20</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="fu">dim</span>(dat.full.with.mortality)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; [1] 101316     21</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="fu">dim</span>(dat.analytic)</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; [1] 50824    21</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="fu">dim</span>(dat.full.with.mortality)[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">dim</span>(dat.analytic)[<span class="dv">1</span>] <span class="co"># added</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; [1] 50492</span></span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co"># Drop variables that are not being used </span></span>
<span id="cb11-14"><a href="#cb11-14"></a>dat.analytic<span class="sc">$</span>stime.since.interview <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>dat.analytic<span class="sc">$</span>born <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>dat.analytic<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>dat.analytic<span class="sc">$</span>age.month <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-18"><a href="#cb11-18"></a></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="do">### Create a copy of the data for the smoking duration analysis later in the chapter</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>dat.analytic.duration.analysis <span class="ot">&lt;-</span> dat.analytic</span>
<span id="cb11-21"><a href="#cb11-21"></a></span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="co"># Drop quit related variables</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>dat.analytic<span class="sc">$</span>smoking.quit.age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 3: PIR and HHedu</li>
</ul>
<p>The following code gives a summary table of the two variables: poverty income ratio (PIR) and education level of the household head.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/summary_65880567ec53c5efd34c984addb48713">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">table</span>(dat.analytic<span class="sc">$</span>pir, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">#&gt; </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt;    Below Poverty Line     Near Poverty Line  Low to Middle Income </span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt;                  9720                 11890                 12281 </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt; Middle to High Income           High Income                  &lt;NA&gt; </span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt;                  3808                  8378                  4747</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="fu">table</span>(dat.analytic<span class="sc">$</span>HHedu, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt; </span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt;     Less than high school    High school or college College graduate or above </span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt;                     13009                     21704                     11048 </span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt;                      &lt;NA&gt; </span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt;                      5063</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 4: Accounting for Missing Data</li>
</ul>
<p>Before analysis, we must handle missing data. The following code perform a complete-case analysis by first removing participants with missing exposure (<code>exposure.cat</code>) or outcome (<code>stime.since.birth</code>) information. Then, any remaining missing values in the covariates are handled, and the number of participants dropped at each stage is calculated.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/handle-missing_fbf96c36d99785198112ce2215008055">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Sequentially remove participants with missing exposure or outcome</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>dat.analytic1 <span class="ot">&lt;-</span> dat.analytic[<span class="fu">complete.cases</span>(dat.analytic<span class="sc">$</span>stime.since.birth),]</span>
<span id="cb13-3"><a href="#cb13-3"></a>dat.analytic2 <span class="ot">&lt;-</span> dat.analytic1[<span class="fu">complete.cases</span>(dat.analytic1<span class="sc">$</span>exposure.cat),]</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co"># Create the final complete-case dataset by removing any other missing values</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>dat.complete <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat.analytic2)</span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="fu">dim</span>(dat.complete)</span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt; [1] 41671    16</span></span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co"># Report on participants dropped</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="fu">cat</span>(<span class="st">"Participants dropped due to missing exposure or outcome:"</span>, </span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="fu">nrow</span>(dat.analytic) <span class="sc">-</span> <span class="fu">nrow</span>(dat.analytic2), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt; Participants dropped due to missing exposure or outcome: 275</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="fu">cat</span>(<span class="st">"Participants dropped due to missing covariates:"</span>, </span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="fu">nrow</span>(dat.analytic2) <span class="sc">-</span> <span class="fu">nrow</span>(dat.complete), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt; Participants dropped due to missing covariates: 8878</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="fu">cat</span>(<span class="st">"Total participants dropped:"</span>,</span>
<span id="cb13-18"><a href="#cb13-18"></a>    <span class="fu">nrow</span>(dat.full.with.mortality) <span class="sc">-</span> <span class="fu">nrow</span>(dat.complete), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; Total participants dropped: 59645</span></span>
<span id="cb13-20"><a href="#cb13-20"></a></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co"># Overwrite dat.analytic2 to be the final complete dataset for analysis</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>dat.analytic2 <span class="ot">&lt;-</span> dat.complete</span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="fu">dim</span>(dat.analytic2)</span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt; [1] 41671    16</span></span>
<span id="cb13-25"><a href="#cb13-25"></a></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co"># Save</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="fu">save</span>(dat.full.with.mortality, dat.analytic2, <span class="at">file =</span> <span class="st">"data/SensAnalysis.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 5: Descriptive Statistics</li>
</ul>
<p>The following code creates a descriptive summary table of the final analytic sample using the <code>CreateTableOne</code> function. The table shows the distribution of the exposure, race, and sex, stratified by mortality status.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/table1_515be4c8ee10fb2b46a0608399b6adbf">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"exposure.cat"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span>), </span>
<span id="cb14-2"><a href="#cb14-2"></a>                       <span class="at">strata =</span> <span class="st">"status_all"</span>, </span>
<span id="cb14-3"><a href="#cb14-3"></a>                       <span class="at">data =</span> dat.analytic2, </span>
<span id="cb14-4"><a href="#cb14-4"></a>                       <span class="at">addOverall =</span> <span class="cn">TRUE</span>, </span>
<span id="cb14-5"><a href="#cb14-5"></a>                       <span class="at">test =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a>tab1<span class="sc">$</span>CatTable</span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt;                       Stratified by status_all</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt;                        Overall       0             1            p      test</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt;   n                    41671         36426         5245                    </span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt;   exposure.cat (%)                                              &lt;0.001     </span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt;      Never smoked      23570 (56.6)  21576 (59.2)  1994 (38.0)             </span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt;      Started before 10   280 ( 0.7)    201 ( 0.6)    79 ( 1.5)             </span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt;      Started at 10-14   3203 ( 7.7)   2560 ( 7.0)   643 (12.3)             </span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt;      Started at 15-17   5949 (14.3)   4924 (13.5)  1025 (19.5)             </span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt;      Started at 18-20   5194 (12.5)   4338 (11.9)   856 (16.3)             </span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt;      Started after 20   3475 ( 8.3)   2827 ( 7.8)   648 (12.4)             </span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#&gt;   race (%)                                                      &lt;0.001     </span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#&gt;      White             18234 (43.8)  15462 (42.4)  2772 (52.9)             </span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#&gt;      Black              8826 (21.2)   7571 (20.8)  1255 (23.9)             </span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt;      Hispanic          10760 (25.8)   9735 (26.7)  1025 (19.5)             </span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt;      Others             3851 ( 9.2)   3658 (10.0)   193 ( 3.7)             </span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">#&gt;   sex = Female (%)     21429 (51.4)  19235 (52.8)  2194 (41.8)  &lt;0.001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="analysis-with-ses-adjustment" class="level3" data-number="12.1.2"><h3 data-number="12.1.2" class="anchored" data-anchor-id="analysis-with-ses-adjustment">
<span class="header-section-number">12.1.2</span> Analysis with SES Adjustment</h3>
<ul>
<li>R Code Chunk 6: Specify the Survey Design</li>
</ul>
<p>Once again, to ensure our results are representative, we must account for the complex sampling design of NHANES. The following code creates a survey design object using the <code>svydesign()</code> function, incorporating the survey weights, strata, and PSU variables</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/surveyDes_f28d35b43a3f75a03f9a42957f3c50eb">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create a flag to identify participants in our final analytic sample</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>dat.full.with.mortality<span class="sc">$</span>miss <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>dat.full.with.mortality<span class="sc">$</span>miss[dat.full.with.mortality<span class="sc">$</span>id <span class="sc">%in%</span> dat.analytic2<span class="sc">$</span>id] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="fu">table</span>(dat.full.with.mortality<span class="sc">$</span>miss)</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt;     0     1 </span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; 41671 59645</span></span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co"># Create the survey design object</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>w.design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>psu, <span class="at">strata =</span> <span class="sc">~</span>strata, </span>
<span id="cb15-11"><a href="#cb15-11"></a>                      <span class="at">weights =</span> <span class="sc">~</span>survey.weight.new, </span>
<span id="cb15-12"><a href="#cb15-12"></a>                      <span class="at">data =</span> dat.full.with.mortality, <span class="at">nest =</span> T)</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co"># Subset the design object to our analytic sample</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>w.design0 <span class="ot">&lt;-</span> <span class="fu">subset</span>(w.design, miss <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> survey.weight.new <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="fu">dim</span>(w.design0)</span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="co">#&gt; [1] 41671    22</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 7: Regression and Survival Analysis</li>
</ul>
<p>The following section contains the code for core statistical models for the sensitivity analysis, including Kaplan-Meier curves and various Cox proportional hazards models.</p>
<p><strong>Kaplan-Meier Survival Curve</strong></p>
<p>The following code generates a survey-weighted Kaplan-Meier survival curve to visualize the probability of survival over time, stratified by the age of smoking initiation.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/kmplottingSens_740bf8f23903d7b5842234e9666c75f8">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.factor</span>(w.design0<span class="sc">$</span>variables<span class="sc">$</span>exposure.cat)))</span>
<span id="cb16-2"><a href="#cb16-2"></a>formulax0 <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat)</span>
<span id="cb16-3"><a href="#cb16-3"></a>sA<span class="ot">&lt;-</span><span class="fu">svykm</span>(formulax0, <span class="at">design=</span>w.design0)</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co"># Plot</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="fu">par</span>(<span class="at">oma=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.1</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="fu">plot</span>(sA, <span class="at">pars=</span><span class="fu">list</span>(<span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>dummy)),</span>
<span id="cb16-9"><a href="#cb16-9"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>,</span>
<span id="cb16-10"><a href="#cb16-10"></a>     <span class="at">ylab =</span> <span class="st">"Proportion surviving"</span>)</span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">levels</span>(<span class="fu">as.factor</span>(w.design0<span class="sc">$</span>variables<span class="sc">$</span>exposure.cat)),</span>
<span id="cb16-12"><a href="#cb16-12"></a>       <span class="at">col =</span> (<span class="dv">1</span><span class="sc">:</span>dummy), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/kmplottingSens-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Sensitivity Analysis 1: Survey-Weighted Kaplan-Meier Curves</figcaption></figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>Log-Rank Test</strong></p>
<p>The following code performs a weighted log-rank test to see if the differences between the curves are statistically significant.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/logrank_7a31758ff7476794e6a9832c0f35da9b">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Weighted logrank test</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>lrt <span class="ot">&lt;-</span> <span class="fu">svylogrank</span>(formulax0,<span class="at">design=</span><span class="fu">subset</span>(w.design0, survey.weight.new<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">round</span>(lrt[[<span class="dv">2</span>]],<span class="dv">2</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt;  Chisq      p </span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt; 271.25   0.00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p><strong>Cox Proportional Hazards Models</strong></p>
<p>The following code fits several survey-weighted Cox models to estimate the Hazard Ratios (HRs) for all-cause mortality associated with smoking initiation age. We fit:</p>
<ul>
<li><ol type="1">
<li>An unadjusted (crude) model.</li>
</ol></li>
<li><ol start="2" type="1">
<li>An adjusted model, controlling for sex, race, survey year, and the SES proxy variables (pir and HHedu).</li>
</ol></li>
<li><ol start="3" type="1">
<li>Two effect modification models to see if the association is different across racial/ethnic groups and by sex.</li>
</ol></li>
</ul>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/coxModels_14d7b5d0a0e3cee889dc225591990de7">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Test One</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>fit0_ <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat, <span class="at">data =</span> dat.complete)</span>
<span id="cb18-3"><a href="#cb18-3"></a>fit0_</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co"># Unadjusted model</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat, </span>
<span id="cb18-8"><a href="#cb18-8"></a>                 <span class="at">design =</span> w.design0)</span>
<span id="cb18-9"><a href="#cb18-9"></a>fit0</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co"># Adjusted model overall with SES proxies as covariates</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> year.cat <span class="sc">+</span> pir <span class="sc">+</span> HHedu,</span>
<span id="cb18-13"><a href="#cb18-13"></a>                 <span class="at">design =</span> w.design0)</span>
<span id="cb18-14"><a href="#cb18-14"></a>fit1</span>
<span id="cb18-15"><a href="#cb18-15"></a></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co"># Effect modification by race model + proxies</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat<span class="sc">*</span>race</span>
<span id="cb18-18"><a href="#cb18-18"></a>                 <span class="sc">+</span> sex  <span class="sc">+</span> year.cat <span class="sc">+</span> pir <span class="sc">+</span>HHedu,</span>
<span id="cb18-19"><a href="#cb18-19"></a>                 <span class="at">design =</span> w.design0)</span>
<span id="cb18-20"><a href="#cb18-20"></a>fit2</span>
<span id="cb18-21"><a href="#cb18-21"></a></span>
<span id="cb18-22"><a href="#cb18-22"></a><span class="co"># Effect modification by sex model + proxies</span></span>
<span id="cb18-23"><a href="#cb18-23"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat<span class="sc">*</span>sex </span>
<span id="cb18-24"><a href="#cb18-24"></a>                 <span class="sc">+</span> race <span class="sc">+</span> year.cat <span class="sc">+</span> pir <span class="sc">+</span> HHedu,</span>
<span id="cb18-25"><a href="#cb18-25"></a>                 <span class="at">design =</span> w.design0)</span>
<span id="cb18-26"><a href="#cb18-26"></a>fit3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 8: Prepare Data for Forest Plot</li>
</ul>
<p>The following code extracts the Hazard Ratios and 95% Confidence Intervals from each of the four models above: <code>fit0</code>, <code>fit1</code>, <code>fit2</code>, and <code>fit3</code>. It then combines them into a single data frame (<code>fr</code>) that will be used to create a summary forest plot.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/modelResults_69ff0c19171eac63d51260bd4e4dae2e">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Extract results from crude model (fit0)</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>f0 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit0)</span>
<span id="cb19-3"><a href="#cb19-3"></a>f0r <span class="ot">&lt;-</span> f0<span class="sc">$</span>regressionTable[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-4"><a href="#cb19-4"></a>f0r<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Crude"</span></span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co"># Extract results from adjusted model (fit1)</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>f1 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit1)</span>
<span id="cb19-8"><a href="#cb19-8"></a>f1r <span class="ot">&lt;-</span> f1<span class="sc">$</span>regressionTable[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-9"><a href="#cb19-9"></a>f1r<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Adjusted"</span></span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co"># Extract results from race interaction model (fit2)</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>f2 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit2)</span>
<span id="cb19-13"><a href="#cb19-13"></a>f2rW <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[(<span class="dv">31</span><span class="sc">:</span><span class="dv">35</span>)<span class="sc">+</span><span class="dv">8</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-14"><a href="#cb19-14"></a>f2rB <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[(<span class="dv">36</span><span class="sc">:</span><span class="dv">40</span>)<span class="sc">+</span><span class="dv">8</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-15"><a href="#cb19-15"></a>f2rH <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[(<span class="dv">41</span><span class="sc">:</span><span class="dv">45</span>)<span class="sc">+</span><span class="dv">8</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-16"><a href="#cb19-16"></a>f2rW<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"White"</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>f2rB<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Black"</span></span>
<span id="cb19-18"><a href="#cb19-18"></a>f2rH<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Hispanic"</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>f2r <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f2rW, f2rB, f2rH)</span>
<span id="cb19-20"><a href="#cb19-20"></a></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="co"># Extract results from sex interaction model (fit3)</span></span>
<span id="cb19-22"><a href="#cb19-22"></a>f3 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit3)</span>
<span id="cb19-23"><a href="#cb19-23"></a>f3rM <span class="ot">&lt;-</span> f3<span class="sc">$</span>regressionTable[<span class="dv">29</span><span class="sc">:</span><span class="dv">33</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-24"><a href="#cb19-24"></a>f3rF <span class="ot">&lt;-</span> f3<span class="sc">$</span>regressionTable[<span class="dv">34</span><span class="sc">:</span><span class="dv">38</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb19-25"><a href="#cb19-25"></a>f3rM<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Male"</span></span>
<span id="cb19-26"><a href="#cb19-26"></a>f3rF<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Female"</span></span>
<span id="cb19-27"><a href="#cb19-27"></a>f3r <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f3rM, f3rF)</span>
<span id="cb19-28"><a href="#cb19-28"></a></span>
<span id="cb19-29"><a href="#cb19-29"></a><span class="co"># Combine all results into one data frame</span></span>
<span id="cb19-30"><a href="#cb19-30"></a>fr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f0r,f1r,f2r,f3r)</span>
<span id="cb19-31"><a href="#cb19-31"></a>fr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fr)</span>
<span id="cb19-32"><a href="#cb19-32"></a>fr<span class="sc">$</span>age.grp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Started before 10'</span>, <span class="st">'Started at 10-14'</span>, <span class="st">"Started at 15-17"</span>,</span>
<span id="cb19-33"><a href="#cb19-33"></a>                <span class="st">"Started at 18-20"</span>, <span class="st">"Started after 20"</span>)</span>
<span id="cb19-34"><a href="#cb19-34"></a></span>
<span id="cb19-35"><a href="#cb19-35"></a><span class="co"># Clean up numeric columns</span></span>
<span id="cb19-36"><a href="#cb19-36"></a>ci <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_extract_all</span>(fr<span class="sc">$</span>CI<span class="fl">.95</span>, <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.,]</span><span class="sc">\\</span><span class="st">d+)?'</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-37"><a href="#cb19-37"></a>fr<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(fr<span class="sc">$</span>HazardRatio)</span>
<span id="cb19-38"><a href="#cb19-38"></a>fr<span class="sc">$</span>lower <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci[,<span class="dv">1</span>]))</span>
<span id="cb19-39"><a href="#cb19-39"></a>fr<span class="sc">$</span>upper <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci[,<span class="dv">2</span>]))</span>
<span id="cb19-40"><a href="#cb19-40"></a><span class="co">#fr$CI.95 &lt;- NULL</span></span>
<span id="cb19-41"><a href="#cb19-41"></a>fr<span class="sc">$</span>HazardRatio <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-42"><a href="#cb19-42"></a></span>
<span id="cb19-43"><a href="#cb19-43"></a><span class="co"># Save the plot data</span></span>
<span id="cb19-44"><a href="#cb19-44"></a>frS <span class="ot">&lt;-</span> fr</span>
<span id="cb19-45"><a href="#cb19-45"></a><span class="fu">save</span>(frS, <span class="at">file =</span> <span class="st">"data/SensForest.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="visualizing-the-ses-adjusted-results" class="level3" data-number="12.1.3"><h3 data-number="12.1.3" class="anchored" data-anchor-id="visualizing-the-ses-adjusted-results">
<span class="header-section-number">12.1.3</span> Visualizing the SES-Adjusted Results</h3>
<ul>
<li>R Code Chunk 9: Plot</li>
</ul>
<p>The following code creates the forest plot using <code>ggplot2</code>. The first plot summarizes all the results from this sensitivity analysis. This plot corresponds to <em>Appendix Figure 5</em> in section C.2 Sensitivity analysis with proxy covariates, part of the supplementary materials published with the paper.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/forestplotting_bd2e30b845a2fda58a19b60ee5c7abfd">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>fr<span class="sc">$</span>age.grp <span class="ot">&lt;-</span> <span class="fu">factor</span>(fr<span class="sc">$</span>age.grp,</span>
<span id="cb20-2"><a href="#cb20-2"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Started before 10'</span>, <span class="st">'Started at 10-14'</span>,</span>
<span id="cb20-3"><a href="#cb20-3"></a>                                <span class="st">"Started at 15-17"</span>, <span class="st">"Started at 18-20"</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>                                <span class="st">"Started after 20"</span>))</span>
<span id="cb20-5"><a href="#cb20-5"></a>fr<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(fr<span class="sc">$</span>group,</span>
<span id="cb20-6"><a href="#cb20-6"></a>                   <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Crude"</span>, <span class="st">"Adjusted"</span>, </span>
<span id="cb20-7"><a href="#cb20-7"></a>                                  <span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Hispanic"</span>, </span>
<span id="cb20-8"><a href="#cb20-8"></a>                                  <span class="st">"Male"</span>, <span class="st">"Female"</span>)))</span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="fu">levels</span>(fr<span class="sc">$</span>group)[<span class="fu">levels</span>(fr<span class="sc">$</span>group) <span class="sc">==</span> <span class="st">"White"</span>] <span class="ot">&lt;-</span> <span class="st">"Non-Hispanic White"</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="fu">levels</span>(fr<span class="sc">$</span>group)[<span class="fu">levels</span>(fr<span class="sc">$</span>group) <span class="sc">==</span> <span class="st">"Black"</span>] <span class="ot">&lt;-</span> <span class="st">"Non-Hispanic Black"</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>fr<span class="sc">$</span>text_label <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.2f [%.2f;%.2f]"</span>, fr<span class="sc">$</span>mean, fr<span class="sc">$</span>lower, fr<span class="sc">$</span>upper)</span>
<span id="cb20-12"><a href="#cb20-12"></a></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co"># Plotting</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="fu">ggplot</span>(fr, <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> group, <span class="at">colour =</span> age.grp)) <span class="sc">+</span> </span>
<span id="cb20-15"><a href="#cb20-15"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">width =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> text_label, <span class="at">x =</span> upper, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">7.7</span>)) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Hazard Ratio"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">legend=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"Age group"</span>) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-22"><a href="#cb20-22"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-23"><a href="#cb20-23"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>), </span>
<span id="cb20-24"><a href="#cb20-24"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb20-25"><a href="#cb20-25"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-26"><a href="#cb20-26"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb20-27"><a href="#cb20-27"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb20-28"><a href="#cb20-28"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb20-30"><a href="#cb20-30"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>)))</span>
<span id="cb20-31"><a href="#cb20-31"></a><span class="co">#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2</span></span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="co">#&gt; 3.5.0.</span></span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="co">#&gt; ℹ Please use the `legend.position.inside` argument of `theme()` instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/forestplotting-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Appendix Figure 5: Forest plot of Hazard Ratios from the SES-adjusted sensitivity analysis.</figcaption></figure>
</div>
</div>
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Save Plot</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">ggsave</span>(<span class="st">"images/forestSens.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p>This second plot creates a direct visual comparison between the main analysis results and this sensitivity analysis.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/plot2_d81e6d77740b872bd602baa0d9413fae">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Load the data for both plots</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">"data/SensForest.RData"</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">"data/MainForest.RData"</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># Combine data from fr (main) and frS (sensitivity), with an indicator variable</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">mutate</span>(fr, <span class="at">dataset =</span> <span class="st">'Main Analysis'</span>),</span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">mutate</span>(frS, <span class="at">dataset =</span> <span class="st">'Sensitivity Analysis'</span>)</span>
<span id="cb22-9"><a href="#cb22-9"></a>)</span>
<span id="cb22-10"><a href="#cb22-10"></a>combined_data<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(combined_data<span class="sc">$</span>group, <span class="at">levels =</span> <span class="fu">unique</span>(combined_data<span class="sc">$</span>group))</span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co"># Create the plot</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> group, <span class="at">colour =</span> age.grp, <span class="at">shape =</span> dataset)) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Hazard Ratio"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">colour =</span> <span class="st">"Age group"</span>, <span class="at">shape =</span> <span class="st">"Analysis Type"</span>) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb22-19"><a href="#cb22-19"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb22-20"><a href="#cb22-20"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb22-21"><a href="#cb22-21"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/plot2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Comparison of results: Main vs.&nbsp;SES-adjusted Sensitivity Analysis.</figcaption></figure>
</div>
</div>
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Save Plot</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">ggsave</span>(<span class="st">"images/combined_forest_plot.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr style="border: none; border-top: 3px solid black; width: 100%; margin-top: 1em; margin-bottom: 1em;"></section></section><section id="sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018" class="level2" data-number="12.2"><h2 data-number="12.2" class="anchored" data-anchor-id="sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018">
<span class="header-section-number">12.2</span> Sensitivity Analysis 2: Effect Modification by Race/Ethnicity (2011-2018)</h2>
<section id="data-reprocessing-for-the-2011-2018-sub-period" class="level3" data-number="12.2.1"><h3 data-number="12.2.1" class="anchored" data-anchor-id="data-reprocessing-for-the-2011-2018-sub-period">
<span class="header-section-number">12.2.1</span> Data Reprocessing for the 2011-2018 Sub-period</h3>
<p>The paper also notes that starting from the 2011−2012 cycle, NHANES introduced a new category labeled non-Hispanic Asian. To investigate the implications of this change, an additional analysis of effect modification by race/ethnicity was conducted specifically for the survey cycles spanning 2011-2018. The following sections re-run similar data merging and cleaning steps, and the different models as in the main analysis code sections, thus only the important changes are noted.</p>
<hr>
<ul>
<li>R Code Chunk 1: Redo Data Preparation</li>
</ul>
<p>The following code shows the respective data needed from the <code>nhanesA</code> library for the 4 cycles and the steps to prepare the specific dataset required for the 2011-2018 sub-period sensitivity analysis. This again, involves downloading raw data, merging them, and constructing necessary variables, mirroring the steps in the main data preparation but for this specific sub-period. The analysis focuses on the 4 cycles spanning 2011-2018.</p>
<p>The same steps are taken, thus only important changes are noted below.</p>
<ul>
<li>Load Analytic Data for 2011-2018 Cycles and Merge</li>
<li>Load and Merge Mortality Data for Sub-period Analysis</li>
<li>Variable Construction for Sub-period Data</li>
<li>Construct Final Analytic Dataset for Sub-period Analysis</li>
<li>Create Survey Design Object for Sub-period Analysis</li>
</ul>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/reload_0484f3bfdd4fb00e6a62e1c62d107c42">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># 2011-2012, 2013-2014, 2015-2016, 2017-2018</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>demo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DEMO_G"</span>, <span class="st">"DEMO_H"</span>, <span class="st">"DEMO_I"</span>, <span class="st">"DEMO_J"</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a>smoking <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SMQ_G"</span>, <span class="st">"SMQ_H"</span>, <span class="st">"SMQ_I"</span>, <span class="st">"SMQ_J"</span>)</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co"># DEMOGRAPHICS</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>demo_list_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(demo, nhanes)</span>
<span id="cb24-7"><a href="#cb24-7"></a>demo_data_files <span class="ot">&lt;-</span> demo_list_2</span>
<span id="cb24-8"><a href="#cb24-8"></a></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="co"># SMOKING</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>smoking_list_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(smoking, nhanes)</span>
<span id="cb24-11"><a href="#cb24-11"></a>smoking_data_files <span class="ot">&lt;-</span> smoking_list_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following variables are selected from the data for 4 cycles spanning 2011-2018. The variable <code>RIDRETH3</code> includes the Race/Hispanic origin w/ NH Asian group. The remaining variables selected are the same as in the main analysis.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/variables _b04a31afd98d443673460a23453e503d">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>demo_columns_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>, <span class="st">"RIDAGEYR"</span>, <span class="st">"RIAGENDR"</span>,</span>
<span id="cb25-2"><a href="#cb25-2"></a>                    <span class="st">"RIDRETH1"</span>, <span class="st">"RIDRETH3"</span>, <span class="st">"DMDBORN4"</span>, </span>
<span id="cb25-3"><a href="#cb25-3"></a>                    <span class="st">"SDDSRVYR"</span>, <span class="st">"WTINT2YR"</span>, <span class="st">"WTMEC2YR"</span>, </span>
<span id="cb25-4"><a href="#cb25-4"></a>                    <span class="st">"SDMVPSU"</span>, <span class="st">"SDMVSTRA"</span>) </span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a>smoking_columns_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>, <span class="st">"SMQ020"</span>, <span class="st">"SMD030"</span>, <span class="st">"SMQ040"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/subset_f8175c2f181b70814793465bbdac2e82">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># DEMOGRAPHICS</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>demo_data_files_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(demo_data_files), <span class="cf">function</span>(i) </span>
<span id="cb26-3"><a href="#cb26-3"></a>  {</span>
<span id="cb26-4"><a href="#cb26-4"></a>  current_cycle_data <span class="ot">&lt;-</span> demo_data_files[[i]]</span>
<span id="cb26-5"><a href="#cb26-5"></a>  original <span class="ot">&lt;-</span> demo[i] </span>
<span id="cb26-6"><a href="#cb26-6"></a>  </span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="co"># Select Columns</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>  subset_data <span class="ot">&lt;-</span> current_cycle_data <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="#cb26-9"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">any_of</span>(demo_columns_2))</span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="co"># Translate </span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  translated_data <span class="ot">&lt;-</span> <span class="fu">nhanesTranslate</span>(original,</span>
<span id="cb26-12"><a href="#cb26-12"></a>                                     <span class="fu">names</span>(subset_data), </span>
<span id="cb26-13"><a href="#cb26-13"></a>                                     <span class="at">data =</span> subset_data)</span>
<span id="cb26-14"><a href="#cb26-14"></a>  <span class="co"># Return</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>  <span class="fu">return</span>(translated_data) </span>
<span id="cb26-16"><a href="#cb26-16"></a>})</span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR</span></span>
<span id="cb26-18"><a href="#cb26-18"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR</span></span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR</span></span>
<span id="cb26-20"><a href="#cb26-20"></a><span class="co">#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR</span></span>
<span id="cb26-21"><a href="#cb26-21"></a></span>
<span id="cb26-22"><a href="#cb26-22"></a></span>
<span id="cb26-23"><a href="#cb26-23"></a><span class="co"># SMOKING</span></span>
<span id="cb26-24"><a href="#cb26-24"></a>smoking_data_files_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(smoking_data_files), <span class="cf">function</span>(i) </span>
<span id="cb26-25"><a href="#cb26-25"></a>  {</span>
<span id="cb26-26"><a href="#cb26-26"></a>  current_cycle_data <span class="ot">&lt;-</span> smoking_data_files[[i]]</span>
<span id="cb26-27"><a href="#cb26-27"></a>  original <span class="ot">&lt;-</span> smoking[i]</span>
<span id="cb26-28"><a href="#cb26-28"></a></span>
<span id="cb26-29"><a href="#cb26-29"></a>  <span class="co"># Select Columns</span></span>
<span id="cb26-30"><a href="#cb26-30"></a>  subset_data <span class="ot">&lt;-</span> current_cycle_data <span class="sc">%&gt;%</span></span>
<span id="cb26-31"><a href="#cb26-31"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">any_of</span>(smoking_columns_2))</span>
<span id="cb26-32"><a href="#cb26-32"></a>  <span class="co"># Translate</span></span>
<span id="cb26-33"><a href="#cb26-33"></a>  translated_data <span class="ot">&lt;-</span> <span class="fu">nhanesTranslate</span>(original, </span>
<span id="cb26-34"><a href="#cb26-34"></a>                                     <span class="fu">names</span>(subset_data), </span>
<span id="cb26-35"><a href="#cb26-35"></a>                                     <span class="at">data =</span> subset_data)</span>
<span id="cb26-36"><a href="#cb26-36"></a>  <span class="co"># Return</span></span>
<span id="cb26-37"><a href="#cb26-37"></a>  <span class="fu">return</span>(translated_data)</span>
<span id="cb26-38"><a href="#cb26-38"></a>})</span>
<span id="cb26-39"><a href="#cb26-39"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb26-40"><a href="#cb26-40"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb26-41"><a href="#cb26-41"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb26-42"><a href="#cb26-42"></a><span class="co">#&gt; Translated columns: SMQ020 SMQ040</span></span>
<span id="cb26-43"><a href="#cb26-43"></a></span>
<span id="cb26-44"><a href="#cb26-44"></a></span>
<span id="cb26-45"><a href="#cb26-45"></a><span class="co"># Merge</span></span>
<span id="cb26-46"><a href="#cb26-46"></a>data_all <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(demo_data_files_2), <span class="cf">function</span>(i) {</span>
<span id="cb26-47"><a href="#cb26-47"></a>  demo_df <span class="ot">&lt;-</span> demo_data_files_2[[i]]</span>
<span id="cb26-48"><a href="#cb26-48"></a>  smoking_df <span class="ot">&lt;-</span> smoking_data_files_2[[i]]</span>
<span id="cb26-49"><a href="#cb26-49"></a>  </span>
<span id="cb26-50"><a href="#cb26-50"></a>  <span class="co"># Merge by SEQN</span></span>
<span id="cb26-51"><a href="#cb26-51"></a>  merged_df <span class="ot">&lt;-</span> <span class="fu">join_all</span>(<span class="fu">list</span>(demo_df, smoking_df), </span>
<span id="cb26-52"><a href="#cb26-52"></a>                        <span class="at">by =</span> <span class="st">"SEQN"</span>, </span>
<span id="cb26-53"><a href="#cb26-53"></a>                        <span class="at">type =</span> <span class="st">'full'</span>)</span>
<span id="cb26-54"><a href="#cb26-54"></a>  <span class="fu">return</span>(merged_df)</span>
<span id="cb26-55"><a href="#cb26-55"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 2: Recode</li>
</ul>
<p>The following sections of code apply the same recoding except we have another race/ethnicity this time.</p>
<p><em>ID:</em></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/recoding1_16164cd668476702a3c0b6bb18fc59cb">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>data_all2 <span class="ot">&lt;-</span> data_all</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co"># ID</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="co"># Set Data</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb27-7"><a href="#cb27-7"></a>  </span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="co"># ID</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  dat2<span class="sc">$</span>id <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SEQN</span>
<span id="cb27-10"><a href="#cb27-10"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb27-11"><a href="#cb27-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Demographic Variables:</em></p>
<ul>
<li>Below, the demographic variables like age, sex, and importantly, both race (from RIDRETH1) and race2 (from RIDRETH3 to include Asian) are recoded for the sub-period data.</li>
</ul>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/recoding2_00e0c50367524e29b69f34bc7ae692e8">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Demo</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="co"># Set Data</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb28-5"><a href="#cb28-5"></a>  </span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="co"># Age</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>  dat2<span class="sc">$</span>age <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIDAGEYR</span>
<span id="cb28-8"><a href="#cb28-8"></a>  </span>
<span id="cb28-9"><a href="#cb28-9"></a>  <span class="co"># Sex</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>  dat2<span class="sc">$</span>sex <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIAGENDR</span>
<span id="cb28-11"><a href="#cb28-11"></a>  </span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="co"># Race/Ethnicity (RIDRETH1 and RIDRETH3)</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  dat2<span class="sc">$</span>race <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIDRETH1</span>
<span id="cb28-14"><a href="#cb28-14"></a>  dat2<span class="sc">$</span>race <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>race, <span class="at">recodes =</span> <span class="st">"</span></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="st">    'Non-Hispanic White'='White';</span></span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="st">    'Non-Hispanic Black'='Black';</span></span>
<span id="cb28-17"><a href="#cb28-17"></a><span class="st">    c('Mexican American','Other Hispanic')='Hispanic';</span></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="st">    else='Others'"</span>)</span>
<span id="cb28-19"><a href="#cb28-19"></a>  dat2<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>race, </span>
<span id="cb28-20"><a href="#cb28-20"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Hispanic"</span>, <span class="st">"Others"</span>))</span>
<span id="cb28-21"><a href="#cb28-21"></a>  </span>
<span id="cb28-22"><a href="#cb28-22"></a>  </span>
<span id="cb28-23"><a href="#cb28-23"></a>  dat2<span class="sc">$</span>race2 <span class="ot">&lt;-</span> dat2<span class="sc">$</span>RIDRETH3</span>
<span id="cb28-24"><a href="#cb28-24"></a>  dat2<span class="sc">$</span>race2 <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>race2, <span class="at">recodes =</span> <span class="st">" </span></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="st">            'Non-Hispanic White'='White';</span></span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="st">            'Non-Hispanic Black'='Black'; </span></span>
<span id="cb28-27"><a href="#cb28-27"></a><span class="st">            'Non-Hispanic Asian'='Asian';</span></span>
<span id="cb28-28"><a href="#cb28-28"></a><span class="st">            c('Mexican American','Other Hispanic')= 'Hispanic'; </span></span>
<span id="cb28-29"><a href="#cb28-29"></a><span class="st">            else='Others' "</span>)  </span>
<span id="cb28-30"><a href="#cb28-30"></a>  dat2<span class="sc">$</span>race2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>race2, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black"</span>,</span>
<span id="cb28-31"><a href="#cb28-31"></a>                                              <span class="st">"Hispanic"</span>, <span class="st">"Asian"</span>,</span>
<span id="cb28-32"><a href="#cb28-32"></a>                                              <span class="st">"Others"</span>))</span>
<span id="cb28-33"><a href="#cb28-33"></a>  </span>
<span id="cb28-34"><a href="#cb28-34"></a>  </span>
<span id="cb28-35"><a href="#cb28-35"></a>  </span>
<span id="cb28-36"><a href="#cb28-36"></a>  <span class="co"># Country of birth / citizenship</span></span>
<span id="cb28-37"><a href="#cb28-37"></a>  dat2<span class="sc">$</span>born <span class="ot">&lt;-</span> dat2<span class="sc">$</span>DMDBORN4</span>
<span id="cb28-38"><a href="#cb28-38"></a>  dat2<span class="sc">$</span>born <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>born, <span class="at">recodes =</span> <span class="st">" </span></span>
<span id="cb28-39"><a href="#cb28-39"></a><span class="st">  'Others'='Other place';</span></span>
<span id="cb28-40"><a href="#cb28-40"></a><span class="st">  'Born in 50 US states or Washington, DC'= 'Born in US'; </span></span>
<span id="cb28-41"><a href="#cb28-41"></a><span class="st">  else=NA"</span>)</span>
<span id="cb28-42"><a href="#cb28-42"></a>  dat2<span class="sc">$</span>born <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>born, </span>
<span id="cb28-43"><a href="#cb28-43"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Born in US"</span>, <span class="st">"Other place"</span>))</span>
<span id="cb28-44"><a href="#cb28-44"></a>  </span>
<span id="cb28-45"><a href="#cb28-45"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb28-46"><a href="#cb28-46"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Smoking:</em></p>
<ul>
<li>Below, the smoking-related variables, including smoking status, age started smoking and whether smoking started at age 15 or younger for the sub-period data are recoded.</li>
</ul>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/recoding3_9c91ef209f0f26459e45fd6c1a49f18a">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Smoking</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="co"># Set Data</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb29-5"><a href="#cb29-5"></a>  </span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="co"># Smoking Status</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>  dat2<span class="sc">$</span>smoking <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SMQ020</span>
<span id="cb29-8"><a href="#cb29-8"></a>  dat2<span class="sc">$</span>smoking <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>smoking, <span class="st">"</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="st">    'Yes' = 'Current smoker';</span></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="st">    'No' = 'Never smoker';</span></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="st">    else = NA"</span>)</span>
<span id="cb29-12"><a href="#cb29-12"></a>  dat2<span class="sc">$</span>smoking <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat2<span class="sc">$</span>smoking, </span>
<span id="cb29-13"><a href="#cb29-13"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never smoker"</span>, </span>
<span id="cb29-14"><a href="#cb29-14"></a>                                    <span class="st">"Previous smoker"</span>, </span>
<span id="cb29-15"><a href="#cb29-15"></a>                                    <span class="st">"Current smoker"</span>))</span>
<span id="cb29-16"><a href="#cb29-16"></a>  </span>
<span id="cb29-17"><a href="#cb29-17"></a>  <span class="co"># Ask about variable SMQ040 ***</span></span>
<span id="cb29-18"><a href="#cb29-18"></a>  dat2<span class="sc">$</span>smoking[dat2<span class="sc">$</span>SMQ040 <span class="sc">==</span> <span class="st">"Not at all?"</span> <span class="sc">|</span> </span>
<span id="cb29-19"><a href="#cb29-19"></a>                 dat2<span class="sc">$</span>SMQ040 <span class="sc">==</span> <span class="st">"Not at all"</span>] <span class="ot">&lt;-</span> <span class="st">"Previous smoker"</span></span>
<span id="cb29-20"><a href="#cb29-20"></a>  </span>
<span id="cb29-21"><a href="#cb29-21"></a>  <span class="co"># Age Started Smoking</span></span>
<span id="cb29-22"><a href="#cb29-22"></a>  dat2<span class="sc">$</span>smoking.age <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SMD030</span>
<span id="cb29-23"><a href="#cb29-23"></a>  dat2<span class="sc">$</span>smoking.age[dat2<span class="sc">$</span>smoking.age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">777</span>, <span class="dv">999</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb29-24"><a href="#cb29-24"></a>  dat2<span class="sc">$</span>smoking.age[<span class="fu">is.na</span>(dat2<span class="sc">$</span>smoking.age) <span class="sc">&amp;</span> </span>
<span id="cb29-25"><a href="#cb29-25"></a>                     dat2<span class="sc">$</span>smoking <span class="sc">==</span> <span class="st">"Never smoker"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-26"><a href="#cb29-26"></a>  </span>
<span id="cb29-27"><a href="#cb29-27"></a>  <span class="co"># Whether Smoking started age ≤ 15</span></span>
<span id="cb29-28"><a href="#cb29-28"></a>  dat2<span class="sc">$</span>smoked.while.child <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat2<span class="sc">$</span>smoking.age, </span>
<span id="cb29-29"><a href="#cb29-29"></a>  <span class="st">" 0 = 'No'; 6:15 = 'Yes'; else = NA "</span>, <span class="at">as.factor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-30"><a href="#cb29-30"></a>  </span>
<span id="cb29-31"><a href="#cb29-31"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb29-32"><a href="#cb29-32"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Survey Design:</em></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/recoding4_da40ef9df9e39371bf1a2f5d0cc10261">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Survey Design</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="co"># Set Data</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb30-5"><a href="#cb30-5"></a>  </span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="co"># Weight</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>  dat2<span class="sc">$</span>survey.weight <span class="ot">&lt;-</span> dat2<span class="sc">$</span>WTINT2YR</span>
<span id="cb30-8"><a href="#cb30-8"></a>  </span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="co"># PSU</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  dat2<span class="sc">$</span>psu <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat2<span class="sc">$</span>SDMVPSU)</span>
<span id="cb30-11"><a href="#cb30-11"></a>  </span>
<span id="cb30-12"><a href="#cb30-12"></a>  <span class="co"># Strata</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  dat2<span class="sc">$</span>strata <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat2<span class="sc">$</span>SDMVSTRA)</span>
<span id="cb30-14"><a href="#cb30-14"></a>  </span>
<span id="cb30-15"><a href="#cb30-15"></a>  <span class="co"># Survey year</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>  dat2<span class="sc">$</span>year <span class="ot">&lt;-</span> dat2<span class="sc">$</span>SDDSRVYR</span>
<span id="cb30-17"><a href="#cb30-17"></a>  </span>
<span id="cb30-18"><a href="#cb30-18"></a>  data_all2[[i]] <span class="ot">&lt;-</span> dat2</span>
<span id="cb30-19"><a href="#cb30-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 3: Save Analytic Data for Sub-period Analysis (Per Cycle)</li>
</ul>
<p>The following code processes the cleaned sub-period dataframes, applies the age filter (&gt;20 years), selects the final set of variables, and saves them as .RData files for each cycle.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/analytic-data_26dd394c5e86ba6edd0a80720be46555">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a></span>
<span id="cb31-2"><a href="#cb31-2"></a>nhanes2_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nhanes2_11"</span>, <span class="st">"nhanes2_13"</span>, <span class="st">"nhanes2_15"</span>, <span class="st">"nhanes2_17"</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>vars_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"race"</span>, <span class="st">"race2"</span>, <span class="st">"born"</span>, </span>
<span id="cb31-4"><a href="#cb31-4"></a>          <span class="st">"smoking.age"</span>, <span class="st">"smoked.while.child"</span>, <span class="st">"smoking"</span>, </span>
<span id="cb31-5"><a href="#cb31-5"></a>          <span class="st">"survey.weight"</span>, <span class="st">"psu"</span>, <span class="st">"strata"</span>, <span class="st">"year"</span>)</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data_all2)) {</span>
<span id="cb31-8"><a href="#cb31-8"></a>  dat2 <span class="ot">&lt;-</span> data_all2[[i]]</span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a>  nhanes2_i <span class="ot">&lt;-</span> nhanes2_all[i]</span>
<span id="cb31-11"><a href="#cb31-11"></a>  <span class="fu">assign</span>(nhanes2_i, dat2[, vars_2], <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb31-12"><a href="#cb31-12"></a>  </span>
<span id="cb31-13"><a href="#cb31-13"></a>  analytic <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">get</span>(nhanes2_i), age <span class="sc">&gt;=</span> <span class="dv">20</span>)</span>
<span id="cb31-14"><a href="#cb31-14"></a>  <span class="fu">cat</span>(<span class="st">"Processing:"</span>, nhanes2_i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-15"><a href="#cb31-15"></a>  <span class="fu">print</span>(<span class="fu">dim</span>(analytic))</span>
<span id="cb31-16"><a href="#cb31-16"></a>  </span>
<span id="cb31-17"><a href="#cb31-17"></a>  analytic_i <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"analytic2_"</span>, <span class="fu">substr</span>(nhanes2_i, <span class="dv">9</span>, <span class="dv">10</span>))</span>
<span id="cb31-18"><a href="#cb31-18"></a>  analytic_i</span>
<span id="cb31-19"><a href="#cb31-19"></a>  <span class="fu">assign</span>(analytic_i, analytic, <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb31-20"><a href="#cb31-20"></a>  </span>
<span id="cb31-21"><a href="#cb31-21"></a>  <span class="co"># Create 'data' directory if it does not exist</span></span>
<span id="cb31-22"><a href="#cb31-22"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">"data"</span>)) {</span>
<span id="cb31-23"><a href="#cb31-23"></a>    <span class="fu">dir.create</span>(<span class="st">"data"</span>)</span>
<span id="cb31-24"><a href="#cb31-24"></a>  }</span>
<span id="cb31-25"><a href="#cb31-25"></a>  <span class="co"># Save</span></span>
<span id="cb31-26"><a href="#cb31-26"></a>  <span class="fu">save</span>(<span class="at">list =</span> <span class="fu">c</span>(nhanes2_i, analytic_i),</span>
<span id="cb31-27"><a href="#cb31-27"></a>       <span class="at">file =</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="fu">paste0</span>(analytic_i, <span class="st">".RData"</span>)))</span>
<span id="cb31-28"><a href="#cb31-28"></a>  <span class="co">#print(analytic_i)</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>}</span>
<span id="cb31-30"><a href="#cb31-30"></a><span class="co">#&gt; Processing: nhanes2_11 </span></span>
<span id="cb31-31"><a href="#cb31-31"></a><span class="co">#&gt; [1] 5560   13</span></span>
<span id="cb31-32"><a href="#cb31-32"></a><span class="co">#&gt; Processing: nhanes2_13 </span></span>
<span id="cb31-33"><a href="#cb31-33"></a><span class="co">#&gt; [1] 5769   13</span></span>
<span id="cb31-34"><a href="#cb31-34"></a><span class="co">#&gt; Processing: nhanes2_15 </span></span>
<span id="cb31-35"><a href="#cb31-35"></a><span class="co">#&gt; [1] 5719   13</span></span>
<span id="cb31-36"><a href="#cb31-36"></a><span class="co">#&gt; Processing: nhanes2_17 </span></span>
<span id="cb31-37"><a href="#cb31-37"></a><span class="co">#&gt; [1] 5569   13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 4: Combine analytic files</li>
</ul>
<p>The following code ensure the individual analytic .RData files for the sub-period are loaded and combines them into a single <code>dat.full.2</code> dataframe, recalculating weights for the combined period.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/load-4_4df7ed2a3232f25f801274c93ba51651">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Load the 4 new datasets</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">"data/analytic2_11.RData"</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">"data/analytic2_13.RData"</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">"data/analytic2_15.RData"</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">"data/analytic2_17.RData"</span>)</span>
<span id="cb32-6"><a href="#cb32-6"></a></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co"># Bind</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>dat.full<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes2_11, nhanes2_13, nhanes2_15, nhanes2_17)</span>
<span id="cb32-9"><a href="#cb32-9"></a></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co"># Confirm</span></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="fu">unique</span>(dat.full<span class="fl">.2</span><span class="sc">$</span>year)</span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co">#&gt; [1] NHANES 2011-2012 public release NHANES 2013-2014 public release</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co">#&gt; [3] NHANES 2015-2016 public release NHANES 2017-2018 public release</span></span>
<span id="cb32-14"><a href="#cb32-14"></a><span class="co">#&gt; 4 Levels: NHANES 2011-2012 public release ... NHANES 2017-2018 public release</span></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="fu">length</span>(<span class="fu">unique</span>(dat.full<span class="fl">.2</span><span class="sc">$</span>year))</span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb32-17"><a href="#cb32-17"></a></span>
<span id="cb32-18"><a href="#cb32-18"></a><span class="co"># Corrected weights</span></span>
<span id="cb32-19"><a href="#cb32-19"></a>dat.full<span class="fl">.2</span><span class="sc">$</span>survey.weight.new <span class="ot">&lt;-</span> dat.full<span class="fl">.2</span><span class="sc">$</span>survey.weight<span class="sc">/</span><span class="fu">length</span>(<span class="fu">unique</span>(dat.full<span class="fl">.2</span><span class="sc">$</span>year))</span>
<span id="cb32-20"><a href="#cb32-20"></a>dat.full<span class="fl">.2</span><span class="sc">$</span>survey.weight <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-21"><a href="#cb32-21"></a><span class="fu">names</span>(dat.full<span class="fl">.2</span>)</span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="co">#&gt;  [1] "id"                 "age"                "sex"               </span></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="co">#&gt;  [4] "race"               "race2"              "born"              </span></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="co">#&gt;  [7] "smoking.age"        "smoked.while.child" "smoking"           </span></span>
<span id="cb32-25"><a href="#cb32-25"></a><span class="co">#&gt; [10] "psu"                "strata"             "year"              </span></span>
<span id="cb32-26"><a href="#cb32-26"></a><span class="co">#&gt; [13] "survey.weight.new"</span></span>
<span id="cb32-27"><a href="#cb32-27"></a><span class="fu">dim</span>(dat.full<span class="fl">.2</span>)</span>
<span id="cb32-28"><a href="#cb32-28"></a><span class="co">#&gt; [1] 39156    13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 5: Load and Merge Mortality Data for Sub-period Analysis</li>
</ul>
<p>The following code loads the individual mortality datasets for the 4 cycles and combines them. Subsequently, it merges this comprehensive mortality data with the full sub-period analytic dataset (<code>dat.full.2</code>) using the <code>id</code> variable.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/mortData_d4e5873e3fb46cfa9323c0ce893108b2">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>mort2000 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2000.RData"</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a>mort2001 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2001.RData"</span>)</span>
<span id="cb33-3"><a href="#cb33-3"></a>mort2003 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2003.RData"</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a>mort2005 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2005.RData"</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a>mort2007 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2007.RData"</span>)</span>
<span id="cb33-6"><a href="#cb33-6"></a>mort2009 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2009.RData"</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a>mort2011 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2011.RData"</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a>mort2013 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2013.RData"</span>)</span>
<span id="cb33-9"><a href="#cb33-9"></a>mort2015 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2015.RData"</span>)</span>
<span id="cb33-10"><a href="#cb33-10"></a>mort2017 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"data/Mortalitydata/mort2017.RData"</span>)</span>
<span id="cb33-11"><a href="#cb33-11"></a></span>
<span id="cb33-12"><a href="#cb33-12"></a>dat.mortality<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mort2000, mort2001, mort2003,</span>
<span id="cb33-13"><a href="#cb33-13"></a>                       mort2005, mort2007, mort2009, </span>
<span id="cb33-14"><a href="#cb33-14"></a>                       mort2011, mort2013, mort2015, </span>
<span id="cb33-15"><a href="#cb33-15"></a>                       mort2017)</span>
<span id="cb33-16"><a href="#cb33-16"></a></span>
<span id="cb33-17"><a href="#cb33-17"></a>dat.full.with.mortality<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">merge</span>(dat.full<span class="fl">.2</span>, dat.mortality<span class="fl">.2</span>, </span>
<span id="cb33-18"><a href="#cb33-18"></a>                                   <span class="at">by =</span> <span class="st">"id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-19"><a href="#cb33-19"></a><span class="fu">dim</span>(dat.full.with.mortality<span class="fl">.2</span>)</span>
<span id="cb33-20"><a href="#cb33-20"></a><span class="co">#&gt; [1] 39156    20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following code applies recoding which is also similar to main analysis.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/recode_ec4ca9a5c740e61337f78c2abd2bf48e">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>exposure.cat <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>smoking.age, <span class="st">" </span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="st">                                                    0 = 'Never smoked'; </span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="st">                                                    1:9 = 'Started before 10';</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="st">                                                    10:14 = 'Started at 10-14';</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="st">                                                    15:17 = 'Started at 15-17';</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="st">                                                    18:20 = 'Started at 18-20';</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">                                                    21:80 = 'Started after 20';</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="st">                                                    else = NA "</span>, </span>
<span id="cb34-9"><a href="#cb34-9"></a>                                                    <span class="at">as.factor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-10"><a href="#cb34-10"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>exposure.cat <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>exposure.cat, </span>
<span id="cb34-11"><a href="#cb34-11"></a>                                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never smoked"</span>,</span>
<span id="cb34-12"><a href="#cb34-12"></a>                                                          <span class="st">'Started before 10'</span>,</span>
<span id="cb34-13"><a href="#cb34-13"></a>                                                          <span class="st">'Started at 10-14'</span>,</span>
<span id="cb34-14"><a href="#cb34-14"></a>                                                          <span class="st">"Started at 15-17"</span>,</span>
<span id="cb34-15"><a href="#cb34-15"></a>                                                          <span class="st">"Started at 18-20"</span>,</span>
<span id="cb34-16"><a href="#cb34-16"></a>                                                          <span class="st">"Started after 20"</span>))</span>
<span id="cb34-17"><a href="#cb34-17"></a></span>
<span id="cb34-18"><a href="#cb34-18"></a></span>
<span id="cb34-19"><a href="#cb34-19"></a><span class="co"># Survival time - Person-Months of Follow-up from NHANES Interview date</span></span>
<span id="cb34-20"><a href="#cb34-20"></a><span class="co"># changed to "Number of Person Months of Follow-up from NHANES Mobile Examination Center (MEC) date" from "Number of Person Months of Follow-up from NHANES interview date" as we are using MCQ data</span></span>
<span id="cb34-21"><a href="#cb34-21"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.interview <span class="ot">&lt;-</span> dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_permth_int <span class="co"># mort_permth_exm </span></span>
<span id="cb34-22"><a href="#cb34-22"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.interview) </span>
<span id="cb34-23"><a href="#cb34-23"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb34-24"><a href="#cb34-24"></a><span class="co">#&gt;    1.00   34.00   58.00   58.67   82.00  113.00   15424</span></span>
<span id="cb34-25"><a href="#cb34-25"></a></span>
<span id="cb34-26"><a href="#cb34-26"></a><span class="co"># Age in month</span></span>
<span id="cb34-27"><a href="#cb34-27"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>age.month <span class="ot">&lt;-</span> dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>age <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb34-28"><a href="#cb34-28"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>age.month)</span>
<span id="cb34-29"><a href="#cb34-29"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb34-30"><a href="#cb34-30"></a><span class="co">#&gt;     0.0   120.0   336.0   386.9   648.0   960.0</span></span>
<span id="cb34-31"><a href="#cb34-31"></a></span>
<span id="cb34-32"><a href="#cb34-32"></a><span class="co"># Survival time - Person-Months of Follow-up from birth = birth to screening + screening to event/censor</span></span>
<span id="cb34-33"><a href="#cb34-33"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.birth <span class="ot">&lt;-</span> <span class="fu">with</span>(dat.full.with.mortality<span class="fl">.2</span>, age.month <span class="sc">+</span> stime.since.interview)</span>
<span id="cb34-34"><a href="#cb34-34"></a><span class="co"># converted back to year so that KM plot is in years / HR results remain the same (added)</span></span>
<span id="cb34-35"><a href="#cb34-35"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.birth <span class="ot">&lt;-</span> dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.birth<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb34-36"><a href="#cb34-36"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.birth[<span class="fu">is.na</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.interview)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-37"><a href="#cb34-37"></a><span class="fu">summary</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>stime.since.birth)</span>
<span id="cb34-38"><a href="#cb34-38"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb34-39"><a href="#cb34-39"></a><span class="co">#&gt;   19.08   37.17   53.17   53.08   68.17   89.00   15424</span></span>
<span id="cb34-40"><a href="#cb34-40"></a></span>
<span id="cb34-41"><a href="#cb34-41"></a><span class="co"># All-cause mortality status</span></span>
<span id="cb34-42"><a href="#cb34-42"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>status_all <span class="ot">&lt;-</span> dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_stat</span>
<span id="cb34-43"><a href="#cb34-43"></a><span class="fu">table</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>status_all, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb34-44"><a href="#cb34-44"></a><span class="co">#&gt; </span></span>
<span id="cb34-45"><a href="#cb34-45"></a><span class="co">#&gt;     0     1  &lt;NA&gt; </span></span>
<span id="cb34-46"><a href="#cb34-46"></a><span class="co">#&gt; 22216  1516 15424</span></span>
<span id="cb34-47"><a href="#cb34-47"></a></span>
<span id="cb34-48"><a href="#cb34-48"></a><span class="co"># Cause-specific mortality</span></span>
<span id="cb34-49"><a href="#cb34-49"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_diabetes <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-50"><a href="#cb34-50"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_hyperten <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-51"><a href="#cb34-51"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_permth_int <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-52"><a href="#cb34-52"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_permth_exm <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-53"><a href="#cb34-53"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_ucod_leading <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-54"><a href="#cb34-54"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>mort_eligstat <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 6: Variable Construction and Final Analytic Dataset for Sub-period Analysis</li>
</ul>
<p>The same variables are constructed as the main analysis, but note, only for the 4 cycles. Below, the year variable is recoded into categorical levels. Then, the final data set is saved.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/year-Recode_4853475f195aba8073330939467c59c8">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Recode year variable</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>year.cat <span class="ot">&lt;-</span> dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>year</span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a>new_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2011-2012"</span>, <span class="st">"2013-2014"</span>, <span class="st">"2015-2016"</span>, <span class="st">"2017-2018"</span>)</span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="fu">levels</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>year.cat) <span class="ot">&lt;-</span> new_levels</span>
<span id="cb35-6"><a href="#cb35-6"></a></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co"># Display the unique levels of year.cat</span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="fu">levels</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>year.cat)</span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="co">#&gt; [1] "2011-2012" "2013-2014" "2015-2016" "2017-2018"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/data-cleaning_3ccfc0701ca809d851aecad9d499767b">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Remove variable, not used</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>smoked.while.child <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="do">### Analytic dataset - age 20 - 79</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>dat.analytic<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">subset</span>(dat.full.with.mortality<span class="fl">.2</span>, age<span class="sc">&gt;=</span><span class="dv">20</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="fu">dim</span>(dat.full.with.mortality<span class="fl">.2</span>)[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">dim</span>(dat.analytic<span class="fl">.2</span>)[<span class="dv">1</span>] <span class="co"># added</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="co">#&gt; [1] 18057</span></span>
<span id="cb36-8"><a href="#cb36-8"></a></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="co"># Drop variables that are not being used </span></span>
<span id="cb36-10"><a href="#cb36-10"></a>dat.analytic<span class="fl">.2</span><span class="sc">$</span>born <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-11"><a href="#cb36-11"></a>dat.analytic<span class="fl">.2</span><span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-12"><a href="#cb36-12"></a>dat.analytic<span class="fl">.2</span><span class="sc">$</span>age.month <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-13"><a href="#cb36-13"></a></span>
<span id="cb36-14"><a href="#cb36-14"></a><span class="co"># No missing exposure or outcome</span></span>
<span id="cb36-15"><a href="#cb36-15"></a><span class="fu">dim</span>(dat.analytic<span class="fl">.2</span>)</span>
<span id="cb36-16"><a href="#cb36-16"></a><span class="co">#&gt; [1] 21099    16</span></span>
<span id="cb36-17"><a href="#cb36-17"></a>dat.analytic1 <span class="ot">&lt;-</span> dat.analytic<span class="fl">.2</span>[<span class="fu">complete.cases</span>(dat.analytic<span class="fl">.2</span><span class="sc">$</span>stime.since.birth),]</span>
<span id="cb36-18"><a href="#cb36-18"></a><span class="fu">dim</span>(dat.analytic1)</span>
<span id="cb36-19"><a href="#cb36-19"></a><span class="co">#&gt; [1] 21011    16</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>dat.analytic2 <span class="ot">&lt;-</span> dat.analytic1[<span class="fu">complete.cases</span>(dat.analytic1<span class="sc">$</span>exposure.cat),]</span>
<span id="cb36-21"><a href="#cb36-21"></a><span class="fu">dim</span>(dat.analytic2)</span>
<span id="cb36-22"><a href="#cb36-22"></a><span class="co">#&gt; [1] 20950    16</span></span>
<span id="cb36-23"><a href="#cb36-23"></a><span class="fu">profile_missing</span>(dat.analytic2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div data-pagedtable="false">

<script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature"],"name":[1],"type":["fct"],"align":["left"]},{"label":["num_missing"],"name":[2],"type":["int"],"align":["right"]},{"label":["pct_missing"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"id","2":"0","3":"0"},{"1":"sex","2":"0","3":"0"},{"1":"race","2":"0","3":"0"},{"1":"race2","2":"0","3":"0"},{"1":"smoking.age","2":"0","3":"0"},{"1":"smoking","2":"0","3":"0"},{"1":"psu","2":"0","3":"0"},{"1":"strata","2":"0","3":"0"},{"1":"year","2":"0","3":"0"},{"1":"survey.weight.new","2":"0","3":"0"},{"1":"mort_stat","2":"0","3":"0"},{"1":"exposure.cat","2":"0","3":"0"},{"1":"stime.since.interview","2":"0","3":"0"},{"1":"stime.since.birth","2":"0","3":"0"},{"1":"status_all","2":"0","3":"0"},{"1":"year.cat","2":"0","3":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Profile of missing data after removing participants with missing outcome or exposure. This table confirms that no missing values remain in the key covariates.</p>
</div>
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co"># No missing values in covariates - complete case dataset </span></span>
<span id="cb37-3"><a href="#cb37-3"></a>dat.complete<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat.analytic2)</span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="fu">dim</span>(dat.complete<span class="fl">.2</span>)</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="co">#&gt; [1] 20950    16</span></span>
<span id="cb37-6"><a href="#cb37-6"></a></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="co"># Participants dropped - overall</span></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="fu">nrow</span>(dat.full.with.mortality<span class="fl">.2</span>) <span class="sc">-</span> <span class="fu">nrow</span>(dat.complete<span class="fl">.2</span>)</span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="co">#&gt; [1] 18206</span></span>
<span id="cb37-10"><a href="#cb37-10"></a></span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="co"># Participants dropped - due to missing exposure or outcome</span></span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="fu">nrow</span>(dat.analytic<span class="fl">.2</span>) <span class="sc">-</span> <span class="fu">nrow</span>(dat.analytic2)</span>
<span id="cb37-13"><a href="#cb37-13"></a><span class="co">#&gt; [1] 149</span></span>
<span id="cb37-14"><a href="#cb37-14"></a></span>
<span id="cb37-15"><a href="#cb37-15"></a><span class="co"># Participants dropped - due to missing covariates</span></span>
<span id="cb37-16"><a href="#cb37-16"></a><span class="fu">nrow</span>(dat.analytic2) <span class="sc">-</span> <span class="fu">nrow</span>(dat.complete<span class="fl">.2</span>)</span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb37-18"><a href="#cb37-18"></a></span>
<span id="cb37-19"><a href="#cb37-19"></a><span class="co"># added</span></span>
<span id="cb37-20"><a href="#cb37-20"></a><span class="fu">table</span>(dat.analytic<span class="fl">.2</span><span class="sc">$</span>exposure.cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb37-21"><a href="#cb37-21"></a><span class="co">#&gt; </span></span>
<span id="cb37-22"><a href="#cb37-22"></a><span class="co">#&gt;      Never smoked Started before 10  Started at 10-14  Started at 15-17 </span></span>
<span id="cb37-23"><a href="#cb37-23"></a><span class="co">#&gt;             12437               126              1497              2769 </span></span>
<span id="cb37-24"><a href="#cb37-24"></a><span class="co">#&gt;  Started at 18-20  Started after 20              &lt;NA&gt; </span></span>
<span id="cb37-25"><a href="#cb37-25"></a><span class="co">#&gt;              2440              1767                63</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Save the final analytic data for sensitivity analysis used below.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/saveSubAsian_418a40d351361e016f96899a39812fd9">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">save</span>(dat.complete<span class="fl">.2</span>, <span class="at">file =</span> <span class="st">"data/dat.complete.2.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="analysis-of-the-2011-2018-sub-period" class="level3" data-number="12.2.2"><h3 data-number="12.2.2" class="anchored" data-anchor-id="analysis-of-the-2011-2018-sub-period">
<span class="header-section-number">12.2.2</span> Analysis of the 2011-2018 Sub-period</h3>
<ul>
<li>R Code Chunk 7: Analysis</li>
</ul>
<p>The following code sets up the survey design object (<code>w.design.2.0</code>) specifically for the 2011-2018 sub-period. It uses the <code>psu</code>, <code>strata</code>, and <code>survey.weight.new</code> variables to correctly account for the complex sampling methodology within this subset of the data. This <code>w.design.2.0</code> object is essential for running survey-weighted models in this sensitivity analysis.</p>
<p>The following code sets up the survey design object for the 2011-2018 sub-period as in the main analysis.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/survey-design_fa72b919f52f544c4e2ec42e0267990d">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Set up the design </span></span>
<span id="cb39-2"><a href="#cb39-2"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>miss <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>miss[dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>id <span class="sc">%in%</span> dat.analytic2<span class="sc">$</span>id] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="fu">table</span>(dat.full.with.mortality<span class="fl">.2</span><span class="sc">$</span>miss)</span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co">#&gt; </span></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="co">#&gt;     0     1 </span></span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="co">#&gt; 20950 18206</span></span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a>w.design<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>psu, <span class="at">strata =</span> <span class="sc">~</span>strata, <span class="at">weights =</span> <span class="sc">~</span>survey.weight.new, </span>
<span id="cb39-10"><a href="#cb39-10"></a>                      <span class="at">data =</span> dat.full.with.mortality<span class="fl">.2</span>, <span class="at">nest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="co"># Subset the design</span></span>
<span id="cb39-13"><a href="#cb39-13"></a>w.design.<span class="fl">2.0</span> <span class="ot">&lt;-</span> <span class="fu">subset</span>(w.design<span class="fl">.2</span>, miss <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> survey.weight.new <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 8: Descriptive Statistics for Sub-period (<strong>Appendix Table 3</strong>)</li>
</ul>
<p>The following table reproduces <em>Appendix Table 3</em> from the paper. It summarizes the demographic characteristics of the cohort from the 2011-2018 NHANES cycles, stratified by smoking initiation categories, to provide context for this sensitivity analysis.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/Table3_147a8c49bbf361e049b9c68362b824fe">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Create the weighted table using the survey design object for the 2011-2018 data</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>tab_app_3_weighted <span class="ot">&lt;-</span> <span class="fu">svyCreateTableOne</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"race2"</span>),</span>
<span id="cb40-3"><a href="#cb40-3"></a>                                        <span class="at">strata =</span> <span class="st">"exposure.cat"</span>,</span>
<span id="cb40-4"><a href="#cb40-4"></a>                                        <span class="at">data =</span> w.design.<span class="fl">2.0</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>                                        <span class="at">addOverall =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-6"><a href="#cb40-6"></a>                                        <span class="at">test =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="co"># Print and format the table</span></span>
<span id="cb40-9"><a href="#cb40-9"></a>tab_app_3_printed <span class="ot">&lt;-</span> <span class="fu">print</span>(tab_app_3_weighted,</span>
<span id="cb40-10"><a href="#cb40-10"></a>                           <span class="at">format =</span> <span class="st">"p"</span>,</span>
<span id="cb40-11"><a href="#cb40-11"></a>                           <span class="at">catDigits =</span> <span class="dv">2</span>,</span>
<span id="cb40-12"><a href="#cb40-12"></a>                           <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-13"><a href="#cb40-13"></a>                           <span class="at">smd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-14"><a href="#cb40-14"></a></span>
<span id="cb40-15"><a href="#cb40-15"></a><span class="co"># Define the desired column order</span></span>
<span id="cb40-16"><a href="#cb40-16"></a>new_order_t3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"level"</span>, <span class="st">"Never smoked"</span>, <span class="st">"Started before 10"</span>, </span>
<span id="cb40-17"><a href="#cb40-17"></a>                  <span class="st">"Started at 10-14"</span>, <span class="st">"Started at 15-17"</span>, </span>
<span id="cb40-18"><a href="#cb40-18"></a>                  <span class="st">"Started at 18-20"</span>, <span class="st">"Started after 20"</span>, </span>
<span id="cb40-19"><a href="#cb40-19"></a>                  <span class="st">"Overall"</span>, <span class="st">"p"</span>, <span class="st">"test"</span>, <span class="st">"SMD"</span>)</span>
<span id="cb40-20"><a href="#cb40-20"></a></span>
<span id="cb40-21"><a href="#cb40-21"></a><span class="co"># Apply the new order to the table object</span></span>
<span id="cb40-22"><a href="#cb40-22"></a>tab_app_3 <span class="ot">&lt;-</span> tab_app_3_printed[, new_order_t3]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/displayT3_8a9a70f5b61dfbdc5fe03bc86cdc06e6">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Display the formatted table using kable for a clean Quarto output</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="fu">kable</span>(tab_app_3, <span class="at">caption =</span> <span class="st">"Appendix Table 3: Characteristics </span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="st">      of the study sample for the 2011-2018 NHANES cycles,</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="st">      stratified by smoking initiation age."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped table-sm small" data-quarto-postprocess="true">
<caption>Appendix Table 3: Characteristics of the study sample for the 2011-2018 NHANES cycles, stratified by smoking initiation age.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">level</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Never smoked</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Started before 10</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Started at 10-14</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Started at 15-17</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Started at 18-20</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Started after 20</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Overall</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">test</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">SMD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">128386920.10</td>
<td style="text-align: left;">1240174.76</td>
<td style="text-align: left;">16008335.09</td>
<td style="text-align: left;">32086914.62</td>
<td style="text-align: left;">26126847.18</td>
<td style="text-align: left;">15892076.56</td>
<td style="text-align: left;">219741268.30</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">race2 (%)</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">59.51</td>
<td style="text-align: left;">74.22</td>
<td style="text-align: left;">73.86</td>
<td style="text-align: left;">73.66</td>
<td style="text-align: left;">68.27</td>
<td style="text-align: left;">60.61</td>
<td style="text-align: left;">63.82</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.284</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Black</td>
<td style="text-align: left;">12.39</td>
<td style="text-align: left;">5.51</td>
<td style="text-align: left;">7.49</td>
<td style="text-align: left;">8.55</td>
<td style="text-align: left;">11.03</td>
<td style="text-align: left;">16.85</td>
<td style="text-align: left;">11.59</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Hispanic</td>
<td style="text-align: left;">17.72</td>
<td style="text-align: left;">11.12</td>
<td style="text-align: left;">12.94</td>
<td style="text-align: left;">11.46</td>
<td style="text-align: left;">12.77</td>
<td style="text-align: left;">12.87</td>
<td style="text-align: left;">15.48</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">7.62</td>
<td style="text-align: left;">1.33</td>
<td style="text-align: left;">1.31</td>
<td style="text-align: left;">2.14</td>
<td style="text-align: left;">3.40</td>
<td style="text-align: left;">5.30</td>
<td style="text-align: left;">5.65</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">2.76</td>
<td style="text-align: left;">7.82</td>
<td style="text-align: left;">4.40</td>
<td style="text-align: left;">4.19</td>
<td style="text-align: left;">4.53</td>
<td style="text-align: left;">4.36</td>
<td style="text-align: left;">3.45</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p><strong>Sub-Period Specific Analyses</strong> This subsection presents the Kaplan-Meier curve, unadjusted and adjusted Cox models for the 2011-2018 sub-period data, providing initial insights before delving into effect modification.</p>
<ul>
<li>R Code Chunk 9 : Kaplan-Meier Curves and Log-Rank Test for Sub-period</li>
</ul>
<p>The following code visualizes the survival probabilities for the 2011-2018 sub-period data using Kaplan-Meier curves, stratified by <code>exposure.cat</code>. It also performs a survey-weighted log-rank test to assess statistical differences between the survival curves in this specific subset of the data. The process is the same as the main analysis.</p>
<p><strong>Kaplan-Meier Survival Curves</strong></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/subPlot_af76819a00248df5a9b5b07b0ef27957">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>dummy_sub <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.factor</span>(w.design.<span class="fl">2.0</span><span class="sc">$</span>variables<span class="sc">$</span>exposure.cat)))</span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="co"># Define the survival formula for Kaplan-Meier plot and log-rank test</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>formulax0_sub <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat)</span>
<span id="cb42-5"><a href="#cb42-5"></a></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="co"># Calculate survey-weighted Kaplan-Meier curves for the sub-period</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>sA_sub<span class="ot">&lt;-</span><span class="fu">svykm</span>(formulax0_sub, <span class="at">design=</span>w.design.<span class="fl">2.0</span>)</span>
<span id="cb42-8"><a href="#cb42-8"></a></span>
<span id="cb42-9"><a href="#cb42-9"></a><span class="co"># Plot</span></span>
<span id="cb42-10"><a href="#cb42-10"></a><span class="fu">par</span>(<span class="at">oma=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb42-11"><a href="#cb42-11"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.1</span>)</span>
<span id="cb42-12"><a href="#cb42-12"></a><span class="fu">plot</span>(sA_sub, <span class="at">pars=</span><span class="fu">list</span>(<span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>dummy_sub)),</span>
<span id="cb42-13"><a href="#cb42-13"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>,</span>
<span id="cb42-14"><a href="#cb42-14"></a>     <span class="at">ylab =</span> <span class="st">"Proportion surviving"</span>)</span>
<span id="cb42-15"><a href="#cb42-15"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">levels</span>(<span class="fu">as.factor</span>(w.design.<span class="fl">2.0</span><span class="sc">$</span>variables<span class="sc">$</span>exposure.cat)),</span>
<span id="cb42-16"><a href="#cb42-16"></a>       <span class="at">col =</span> (<span class="dv">1</span><span class="sc">:</span>dummy_sub), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/subPlot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Sensitivity Analysis 2: Survey-Weighted Kaplan-Meier Curves</figcaption></figure>
</div>
</div>
</div>
<p><strong>Log-Rank Test</strong></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/sub-logrank_4a0ca0b717c624c5bbdb282839cc79e9">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Perform the survey-weighted log-rank test</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>lrt_sub <span class="ot">&lt;-</span> <span class="fu">svylogrank</span>(formulax0_sub,<span class="at">design=</span><span class="fu">subset</span>(w.design.<span class="fl">2.0</span>, survey.weight.new<span class="sc">&gt;</span><span class="dv">0</span>))</span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="fu">round</span>(lrt_sub[[<span class="dv">2</span>]],<span class="dv">2</span>)</span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co">#&gt; Chisq     p </span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="co">#&gt; 40.71  0.00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p><strong>Cox Proportional Hazards Models</strong></p>
<ul>
<li>R Code Chunk 10 : Unadjusted Cox Proportional Hazards Models for Sub-period</li>
</ul>
<p>The following code runs both unweighted (<code>coxph</code>) and survey-weighted (<code>svycoxph</code>) unadjusted Cox proportional hazards models on the sub-period data. These models serve as a baseline for comparison within this specific sensitivity analysis.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/unadjusted_8f973fd99bf60e7f6d7f9bb3831b9645">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Unweighted Cox model for sub-period</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat, </span>
<span id="cb44-3"><a href="#cb44-3"></a>              <span class="at">data =</span> dat.complete<span class="fl">.2</span>) </span>
<span id="cb44-4"><a href="#cb44-4"></a></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="co"># Survey-weighted unadjusted Cox model for sub-period</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat, </span>
<span id="cb44-7"><a href="#cb44-7"></a>                 <span class="at">design =</span> w.design.<span class="fl">2.0</span>) <span class="co"># Using w.design.2.0</span></span>
<span id="cb44-8"><a href="#cb44-8"></a>f0 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit0)</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="co"># Process unadjusted HRs for sub-period (similar to main analysis f0r)</span></span>
<span id="cb44-11"><a href="#cb44-11"></a>f0r <span class="ot">&lt;-</span> f0<span class="sc">$</span>regressionTable[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)] </span>
<span id="cb44-12"><a href="#cb44-12"></a>f0r<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Crude (Sub-period)"</span></span>
<span id="cb44-13"><a href="#cb44-13"></a>ci_f0_sub <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(f0r[,<span class="dv">2</span>], <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.,]</span><span class="sc">\\</span><span class="st">d+)?'</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-14"><a href="#cb44-14"></a>f0r<span class="sc">$</span>CI.l <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci_f0_sub[,<span class="dv">1</span>]))</span>
<span id="cb44-15"><a href="#cb44-15"></a>f0r<span class="sc">$</span>CI.u <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci_f0_sub[,<span class="dv">2</span>]))</span>
<span id="cb44-16"><a href="#cb44-16"></a><span class="fu">names</span>(f0r) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mean"</span>,<span class="st">"CI.95"</span>,<span class="st">"group"</span>,<span class="st">"lower"</span>,<span class="st">"upper"</span>)</span>
<span id="cb44-17"><a href="#cb44-17"></a>f0r </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 11: Adjusted Cox Proportional Hazards Model for Sub-period</li>
</ul>
<p>The following code fits the adjusted Cox proportional hazards model for the sub-period data, controlling for <code>sex</code>, <code>race2</code>, and <code>year.cat</code>.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/adjusted_9ea8e4af8a3273f47dc5b338b60d3fe1">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Survey-weighted adjusted Cox model for sub-period</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat <span class="sc">+</span> sex <span class="sc">+</span> race2 <span class="sc">+</span> year.cat,</span>
<span id="cb45-3"><a href="#cb45-3"></a>                 <span class="at">design =</span> w.design.<span class="fl">2.0</span>) </span>
<span id="cb45-4"><a href="#cb45-4"></a>f1 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit1)</span>
<span id="cb45-5"><a href="#cb45-5"></a></span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="co"># Process adjusted HRs for sub-period (similar to main analysis f1r)</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>f1r <span class="ot">&lt;-</span> f1<span class="sc">$</span>regressionTable[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb45-8"><a href="#cb45-8"></a>f1r<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Adjusted (Sub-period)"</span></span>
<span id="cb45-9"><a href="#cb45-9"></a>ci_f1_sub <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(f1r[,<span class="dv">2</span>], <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.,]</span><span class="sc">\\</span><span class="st">d+)?'</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-10"><a href="#cb45-10"></a>f1r<span class="sc">$</span>CI.l <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci_f1_sub[,<span class="dv">1</span>]))</span>
<span id="cb45-11"><a href="#cb45-11"></a>f1r<span class="sc">$</span>CI.u <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci_f1_sub[,<span class="dv">2</span>]))</span>
<span id="cb45-12"><a href="#cb45-12"></a><span class="fu">names</span>(f1r) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mean"</span>,<span class="st">"CI.95"</span>,<span class="st">"group"</span>,<span class="st">"lower"</span>,<span class="st">"upper"</span>)</span>
<span id="cb45-13"><a href="#cb45-13"></a>f1r </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 12: Effect Modification by Race/Ethnicity in Sub-period (Model)</li>
</ul>
<p>The following code fits the core model for the sub-period sensitivity analysis: a survey-weighted Cox proportional hazards model with an interaction term between <code>exposure.cat</code> and <code>race2</code>.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/subEM-race2_6123cc419b9adf8f82b7253974a1bc96">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Model</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat<span class="sc">*</span>race2 <span class="sc">+</span> sex  <span class="sc">+</span> year.cat,</span>
<span id="cb46-3"><a href="#cb46-3"></a>                           <span class="at">design =</span> w.design.<span class="fl">2.0</span>) <span class="co"># Using w.design.2.0</span></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="co">#&gt; Loglik converged before variable 24 ; coefficient may be infinite.</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>f2 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit2)</span>
<span id="cb46-7"><a href="#cb46-7"></a></span>
<span id="cb46-8"><a href="#cb46-8"></a><span class="co"># Process Race-Specific Hazard Ratios for Sub-period Plotting</span></span>
<span id="cb46-9"><a href="#cb46-9"></a>f2rW <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[<span class="dv">31</span><span class="sc">:</span><span class="dv">35</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb46-10"><a href="#cb46-10"></a>f2rB <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[<span class="dv">36</span><span class="sc">:</span><span class="dv">40</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb46-11"><a href="#cb46-11"></a>f2rH <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[<span class="dv">41</span><span class="sc">:</span><span class="dv">45</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb46-12"><a href="#cb46-12"></a>f2rA <span class="ot">&lt;-</span> f2<span class="sc">$</span>regressionTable[<span class="dv">46</span><span class="sc">:</span><span class="dv">50</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb46-13"><a href="#cb46-13"></a><span class="co"># Assign group labels</span></span>
<span id="cb46-14"><a href="#cb46-14"></a>f2rW<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"White (Sub-period)"</span></span>
<span id="cb46-15"><a href="#cb46-15"></a>f2rB<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Black (Sub-period)"</span></span>
<span id="cb46-16"><a href="#cb46-16"></a>f2rH<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Hispanic (Sub-period)"</span></span>
<span id="cb46-17"><a href="#cb46-17"></a>f2rA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Asian (Sub-period)"</span></span>
<span id="cb46-18"><a href="#cb46-18"></a>f2r <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f2rW, f2rB, f2rH, f2rA)</span>
<span id="cb46-19"><a href="#cb46-19"></a>ci <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(f2r[,<span class="dv">2</span>], <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.,]</span><span class="sc">\\</span><span class="st">d+)?'</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-20"><a href="#cb46-20"></a>f2r<span class="sc">$</span>CI.l <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci[,<span class="dv">1</span>]))</span>
<span id="cb46-21"><a href="#cb46-21"></a>f2r<span class="sc">$</span>CI.u <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci[,<span class="dv">2</span>]))</span>
<span id="cb46-22"><a href="#cb46-22"></a><span class="fu">names</span>(f2r) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mean"</span>,<span class="st">"CI.95"</span>,<span class="st">"group"</span>,<span class="st">"lower"</span>,<span class="st">"upper"</span>)</span>
<span id="cb46-23"><a href="#cb46-23"></a>f2r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>R Code Chunk 13: Effect Modification by Sex in Sub-period (Model)</li>
</ul>
<p>The following code fits a survey-weighted Cox proportional hazards model, including an interaction term between <code>exposure.cat</code> and <code>sex</code> for the sub-period data.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/subEM-sex_1e729dc45a296a190c706eb6e5ba5ac3">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">svycoxph</span>(<span class="fu">Surv</span>(stime.since.birth, status_all) <span class="sc">~</span> exposure.cat<span class="sc">*</span>sex <span class="sc">+</span> race2 <span class="sc">+</span> year.cat, <span class="co"># Using fit3</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>                 <span class="at">design =</span> w.design.<span class="fl">2.0</span>) </span>
<span id="cb47-3"><a href="#cb47-3"></a>f3 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit3)</span>
<span id="cb47-4"><a href="#cb47-4"></a></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co"># Process Sex-Specific Hazard Ratios for Sub-period Plotting</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>f3rM <span class="ot">&lt;-</span> f3<span class="sc">$</span>regressionTable[<span class="dv">16</span><span class="sc">:</span><span class="dv">20</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb47-7"><a href="#cb47-7"></a>f3rF <span class="ot">&lt;-</span> f3<span class="sc">$</span>regressionTable[<span class="dv">21</span><span class="sc">:</span><span class="dv">25</span>,<span class="fu">c</span>(<span class="st">"HazardRatio"</span>,<span class="st">"CI.95"</span>)]</span>
<span id="cb47-8"><a href="#cb47-8"></a></span>
<span id="cb47-9"><a href="#cb47-9"></a>f3rM<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Male (Sub-period)"</span></span>
<span id="cb47-10"><a href="#cb47-10"></a>f3rF<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">"Female (Sub-period)"</span></span>
<span id="cb47-11"><a href="#cb47-11"></a>f3r <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f3rM, f3rF)</span>
<span id="cb47-12"><a href="#cb47-12"></a>ci <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(f3r[,<span class="dv">2</span>], <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.,]</span><span class="sc">\\</span><span class="st">d+)?'</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-13"><a href="#cb47-13"></a>f3r<span class="sc">$</span>CI.l <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci[,<span class="dv">1</span>]))</span>
<span id="cb47-14"><a href="#cb47-14"></a>f3r<span class="sc">$</span>CI.u <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ci[,<span class="dv">2</span>]))</span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="fu">names</span>(f3r) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mean"</span>,<span class="st">"CI.95"</span>,<span class="st">"group"</span>,<span class="st">"lower"</span>,<span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="visualizing-the-sub-period-results" class="level3" data-number="12.2.3"><h3 data-number="12.2.3" class="anchored" data-anchor-id="visualizing-the-sub-period-results">
<span class="header-section-number">12.2.3</span> Visualizing the Sub-period Results</h3>
<ul>
<li>R Code Chunk 14: Plot</li>
</ul>
<p>The following code creates the plot using <code>ggplot2</code> and corresponds to <em>Appendix Figure 4</em> in section C.1, Sensitivity analysis with ‘Asian’ category, part of the supplementary materials published with the original paper.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/forest-plot_ae09fc3fe994de0e71c6c18365090a43">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>fr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(f2r)</span>
<span id="cb48-2"><a href="#cb48-2"></a>fr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fr)</span>
<span id="cb48-3"><a href="#cb48-3"></a>fr[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>)] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fr[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>)], as.numeric)</span>
<span id="cb48-4"><a href="#cb48-4"></a>fr<span class="sc">$</span>age.grp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Started before 10"</span>, <span class="st">"Started at 10-14"</span>, <span class="st">"Started at 15-17"</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>                <span class="st">"Started at 18-20"</span>, <span class="st">"Started after 20"</span>)</span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="co"># Change levels</span></span>
<span id="cb48-7"><a href="#cb48-7"></a>fr<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(fr<span class="sc">$</span>group,</span>
<span id="cb48-8"><a href="#cb48-8"></a>  <span class="st">"Non-Hispanic White"</span> <span class="ot">=</span> <span class="st">"White (Sub-period)"</span>,</span>
<span id="cb48-9"><a href="#cb48-9"></a>  <span class="st">"Non-Hispanic Black"</span> <span class="ot">=</span> <span class="st">"Black (Sub-period)"</span>,</span>
<span id="cb48-10"><a href="#cb48-10"></a>  <span class="st">"Hispanic"</span>           <span class="ot">=</span> <span class="st">"Hispanic (Sub-period)"</span>,</span>
<span id="cb48-11"><a href="#cb48-11"></a>  <span class="st">"Asian"</span>              <span class="ot">=</span> <span class="st">"Asian (Sub-period)"</span></span>
<span id="cb48-12"><a href="#cb48-12"></a>)</span>
<span id="cb48-13"><a href="#cb48-13"></a></span>
<span id="cb48-14"><a href="#cb48-14"></a><span class="co"># Re-order</span></span>
<span id="cb48-15"><a href="#cb48-15"></a>fr<span class="sc">$</span>age.grp <span class="ot">&lt;-</span> <span class="fu">factor</span>(fr<span class="sc">$</span>age.grp,</span>
<span id="cb48-16"><a href="#cb48-16"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Started before 10"</span>,</span>
<span id="cb48-17"><a href="#cb48-17"></a>                                <span class="st">"Started at 10-14"</span>,</span>
<span id="cb48-18"><a href="#cb48-18"></a>                                <span class="st">"Started at 15-17"</span>,</span>
<span id="cb48-19"><a href="#cb48-19"></a>                                <span class="st">"Started at 18-20"</span>,</span>
<span id="cb48-20"><a href="#cb48-20"></a>                                <span class="st">"Started after 20"</span>))</span>
<span id="cb48-21"><a href="#cb48-21"></a></span>
<span id="cb48-22"><a href="#cb48-22"></a>fr<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(fr<span class="sc">$</span>group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Asian"</span>, <span class="st">"Hispanic"</span>, </span>
<span id="cb48-23"><a href="#cb48-23"></a>                                        <span class="st">"Non-Hispanic Black"</span>, <span class="st">"Non-Hispanic White"</span>))</span>
<span id="cb48-24"><a href="#cb48-24"></a></span>
<span id="cb48-25"><a href="#cb48-25"></a><span class="co"># Plot</span></span>
<span id="cb48-26"><a href="#cb48-26"></a><span class="fu">ggplot</span>(fr, <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> group, <span class="at">colour =</span> age.grp)) <span class="sc">+</span> </span>
<span id="cb48-27"><a href="#cb48-27"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb48-28"><a href="#cb48-28"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmax =</span> lower, <span class="at">xmin =</span> upper), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb48-29"><a href="#cb48-29"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span> </span>
<span id="cb48-30"><a href="#cb48-30"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Hazard Ratio"</span>, <span class="at">y =</span> <span class="st">""</span>, </span>
<span id="cb48-31"><a href="#cb48-31"></a>       <span class="at">legend=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"Age group"</span>) <span class="sc">+</span></span>
<span id="cb48-32"><a href="#cb48-32"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb48-33"><a href="#cb48-33"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb48-34"><a href="#cb48-34"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb48-35"><a href="#cb48-35"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>), </span>
<span id="cb48-36"><a href="#cb48-36"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb48-37"><a href="#cb48-37"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb48-38"><a href="#cb48-38"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb48-39"><a href="#cb48-39"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb48-40"><a href="#cb48-40"></a>        <span class="at">legend.position=</span><span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/forest-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Appendix Figure 4: Forest plot of Hazard Ratios from the sensitivity analysis with ‘Asian’ category.</figcaption></figure>
</div>
</div>
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">ggsave</span>(<span class="st">"images/forest2.png"</span>)</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co">#&gt; Saving 7 x 5 in image</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This concludes the sensitivity analysis.</p>
<hr style="border: none; border-top: 3px solid black; width: 100%; margin-top: 1em; margin-bottom: 1em;"></section></section><section id="appendix-b-exploratory-analysis-of-smoking-duration" class="level2" data-number="12.3"><h2 data-number="12.3" class="anchored" data-anchor-id="appendix-b-exploratory-analysis-of-smoking-duration">
<span class="header-section-number">12.3</span> Appendix B: Exploratory Analysis of Smoking Duration</h2>
<p>As noted in the main paper, the duration of smoking is a potential mediator in the pathway from early smoking initiation to mortality. To investigate this secondary relationship, we create boxplots to visualize smoking duration across the different age-of-initiation categories. The following analysis uses the data we set aside earlier (<code>dat.analytic.duration.analysis</code>). This analysis reproduces Appendix Figures 1, 2, and 3 from the paper.</p>
<p><strong>NOTE</strong>: This analysis is based on participants from 1999-2016, as the variable for age of smoking cessation (<code>SMD055</code>) was not collected in the 2017-2018 cycle.</p>
<section id="data-preparation-for-duration-plots" class="level3" data-number="12.3.1"><h3 data-number="12.3.1" class="anchored" data-anchor-id="data-preparation-for-duration-plots">
<span class="header-section-number">12.3.1</span> Data Preparation for Duration Plots</h3>
<ul>
<li>R Code Chunk 1: Prepare Data for Duration Analysis</li>
</ul>
<p>The following code processes the data to calculate smoking duration by cleaning the age variables, computing the difference, correcting for data entry errors, and saving the final, plot-ready dataset.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/create-duration-data_de5ef1bd45d72c9b2909d1f213a157f1">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Clean the 'smoking.age' variable before calculation.</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="co"># Recode 0 and 99 (codes for never-smokers) to NA.</span></span>
<span id="cb50-3"><a href="#cb50-3"></a>dat.analytic.duration.analysis<span class="sc">$</span>smoking.age[dat.analytic.duration.analysis<span class="sc">$</span>smoking.age <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>dat.analytic.duration.analysis<span class="sc">$</span>smoking.age[dat.analytic.duration.analysis<span class="sc">$</span>smoking.age <span class="sc">==</span> <span class="dv">99</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb50-5"><a href="#cb50-5"></a></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="co"># Calculate smoking duration.</span></span>
<span id="cb50-7"><a href="#cb50-7"></a>dat.analytic.duration.analysis<span class="sc">$</span>smoking.duration <span class="ot">&lt;-</span> dat.analytic.duration.analysis<span class="sc">$</span>smoking.quit.age <span class="sc">-</span> dat.analytic.duration.analysis<span class="sc">$</span>smoking.age</span>
<span id="cb50-8"><a href="#cb50-8"></a></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="co"># Correct any negative durations (from data entry errors) to 0.</span></span>
<span id="cb50-10"><a href="#cb50-10"></a>dat.analytic.duration.analysis<span class="sc">$</span>smoking.duration[<span class="sc">!</span><span class="fu">is.na</span>(dat.analytic.duration.analysis<span class="sc">$</span>smoking.duration) <span class="sc">&amp;</span> dat.analytic.duration.analysis<span class="sc">$</span>smoking.duration <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-11"><a href="#cb50-11"></a></span>
<span id="cb50-12"><a href="#cb50-12"></a><span class="co"># Run the original summary checks to explore the new variable.</span></span>
<span id="cb50-13"><a href="#cb50-13"></a><span class="fu">cat</span>(<span class="st">"Total number of participants with non-missing smoking duration data:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-14"><a href="#cb50-14"></a><span class="co">#&gt; Total number of participants with non-missing smoking duration data:</span></span>
<span id="cb50-15"><a href="#cb50-15"></a><span class="fu">print</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat.analytic.duration.analysis<span class="sc">$</span>smoking.duration)))</span>
<span id="cb50-16"><a href="#cb50-16"></a><span class="co">#&gt; [1] 8916</span></span>
<span id="cb50-17"><a href="#cb50-17"></a></span>
<span id="cb50-18"><a href="#cb50-18"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Summary of smoking duration for all ever-smokers:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-19"><a href="#cb50-19"></a><span class="co">#&gt; </span></span>
<span id="cb50-20"><a href="#cb50-20"></a><span class="co">#&gt; Summary of smoking duration for all ever-smokers:</span></span>
<span id="cb50-21"><a href="#cb50-21"></a><span class="fu">print</span>(<span class="fu">summary</span>(dat.analytic.duration.analysis<span class="sc">$</span>smoking.duration))</span>
<span id="cb50-22"><a href="#cb50-22"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb50-23"><a href="#cb50-23"></a><span class="co">#&gt;    0.00    8.00   18.00   19.99   30.00   68.00   41908</span></span>
<span id="cb50-24"><a href="#cb50-24"></a></span>
<span id="cb50-25"><a href="#cb50-25"></a><span class="co"># Create the final data frame for plotting by filtering out non-smokers.</span></span>
<span id="cb50-26"><a href="#cb50-26"></a>dat.analytic.plot <span class="ot">&lt;-</span> dat.analytic.duration.analysis <span class="sc">%&gt;%</span> </span>
<span id="cb50-27"><a href="#cb50-27"></a>  <span class="fu">filter</span>(<span class="sc">!</span>exposure.cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Never smoked"</span>, <span class="cn">NA</span>))</span>
<span id="cb50-28"><a href="#cb50-28"></a></span>
<span id="cb50-29"><a href="#cb50-29"></a><span class="co"># Save the final plot-ready data.</span></span>
<span id="cb50-30"><a href="#cb50-30"></a><span class="fu">saveRDS</span>(dat.analytic.plot, <span class="at">file =</span> <span class="st">"data/duration_plot_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="visualizing-smoking-duration-by-initiation-age" class="level3" data-number="12.3.2"><h3 data-number="12.3.2" class="anchored" data-anchor-id="visualizing-smoking-duration-by-initiation-age">
<span class="header-section-number">12.3.2</span> Visualizing Smoking Duration by Initiation Age</h3>
<ul>
<li>R Code Chunk 2: Smoking Duration Plots</li>
</ul>
<p>Now, the following code uses the <code>dat.analytic.plot</code> data version to calculate the median smoking duration for each exposure category, which will be used to draw a trend line on the plots.</p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/median_2abcc00dea26a11e912740a1cef020e1">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Pre-calculate medians for the trend line</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>median_data <span class="ot">&lt;-</span> dat.analytic.plot <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="fu">group_by</span>(exposure.cat) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(smoking.duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>  <span class="fu">arrange</span>(<span class="fu">factor</span>(exposure.cat, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'Started before 10'</span>,</span>
<span id="cb51-6"><a href="#cb51-6"></a>                                         <span class="st">'Started at 10-14'</span>,</span>
<span id="cb51-7"><a href="#cb51-7"></a>                                         <span class="st">"Started at 15-17"</span>,</span>
<span id="cb51-8"><a href="#cb51-8"></a>                                         <span class="st">"Started at 18-20"</span>,</span>
<span id="cb51-9"><a href="#cb51-9"></a>                                         <span class="st">"Started after 20"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following code chunks generate the three plots corresponding to <strong>Appendix Figures 1, 2, and 3</strong> in the paper’s supplementary material.</p>
<p><strong>Appendix Figure 1: Overall Smoking Duration</strong></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/app-plot1_634694f05ae95d607d5bc6c1109dbc87">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">ggplot</span>(dat.analytic.plot, <span class="fu">aes</span>(<span class="at">x =</span> exposure.cat, <span class="at">y =</span> smoking.duration, <span class="at">group =</span> exposure.cat)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> median_data, <span class="fu">aes</span>(<span class="at">x =</span> exposure.cat, <span class="at">y =</span> median, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">span =</span> <span class="fl">0.5</span>, <span class="at">level =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-7"><a href="#cb52-7"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb52-8"><a href="#cb52-8"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-9"><a href="#cb52-9"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-10"><a href="#cb52-10"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb52-11"><a href="#cb52-11"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb52-12"><a href="#cb52-12"></a>  ) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Smoking Duration (Years)"</span>,</span>
<span id="cb52-14"><a href="#cb52-14"></a>       <span class="at">title =</span> <span class="st">"Boxplot of Smoking Duration by Exposure Category"</span>)</span>
<span id="cb52-15"><a href="#cb52-15"></a><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/app-plot1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Smoking duration by age of initiation category among ever-smokers.</figcaption></figure>
</div>
</div>
</div>
<p><strong>Appendix Figure 2: Stratified by Sex</strong></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/app-plot2_e39fa31b904b3598ded50d96b6516da2">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">ggplot</span>(dat.analytic.plot, <span class="fu">aes</span>(<span class="at">x =</span> exposure.cat, <span class="at">y =</span> smoking.duration, <span class="at">group =</span> exposure.cat)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> median_data, <span class="fu">aes</span>(<span class="at">x =</span> exposure.cat, <span class="at">y =</span> median, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">span =</span> <span class="fl">0.5</span>, <span class="at">level =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sex) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>  <span class="fu">theme</span>(</span>
<span id="cb53-8"><a href="#cb53-8"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb53-9"><a href="#cb53-9"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-10"><a href="#cb53-10"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-11"><a href="#cb53-11"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb53-12"><a href="#cb53-12"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb53-13"><a href="#cb53-13"></a>  ) <span class="sc">+</span></span>
<span id="cb53-14"><a href="#cb53-14"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Smoking Duration (Years)"</span>,</span>
<span id="cb53-15"><a href="#cb53-15"></a>       <span class="at">title =</span> <span class="st">"Boxplot of Smoking Duration by Exposure Category"</span>)</span>
<span id="cb53-16"><a href="#cb53-16"></a><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/app-plot2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Smoking duration by age of initiation, stratified by sex.</figcaption></figure>
</div>
</div>
</div>
<p><strong>Appendix Figure 3: Stratified by Race/Ethnicity</strong></p>
<div class="cell" data-hash="10-sensitivity-analysis_cache/html/app-plot3_a7f4452902a2d6ba902784a2aae70bd8">
<details><summary>Show/Hide Code</summary><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">levels</span>(dat.analytic.plot<span class="sc">$</span>race)[<span class="fu">levels</span>(dat.analytic.plot<span class="sc">$</span>race) <span class="sc">==</span> <span class="st">"White"</span>] <span class="ot">&lt;-</span> <span class="st">"Non-Hispanic White"</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="fu">levels</span>(dat.analytic.plot<span class="sc">$</span>race)[<span class="fu">levels</span>(dat.analytic.plot<span class="sc">$</span>race) <span class="sc">==</span> <span class="st">"Black"</span>] <span class="ot">&lt;-</span> <span class="st">"Non-Hispanic Black"</span></span>
<span id="cb54-3"><a href="#cb54-3"></a></span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="fu">ggplot</span>(dat.analytic.plot, <span class="fu">aes</span>(<span class="at">x =</span> exposure.cat, <span class="at">y =</span> smoking.duration, <span class="at">group =</span> exposure.cat)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> median_data, <span class="fu">aes</span>(<span class="at">x =</span> exposure.cat, <span class="at">y =</span> median, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">span =</span> <span class="fl">0.5</span>, <span class="at">level =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>race) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-11"><a href="#cb54-11"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb54-12"><a href="#cb54-12"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-13"><a href="#cb54-13"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-14"><a href="#cb54-14"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb54-15"><a href="#cb54-15"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb54-16"><a href="#cb54-16"></a>  ) <span class="sc">+</span></span>
<span id="cb54-17"><a href="#cb54-17"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Smoking Duration (Years)"</span>,</span>
<span id="cb54-18"><a href="#cb54-18"></a>       <span class="at">title =</span> <span class="st">"Boxplot of Smoking Duration by Exposure Category"</span>)</span>
<span id="cb54-19"><a href="#cb54-19"></a><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="10-sensitivity-analysis_files/figure-html/app-plot3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Smoking duration by age of initiation, stratified by race/ethnicity.</figcaption></figure>
</div>
</div>
</div>
</section><section id="interpretation-of-results" class="level3" data-number="12.3.3"><h3 data-number="12.3.3" class="anchored" data-anchor-id="interpretation-of-results">
<span class="header-section-number">12.3.3</span> Interpretation of Results</h3>
<p>The boxplots consistently show a clear inverse relationship. The median smoking duration (indicated by the grey dashed line) is highest for those who started smoking before age 10 and steadily decreases for groups that started later in life. This trend holds true when the data is stratified by both sex and race/ethnicity. This visual evidence supports the hypothesis that <strong>earlier smoking initiation leads to a longer cumulative exposure to tobacco</strong>, which is a likely mediator in the pathway to increased mortality risk.</p>
</section></section><section id="chapter-summary-and-next-steps" class="level2" data-number="12.4"><h2 data-number="12.4" class="anchored" data-anchor-id="chapter-summary-and-next-steps">
<span class="header-section-number">12.4</span> Chapter Summary and Next Steps</h2>
<p>We have now completed two important sensitivity analyses to test the robustness of our primary findings. First, we adjusted for socioeconomic status proxies, and second, we re-ran the effect modification analysis on the 2011-2018 data to include the non-Hispanic Asian category. The results from both analyses were largely consistent with the main findings, strengthening our confidence in the conclusions.</p>
<p>We also completed the exploratory analysis which suggested a potential mechanism for our findings, showing that earlier smoking initiation is strongly associated with a longer lifetime smoking duration.</p>
<p>With the analytical portion complete, the next chapter, “Discussion of Results,” will synthesize the findings from all analyses and interpret their meaning.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./09-effect-modification.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Effect Modification Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-discussion.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Discussion of Results</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>