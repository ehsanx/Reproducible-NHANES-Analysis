[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Analyzing Early Smoking Initiation and Mortality",
    "section": "",
    "text": "1 Reproducing the Analysis: Early Smoking Initiation and Mortality\nWelcome! This technical documentation provides a comprehensive and transparent guide for reproducing the analysis from the published paper:\nBy documenting the complete analytical pipeline‚Äîfrom raw data processing to the final statistical models‚Äîthis guide allows researchers to fully understand and replicate the study, or to adapt this framework for new research questions."
  },
  {
    "objectID": "index.html#about-this-guide",
    "href": "index.html#about-this-guide",
    "title": "Analyzing Early Smoking Initiation and Mortality",
    "section": "1.1 About This Guide",
    "text": "1.1 About This Guide\nThis guide is designed for researchers, students, and public health analysts interested in longitudinal data analysis using NHANES. It demonstrates a complete workflow, including:\n\nData Acquisition: Programmatically downloading and merging multiple cycles of NHANES data.\nData Cleaning: Harmonizing variables that change across survey years.\nComplex Survey Analysis: Correctly applying survey weights, strata, and clusters for nationally representative estimates.\nSurvival Modeling: Implementing Kaplan-Meier curves, Cox proportional hazards models, and effect modification analysis."
  },
  {
    "objectID": "index.html#book-structure",
    "href": "index.html#book-structure",
    "title": "Analyzing Early Smoking Initiation and Mortality",
    "section": "1.2 Book Structure",
    "text": "1.2 Book Structure\nThis book is structured to guide you through each stage of the analysis:\n\nPart I: Introduction and Background\n\nSets the context for the study, provides an overview of the NHANES data, and outlines the research objectives.\n\nPart II: Data Preparation\n\nDetails the steps for downloading, cleaning, and merging the raw NHANES and mortality linkage files to create the final analytic dataset.\n\nPart III: Statistical Analysis\n\nElaborates on the complex survey design specification and the various statistical models employed, including survival analysis, effect modification, and sensitivity analyses.\n\nPart IV: Discussion\n\nPresents the key findings of the analysis, discusses their implications in the context of the original paper, and outlines limitations and future directions.\n\n\nLet‚Äôs get started!"
  },
  {
    "objectID": "01-overview.html#how-to-use-this-guide",
    "href": "01-overview.html#how-to-use-this-guide",
    "title": "\n2¬† Overview of the Study\n",
    "section": "\n2.1 How to Use This Guide üìñ",
    "text": "2.1 How to Use This Guide üìñ\nThis Quarto book is designed to be a transparent and comprehensive guide for reproducing the original analysis.\n\n\nIntended Audience: This guide is for researchers, public health analysts, and students with a foundational understanding of R and statistical concepts like survival analysis.\n\nRequired Software: To run the code in this walkthrough, you will need R (version 4.2.2 or later) and RStudio. The code relies on several key R packages, including nhanesA, survey, survival, and ggplot2, which are loaded at the beginning of each relevant chapter.\n\nA Note on Reproducibility: The primary goal is to allow other researchers to validate these findings and build upon them. By documenting the complete analytical pipeline, this guide supports the principles of open and reproducible science."
  },
  {
    "objectID": "01-overview.html#motivation",
    "href": "01-overview.html#motivation",
    "title": "\n2¬† Overview of the Study\n",
    "section": "\n2.2 Motivation üß†",
    "text": "2.2 Motivation üß†\nThe motive behind this study was to better understand the link between smoking initiation age and mortality across different demographic groups. Cigarette smoking remains a leading preventable cause of premature death in the U.S., accounting for over 480,000 deaths annually. Clarifying how this risk varies across populations is essential for developing targeted public health interventions that address the specific needs and risks within different communities, thereby enhancing the precision and relevance of health policies."
  },
  {
    "objectID": "01-overview.html#research-objectives",
    "href": "01-overview.html#research-objectives",
    "title": "\n2¬† Overview of the Study\n",
    "section": "\n2.3 Research Objectives üéØ",
    "text": "2.3 Research Objectives üéØ\nThis study addresses two primary objectives:\n\nTo re-assess the relationship between the initial age of cigarette smoking and overall mortality.\nTo examine how this relationship is modified by race/ethnicity and sex.\n\nTo investigate these objectives, the analysis utilizes data from U.S. adults aged 20-79 who participated in the 1999‚Äì2018 National Health and Nutrition Examination Survey (NHANES). Mortality data was provided by the National Center for Health Statistics (NCHS) through a linkage with public-use death records."
  },
  {
    "objectID": "01-overview.html#analytical-approach",
    "href": "01-overview.html#analytical-approach",
    "title": "\n2¬† Overview of the Study\n",
    "section": "\n2.4 Analytical Approach üõ†Ô∏è",
    "text": "2.4 Analytical Approach üõ†Ô∏è\nTo address the research objectives, the paper employed multiple analytic approaches. The main survival analysis directly answers the two primary research questions, followed by additional analyses to explore potential mediators and validate the main conclusions.\nThis tutorial will replicate the following key analyses performed in the original paper:\n\n\nDescriptive Analysis: Reproduces Appendix Tables 1 & 2 results.\n\nMain Survival Analysis: Establishes the primary link between smoking initiation age and mortality using Kaplan-Meier Curves: Figure 1. Cox Proportional Hazards Model results are incorporated in Figure 2 in the main paper.\n\nEffect Modification Analysis: It then investigates how this relationship is modified by race/ethnicity and sex. This corresponds to Figure 2 in the main paper and Appendix Tables 4 and 5 in the supplementary material.\n\nExploratory Analysis: Investigates the secondary relationship between the age of smoking initiation and the total duration of smoking using boxplots. This corresponds to Appendix Figures 1-3 in the supplementary material.\n\nSensitivity Analysis 1: Adjusts for socioeconomic status (SES) proxies, such as family income and education, to check for confounding. This corresponds to Appendix Figure 5 in the supplementary material.\n\nSensitivity Analysis 2: Repeats the analysis on data from the 2011‚Äì2018 cycles to include the ‚Äúnon-Hispanic Asian‚Äù category, which was introduced in the 2011 NHANES survey. This corresponds to Appendix Table 3 and Appendix Figure 4 in the supplementary material."
  },
  {
    "objectID": "01-overview.html#summary-of-findings",
    "href": "01-overview.html#summary-of-findings",
    "title": "\n2¬† Overview of the Study\n",
    "section": "\n2.5 Summary of Findings üìä",
    "text": "2.5 Summary of Findings üìä\nThe final statistical analysis included 50,549 participants. The study found that early smoking initiation was significantly associated with a higher risk of all-cause mortality across all age groups, with earlier starting ages having higher hazard ratios. Furthermore, this association was observed to differ across race/ethnicity and sex, with the interaction by sex being statistically significant."
  },
  {
    "objectID": "02-nhanes-overview.html#description-of-nhanes",
    "href": "02-nhanes-overview.html#description-of-nhanes",
    "title": "3¬† NHANES Data Overview",
    "section": "3.1 Description of NHANES üìä",
    "text": "3.1 Description of NHANES üìä\nNHANES is a continuous program of studies run by the Centers for Disease Control and Prevention (CDC) that began in the 1960s. It is designed to assess the health and nutritional status of the U.S. population. Since 1999, the program has been conducted in 2-year cycles. Further details about the program can be found on the main NHANES website at the CDC.\n\n3.1.1 Why NHANES for this study?\n\nNational Representativeness: NHANES uses a complex, multi-stage probability sampling design to be representative of the entire noninstitutionalized U.S. civilian population.\nRich Data: It collects a wide range of data through interviews, physical examinations, and laboratory tests.\nPublic Availability: The data files are publicly available online, which allows researchers to easily retrieve and use the data, promoting transparency and reproducibility.\n\nThis study utilizes data from 10 consecutive cycles spanning 1999-2018, providing a robust, long-term dataset for analysis."
  },
  {
    "objectID": "02-nhanes-overview.html#survey-design",
    "href": "02-nhanes-overview.html#survey-design",
    "title": "3¬† NHANES Data Overview",
    "section": "3.2 Survey Design üèóÔ∏è",
    "text": "3.2 Survey Design üèóÔ∏è\nThe NHANES survey design is complex and must be accounted for in any analysis to produce valid, generalizable results. The procedure involves four main stages:\n\nStage 1: Primary Sampling Units (PSUs) - PSUs, which are mostly counties, are selected with a higher probability for more populated areas.\nStage 2: Segments within PSUs - Each PSU is divided into smaller geographic areas (like city blocks), and a sample of these segments is drawn.\nStage 3: Households within Segments - A sample of households is chosen, with over-sampling of certain populations (e.g., low-income persons, specific racial/ethnic groups) to ensure sufficient numbers for meaningful analysis.\nStage 4: Individuals within Households - Individuals are randomly selected from within the chosen households.\n\nThe CDC provides detailed documentation on how to correctly analyze this complex survey data. More information can be found in the NHANES Analytic Guidelines.\n\n\n\n\n\n\nWhy This Matters\n\n\n\nThis multi-stage design requires the use of special survey weights, strata, and PSU variables in any statistical analysis. Ignoring these design elements would lead to biased estimates and incorrect standard errors, potentially invalidating the study‚Äôs conclusions."
  },
  {
    "objectID": "02-nhanes-overview.html#mortality-linkage",
    "href": "02-nhanes-overview.html#mortality-linkage",
    "title": "3¬† NHANES Data Overview",
    "section": "3.3 Mortality Linkage üîó",
    "text": "3.3 Mortality Linkage üîó\nA key advantage of NHANES is the ability to link participant data with the National Death Index (NDI). The NCHS periodically performs this linkage to create public-use Linked Mortality Files (LMF), which provide mortality follow-up information for adult participants. The official Public-use Linked Mortality Files are available from the NCHS Data Linkage Program.\nKey variables from the LMF used in this analysis include:\n\nMortality Status (MORTSTAT): Indicates whether a participant is deceased or presumed alive at the end of the follow-up period.\nFollow-up Time (PERMTH_INT): The duration, in months, from the participant‚Äôs survey interview date until the date of death or the end of the follow-up period.\n\nBy incorporating this mortality data, the cross-sectional NHANES survey is effectively transformed into a prospective cohort study. This powerful feature allows us to link baseline characteristics collected at the time of the survey to long-term health outcomes like all-cause mortality, which is the foundation of our research question."
  },
  {
    "objectID": "03a-download-merge.html#data-acquisition-and-merging",
    "href": "03a-download-merge.html#data-acquisition-and-merging",
    "title": "\n4¬† Data Download and Merging\n",
    "section": "\n4.1 Data Acquisition and Merging",
    "text": "4.1 Data Acquisition and Merging\n\nR Code Chunk 1: Load Necessary Packages\n\nBefore we begin the analysis, we import the necessary libraries to ensure we can use the certain functions. The nhanesA package is essential, as it provides functions to directly access and import the National Health and Nutrition Examination Survey (NHANES) datasets. In this package, data files from the 10 cycles (1999‚Äì2018) are denoted by lettered suffixes. For example, the demographics file for 1999‚Äì2000 is named DEMO, while subsequent cycles are named DEMO_B, DEMO_C, and up to the letter J. Other key packages are loaded to support data manipulation, variable recoding and merging.\n\nShow/Hide Code# Load required packages\nlibrary(nhanesA)\nlibrary(car)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(DataExplorer)\nlibrary(ggplot2)\nlibrary(grid)\nlibrary(gridExtra)\n\n\n\n\nR Code Chunk 2: Define NHANES Datasets by Cycle\n\nThe first step in our workflow is to define character vectors using c() that contain the specific names of the NHANES data files we need to download. Following the nhanesA package‚Äôs naming convention, we create two vectors: demo for the demographic data files and smoking for the smoking questionnaire files, each covering the 10 cycles from 1999 to 2018.\n\nShow/Hide Codedemo &lt;- c(\"DEMO\", \"DEMO_B\", \"DEMO_C\", \"DEMO_D\", \"DEMO_E\", \n          \"DEMO_F\", \"DEMO_G\", \"DEMO_H\", \"DEMO_I\", \"DEMO_J\")\n\nsmoking &lt;- c(\"SMQ\", \"SMQ_B\", \"SMQ_C\", \"SMQ_D\", \"SMQ_E\",\n             \"SMQ_F\", \"SMQ_G\", \"SMQ_H\", \"SMQ_I\", \"SMQ_J\")\n\n\n\n\nR Code Chunk 3: Download and Process NHANES Data\n\nThis code section covers several key steps: downloading the raw data, defining the variables of interest, and then subsetting and processing the data files.\n1. Download Raw Data\nWith the data files‚Äô names defined in the lists demo and smoking, we now use the lapply() function to iterate through each vector and download the corresponding data files using nhanesA::nhanes(). For reproducibility and to avoid re-downloading the data every time the script is run, we save these lists of raw data files as .rds files into a data/ subdirectory.\n\n\n\n\n\n\nNote\n\n\n\nWe will heavily use the lapply() function in this section. This is a more efficient and readable alternative to a for loop in R for applying the same operation to each element of a list (in our case, each data file name).\n\n\n\nShow/Hide Codedemo_list &lt;- lapply(demo, nhanes)\ndemo_data_files &lt;- demo_list\nsaveRDS(demo_data_files, \"data/demo_data_files.rds\")\n\nsmoking_list &lt;- lapply(smoking, nhanes)\nsmoking_data_files &lt;- smoking_list\nsaveRDS(smoking_data_files, \"data/smoking_data_files.rds\")\n\n\n2. Define Variables for Selection\nNext, we define the specific variables (columns) we want to keep for our analysis. We create two vectors, demo_columns and smoking_columns, listing our variables of interest.\nIt is important to note a key inconsistency across the NHANES cycles: the variable for the participant‚Äôs country of birth changes its name over time (DMDBORN, DMDBORN2, DMDBORN4). We include all three variations in our list to ensure we capture this information from every cycle. This will be changed into a single variable name later.\nFor the demographic data, we selected the following key columns:\n\n\nSEQN: Respondent sequence number (unique identifier).\n\nRIDAGEYR: Age in years at screening.\n\nRIAGENDR: Gender.\n\nRIDRETH1: Race and ethnicity.\n\nDMDBORN / DMDBORN2 / DMDBORN4: Country of birth.\n\nSDDSRVYR: NHANES survey cycle year.\n\nWTINT2YR: Full sample 2-year interview weight.\n\nWTMEC2YR: Full sample 2-year Mobile Examination Center (MEC) exam weight.\n\nSDMVPSU: Masked variance pseudo-Primary Sampling Unit.\n\nSDMVSTRA: Masked variance pseudo-stratum.\n\nFor the smoking data, we selected the following key columns:\n\n\nSEQN: Respondent sequence number.\n\nSMQ020: Indicates if respondent smoked at least 100 cigarettes in life.\n\nSMD030: Age respondent started smoking cigarettes regularly.\n\nSMQ040: Current cigarette smoking status\n\n\nShow/Hide Codedemo_columns &lt;- c(\"SEQN\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH1\", \n                  \"DMDBORN\", \"DMDBORN2\", \"DMDBORN4\", \"SDDSRVYR\", \n                  \"WTINT2YR\", \"WTMEC2YR\", \"SDMVPSU\", \"SDMVSTRA\") \n\nsmoking_columns &lt;- c(\"SEQN\", \"SMQ020\", \"SMD030\", \"SMQ040\") \n\n\n3. Subset Data and Translate Codes\nThe final step in this section is to process the raw data. We iterate through each downloaded data file in the lists, demo_data_files and smoking_data_files, and perform two key operations:\n\nSelect Columns: We use dplyr::select() with the any_of() helper to keep only the columns defined above in demo_columns and smoking_columns. Using any_of() prevents errors if a column name (e.g., DMDBORN2) doesn‚Äôt exist in a particular data file.\nTranslate Codes: We use nhanesA::nhanesTranslate() to convert the numeric codes in the data (e.g., 1 for ‚ÄòMale‚Äô) into more descriptive, human-readable factor labels.\n\nThe newly processed lists of data frames are stored in demo_data_files_2 and smoking_data_files_2.\n\nShow/Hide Code# DEMOGRAPHICS\ndemo_data_files_2 &lt;- lapply(seq_along(demo_data_files), function(i) {\n  current_cycle_data &lt;- demo_data_files[[i]]\n  original &lt;- demo[i] \n  \n  # Select Columns\n  subset_data &lt;- current_cycle_data %&gt;% \n    dplyr::select(dplyr::any_of(demo_columns))\n  # Translate \n  translated_data &lt;- nhanesTranslate(original,\n                                     names(subset_data), \n                                     data = subset_data)\n  # Return\n  return(translated_data) \n})\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN2 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN2 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDBORN4 SDDSRVYR\n\n# SMOKING\nsmoking_data_files_2 &lt;- lapply(seq_along(smoking_data_files), function(i) {\n  current_cycle_data &lt;- smoking_data_files[[i]]\n  original &lt;- smoking[i]\n\n  # Select Columns\n  subset_data &lt;- current_cycle_data %&gt;%\n    dplyr::select(dplyr::any_of(smoking_columns))\n  # Translate\n  translated_data &lt;- nhanesTranslate(original, \n                                     names(subset_data), \n                                     data = subset_data)\n  # Return\n  return(translated_data)\n})\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n\n\n\n\nR Code Chunk 4: Merging Datasets\n\nNow that we have two processed lists of data frames (one for demographics and one for smoking), we need to merge them for each NHANES cycle. We iterate through both lists (demo_data_files_2 and smoking_data_files_2), combining each corresponding pair of cycle-specific data frames into a single data frame.\nThe merge is performed using plyr::join_all() with the unique participant identifier, SEQN, as the key. We use a type = 'full' join to ensure that all participants from both datasets are kept in the final merged data, while NA values will be inserted for any non-matching records.\nThe final output, data_all, is a single list containing 10 merged data frames (one for each NHANES cycle).\n\nShow/Hide Codedata_all &lt;- lapply(seq_along(demo_data_files_2), function(i) {\n  demo_df &lt;- demo_data_files_2[[i]]\n  smoking_df &lt;- smoking_data_files_2[[i]]\n  \n  # Merge by SEQN\n  merged_df &lt;- join_all(list(demo_df, smoking_df), \n                        by = \"SEQN\", \n                        type = 'full')\n  return(merged_df)\n})"
  },
  {
    "objectID": "03a-download-merge.html#variable-recoding-and-cleaning",
    "href": "03a-download-merge.html#variable-recoding-and-cleaning",
    "title": "\n4¬† Data Download and Merging\n",
    "section": "\n4.2 Variable Recoding and Cleaning",
    "text": "4.2 Variable Recoding and Cleaning\n\nR Code Chunk 5: Data Recoding and Cleaning\n\nThis code chunk is the most extensive data processing step of the tutorial. Here, we will loop through each of the 10 merged data frames stored in data_all to perform data cleaning and recoding. The goal is to create a new, standardized set of variables that are consistent across all survey cycles.\nWe will create clean variables for participant ID, demographics, smoking behavior, and survey design features.\n1. Solve Inconsistent Column Names\nAs noted previously, the column name for the country of birth is inconsistent across cycles (DMDBORN, DMDBORN2, DMDBORN4). Before we can recode the values, we must first combine these into a single, consistent column name, DMDBORN. The following loop handles this standardization.\n\nShow/Hide Codedata_all2 &lt;- data_all\nfor (i in seq_along(data_all2)) {\n  df &lt;- as.data.frame(data_all2[[i]])\n\n  if (\"DMDBORN2\" %in% names(df)) {\n    names(df)[names(df) == \"DMDBORN2\"] &lt;- \"DMDBORN\"\n  } else if (\"DMDBORN4\" %in% names(df)) {\n    names(df)[names(df) == \"DMDBORN4\"] &lt;- \"DMDBORN\"\n  }\n  data_all2[[i]] &lt;- df\n}\n\n\n2. Recoding Reference Table\nThe table below summarizes the key new variables that will be created below. This serves as a quick reference for the data cleaning process.\n\n\n\n\n\n\nNew Variable\nDescription\n\n\n\nid\nUnique participant ID (from SEQN)\n\n\nage\nAge in years at screening (from RIDAGEYR)\n\n\nsex\nBiological sex (from RIAGENDR)\n\n\nrace\nRace/ethnicity (from RIDRETH1), recoded into White, Black, Hispanic, Others\n\n\nborn\nCountry of birth (from DMDBORN), recoded as ‚ÄúBorn in US‚Äù or ‚ÄúOther place‚Äù\n\n\nsmoking\nSmoking status categorized into Never, Previous, or Current (from SMQ020 and SMQ040)\n\n\nsmoking.age\nAge participant started smoking (SMD030), with special codes 777, 999 replaced by NA, and 0 for never smokers\n\n\nsmoked.while.child\nDerived variable indicating if smoking started at age 15 or younger\n\n\nsurvey.weight\nFull sample 2-year interview weight (from WTINT2YR)\n\n\npsu\nMasked variance pseudo-Primary Sampling Unit (from SDMVPSU)\n\n\nstrata\nMasked variance pseudo-stratum (from SDMVSTRA)\n\n\nyear\nSurvey cycle year (from SDDSRVYR)\n\n\n\n3. Recoding and Cleaning Data\nNow, we will perform the recoding in a series of steps. For clarity in this tutorial, we use a separate loop for each group of variables.\nFirst, we create a simple ID variable from the original SEQN variable.\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # ID\n  dat2$id &lt;- dat2$SEQN\n  \n  # Return\n  data_all2[[i]] &lt;- dat2\n}\n\n\nNext, we recode the core demographic variables. This includes creating simple lowercase versions of age and sex, and collapsing the detailed categories for race and born into simpler factors using car::recode().\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Age\n  dat2$age &lt;- dat2$RIDAGEYR\n  \n  # Sex\n  dat2$sex &lt;- dat2$RIAGENDR\n  \n  # Race/Ethnicity\n  dat2$race &lt;- dat2$RIDRETH1\n  dat2$race &lt;- car::recode(dat2$race, recodes = \"\n    'Non-Hispanic White'='White';\n    'Non-Hispanic Black'='Black';\n    c('Mexican American','Other Hispanic')='Hispanic';\n    else='Others'\")\n  dat2$race &lt;- factor(dat2$race, \n                      levels = c(\"White\", \"Black\", \n                                 \"Hispanic\", \"Others\"))\n  \n  # Country of birth\n  dat2$born &lt;- dat2$DMDBORN\n  dat2$born &lt;- car::recode(dat2$born, recodes = \"\n    c('Born in Mexico','Born Elsewhere', 'Others') = 'Other place';\n    c('Born in 50 US States or Washington, DC', \n    'Born in 50 US states or Washington, DC') = 'Born in US';\n    else = NA\")\n  dat2$born &lt;- factor(dat2$born, \n                      levels = c(\"Born in US\", \"Other place\"))\n  \n  # Return\n  data_all2[[i]] &lt;- dat2\n}\n\n\nThe tables below summarize the recoding logic for the demographic variables.\n\n\n\n\n\n\n\n\nOriginal Variable\nOriginal Categories\nNew Variable\nNew Categories\n\n\n\nRIDRETH1\nNon-Hispanic White\nrace\nWhite\n\n\n\nNon-Hispanic Black\n\nBlack\n\n\n\n\nMexican American, Other Hispanic\n\n\nHispanic\n\n\n\n\nNon-Hispanic Asian, Other Race\n\n\nOthers\n\n\nDMDBORN\nBorn in 50 US States or Washington, DC\nborn\nBorn in US\n\n\n\n\nBorn in Mexico, Born Elsewhere, Others\n\n\nOther place\n\n\n\nNext, we recode the smoking variables. A key step here is creating the three-level smoking status factor (Never, Previous, Current). This requires using both SMQ020 (smoked 100+ cigarettes) and SMQ040 (smokes at all now) to correctly identify former smokers. We also clean the smoking.age variable and create a new binary variable, smoked.while.child.\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Smoking Status\n  dat2$smoking &lt;- dat2$SMQ020\n  dat2$smoking &lt;- car::recode(dat2$smoking, \"\n    'Yes' = 'Current smoker';\n    'No' = 'Never smoker';\n    else = NA\")\n  dat2$smoking &lt;- factor(dat2$smoking, \n                         levels = c(\"Never smoker\", \n                                    \"Previous smoker\", \n                                    \"Current smoker\"))\n  \n  # Use SMQ040 to identify former smokers\n  dat2$smoking[dat2$SMQ040 == \"Not at all?\" | \n                 dat2$SMQ040 == \"Not at all\"] &lt;- \"Previous smoker\"\n  \n  # Age Started Smoking\n  dat2$smoking.age &lt;- dat2$SMD030\n  dat2$smoking.age[dat2$smoking.age %in% c(777, 999)] &lt;- NA\n  dat2$smoking.age[is.na(dat2$smoking.age) & \n                     dat2$smoking == \"Never smoker\"] &lt;- 0\n  \n  # Whether Smoking started age ‚â§ 15\n  dat2$smoked.while.child &lt;- car::recode(dat2$smoking.age, \n  \"0 = 'No'; 7:15 = 'Yes'; else = NA\", as.factor = TRUE)\n  \n  # Return\n  data_all2[[i]] &lt;- dat2\n}\n\n\nThe table below summarizes the logic for creating the final smoking status variable.\n\n\n\n\n\n\n\n\nStep\nOriginal Variable(s)\nLogic\nResulting Category\n\n\n\n1\nSMQ020\nNo\nNever smoker\n\n\n2\nSMQ020\nYes\nCurrent smoker\n\n\n3\nSMQ040\nIf SMQ020 is Yes AND SMQ040 is Not at all, re-categorize\nPrevious smoker\n\n\n\nFor smoking.age, numeric codes for ‚ÄúRefused‚Äù (777) and ‚ÄúDon‚Äôt know‚Äù (999) were recoded to NA, and a value of 0 was assigned to never smokers for clarity.\nFinally, we create lowercase versions of the survey design variables for ease of use in later analyses.\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Weight\n  dat2$survey.weight &lt;- dat2$WTINT2YR\n  \n  # PSU\n  dat2$psu &lt;- as.factor(dat2$SDMVPSU)\n  \n  # Strata\n  dat2$strata &lt;- as.factor(dat2$SDMVSTRA)\n  \n  # Survey year\n  dat2$year &lt;- dat2$SDDSRVYR\n  \n  # Return\n  data_all2[[i]] &lt;- dat2\n}"
  },
  {
    "objectID": "03a-download-merge.html#finalizing-datasets-and-assessing-data-completeness",
    "href": "03a-download-merge.html#finalizing-datasets-and-assessing-data-completeness",
    "title": "\n4¬† Data Download and Merging\n",
    "section": "\n4.3 Finalizing Datasets and Assessing Data Completeness",
    "text": "4.3 Finalizing Datasets and Assessing Data Completeness\n\nR Code Chunk 6: Create, Save, and Plot Datasets\n\nThe final step is to create the analytic datasets and save them for use in subsequent chapters. The following code loops through each of the 10 cleaned data frames and performs several actions:\n\nSelects the final set of cleaned variables.\nCreates the final analytic sample by filtering for eligible participants.\nGenerates a missing data plot for each cycle and stores it in a list.\nSaves the data for each cycle into a separate .RData file.\n\nFirst, we define two vectors: nhanes_all contains the desired names for each cycle‚Äôs data frame (e.g., nhanes00, nhanes01, etc.), and vars lists the set of cleaned variable names we want to keep for the analysis.\nWithin the loop, the code subsets the data to include only participants aged 20 years or older, matching the age criteria of the original paper. It then saves both the full data frame (all ages) and the filtered analytic data frame (ages 20+) into a single .RData file in the data/ directory (e.g., analytic00.RData).\n\nShow/Hide Codenhanes_all &lt;- c(\"nhanes00\", \"nhanes01\", \"nhanes03\", \"nhanes05\", \n                \"nhanes07\", \"nhanes09\", \"nhanes11\", \n                \"nhanes13\", \"nhanes15\", \"nhanes17\")\n\nvars &lt;- c(\"id\", \"age\", \"sex\", \"race\", \"born\", \n          \"smoking.age\", \"smoked.while.child\", \"smoking\", \n          \"survey.weight\", \"psu\", \"strata\", \"year\")\n\nmissing_plots &lt;- list()\n\n\nfor (i in seq_along(data_all2)) {\n  dat2 &lt;- data_all2[[i]]\n  \n  nhanes_i &lt;- nhanes_all[i]\n  assign(nhanes_i, dat2[, vars], envir = .GlobalEnv)\n  \n  analytic &lt;- subset(get(nhanes_i), age &gt;= 20)\n  \n  # Create a temporary dataset for plotting, excluding irrelevant variables\n  data_for_plot &lt;- analytic %&gt;% \n    dplyr::select(-born, -smoked.while.child)\n  \n  # Generate a plot, add a title, and remove individual axis titles\n  p &lt;- plot_missing(data_for_plot) +\n       labs(title = nhanes_i) +\n       theme(\n         plot.title = element_text(hjust = 0.5),\n         legend.position = \"none\",\n         axis.title = element_blank()\n       )\n  missing_plots[[i]] &lt;- p\n  \n  cat(\"Processing:\", nhanes_i, \"\\n\")\n  print(dim(analytic))\n  \n  analytic_i &lt;- paste0(\"analytic\", substr(nhanes_i, 7, 8))\n  assign(analytic_i, analytic, envir = .GlobalEnv)\n  \n  # Create 'data' directory if it does not exist\n  if (!dir.exists(\"data\")) {\n    dir.create(\"data\")\n  }\n\n  # Save\n  save(list = c(nhanes_i, analytic_i),\n       file = file.path(\"data\", paste0(analytic_i, \".RData\")))\n}\n#&gt; Processing: nhanes00 \n#&gt; [1] 4880   12\n#&gt; Processing: nhanes01 \n#&gt; [1] 5411   12\n#&gt; Processing: nhanes03 \n#&gt; [1] 5041   12\n#&gt; Processing: nhanes05 \n#&gt; [1] 4979   12\n#&gt; Processing: nhanes07 \n#&gt; [1] 5935   12\n#&gt; Processing: nhanes09 \n#&gt; [1] 6218   12\n#&gt; Processing: nhanes11 \n#&gt; [1] 5560   12\n#&gt; Processing: nhanes13 \n#&gt; [1] 5769   12\n#&gt; Processing: nhanes15 \n#&gt; [1] 5719   12\n#&gt; Processing: nhanes17 \n#&gt; [1] 5569   12\n\n\nFinally, the 10 missing data plots are displayed in a single 5x2 grid.\n\nShow/Hide Code# Define common axis labels\ny_label &lt;- textGrob(\"Features\", gp = gpar(fontsize = 12), rot = 90)\nx_label &lt;- textGrob(\"Missing Rows\", gp = gpar(fontsize = 12))\n\n# Arrange the plots in a grid with common labels\ngrid.arrange(\n  grobs = missing_plots,\n  nrow = 5,\n  ncol = 2,\n  left = y_label,\n  bottom = x_label\n)\n\n\n\nFigure¬†4.1: Missing data patterns for analytic variables across all 10 NHANES cycles (1999-2018). The x-axis represents the number of missing observations.\n\n\n\nThis concludes the first part of the data preparation stage."
  },
  {
    "objectID": "03a-download-merge.html#chapter-summary-and-next-steps",
    "href": "03a-download-merge.html#chapter-summary-and-next-steps",
    "title": "\n4¬† Data Download and Merging\n",
    "section": "\n4.4 Chapter Summary and Next Steps",
    "text": "4.4 Chapter Summary and Next Steps\nWe have now successfully completed the initial data acquisition and preparation phase. We have downloaded 20 raw data files, processed them into a consistent format, and merged them into a single list of 10 data frames‚Äîone for each NHANES cycle.\nIn the next chapter, ‚ÄúMortality and NHANES Merging,‚Äù we will combine these 10 data frames and link them with the public-use mortality data to create the final, comprehensive dataset for our analysis."
  },
  {
    "objectID": "03b-mortality-merge.html#combining-the-nhanes-survey-cycles",
    "href": "03b-mortality-merge.html#combining-the-nhanes-survey-cycles",
    "title": "\n5¬† Mortality and NHANES Merging\n",
    "section": "\n5.1 Combining the NHANES Survey Cycles",
    "text": "5.1 Combining the NHANES Survey Cycles\n\nR Code Chunk 1: Load Processed NHANES Data\n\nThe following code begins by loading the 10 processed .RData files that were created and saved in the previous section. Each file contains the cleaned demographic and smoking variables for participants aged 20 years and older for a specific survey cycle. The ls() command is used to list the objects now loaded in our R environment.\n\nShow/Hide Codeload(file=\"data/analytic00.RData\")\nload(file=\"data/analytic01.RData\")\nload(file=\"data/analytic03.RData\")\nload(file=\"data/analytic05.RData\")\nload(file=\"data/analytic07.RData\")\nload(file=\"data/analytic09.RData\")\nload(file=\"data/analytic11.RData\")\nload(file=\"data/analytic13.RData\")\nload(file=\"data/analytic15.RData\")\nload(file=\"data/analytic17.RData\")\nls()\n#&gt;  [1] \"analytic00\"      \"analytic01\"      \"analytic03\"      \"analytic05\"     \n#&gt;  [5] \"analytic07\"      \"analytic09\"      \"analytic11\"      \"analytic13\"     \n#&gt;  [9] \"analytic15\"      \"analytic17\"      \"has_annotations\" \"nhanes00\"       \n#&gt; [13] \"nhanes01\"        \"nhanes03\"        \"nhanes05\"        \"nhanes07\"       \n#&gt; [17] \"nhanes09\"        \"nhanes11\"        \"nhanes13\"        \"nhanes15\"       \n#&gt; [21] \"nhanes17\"\n\n\n\n\nR Code Chunk 2: Combine NHANES Cycles and Adjust Weights\n\nNow that the 10 separate NHANES datasets are loaded into the environment, we need to combine them into one single data frame and adjust the survey weights for the pooled data.\n1. Combine Datasets\nThe following code combines the 10 individual analytic data frames into a single, large data frame named dat.full. The rbind() function is used to stack the data frames by row. After this step, we run several checks to confirm that all 10 survey cycles are present and to see the final dimensions of the combined dataset. There are now 101316 rows in the single dataframe.\n\nShow/Hide Code# Full dataset : 1999-2018\ndat.full &lt;- rbind(nhanes00, nhanes01, nhanes03, nhanes05, \n                  nhanes07, nhanes09, nhanes11, \n                  nhanes13, nhanes15, nhanes17)\n\nunique(dat.full$year)\n#&gt;  [1] NHANES 1999-2000 Public Release NHANES 2001-2002 Public Release\n#&gt;  [3] NHANES 2003-2004 Public Release NHANES 2005-2006 Public Release\n#&gt;  [5] NHANES 2007-2008 Public Release NHANES 2009-2010 Public Release\n#&gt;  [7] NHANES 2011-2012 public release NHANES 2013-2014 public release\n#&gt;  [9] NHANES 2015-2016 public release NHANES 2017-2018 public release\n#&gt; 10 Levels: NHANES 1999-2000 Public Release ... NHANES 2017-2018 public release\nlength(unique(dat.full$year))\n#&gt; [1] 10\ndim(dat.full)\n#&gt; [1] 101316     12\n\n\n2. Adjust Survey Weights\nNext, the following code adjusts the survey weights. When combining multiple NHANES cycles, the original two-year survey weights must be redistributed. We create a new weight variable, survey.weight.new, by dividing the original weight by the number of survey cycles (10). The original weight column is then removed.\n\nShow/Hide Code# Corrected Weights\ndat.full$survey.weight.new &lt;- dat.full$survey.weight / \n  length(unique(dat.full$year))\n\n# Remove original variable\ndat.full$survey.weight &lt;- NULL\n\n# Print Columns\nnames(dat.full)\n#&gt;  [1] \"id\"                 \"age\"                \"sex\"               \n#&gt;  [4] \"race\"               \"born\"               \"smoking.age\"       \n#&gt;  [7] \"smoked.while.child\" \"smoking\"            \"psu\"               \n#&gt; [10] \"strata\"             \"year\"               \"survey.weight.new\""
  },
  {
    "objectID": "03b-mortality-merge.html#acquiring-the-linked-mortality-data",
    "href": "03b-mortality-merge.html#acquiring-the-linked-mortality-data",
    "title": "\n5¬† Mortality and NHANES Merging\n",
    "section": "\n5.2 Acquiring the Linked Mortality Data",
    "text": "5.2 Acquiring the Linked Mortality Data\n\nR Code Chunk 3: Download and Read Mortality Data\n\nThis section covers downloading the public-use mortality data linked to the NHANES participants.\n1. Create Data Directories\nBefore downloading the data, we first ensure the necessary subdirectories (data/ and data/Mortalitydata/) exist in our project folder for our computer‚Äôs workspace. The following code checks for these directories and creates them if they are missing, which prevents errors when saving files.\n\nShow/Hide Code# Create directories only if they don't exist\nif (!dir.exists(\"data\")) {\n  dir.create(\"data\")\n}\nif (!dir.exists(\"data/Mortalitydata\")) {\n  dir.create(\"data/Mortalitydata\")\n}\n\n\n2. Read Fixed-Width Format Files\nThe public-use mortality data is provided by NCHS in a fixed-width text file format (.dat). In this format, each variable occupies a specific character position on each line. We need to read the file for each NHANES cycle and extract the necessary columns.\n\n\n\n\n\n\n\n\nTo read this type of file, we use the readr::read_fwf() function. We must provide fwf_cols() with the exact start and end positions for each variable we want to extract, based on the official NCHS documentation.\nThe following code demonstrates this process for the 1999-2000 mortality file, reading it directly from the CDC‚Äôs server by copying the link (shown in image). For this tutorial, this same process was repeated for all 10 survey cycles.\n\n5.2.1 Mortality data 1999-2000\n\nShow/Hide Codemort2000 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_1999_2000_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\ncolnames(mort2000)\n#&gt; [1] \"id\"                \"mort_eligstat\"     \"mort_stat\"        \n#&gt; [4] \"mort_ucod_leading\" \"mort_diabetes\"     \"mort_hyperten\"    \n#&gt; [7] \"mort_permth_int\"   \"mort_permth_exm\"\nhead(mort2000)\n\n\n\n  \n\n\n\n\n5.2.2 Mortality data 2001-2002\n\nShow/Hide Codemort2001 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2001_2002_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n#colnames(mort2001)\n#head(mort2001)\n\n\n\n5.2.3 Mortality data 2003-2004\n\nShow/Hide Codemort2003 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2003_2004_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2003)\n#head(mort2003)\n\n\n\n5.2.4 Mortality data 2005-2006\n\nShow/Hide Codemort2005 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2005_2006_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2005)\n#head(mort2005)\n\n\n\n5.2.5 Mortality data 2007-2008\n\nShow/Hide Codemort2007 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2007_2008_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2007)\n#head(mort2007)\n\n\n\n5.2.6 Mortality data 2009-2010\n\nShow/Hide Codemort2009 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2009_2010_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2009)\n#head(mort2009)\n\n\n\n5.2.7 Mortality data 2011-2012\n\nShow/Hide Codemort2011 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2011_2012_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2011)\n#head(mort2011)\n\n\n\n5.2.8 Mortality data 2013-2014\n\nShow/Hide Codemort2013 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2013_2014_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2013)\n#head(mort2013)\n\n\n\n5.2.9 Mortality data 2015-2016\n\nShow/Hide Codemort2015 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2015_2016_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2015)\n#head(mort2015)\n\n\n\n5.2.10 Mortality data 2017-2018\n\nShow/Hide Codemort2017 &lt;- read_fwf(file = \"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/datalinkage/linked_mortality/NHANES_2017_2018_MORT_2019_PUBLIC.dat\",\n                     col_types = \"iiiiiiii\",\n                     fwf_cols(id = c(1,6),\n                              mort_eligstat = c(15,15),\n                              mort_stat = c(16,16),\n                              mort_ucod_leading = c(17,19),\n                              mort_diabetes = c(20,20),\n                              mort_hyperten = c(21,21),\n                              mort_permth_int = c(43,45),\n                              mort_permth_exm = c(46,48)),\n                     na = c(\"\", \".\"))\n\n#colnames(mort2017)\n#head(mort2017)\n\n\nAfter downloading, each of the 10 mortality data frames is saved as an .RData file.\n\nShow/Hide CodesaveRDS(mort2000, file = \"data/Mortalitydata/mort2000.RData\")\nsaveRDS(mort2001, file = \"data/Mortalitydata/mort2001.RData\")\nsaveRDS(mort2003, file = \"data/Mortalitydata/mort2003.RData\")\nsaveRDS(mort2005, file = \"data/Mortalitydata/mort2005.RData\")\nsaveRDS(mort2007, file = \"data/Mortalitydata/mort2007.RData\")\nsaveRDS(mort2009, file = \"data/Mortalitydata/mort2009.RData\")\nsaveRDS(mort2011, file = \"data/Mortalitydata/mort2011.RData\")\nsaveRDS(mort2013, file = \"data/Mortalitydata/mort2013.RData\")\nsaveRDS(mort2015, file = \"data/Mortalitydata/mort2015.RData\")\nsaveRDS(mort2017, file = \"data/Mortalitydata/mort2017.RData\")"
  },
  {
    "objectID": "03b-mortality-merge.html#merging-nhanes-with-mortality-data",
    "href": "03b-mortality-merge.html#merging-nhanes-with-mortality-data",
    "title": "\n5¬† Mortality and NHANES Merging\n",
    "section": "\n5.3 Merging NHANES with Mortality Data",
    "text": "5.3 Merging NHANES with Mortality Data\n\nR Code Chunk 4: Combine Mortality Datasets\n\nThe following code combines the 10 individual mortality data frames into a single, large data frame named dat.mortality. The rbind() function is used to combine the data frames vertically by stacking rows. The dim() and head() functions are then used to confirm the dimensions and inspect the first few rows of the combined dataset. There are 101,316 rows in the dataset.\n\nShow/Hide Codedat.mortality &lt;- rbind(mort2000, mort2001, mort2003, mort2005, \n                       mort2007, mort2009, mort2011, \n                       mort2013, mort2015, mort2017)\ndim(dat.mortality)\n#&gt; [1] 101316      8\n\n\nExamine Mortality Eligibility Status:\nAfter combining the datasets, it‚Äôs important to examine the mort_eligstat variable. This variable indicates the eligibility status of each participant for the mortality follow-up study. The codes are defined as follows:\n1: Eligible for mortality follow-up.\n2: Under age 18 and not available for public release.\n3: Ineligible for other reasons.\nNA: Missing eligibility status.\nThe table() function is used to see the distribution of participants across these categories.\n\nShow/Hide Codetable(dat.mortality$mort_eligstat, useNA = \"always\")\n#&gt; \n#&gt;     1     2     3  &lt;NA&gt; \n#&gt; 59064 42112   140     0\n\n\n\n\nR Code Chunk 5: Final Merge of NHANES and Mortality Data\n\nThe following code performs the final merge, joining the combined NHANES dataset (dat.full) with the combined mortality dataset (dat.mortality). The two datasets are linked using the unique participant identifier, id. By setting the argument all.x = TRUE, all participants from the combined NHANES dataset are kept, regardless of whether they have a matching record in the combined mortality dataset.\n\nShow/Hide Codedat.full.with.mortality &lt;- merge(dat.full, dat.mortality, \n                                 by = \"id\", all.x = TRUE)\n\ndim(dat.full.with.mortality)\n#&gt; [1] 101316     19\n\n\n\n\nR Code Chunk 6: Save Final Dataset\n\nFinally, the complete, merged dataset is saved as an RDS file. This file, dat.full.with.mortality.RDS, will be the starting point for the statistical analysis in the next chapter.\n\nShow/Hide CodesaveRDS(dat.full.with.mortality, \n        file = \"data/dat.full.with.mortality.RDS\")\n\n\nThis concludes the second part of the data preparation stage."
  },
  {
    "objectID": "03b-mortality-merge.html#chapter-summary-and-next-steps",
    "href": "03b-mortality-merge.html#chapter-summary-and-next-steps",
    "title": "\n5¬† Mortality and NHANES Merging\n",
    "section": "\n5.4 Chapter Summary and Next Steps",
    "text": "5.4 Chapter Summary and Next Steps\nThis chapter concluded the data preparation phase. We first combined the 10 individual NHANES survey cycles into a single, comprehensive dataset and adjusted the survey weights for the pooled 20-year period.\nSubsequently, we acquired the public-use mortality follow-up data and merged it with the NHANES data by participant ID. The final output of this chapter is a single, complete dataset that links baseline survey data to long-term mortality outcomes, forming the foundation for all statistical analyses in the chapters that follow."
  },
  {
    "objectID": "04-variable-cleaning.html#creating-key-analysis-variables",
    "href": "04-variable-cleaning.html#creating-key-analysis-variables",
    "title": "\n6¬† Variable Definitions and Cleaning\n",
    "section": "\n6.1 Creating Key Analysis Variables",
    "text": "6.1 Creating Key Analysis Variables\n\nR Code Chunk 2: Variable Construction\n\nThis section details the construction of the key variables essential for our survival analysis. This includes defining the exposure variable (age at smoking initiation), the survival outcome, and the follow-up time.\n1. Exposure Variable: Age at Smoking Initiation Categories (exposure.cat)\nThe following code creates the primary exposure variable for our analysis, exposure.cat. The numeric smoking.age variable (SMD030 from NHANES) is categorized into six levels based on age ranges used in the original paper. This categorization is based on established age ranges for smoking initiation used in previous research, and aims to capture distinct developmental and addiction risk profiles. We first inspect the raw distribution of smoking.age before using car::recode() to create the new factor and explicitly setting the level order to ensure ‚ÄúNever smoked‚Äù is the reference category.\n\nShow/Hide Code# Display initial distribution of raw smoking.age\ntable(dat.full.with.mortality$smoking.age, useNA = \"always\")\n#&gt; \n#&gt;     0     5     6     7     8     9    10    11    12    13    14    15    16 \n#&gt; 31915     4     3   106   100   157   261   240   841  1207  1597  2354  2973 \n#&gt;    17    18    19    20    21    22    23    24    25    26    27    28    29 \n#&gt;  2399  3591  1510  1755   995   708   415   263   760   166   173   156    63 \n#&gt;    30    31    32    33    34    35    36    37    38    39    40    41    42 \n#&gt;   370    26    71    29    22   143    34    24    28    19    98     9    18 \n#&gt;    43    44    45    46    47    48    49    50    51    52    53    54    55 \n#&gt;    14    11    44    11     7     6     5    25     4     2     1     4     8 \n#&gt;    56    57    58    59    60    62    63    64    65    68    70    71    72 \n#&gt;     2     1     5     2     2     2     1     1     4     4     1     1     4 \n#&gt;    74    76    77  &lt;NA&gt; \n#&gt;     2     1     1 45537\n\n# Recode smoking.age into categorical exposure.cat\ndat.full.with.mortality$exposure.cat &lt;- car::recode(\ndat.full.with.mortality$smoking.age, \"\n0 = 'Never smoked'; 1:9 = 'Started before 10'; \n10:14 = 'Started at 10-14'; 15:17 = 'Started at 15-17'; \n18:20 = 'Started at 18-20'; 21:80 = 'Started after 20'; \nelse = NA \", as.factor = TRUE)\n\n# Explicitly set the order of factor levels\ndat.full.with.mortality$exposure.cat &lt;- \n  factor(dat.full.with.mortality$exposure.cat,\n         levels = c(\"Never smoked\", 'Started before 10',\n                    'Started at 10-14', \"Started at 15-17\",\n                    \"Started at 18-20\", \"Started after 20\"))\n\n\nThe following tables are used to inspect the distribution of the newly created exposure variable, both overall and broken down by mortality status.\n\nShow/Hide Code# Display distributions of the newly created exposure variable\ntable(dat.full.with.mortality$exposure.cat, useNA = \"always\")\n#&gt; \n#&gt;      Never smoked Started before 10  Started at 10-14  Started at 15-17 \n#&gt;             31915               370              4146              7726 \n#&gt;  Started at 18-20  Started after 20              &lt;NA&gt; \n#&gt;              6856              4766             45537\n\n\n# Display distributions of exposure.cat level\n# broken down by mort_stat variable\ntable(dat.full.with.mortality$exposure.cat,\n      dat.full.with.mortality$mort_stat, useNA = \"always\")\n#&gt;                    \n#&gt;                         0     1  &lt;NA&gt;\n#&gt;   Never smoked      27823  3994    98\n#&gt;   Started before 10   254   116     0\n#&gt;   Started at 10-14   3217   922     7\n#&gt;   Started at 15-17   6193  1522    11\n#&gt;   Started at 18-20   5438  1405    13\n#&gt;   Started after 20   3618  1140     8\n#&gt;   &lt;NA&gt;               3272   150 42115\n\n\n2. Outcome and Follow-up Time Variables\nThe following code constructs the variables for the survival analysis. As noted in the original paper, the time of birth is designated as the baseline to prevent differential start times for exposed and unexposed participants. The primary survival outcome is therefore the time from birth to all-cause mortality. Specifically, this is calculated by combining the participant‚Äôs age at the interview (from the RIDAGEYR variable) with their mortality follow-up time from the interview date (from the PERMTH_INT variable). We also define the status_all variable from the raw mortality data to indicate the participant‚Äôs final mortality status.\n\nShow/Hide Code# Survival time Person-Months of Follow-up from Interview date\n# (PERMTH_INT)\ndat.full.with.mortality$stime.since.interview &lt;- \n  dat.full.with.mortality$mort_permth_int \nsummary(dat.full.with.mortality$stime.since.interview) \n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;     0.0    59.0   113.0   117.9   172.0   250.0   42252\n\n\n# Age in month at NHANES interview \n# (RIDAGEYR)\ndat.full.with.mortality$age.month &lt;- dat.full.with.mortality$age * 12\nsummary(dat.full.with.mortality$age.month)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;     0.0   120.0   288.0   373.5   624.0  1020.0\n\n\n# Survival time - Person-Months of Follow-up from birth = age at \n# screening (months) + person-months of follow-up from interview.\n# This combines the age at interview with the time from interview \n# to death or end of follow-up.\ndat.full.with.mortality$stime.since.birth &lt;- \n  with(dat.full.with.mortality, age.month + stime.since.interview)\n\n\n# Convert to years for consistent interpretation with age\ndat.full.with.mortality$stime.since.birth &lt;- dat.full.with.mortality$stime.since.birth/12\n\n\n# Ensure NA values are consistent if stime.since.interview was NA\ndat.full.with.mortality$stime.since.birth[\n  is.na(dat.full.with.mortality$stime.since.interview)] &lt;- NA\nsummary(dat.full.with.mortality$stime.since.birth)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;   19.08   41.50   57.17   57.56   72.92  105.67   42252\n\n\n# All-cause mortality status (PRIMARY outcome)\ndat.full.with.mortality$status_all &lt;- \n  dat.full.with.mortality$mort_stat\ntable(dat.full.with.mortality$status_all, useNA = \"always\")\n#&gt; \n#&gt;     0     1  &lt;NA&gt; \n#&gt; 49815  9249 42252\n\n\n3. Final Variable Cleaning\nThe following code drops mortality-related variables not needed for the final analytic dataset.\n\nShow/Hide Code# Remove unneeded columns\ndat.full.with.mortality$mort_diabetes &lt;- NULL\ndat.full.with.mortality$mort_hyperten &lt;- NULL\ndat.full.with.mortality$mort_permth_int &lt;- NULL\ndat.full.with.mortality$mort_permth_exm &lt;- NULL\ndat.full.with.mortality$mort_ucod_leading &lt;- NULL\ndat.full.with.mortality$mort_eligstat &lt;- NULL\n\n\n4. Recoding Survey Year: year.cat\nThe year variable, representing the NHANES survey cycle is recoded into a more descriptive categorical variable, year.cat.\n\nShow/Hide Code# Recode year variable into a factor with descriptive labels\ndat.full.with.mortality$year.cat &lt;- dat.full.with.mortality$year\n\nnew_levels &lt;- c(\n  \"1999-2000\", \"2001-2002\", \"2003-2004\", \n  \"2005-2006\", \"2007-2008\", \"2009-2010\",\n  \"2011-2012\", \"2013-2014\", \"2015-2016\",\n  \"2017-2018\"\n)\n\nlevels(dat.full.with.mortality$year.cat) &lt;- new_levels\n\n# Display the unique levels of the new year.cat variable\nlevels(dat.full.with.mortality$year.cat)\n#&gt;  [1] \"1999-2000\" \"2001-2002\" \"2003-2004\" \"2005-2006\" \"2007-2008\" \"2009-2010\"\n#&gt;  [7] \"2011-2012\" \"2013-2014\" \"2015-2016\" \"2017-2018\""
  },
  {
    "objectID": "04-variable-cleaning.html#constructing-the-final-analytic-cohort",
    "href": "04-variable-cleaning.html#constructing-the-final-analytic-cohort",
    "title": "\n6¬† Variable Definitions and Cleaning\n",
    "section": "\n6.2 Constructing the Final Analytic Cohort",
    "text": "6.2 Constructing the Final Analytic Cohort\n\nR Code Chunk 3: Final Analytic Dataset Construction\n\nThe following code creates the final analytic dataset by applying the specific inclusion and exclusion criteria used in the published paper. The two main steps are restricting the participant age range to 20‚Äì79 years and performing a complete-case analysis by excluding observations with missing data for key variables.\n1. Apply Age and Variable Exclusions\nFirst, we apply the age restriction, keeping only participants between 20 and 79 years old. We also drop several intermediate or raw variables that are no longer needed for the final analysis. We will remove the smoked.while.child variable. While this variable was created as a simple binary indicator for early smoking, the final analysis relies on the more granular, multi-level exposure.cat variable.\n\n\n\n\n\n\nNote\n\n\n\nThe exposure.cat variable (e.g., ‚ÄòStarted before 10‚Äô, ‚ÄòStarted at 10-14‚Äô) is superior for our research question because it allows us to investigate a dose-response relationship‚Äîthat is, to see if the risk of mortality changes incrementally with different ages of initiation. A simple binary variable like smoked.while.child would only allow us to compare ‚Äúearly starters‚Äù to everyone else, masking the important nuances in risk across different age groups. Therefore, it is excluded from the final analytic dataset.\n\n\n\nShow/Hide Code# Drop the following column not being used\ndat.full.with.mortality$smoked.while.child &lt;- NULL \n\n### Analytic Dataset - age 20 - 79\n\n# Inclusion criteria: adults aged between 20 and 79 years\ndat.analytic &lt;- subset(dat.full.with.mortality, age&gt;=20 & age &lt; 80)\n\n# Dimensions before age filtering\ndim(dat.full.with.mortality)\n#&gt; [1] 101316     18\n\n# Dimensions after age filtering\ndim(dat.analytic)\n#&gt; [1] 50824    18\n\n# Calculate number of participants dropped due to age restriction\ndim(dat.full.with.mortality)[1] - dim(dat.analytic)[1]\n#&gt; [1] 50492\n\n\nDrop other variables that are not being used in the final analysis.\n\nShow/Hide Codedat.analytic$born &lt;- NULL\ndat.analytic$age &lt;- NULL\ndat.analytic$age.month &lt;- NULL\n\n# Dimension\ndim(dat.analytic) \n#&gt; [1] 50824    15\n\n\n2. Apply Complete-Case Analysis\nNext, we exclude participants who have missing data for the primary outcome (survival time) or the primary exposure (smoking initiation category). This is consistent with the original paper, which notes that about 0.5% of the sample (275 observations) was discarded for this reason. Also, there were no missing values in the covariates variables considered in the main analysis.\n\nShow/Hide Code# Participants with incomplete data on smoking status \n# or mortality were excluded\ndat.analytic1 &lt;- dat.analytic[\n  complete.cases(dat.analytic$stime.since.birth),]\ndim(dat.analytic1) # Dimension after removing missing survival time\n#&gt; [1] 50690    15\n\ndat.analytic2 &lt;- dat.analytic1[\n  complete.cases(dat.analytic1$exposure.cat),]\ndim(dat.analytic2) # Dimension after removing missing exposure var\n#&gt; [1] 50549    15\n\n# Complete case analysis: remove missing values in covariates\ndat.complete &lt;- na.omit(dat.analytic2) # No missing values\ndim(dat.complete)\n#&gt; [1] 50549    15\n\n\n\nShow/Hide Code# Profile missingness after initial filtering\nprofile_missing(dat.analytic2)\n\n\n\n\n\nProfile of missing data after removing participants with missing outcome or exposure. This table confirms that no missing values remain in the key covariates.\n\n\n3. Reconcile Sample Sizes The following code calculates the number of participants dropped at each stage of the filtering process. This helps confirm that our data cleaning has resulted in the same final sample size as the original study.\n\nShow/Hide Code# Participants dropped - overall\nnrow(dat.full.with.mortality) - nrow(dat.complete)\n#&gt; [1] 50767\n\n# Participants dropped - due to missing exposure or outcome\nnrow(dat.analytic) - nrow(dat.analytic2)\n#&gt; [1] 275\n\n# Participants dropped - due to missing covariates\nnrow(dat.analytic2) - nrow(dat.complete)\n#&gt; [1] 0"
  },
  {
    "objectID": "04-variable-cleaning.html#exporting-final-datasets",
    "href": "04-variable-cleaning.html#exporting-final-datasets",
    "title": "\n6¬† Variable Definitions and Cleaning\n",
    "section": "\n6.3 Exporting Final Datasets",
    "text": "6.3 Exporting Final Datasets\n\nR Code Chunk 4: Save Final Datasets\n\nThe final step is to save our processed datasets. We save three different versions of the data to create useful checkpoints for the analysis:\n\n\ndat.full.with.mortality.RData: The updated, merged dataset before any filtering was applied in this chapter.\n\ndat.analytic2.RData: The dataset after applying age restrictions and removing participants with missing outcome or exposure data.\n\ndat.complete.RData: The final, clean analytic dataset containing only complete cases.\n\n\nShow/Hide Code# Save\nsave(dat.full.with.mortality, \n     file = \"data/dat.full.with.mortality.RData\")\n\nsave(dat.analytic2, \n     file = \"data/dat.analytic2.RData\")\n\nsave(dat.complete, \n     file = \"data/dat.complete.RData\")\n\n\nThis completes the variable definitions and cleaning part of the data preparation stage."
  },
  {
    "objectID": "04-variable-cleaning.html#chapter-summary-and-next-steps",
    "href": "04-variable-cleaning.html#chapter-summary-and-next-steps",
    "title": "\n6¬† Variable Definitions and Cleaning\n",
    "section": "\n6.4 Chapter Summary and Next Steps",
    "text": "6.4 Chapter Summary and Next Steps\nIn this chapter, we constructed the core variables for the analysis, including the categorized smoking initiation exposure (exposure.cat) and the survival outcome (time from birth to all-cause mortality). We then applied the study‚Äôs inclusion and exclusion criteria to create the final, complete-case analytic dataset with 50,549 participants, matching the sample size of the original paper.\nWith a clean dataset ready, the next chapter, ‚ÄúCohort Definition,‚Äù will formally summarize the criteria used to define our study population."
  },
  {
    "objectID": "05-cohort-definition.html#inclusionexclusion-criteria",
    "href": "05-cohort-definition.html#inclusionexclusion-criteria",
    "title": "7¬† Cohort Definition",
    "section": "7.1 Inclusion/Exclusion Criteria",
    "text": "7.1 Inclusion/Exclusion Criteria\nThe study sample was derived from 10 cycles of the National Health and Nutrition Examination Surveys (NHANES), spanning from 1999 to 2018. The participants included in this study from the NHANES data were adults aged between 20 and 79 years old.\nKey exclusion criteria were as follows:\n\nIndividuals younger than 20 or older than 79 years were excluded from the study.\nIndividuals with incomplete data concerning their smoking status or mortality outcomes were also excluded.\nSome participants were not included in the public-use mortality files because their records lacked the minimum identifying data required for a successful linkage to the National Death Index"
  },
  {
    "objectID": "05-cohort-definition.html#missing-data-handling",
    "href": "05-cohort-definition.html#missing-data-handling",
    "title": "7¬† Cohort Definition",
    "section": "7.2 Missing Data Handling",
    "text": "7.2 Missing Data Handling\nThe study performed a complete-case analysis, meaning only participants with complete data for all variables in the main analysis were included. The final data set comprised a sample size of 50,549 individuals. A total of 275 participants (about 0.5% of the sample) were removed due to missing information on the primary exposure (smoking initiation age) or the outcome (mortality). The main covariates used in the analysis such as race/ethnicity, sex, and survey cycle had no missing values. However, other variables related to socioeconomic status, like family income ratio and education level, were not included in the primary analysis due to a high degree of missing data. The authors chose not to impute these missing values, believing that a reliable model could not be built from the available data."
  },
  {
    "objectID": "05-cohort-definition.html#chapter-summary-and-next-steps",
    "href": "05-cohort-definition.html#chapter-summary-and-next-steps",
    "title": "7¬† Cohort Definition",
    "section": "7.3 Chapter Summary and Next Steps",
    "text": "7.3 Chapter Summary and Next Steps\nThis chapter formally outlined the inclusion and exclusion criteria that defined our final study cohort of 50,549 participants. We also reviewed the complete-case approach used to handle missing data for the primary exposure and outcome variables.\nNow that our cohort is clearly defined, we will proceed to ‚ÄúSurvey Design Specification,‚Äù a critical step where we tell R how to correctly account for the complex sampling design of the NHANES data."
  },
  {
    "objectID": "06-survey-design.html#loading-the-analytic-datasets",
    "href": "06-survey-design.html#loading-the-analytic-datasets",
    "title": "\n8¬† Survey Design Specification\n",
    "section": "\n8.1 Loading the Analytic Datasets",
    "text": "8.1 Loading the Analytic Datasets\n\nR Code Chunk 1: Load Data\n\nThe following code loads the datasets created in the previous steps. dat.full.with.mortality contains the complete merged data, while dat.complete and dat.analytic2 contain the filtered subsets that will be used to define the analytic sub-cohort for the survey design.\n\nShow/Hide Code# Load the full merged dataset\nload(file = \"data/dat.full.with.mortality.RData\")\n\n# Load the intermediate analytic dataset \n# Used for subsetting the design\nload(file = \"data/dat.analytic2.RData\") \nload(file = \"data/dat.complete.RData\") \n\n# Check dimensions\ndim(dat.full.with.mortality)\n#&gt; [1] 101316     18\ndim(dat.analytic2)\n#&gt; [1] 50549    15\ndim(dat.complete)\n#&gt; [1] 50549    15\n\n\nNote: The dat.complete and dat.analytic2 datasets are identical. This confirms that after participants with missing exposure or outcome data were removed, no missing values remained for the covariates used in the main analysis, as stated in the original paper"
  },
  {
    "objectID": "06-survey-design.html#specifying-the-survey-design",
    "href": "06-survey-design.html#specifying-the-survey-design",
    "title": "\n8¬† Survey Design Specification\n",
    "section": "\n8.2 Specifying the Survey Design",
    "text": "8.2 Specifying the Survey Design\n\nR Code Chunk 2: Specify the Survey Design Object\n\nTo correctly analyze NHANES data, we must account for its complex sampling design, which includes stratification, clustering, and unequal weighting. The following code uses the survey package to create a survey design object. This step is critical for obtaining accurate standard errors and p-values in all subsequent analyses.\n\n\n\n\n\n\nNote\n\n\n\nAccounting for the complex sampling design is not just a formality; it is the most critical step for ensuring our results are statistically valid.\nWe will use the svydesign() function from the survey package to create a ‚Äúsurvey design object.‚Äù This object bundles our dataset with the information on how the data was collected (the weights, strata, and PSUs). All of our subsequent analyses will be performed on this object, not on the raw data frame.\nFailing to perform this step and instead running analyses on the raw data would lead to severely underestimated standard errors and incorrect p-values, likely resulting in false positive findings. By specifying the design, we ensure our results are nationally representative and that our statistical inferences are trustworthy.\n\n\n1. The svydesign Function\nWe use the svydesign() function to combine the dataset with its design information. The key arguments are:\n\n\nids = ~psu: Specifies the primary sampling unit (PSU) variable.\n\nstrata = ~strata: Specifies the stratification variable.\n\nweights = ~survey.weight.new: Specifies the adjusted survey weight variable.\n\nnest = TRUE: Correctly handles PSUs that are nested within strata.\n\n2. Subsetting the Design Object\nFor correct variance estimation, the survey package requires us to define the design on the full dataset first and then specify the subset to be analyzed. We do this by creating a miss variable on the dat.full.with.mortality dataset. We then create the full design object (w.design) and use the subset() function to create the final analytic design object (w.design0). This final object includes only our cohort of interest (where miss == 0) and participants with positive survey weights.\n\nShow/Hide Code# Set up the 'miss' indicator for subsetting the design\n# Initialize 'miss' as 1 (excluded) for all \n# in dat.full.with.mortality\ndat.full.with.mortality$miss &lt;- 1\n\n# Set 'miss' to 0 (included) for participants whose 'id' \n# is in dat.analytic2\ndat.full.with.mortality$miss[dat.full.with.mortality$id \n                             %in% dat.analytic2$id] &lt;- 0\n\n# Display the distribution of the 'miss' variable\ntable(dat.full.with.mortality$miss)\n#&gt; \n#&gt;     0     1 \n#&gt; 50549 50767\n\n# Create the full survey design object\nw.design &lt;- svydesign(ids = ~psu,\n                      strata = ~strata,\n                      weights = ~survey.weight.new,\n                      data = dat.full.with.mortality,\n                      nest = TRUE)\n\n# Subset the design to the analytic cohort (miss == 0) and \n# positive weights\nw.design0 &lt;- subset(w.design, miss == 0 & survey.weight.new &gt; 0)\n\n# Verify the number of observations in the subsetted design\ncat(\"Number of observations in w.design0 (subsetted design):\", \n    nrow(w.design0), \"\\n\")\n#&gt; Number of observations in w.design0 (subsetted design): 50549"
  },
  {
    "objectID": "06-survey-design.html#saving-the-survey-design-object",
    "href": "06-survey-design.html#saving-the-survey-design-object",
    "title": "\n8¬† Survey Design Specification\n",
    "section": "\n8.3 Saving the Survey Design Object",
    "text": "8.3 Saving the Survey Design Object\n\nR Code Chunk 3: Save Survey Design Object\n\nFinally, we save the completed survey design object (w.design0) as an .rds file. This allows us to load this object directly in the next chapters without needing to re-run the design specification code, making our workflow more efficient.\n\nShow/Hide Code# Save the final survey design object\nsaveRDS(w.design0, file = \"data/w.design0.rds\")\n\n\nThis completes the survey design specification section of the statistical analysis stage."
  },
  {
    "objectID": "06-survey-design.html#chapter-summary-and-next-steps",
    "href": "06-survey-design.html#chapter-summary-and-next-steps",
    "title": "\n8¬† Survey Design Specification\n",
    "section": "\n8.4 Chapter Summary and Next Steps",
    "text": "8.4 Chapter Summary and Next Steps\nWe have now completed one of the most critical methodological steps in this analysis. By creating a survey design object (w.design0), we have properly accounted for the complex stratification, clustering, and weighting of the NHANES data. This ensures that all subsequent analyses will produce statistically valid, nationally representative results.\nWith the survey design specified, we are ready to begin our analysis. In the next chapter, ‚ÄúDescriptive Analysis,‚Äù we will generate the first set of results: weighted summary statistics of our cohort."
  },
  {
    "objectID": "07-descriptive-analysis.html#exploratory-analysis-unweighted-summaries",
    "href": "07-descriptive-analysis.html#exploratory-analysis-unweighted-summaries",
    "title": "\n9¬† Descriptive Analysis\n",
    "section": "\n9.1 Exploratory Analysis: Unweighted Summaries",
    "text": "9.1 Exploratory Analysis: Unweighted Summaries\n\nR Code Chunk 2: Create Unweighted Descriptive Data Table\n\nThe following code creates a basic unweighted descriptive data table, referred to as ‚ÄúTable 1‚Äù, using the CreateTableOne() function from the tableone package. This table provides unweighted counts and percentages for our key variables, stratified by mortality status. While the paper‚Äôs main results are based on weighted proportions, this unweighted table can be useful for initial data exploration and understanding the raw counts of variables within your specific analytic sample.\n\nShow/Hide Code# Unweighted Table 1 summarizing exposure, race, \n# and sex, stratified by mortality status\ntab1 &lt;- CreateTableOne(vars = c(\"exposure.cat\", \"race\", \"sex\"),\n                                  strata = \"status_all\",\n                                  data = dat.analytic2, \n                                  addOverall = TRUE,\n                                  test = TRUE)\n\n# View the summarized version of the table\nprint(tab1$CatTable)\n#&gt;                       Stratified by status_all\n#&gt;                        Overall       0             1            p      test\n#&gt;   n                    50549         44377         6172                    \n#&gt;   exposure.cat (%)                                              &lt;0.001     \n#&gt;      Never smoked      28593 (56.6)  26235 (59.1)  2358 (38.2)             \n#&gt;      Started before 10   337 ( 0.7)    244 ( 0.5)    93 ( 1.5)             \n#&gt;      Started at 10-14   3903 ( 7.7)   3145 ( 7.1)   758 (12.3)             \n#&gt;      Started at 15-17   7189 (14.2)   6003 (13.5)  1186 (19.2)             \n#&gt;      Started at 18-20   6254 (12.4)   5250 (11.8)  1004 (16.3)             \n#&gt;      Started after 20   4273 ( 8.5)   3500 ( 7.9)   773 (12.5)             \n#&gt;   race (%)                                                      &lt;0.001     \n#&gt;      White             21069 (41.7)  17889 (40.3)  3180 (51.5)             \n#&gt;      Black             10977 (21.7)   9471 (21.3)  1506 (24.4)             \n#&gt;      Hispanic          13592 (26.9)  12342 (27.8)  1250 (20.3)             \n#&gt;      Others             4911 ( 9.7)   4675 (10.5)   236 ( 3.8)             \n#&gt;   sex = Female (%)     26158 (51.7)  23544 (53.1)  2614 (42.4)  &lt;0.001\n\n\n\n\nR Code Chunk 3: More Detailed Unweighted Tables\n\nThe following code uses the table1 package to generate more visually appealing unweighted descriptive tables. These tables offer flexibility in stratifying variables and are useful for detailed unweighted breakdowns of your cohort‚Äôs characteristics, though they do not account for survey weights.\n1. Create and Display Tables\nThe following code chunk demonstrates this by creating four different tables, each exploring a different combination of demographic variables, smoking exposure categories, and mortality status. Each table is then rendered as a clean HTML table using table1::t1kable().\n\nShow/Hide Code\n# Table of exposure.cat stratified by race and mortality status\ntab11 &lt;- table1::table1(~ exposure.cat | race * status_all , \n                        data = dat.analytic2)\n# Display as a formatted HTML table in Quarto\ntable1::t1kable(tab11)\n\n\n\n\n\n\n\n\n\nWhite\n\n\n\n\nBlack\n\n\n\n\nHispanic\n\n\n\n\nOthers\n\n\n\n\nOverall\n\n\n\n\n\n¬†\n\n\n0\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n\n\n\n\n(N=17889)\n\n\n(N=3180)\n\n\n(N=9471)\n\n\n(N=1506)\n\n\n(N=12342)\n\n\n(N=1250)\n\n\n(N=4675)\n\n\n(N=236)\n\n\n(N=44377)\n\n\n(N=6172)\n\n\n\n\nexposure.cat\n\n\n\n\nNever smoked\n\n\n9153 (51.2%)\n\n\n1041 (32.7%)\n\n\n5729 (60.5%)\n\n\n605 (40.2%)\n\n\n8054 (65.3%)\n\n\n600 (48.0%)\n\n\n3299 (70.6%)\n\n\n112 (47.5%)\n\n\n26235 (59.1%)\n\n\n2358 (38.2%)\n\n\n\n\nStarted before 10\n\n\n134 (0.7%)\n\n\n58 (1.8%)\n\n\n31 (0.3%)\n\n\n13 (0.9%)\n\n\n55 (0.4%)\n\n\n18 (1.4%)\n\n\n24 (0.5%)\n\n\n4 (1.7%)\n\n\n244 (0.5%)\n\n\n93 (1.5%)\n\n\n\n\nStarted at 10-14\n\n\n1685 (9.4%)\n\n\n430 (13.5%)\n\n\n503 (5.3%)\n\n\n166 (11.0%)\n\n\n788 (6.4%)\n\n\n135 (10.8%)\n\n\n169 (3.6%)\n\n\n27 (11.4%)\n\n\n3145 (7.1%)\n\n\n758 (12.3%)\n\n\n\n\nStarted at 15-17\n\n\n3198 (17.9%)\n\n\n725 (22.8%)\n\n\n1082 (11.4%)\n\n\n267 (17.7%)\n\n\n1348 (10.9%)\n\n\n163 (13.0%)\n\n\n375 (8.0%)\n\n\n31 (13.1%)\n\n\n6003 (13.5%)\n\n\n1186 (19.2%)\n\n\n\n\nStarted at 18-20\n\n\n2458 (13.7%)\n\n\n561 (17.6%)\n\n\n1116 (11.8%)\n\n\n240 (15.9%)\n\n\n1249 (10.1%)\n\n\n174 (13.9%)\n\n\n427 (9.1%)\n\n\n29 (12.3%)\n\n\n5250 (11.8%)\n\n\n1004 (16.3%)\n\n\n\n\nStarted after 20\n\n\n1261 (7.0%)\n\n\n365 (11.5%)\n\n\n1010 (10.7%)\n\n\n215 (14.3%)\n\n\n848 (6.9%)\n\n\n160 (12.8%)\n\n\n381 (8.1%)\n\n\n33 (14.0%)\n\n\n3500 (7.9%)\n\n\n773 (12.5%)\n\n\n\n\nUnweighted: Smoking initiation categories stratified by race and mortality status.\n\n\n\nShow/Hide Code# Table of exposure.cat stratified by sex and mortality status\ntab12 &lt;- table1::table1(~ exposure.cat| sex * status_all , \n                        data = dat.analytic2)\n# Display as a formatted HTML table in Quarto\ntable1::t1kable(tab12)\n\n\n\n\n\n\n\n\n\nMale\n\n\n\n\nFemale\n\n\n\n\nOverall\n\n\n\n\n\n¬†\n\n\n0\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n\n\n\n\n(N=20833)\n\n\n(N=3558)\n\n\n(N=23544)\n\n\n(N=2614)\n\n\n(N=44377)\n\n\n(N=6172)\n\n\n\n\nexposure.cat\n\n\n\n\nNever smoked\n\n\n10504 (50.4%)\n\n\n1030 (28.9%)\n\n\n15731 (66.8%)\n\n\n1328 (50.8%)\n\n\n26235 (59.1%)\n\n\n2358 (38.2%)\n\n\n\n\nStarted before 10\n\n\n177 (0.8%)\n\n\n80 (2.2%)\n\n\n67 (0.3%)\n\n\n13 (0.5%)\n\n\n244 (0.5%)\n\n\n93 (1.5%)\n\n\n\n\nStarted at 10-14\n\n\n1923 (9.2%)\n\n\n572 (16.1%)\n\n\n1222 (5.2%)\n\n\n186 (7.1%)\n\n\n3145 (7.1%)\n\n\n758 (12.3%)\n\n\n\n\nStarted at 15-17\n\n\n3414 (16.4%)\n\n\n823 (23.1%)\n\n\n2589 (11.0%)\n\n\n363 (13.9%)\n\n\n6003 (13.5%)\n\n\n1186 (19.2%)\n\n\n\n\nStarted at 18-20\n\n\n3005 (14.4%)\n\n\n656 (18.4%)\n\n\n2245 (9.5%)\n\n\n348 (13.3%)\n\n\n5250 (11.8%)\n\n\n1004 (16.3%)\n\n\n\n\nStarted after 20\n\n\n1810 (8.7%)\n\n\n397 (11.2%)\n\n\n1690 (7.2%)\n\n\n376 (14.4%)\n\n\n3500 (7.9%)\n\n\n773 (12.5%)\n\n\n\n\nUnweighted: Smoking initiation categories stratified by sex and mortality status.\n\n\n\nShow/Hide Code# Table of demographics and survey year stratified by mortality status\ntab13 &lt;- table1::table1(~ exposure.cat + race + sex + year.cat |\n                          status_all , data = dat.analytic2)\n# Display as a formatted HTML table in Quarto\ntable1::t1kable(tab13)\n\n\n\n\n\n¬†\n\n\n0\n\n\n1\n\n\nOverall\n\n\n\n\n\n\n\n(N=44377)\n\n\n(N=6172)\n\n\n(N=50549)\n\n\n\n\nexposure.cat\n\n\n\n\nNever smoked\n\n\n26235 (59.1%)\n\n\n2358 (38.2%)\n\n\n28593 (56.6%)\n\n\n\n\nStarted before 10\n\n\n244 (0.5%)\n\n\n93 (1.5%)\n\n\n337 (0.7%)\n\n\n\n\nStarted at 10-14\n\n\n3145 (7.1%)\n\n\n758 (12.3%)\n\n\n3903 (7.7%)\n\n\n\n\nStarted at 15-17\n\n\n6003 (13.5%)\n\n\n1186 (19.2%)\n\n\n7189 (14.2%)\n\n\n\n\nStarted at 18-20\n\n\n5250 (11.8%)\n\n\n1004 (16.3%)\n\n\n6254 (12.4%)\n\n\n\n\nStarted after 20\n\n\n3500 (7.9%)\n\n\n773 (12.5%)\n\n\n4273 (8.5%)\n\n\n\n\nrace\n\n\n\n\nWhite\n\n\n17889 (40.3%)\n\n\n3180 (51.5%)\n\n\n21069 (41.7%)\n\n\n\n\nBlack\n\n\n9471 (21.3%)\n\n\n1506 (24.4%)\n\n\n10977 (21.7%)\n\n\n\n\nHispanic\n\n\n12342 (27.8%)\n\n\n1250 (20.3%)\n\n\n13592 (26.9%)\n\n\n\n\nOthers\n\n\n4675 (10.5%)\n\n\n236 (3.8%)\n\n\n4911 (9.7%)\n\n\n\n\nsex\n\n\n\n\nMale\n\n\n20833 (46.9%)\n\n\n3558 (57.6%)\n\n\n24391 (48.3%)\n\n\n\n\nFemale\n\n\n23544 (53.1%)\n\n\n2614 (42.4%)\n\n\n26158 (51.7%)\n\n\n\n\nyear.cat\n\n\n\n\n1999-2000\n\n\n3188 (7.2%)\n\n\n1247 (20.2%)\n\n\n4435 (8.8%)\n\n\n\n\n2001-2002\n\n\n3772 (8.5%)\n\n\n1073 (17.4%)\n\n\n4845 (9.6%)\n\n\n\n\n2003-2004\n\n\n3583 (8.1%)\n\n\n921 (14.9%)\n\n\n4504 (8.9%)\n\n\n\n\n2005-2006\n\n\n3907 (8.8%)\n\n\n667 (10.8%)\n\n\n4574 (9.0%)\n\n\n\n\n2007-2008\n\n\n4705 (10.6%)\n\n\n769 (12.5%)\n\n\n5474 (10.8%)\n\n\n\n\n2009-2010\n\n\n5204 (11.7%)\n\n\n563 (9.1%)\n\n\n5767 (11.4%)\n\n\n\n\n2011-2012\n\n\n4770 (10.7%)\n\n\n392 (6.4%)\n\n\n5162 (10.2%)\n\n\n\n\n2013-2014\n\n\n5111 (11.5%)\n\n\n285 (4.6%)\n\n\n5396 (10.7%)\n\n\n\n\n2015-2016\n\n\n5132 (11.6%)\n\n\n170 (2.8%)\n\n\n5302 (10.5%)\n\n\n\n\n2017-2018\n\n\n5005 (11.3%)\n\n\n85 (1.4%)\n\n\n5090 (10.1%)\n\n\n\n\nUnweighted: Full cohort characteristics stratified by mortality status.\n\n\n\nShow/Hide Code# Table of race and sex stratified by exposure.cat\ntab14 &lt;- table1::table1(~ race + sex | exposure.cat , \n                        data = dat.analytic2)\n# Display as a formatted HTML table in Quarto\ntable1::t1kable(tab14)\n\n\n\n\n\n¬†\n\n\nNever smoked\n\n\nStarted before 10\n\n\nStarted at 10-14\n\n\nStarted at 15-17\n\n\nStarted at 18-20\n\n\nStarted after 20\n\n\nOverall\n\n\n\n\n\n\n\n(N=28593)\n\n\n(N=337)\n\n\n(N=3903)\n\n\n(N=7189)\n\n\n(N=6254)\n\n\n(N=4273)\n\n\n(N=50549)\n\n\n\n\nrace\n\n\n\n\nWhite\n\n\n10194 (35.7%)\n\n\n192 (57.0%)\n\n\n2115 (54.2%)\n\n\n3923 (54.6%)\n\n\n3019 (48.3%)\n\n\n1626 (38.1%)\n\n\n21069 (41.7%)\n\n\n\n\nBlack\n\n\n6334 (22.2%)\n\n\n44 (13.1%)\n\n\n669 (17.1%)\n\n\n1349 (18.8%)\n\n\n1356 (21.7%)\n\n\n1225 (28.7%)\n\n\n10977 (21.7%)\n\n\n\n\nHispanic\n\n\n8654 (30.3%)\n\n\n73 (21.7%)\n\n\n923 (23.6%)\n\n\n1511 (21.0%)\n\n\n1423 (22.8%)\n\n\n1008 (23.6%)\n\n\n13592 (26.9%)\n\n\n\n\nOthers\n\n\n3411 (11.9%)\n\n\n28 (8.3%)\n\n\n196 (5.0%)\n\n\n406 (5.6%)\n\n\n456 (7.3%)\n\n\n414 (9.7%)\n\n\n4911 (9.7%)\n\n\n\n\nsex\n\n\n\n\nMale\n\n\n11534 (40.3%)\n\n\n257 (76.3%)\n\n\n2495 (63.9%)\n\n\n4237 (58.9%)\n\n\n3661 (58.5%)\n\n\n2207 (51.6%)\n\n\n24391 (48.3%)\n\n\n\n\nFemale\n\n\n17059 (59.7%)\n\n\n80 (23.7%)\n\n\n1408 (36.1%)\n\n\n2952 (41.1%)\n\n\n2593 (41.5%)\n\n\n2066 (48.4%)\n\n\n26158 (51.7%)\n\n\n\n\nUnweighted: Demographic characteristics stratified by smoking initiation category.\n\n\n2. Save Tables to Excel (Optional)\nThe tables created with the table1 package can also be saved to an external file, such as an Excel spreadsheet, for further review outside of this book. The following code demonstrates how to save two of these tables using the expss package.\n\nShow/Hide Code# Table 3\nt13 &lt;- as.data.frame(tab13)\nexpss::xl_write_file(t13, filename = \"data/t13.xlsx\")\n\n# Table 4\nt14 &lt;- as.data.frame(tab14)\nexpss::xl_write_file(t14, filename = \"data/t14.xlsx\")"
  },
  {
    "objectID": "07-descriptive-analysis.html#weighted-descriptive-statistics-paper-reproduction",
    "href": "07-descriptive-analysis.html#weighted-descriptive-statistics-paper-reproduction",
    "title": "\n9¬† Descriptive Analysis\n",
    "section": "\n9.2 Weighted Descriptive Statistics (Paper Reproduction)",
    "text": "9.2 Weighted Descriptive Statistics (Paper Reproduction)\n\nR Code Chunk 4: Weighted Descriptive Tables\n\nThe following code generates the primary descriptive tables for the analysis. Unlike the previous examples, these tables correctly account for the complex survey design by using the svyCreateTableOne() function on our survey design object (w.design0). This produces nationally representative, weighted percentages.\n\n9.2.1 Appendix Table 1: Characteristics by Mortality Status\n\nThis first table summarizes participant characteristics (smoking exposure, race, sex, and survey year), stratified by their mortality status. The output is designed to directly reproduce the results shown in Appendix Table 1 of the supplementary material where percentages were in brackets. Those percentages were calculated by accounting for sampling (interview) weights.\n\nShow/Hide Code# Create weighted Table 1 \n# stratified by outcome status (all-cause mortality)\ntab13_weighted &lt;- svyCreateTableOne(vars = c(\"exposure.cat\", \"race\", \n                                             \"sex\", \"year.cat\"),\n                                    strata = \"status_all\",\n                                    data = w.design0, # CRITICAL\n                                    addOverall = TRUE, \n                                    test = TRUE)\n\n# Print the table with weighted proportions,\n# specified decimal places, and all factor levels\ntab13p_weighted &lt;- print(tab13_weighted,\n                         format = \"p\",         \n                         catDigits = 2,        \n                         showAllLevels = TRUE, \n                         smd = TRUE)     \n# Re-label\ncolnames(tab13p_weighted)[colnames(tab13p_weighted) \n                          == \"0\"] &lt;- \"Alive\"\ncolnames(tab13p_weighted)[colnames(tab13p_weighted) \n                          == \"1\"] &lt;- \"Dead\"\n# Order\nnew_order &lt;- c(\"level\", \"Alive\", \"Dead\", \n               \"Overall\", \"p\", \"test\", \"SMD\")\n# Apply the new order to the table object\ntab13p_weighted &lt;- tab13p_weighted[, new_order]\n\n# Save the weighted table to CSV \nwrite.csv(tab13p_weighted, file = \"data/Table_App_1_Weighted_Mortality.csv\")\n\n\n\nShow/Hide Code# Display the formatted table using kable for a clean Quarto output\nkable(tab13p_weighted, caption = \"Weighted Characteristics by \n      All-Cause Mortality Status (Analogous to Appendix \n      Table 1)\") %&gt;% \n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\nWeighted Characteristics by All-Cause Mortality Status (Analogous to Appendix Table 1)\n\n\nlevel\nAlive\nDead\nOverall\np\ntest\nSMD\n\n\n\nn\n\n187497900.24\n18761712.99\n206259613.23\n\n\n\n\n\nexposure.cat (%)\nNever smoked\n57.99\n36.57\n56.04\n&lt;0.001\n\n0.450\n\n\n\nStarted before 10\n0.49\n1.48\n0.58\n\n\n\n\n\n\nStarted at 10-14\n7.17\n12.54\n7.66\n\n\n\n\n\n\nStarted at 15-17\n15.02\n21.01\n15.57\n\n\n\n\n\n\nStarted at 18-20\n12.24\n16.78\n12.65\n\n\n\n\n\n\nStarted after 20\n7.09\n11.61\n7.50\n\n\n\n\n\nrace (%)\nWhite\n66.42\n74.81\n67.18\n&lt;0.001\n\n0.266\n\n\n\nBlack\n11.35\n12.90\n11.50\n\n\n\n\n\n\nHispanic\n14.81\n7.87\n14.18\n\n\n\n\n\n\nOthers\n7.42\n4.42\n7.15\n\n\n\n\n\nsex (%)\nMale\n47.88\n55.16\n48.54\n&lt;0.001\n\n0.146\n\n\n\nFemale\n52.12\n44.84\n51.46\n\n\n\n\n\nyear.cat (%)\n1999-2000\n7.83\n19.75\n8.92\n&lt;0.001\n\n0.793\n\n\n\n2001-2002\n8.42\n17.12\n9.21\n\n\n\n\n\n\n2003-2004\n8.91\n15.36\n9.49\n\n\n\n\n\n\n2005-2006\n9.46\n12.42\n9.73\n\n\n\n\n\n\n2007-2008\n9.84\n10.81\n9.93\n\n\n\n\n\n\n2009-2010\n10.28\n8.31\n10.10\n\n\n\n\n\n\n2011-2012\n10.65\n6.73\n10.29\n\n\n\n\n\n\n2013-2014\n11.11\n5.36\n10.59\n\n\n\n\n\n\n2015-2016\n11.57\n2.79\n10.78\n\n\n\n\n\n\n2017-2018\n11.92\n1.34\n10.96\n\n\n\n\n\n\n\n\n\n9.2.2 Appendix Table 2: Characteristics by Smoking Initiation Exposure\n\nThis second table reproduces the results from Appendix Table 2 of the supplementary material. It summarizes the demographic characteristics (race and sex) of the cohort, stratified by the exposure.cat variable (smoking initiation categories). This provides the nationally representative, weighted demographic composition within each smoking exposure group as it accounts for the complex survey design.\n\nShow/Hide Code# Create weighted Table 2 stratified by smoking initiation categories\ntab14_weighted &lt;- svyCreateTableOne(vars = c(\"race\", \"sex\"),\n                                    strata = \"exposure.cat\",\n                                    data = w.design0, # CRITICAL\n                                    addOverall = TRUE,\n                                    test = TRUE)\n\n# Print the table with weighted proportions \n# and specified decimal places\ntab14p_weighted &lt;- print(tab14_weighted,\n                         format = \"p\",\n                         catDigits = 2,\n                         showAllLevels = TRUE,\n                         smd = TRUE)\n\n# Define the desired column order\nnew_order_t2 &lt;- c(\"level\", \"Never smoked\", \"Started before 10\", \n                  \"Started at 10-14\", \"Started at 15-17\", \n                  \"Started at 18-20\", \"Started after 20\", \n                  \"Overall\", \"p\", \"test\", \"SMD\")\n# Apply the new order to the table object\ntab14p_weighted &lt;- tab14p_weighted[, new_order_t2]\n\n# Save the weighted table to CSV\nwrite.csv(tab14p_weighted, file = \"data/Table_App_2_Weighted_Exposure.csv\")\n\n\n\nShow/Hide Code# Display the formatted table using kable for a clean Quarto output\nkable(tab14p_weighted, caption = \"Weighted Characteristics by \n      Smoking Initiation Categories (Analogous to Appendix \n      Table 2)\") %&gt;% \n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\nWeighted Characteristics by Smoking Initiation Categories (Analogous to Appendix Table 2)\n\n\nlevel\nNever smoked\nStarted before 10\nStarted at 10-14\nStarted at 15-17\nStarted at 18-20\nStarted after 20\nOverall\np\ntest\nSMD\n\n\n\nn\n\n115595521.42\n1188555.71\n15799589.69\n32111621.33\n26098412.76\n15465912.33\n206259613.23\n\n\n\n\n\nrace (%)\nWhite\n62.54\n74.05\n75.24\n76.89\n72.65\n63.69\n67.18\n&lt;0.001\n\n0.215\n\n\n\nBlack\n12.53\n6.92\n8.07\n8.47\n10.39\n15.77\n11.50\n\n\n\n\n\n\nHispanic\n16.50\n10.22\n12.37\n10.31\n11.09\n12.20\n14.18\n\n\n\n\n\n\nOthers\n8.42\n8.81\n4.32\n4.34\n5.87\n8.34\n7.15\n\n\n\n\n\nsex (%)\nMale\n42.98\n73.85\n58.70\n56.37\n55.14\n50.42\n48.54\n&lt;0.001\n\n0.251\n\n\n\nFemale\n57.02\n26.15\n41.30\n43.63\n44.86\n49.58\n51.46\n\n\n\n\n\n\n\n\nThis completes the descriptive analysis section of the statistical analysis stage."
  },
  {
    "objectID": "07-descriptive-analysis.html#chapter-summary-and-next-steps",
    "href": "07-descriptive-analysis.html#chapter-summary-and-next-steps",
    "title": "\n9¬† Descriptive Analysis\n",
    "section": "\n9.3 Chapter Summary and Next Steps",
    "text": "9.3 Chapter Summary and Next Steps\nIn this chapter, we generated the primary descriptive statistics for the study cohort. By using the survey design object, we successfully reproduced the weighted characteristics of the participants, creating tables analogous to Appendix Tables 1 and 2 from the paper‚Äôs supplementary material. This gives us a clear, nationally representative picture of our study population.\nNow that we understand the characteristics of our cohort, we will move on to the core analysis in the next chapter, ‚ÄúSurvival Analysis,‚Äù where we will investigate the primary relationship between smoking initiation and mortality."
  },
  {
    "objectID": "08-survival-analysis.html#kaplan-meier-survival-analysis-figure-1",
    "href": "08-survival-analysis.html#kaplan-meier-survival-analysis-figure-1",
    "title": "\n10¬† Survival Analysis\n",
    "section": "\n10.1 Kaplan-Meier Survival Analysis (Figure 1)",
    "text": "10.1 Kaplan-Meier Survival Analysis (Figure 1)\n\nR Code Chunk 2: Kaplan-Meier Curves and Log-Rank Test\n\nKaplan-Meier Curves\nThe following code visualizes the survival probabilities over time using Kaplan-Meier (KM) curves, stratified by the exposure.cat (age at smoking initiation) variable. The KM curves illustrate the proportion of participants surviving over their follow-up time from birth. The svykm() function from the survey package is used to calculate the survival estimates while accounting for the complex survey design. The resulting plot reproduces the trends shown in Figure 1 of the original paper.\n\nShow/Hide Code\n# Define the survival formula\nformulax0 &lt;- as.formula(Surv(stime.since.birth, status_all) \n                        ~ exposure.cat)\n\n# Calculate survey-weighted Kaplan-Meier curves\nsA &lt;- svykm(formulax0, design = w.design0)\nsaveRDS(sA, file = \"data/sA.rds\")\n\n# Dynamically set the number of colors for the legend\ndummy &lt;- length(unique(as.factor(w.design0$variables$exposure.cat)))\n\n# Plot the Kaplan-Meier curves\nplot(sA, pars = list(col = c(1:dummy)),\n     xlab = \"Time\",\n     ylab = \"Proportion surviving\",\n     main = \"Survey-featured Kaplan-Meier Curve:\n     All-Cause Mortality\")\nlegend(\"bottomleft\", \n       levels(as.factor(w.design0$variables$exposure.cat)),\n       col = (1:dummy), lty = c(1,1),\n       bty = \"n\")\n\n\n\nSurvey-weighted Kaplan-Meier curves for all-cause mortality, stratified by age of smoking initiation (reproduces Figure 1 from the paper).\n\n\n\nLog-Rank Test\nAfter plotting the curves, a survey-weighted log-rank test is performed using svylogrank() to statistically determine if there are significant differences in survival curves among the exposure groups. A significant p-value from this test would indicate a statistically significant difference in survival experiences between the age groups of smoking initiation. The paper states that the log-rank test was significant.\n\nShow/Hide Code# Perform the survey-weighted log-rank test\nlrt &lt;- svylogrank(formulax0, design = subset(w.design0, \n                                             survey.weight.new &gt; 0))\n\n# Display the rounded p-value from the log-rank test\nround(lrt[[2]],2)\n#&gt;  Chisq      p \n#&gt; 293.72   0.00\n\n\nTo present these results more formally, the following code uses knitr::kable() to display the full test output, including the Chi-squared statistic and degrees of freedom, in a clean table.\n\nShow/Hide Codekable(lrt[[1]],\n      booktabs = TRUE, digits = 2,\n      col.names = c(\"Test Statistic\", \"Standard Error\", \"Z-value\", \"p-value\"),\n      caption=\"Survey-weighted log-rank test for main analysis comparing survival distributions by age of smoking initiation.\") %&gt;%\n  kable_styling(latex_options = \"hold_position\")\n\n\nSurvey-weighted log-rank test for main analysis comparing survival distributions by age of smoking initiation.\n\nTest Statistic\nStandard Error\nZ-value\np-value\n\n\n\n146771.4\n33970.03\n4.32\n0.00\n\n\n1057040.8\n110866.82\n9.53\n0.00\n\n\n1215922.9\n137852.17\n8.82\n0.00\n\n\n259155.7\n128215.04\n2.02\n0.04\n\n\n235676.6\n91478.11\n2.58\n0.01"
  },
  {
    "objectID": "08-survival-analysis.html#cox-proportional-hazards-models-figure-2",
    "href": "08-survival-analysis.html#cox-proportional-hazards-models-figure-2",
    "title": "\n10¬† Survival Analysis\n",
    "section": "\n10.2 Cox Proportional Hazards Models (Figure 2)",
    "text": "10.2 Cox Proportional Hazards Models (Figure 2)\n\n10.2.1 Unadjusted Model (Crude HRs)\n\nR Code Chunk 3: Unadjusted Cox Model (for Comparison)\n\nThe following code demonstrates a standard, un-weighted Cox proportional hazards model using base R‚Äôs coxph() function on the dat.complete dataset. This model does not account for the complex survey design of NHANES and is included as a baseline, primarily for comparison or to understand how unweighted models would be run. The publish() function is used to format the model output for easier interpretation.\n\nShow/Hide Code# Fit an un-weighted Cox Proportional Hazards model\nfit0 &lt;- coxph(Surv(stime.since.birth, status_all) ~ exposure.cat, \n              data = dat.complete)\n\n# Use 'publish' to format the output for display\npublish(fit0)\n#&gt;      Variable             Units HazardRatio       CI.95 p-value \n#&gt;  exposure.cat      Never smoked         Ref                     \n#&gt;               Started before 10        2.44 [1.99;3.00]  &lt;0.001 \n#&gt;                Started at 10-14        2.37 [2.19;2.58]  &lt;0.001 \n#&gt;                Started at 15-17        1.92 [1.79;2.06]  &lt;0.001 \n#&gt;                Started at 18-20        1.51 [1.40;1.62]  &lt;0.001 \n#&gt;                Started after 20        1.51 [1.39;1.64]  &lt;0.001\n\n\n\n\nR Code Chunk 4: Unadjusted Survey-Weighted Cox Proportional Hazards Model\n\nThe following code fits the unadjusted Cox proportional hazards model, but it uses svycoxph() from the survey package to account for the complex NHANES survey design. This model examines the crude association between smoking initiation categories and all-cause mortality, producing Hazard Ratios. The publish() function is used to format the model output for easier interpretation. The HRs from this model contribute to the ‚ÄúCrude‚Äù estimates shown in Figure 2 of the paper.\n\nShow/Hide Code# Fit the unadjusted survey-weighted Cox Proportional Hazards model\nfit0 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat, \n                 design = w.design0)\n\n# Use 'publish' to format the output for display\nf0 &lt;- publish(fit0) \n#&gt; Stratified 1 - level Cluster Sampling design (with replacement)\n#&gt; With (301) clusters.\n#&gt; subset(w.design, miss == 0 & survey.weight.new &gt; 0)\n#&gt;      Variable             Units HazardRatio       CI.95 p-value \n#&gt;  exposure.cat      Never smoked         Ref                     \n#&gt;               Started before 10        3.01 [2.29;3.95]  &lt;0.001 \n#&gt;                Started at 10-14        2.60 [2.32;2.92]  &lt;0.001 \n#&gt;                Started at 15-17        2.07 [1.88;2.28]  &lt;0.001 \n#&gt;                Started at 18-20        1.55 [1.40;1.72]  &lt;0.001 \n#&gt;                Started after 20        1.60 [1.45;1.76]  &lt;0.001\n\n\n\n\nR Code Chunk 5: Process Unadjusted Hazard Ratios for Plotting\n\nThe output from publish() is a formatted table, but for plotting, we need a clean data frame of the results.\nThe following code extracts the Hazard Ratios and their 95% Confidence Intervals from the unadjusted survey-weighted Cox Model (f0). The stringr package is used to parse the confidence interval strings into separate lower and upper bound numeric columns.\n\nShow/Hide Code# Select HR and CI columns for exposure categories from 'f0'\nf0r &lt;- f0$regressionTable[2:6,c(\"HazardRatio\",\"CI.95\")] \n\n# Add a 'group' column to label these results as \"Crude\" for plotting\nf0r$group &lt;- \"Crude\"\n\n# Extract lower and upper bounds from the CI string\nci &lt;- str_extract_all(f0r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf0r$CI.l &lt;- as.numeric(as.character(ci[,1])) # Lower bound\nf0r$CI.u &lt;- as.numeric(as.character(ci[,2])) # Upper bound\n\n# Rename columns for consistency in plotting\nnames(f0r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n# Display the processed data frame\nf0r\n\n\n\n  \n\n\n\n\n10.2.2 Adjusted Model (Adjusted HRs)\n\nR Code Chunk 6: Adjusted Survey-Weighted Cox Proportional Hazards Model\n\nThe following code fits the adjusted Cox proportional hazards model, accounting for the complex survey design and controlling for key covariates. As described in the paper, the model is adjusted to account for sex, race/ethnicity, and survey cycle. This model estimates the adjusted Hazard Ratios, which contribute to the ‚ÄúAdjusted‚Äù estimates shown in Figure 2 of the paper.\n\nShow/Hide Code# Fit the adjusted survey-weighted Cox Proportional Hazards model\nfit1 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat + \n                   sex + race + year.cat, design = w.design0)\n\n# Use 'publish' to format the output for display\nf1 &lt;- publish(fit1) # Store the published output\n#&gt; Stratified 1 - level Cluster Sampling design (with replacement)\n#&gt; With (301) clusters.\n#&gt; subset(w.design, miss == 0 & survey.weight.new &gt; 0)\n#&gt;      Variable             Units HazardRatio       CI.95   p-value \n#&gt;  exposure.cat      Never smoked         Ref                       \n#&gt;               Started before 10        2.71 [2.05;3.58]   &lt; 0.001 \n#&gt;                Started at 10-14        2.38 [2.11;2.68]   &lt; 0.001 \n#&gt;                Started at 15-17        1.96 [1.77;2.16]   &lt; 0.001 \n#&gt;                Started at 18-20        1.48 [1.33;1.64]   &lt; 0.001 \n#&gt;                Started after 20        1.54 [1.39;1.70]   &lt; 0.001 \n#&gt;           sex              Male         Ref                       \n#&gt;                          Female        0.75 [0.70;0.80]   &lt; 0.001 \n#&gt;          race             White         Ref                       \n#&gt;                           Black        1.59 [1.47;1.73]   &lt; 0.001 \n#&gt;                        Hispanic        1.03 [0.93;1.15]   0.55581 \n#&gt;                          Others        1.15 [0.97;1.37]   0.10079 \n#&gt;      year.cat         1999-2000         Ref                       \n#&gt;                       2001-2002        0.96 [0.86;1.08]   0.50457 \n#&gt;                       2003-2004        0.84 [0.75;0.94]   0.00328 \n#&gt;                       2005-2006        0.76 [0.67;0.85]   &lt; 0.001 \n#&gt;                       2007-2008        0.77 [0.67;0.90]   &lt; 0.001 \n#&gt;                       2009-2010        0.68 [0.59;0.78]   &lt; 0.001 \n#&gt;                       2011-2012        0.62 [0.51;0.76]   &lt; 0.001 \n#&gt;                       2013-2014        0.58 [0.48;0.69]   &lt; 0.001 \n#&gt;                       2015-2016        0.35 [0.27;0.45]   &lt; 0.001 \n#&gt;                       2017-2018        0.20 [0.13;0.29]   &lt; 0.001\n\n\n\n\nR Code Chunk 7: Process Adjusted Hazard Ratios for Plotting\n\nThe following code follows the similar processing done for the unadjusted model, but applies it to the results of the adjusted survey-weighted Cox model.\n\nShow/Hide Code# Select Hazard Ratio and CI columns for exposure categories from 'f1'\nf1r &lt;- f1$regressionTable[2:6,c(\"HazardRatio\",\"CI.95\")]\n\n# Add a 'group' column to label these results as \"Adjusted\"\nf1r$group &lt;- \"Adjusted\"\n\n# Extract lower and upper bounds from the CI string\nci &lt;- str_extract_all(f1r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf1r$CI.l &lt;- as.numeric(as.character(ci[,1]))\nf1r$CI.u &lt;- as.numeric(as.character(ci[,2]))\n\n# Rename columns for consistency in plotting\nnames(f1r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n# Display the processed data frame\nf1r"
  },
  {
    "objectID": "08-survival-analysis.html#saving-model-results",
    "href": "08-survival-analysis.html#saving-model-results",
    "title": "\n10¬† Survival Analysis\n",
    "section": "\n10.3 Saving Model Results",
    "text": "10.3 Saving Model Results\n\nR Code Chunk 8: Save Processed Results\n\nFinally, we save the two processed data frames (f0r and f1r) containing the crude and adjusted results. These files will be loaded in the next section to create the plot that visualizes these findings (Figure 2 of paper).\n\nShow/Hide Code# Save the processed HR data frames for the next chapter\nsaveRDS(f0r, file = \"data/f0r.rds\")\nsaveRDS(f1r, file = \"data/f1r.rds\")\n\n\nThis completes the survival analysis section of the statistical analysis stage."
  },
  {
    "objectID": "08-survival-analysis.html#chapter-summary-and-next-steps",
    "href": "08-survival-analysis.html#chapter-summary-and-next-steps",
    "title": "\n10¬† Survival Analysis\n",
    "section": "\n10.4 Chapter Summary and Next Steps",
    "text": "10.4 Chapter Summary and Next Steps\nWe have now completed the main survival analysis. We successfully reproduced the Kaplan-Meier curves (Figure 1 from the paper) to visualize survival probabilities and fitted both crude and adjusted survey-weighted Cox models to estimate the hazard ratios, replicating the core findings presented in Figure 2.\nThe results show a clear association between early smoking initiation and mortality. The next logical step, covered in the ‚ÄúEffect Modification Analysis‚Äù chapter, is to investigate whether this association differs across key demographic groups."
  },
  {
    "objectID": "09-effect-modification.html#investigating-effect-modification-by-raceethnicity",
    "href": "09-effect-modification.html#investigating-effect-modification-by-raceethnicity",
    "title": "\n11¬† Effect Modification Analysis\n",
    "section": "\n11.1 Investigating Effect Modification by Race/Ethnicity",
    "text": "11.1 Investigating Effect Modification by Race/Ethnicity\n\nR Code Chunk 2: Effect Modification by Race/Ethnicity\n\nThe following code fits a survey-weighted Cox proportional hazards model, including an interaction term between exposure.cat (smoking initiation age) and race. This model is used to assess if the association between early smoking initiation and mortality differs across various racial/ethnic levels or groups.\n\nShow/Hide Code# Effect modification by race\nfit2 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*race \n                 + sex + year.cat, design = w.design0)\n\n# Publish the results for later processing\nf2 &lt;- publish(fit2)\n#&gt; Stratified 1 - level Cluster Sampling design (with replacement)\n#&gt; With (301) clusters.\n#&gt; subset(w.design, miss == 0 & survey.weight.new &gt; 0)\n#&gt;                                                         Variable     Units HazardRatio        CI.95   p-value \n#&gt;                                                              sex      Male         Ref                        \n#&gt;                                                                     Female        0.74  [0.70;0.79]   &lt; 0.001 \n#&gt;                                                         year.cat 1999-2000         Ref                        \n#&gt;                                                                  2001-2002        0.96  [0.86;1.08]   0.52079 \n#&gt;                                                                  2003-2004        0.84  [0.74;0.94]   0.00236 \n#&gt;                                                                  2005-2006        0.75  [0.67;0.84]   &lt; 0.001 \n#&gt;                                                                  2007-2008        0.77  [0.66;0.90]   &lt; 0.001 \n#&gt;                                                                  2009-2010        0.68  [0.59;0.78]   &lt; 0.001 \n#&gt;                                                                  2011-2012        0.62  [0.51;0.76]   &lt; 0.001 \n#&gt;                                                                  2013-2014        0.58  [0.48;0.69]   &lt; 0.001 \n#&gt;                                                                  2015-2016        0.34  [0.26;0.45]   &lt; 0.001 \n#&gt;                                                                  2017-2018        0.19  [0.13;0.29]   &lt; 0.001 \n#&gt;                 exposure.cat(Never smoked): race(Black vs White)                  1.82  [1.63;2.04]   &lt; 0.001 \n#&gt;              exposure.cat(Never smoked): race(Hispanic vs White)                  1.24  [1.06;1.45]   0.00596 \n#&gt;                exposure.cat(Never smoked): race(Others vs White)                  1.21  [0.95;1.54]   0.12522 \n#&gt;            exposure.cat(Started before 10): race(Black vs White)                  1.11  [0.54;2.29]   0.77275 \n#&gt;         exposure.cat(Started before 10): race(Hispanic vs White)                  0.40  [0.17;0.90]   0.02774 \n#&gt;           exposure.cat(Started before 10): race(Others vs White)                  1.74  [0.65;4.69]   0.27143 \n#&gt;             exposure.cat(Started at 10-14): race(Black vs White)                  1.44  [1.13;1.83]   0.00303 \n#&gt;          exposure.cat(Started at 10-14): race(Hispanic vs White)                  0.78  [0.55;1.10]   0.14920 \n#&gt;            exposure.cat(Started at 10-14): race(Others vs White)                  1.44  [0.88;2.35]   0.14422 \n#&gt;             exposure.cat(Started at 15-17): race(Black vs White)                  1.43  [1.23;1.67]   &lt; 0.001 \n#&gt;          exposure.cat(Started at 15-17): race(Hispanic vs White)                  0.89  [0.69;1.15]   0.35784 \n#&gt;            exposure.cat(Started at 15-17): race(Others vs White)                  1.57  [1.07;2.30]   0.02207 \n#&gt;             exposure.cat(Started at 18-20): race(Black vs White)                  1.72  [1.40;2.10]   &lt; 0.001 \n#&gt;          exposure.cat(Started at 18-20): race(Hispanic vs White)                  1.05  [0.83;1.32]   0.70369 \n#&gt;            exposure.cat(Started at 18-20): race(Others vs White)                  0.96  [0.62;1.50]   0.86329 \n#&gt;             exposure.cat(Started after 20): race(Black vs White)                  1.32  [1.07;1.61]   0.00811 \n#&gt;          exposure.cat(Started after 20): race(Hispanic vs White)                  0.98  [0.77;1.24]   0.85155 \n#&gt;            exposure.cat(Started after 20): race(Others vs White)                  0.77  [0.54;1.10]   0.14624 \n#&gt;     race(White): exposure.cat(Started before 10 vs Never smoked)                  3.13  [2.27;4.31]   &lt; 0.001 \n#&gt;      race(White): exposure.cat(Started at 10-14 vs Never smoked)                  2.53  [2.16;2.97]   &lt; 0.001 \n#&gt;      race(White): exposure.cat(Started at 15-17 vs Never smoked)                  2.06  [1.84;2.31]   &lt; 0.001 \n#&gt;      race(White): exposure.cat(Started at 18-20 vs Never smoked)                  1.53  [1.35;1.74]   &lt; 0.001 \n#&gt;      race(White): exposure.cat(Started after 20 vs Never smoked)                  1.70  [1.50;1.92]   &lt; 0.001 \n#&gt;     race(Black): exposure.cat(Started before 10 vs Never smoked)                  1.91  [0.99;3.69]   0.05438 \n#&gt;      race(Black): exposure.cat(Started at 10-14 vs Never smoked)                  2.00  [1.65;2.42]   &lt; 0.001 \n#&gt;      race(Black): exposure.cat(Started at 15-17 vs Never smoked)                  1.62  [1.37;1.92]   &lt; 0.001 \n#&gt;      race(Black): exposure.cat(Started at 18-20 vs Never smoked)                  1.45  [1.20;1.75]   &lt; 0.001 \n#&gt;      race(Black): exposure.cat(Started after 20 vs Never smoked)                  1.22  [1.03;1.46]   0.02524 \n#&gt;  race(Hispanic): exposure.cat(Started before 10 vs Never smoked)                  1.00  [0.47;2.15]   0.99907 \n#&gt;   race(Hispanic): exposure.cat(Started at 10-14 vs Never smoked)                  1.58  [1.22;2.05]   &lt; 0.001 \n#&gt;   race(Hispanic): exposure.cat(Started at 15-17 vs Never smoked)                  1.47  [1.08;2.00]   0.01433 \n#&gt;   race(Hispanic): exposure.cat(Started at 18-20 vs Never smoked)                  1.29  [1.00;1.67]   0.04860 \n#&gt;   race(Hispanic): exposure.cat(Started after 20 vs Never smoked)                  1.33  [1.00;1.78]   0.04861 \n#&gt;    race(Others): exposure.cat(Started before 10 vs Never smoked)                  4.51 [1.87;10.87]   &lt; 0.001 \n#&gt;     race(Others): exposure.cat(Started at 10-14 vs Never smoked)                  3.01  [1.81;5.02]   &lt; 0.001 \n#&gt;     race(Others): exposure.cat(Started at 15-17 vs Never smoked)                  2.67  [1.73;4.10]   &lt; 0.001 \n#&gt;     race(Others): exposure.cat(Started at 18-20 vs Never smoked)                  1.22  [0.74;2.00]   0.43325 \n#&gt;     race(Others): exposure.cat(Started after 20 vs Never smoked)                  1.08  [0.70;1.66]   0.73892\n\n\n\n\nR Code Chunk 3: Testing Race/Ethnicity Interaction (Poisson Approximation)\n\nThe following code performs statistical tests to formally assess the significance of the interaction term between exposure.cat and race. It uses svyglm with a Poisson family (as an approximation to the Cox model) to allow for anova() comparisons, and regTermTest() is used to perform a Likelihood Ratio Test (LRT) directly on the interaction term. This helps determine if the observed variations in association by race are statistically significant.\n\nShow/Hide Code# Fit the baseline Poisson model (no interaction)\nfit1a &lt;- svyglm(status_all ~ offset(log(stime.since.birth)) + \n                  exposure.cat + race + sex  + year.cat,\n                design = w.design0, family=poisson)\n\n# Fit the full Poisson model (with interaction)\nfit2a &lt;- svyglm(status_all ~ offset(log(stime.since.birth)) + \n                  exposure.cat*race + sex  + year.cat,\n                design = w.design0, family=poisson)\n\n# Compare the two models using a Rao-Scott test (via anova)\nanova(fit2a,fit1a)\n#&gt; Working (Rao-Scott+F) LRT for exposure.cat:race\n#&gt;  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#&gt;     exposure.cat * race + sex + year.cat, design = w.design0, \n#&gt;     family = poisson)\n#&gt; Working 2logLR =  21.45753 p= 0.16075 \n#&gt; (scale factors:  2 1.9 1.8 1.5 1.4 0.98 0.93 0.76 0.73 0.62 0.57 0.54 0.45 0.37 0.36 );  denominator df= 120\n\n# Directly test the interaction term using a Likelihood Ratio Test\nregTermTest(fit2a, test.terms = \"exposure.cat:race\", method = \"LRT\")\n#&gt; Working (Rao-Scott+F) LRT for exposure.cat:race\n#&gt;  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#&gt;     exposure.cat * race + sex + year.cat, design = w.design0, \n#&gt;     family = poisson)\n#&gt; Working 2logLR =  21.45753 p= 0.16075 \n#&gt; (scale factors:  2 1.9 1.8 1.5 1.4 0.98 0.93 0.76 0.73 0.62 0.57 0.54 0.45 0.37 0.36 );  denominator df= 120\n\n\n\n\nR Code Chunk 4: Process Race-Specific Hazard Ratios for Plotting\n\nAlthough the overall interaction term was not statistically significant, the original paper still presented the stratum-specific Hazard Ratios (HRs) to visualize the trends within each racial/ethnic group. So the following code extracts stratum-specific Hazard Ratios (HRs) and their 95% Confidence Intervals (CIs) for each racial/ethnic group from the f2 object (the published output of fit2). These HRs reflect the effect of smoking initiation within each racial/ethnic stratum, allowing for a detailed examination of potential effect modification. The extracted data is formatted into a dataframe, f2r.\n\nShow/Hide Code# Extract HRs and CIs for each race subgroup from the published output\nf2rW &lt;- f2$regressionTable[31:35,c(\"HazardRatio\",\"CI.95\")]\nf2rB &lt;- f2$regressionTable[36:40,c(\"HazardRatio\",\"CI.95\")]\nf2rH &lt;- f2$regressionTable[41:45,c(\"HazardRatio\",\"CI.95\")]\n\n# Assign group labels and combine into a single data frame\nf2rW$group &lt;- \"White\"\nf2rB$group &lt;- \"Black\"\nf2rH$group &lt;- \"Hispanic\"\nf2r &lt;- rbind(f2rW, f2rB, f2rH)\n\n# Process CIs: Extract lower and upper bounds from the CI string\nci &lt;- str_extract_all(f2r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf2r$CI.l &lt;- as.numeric(as.character(ci[,1]))\nf2r$CI.u &lt;- as.numeric(as.character(ci[,2]))\nnames(f2r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n# Display the final processed data frame\nf2r"
  },
  {
    "objectID": "09-effect-modification.html#investigating-effect-modification-by-sex",
    "href": "09-effect-modification.html#investigating-effect-modification-by-sex",
    "title": "\n11¬† Effect Modification Analysis\n",
    "section": "\n11.2 Investigating Effect Modification by Sex",
    "text": "11.2 Investigating Effect Modification by Sex\n\nR Code Chunk 5: Effect Modification by Sex\n\nThe following code fits another survey-weighted Cox proportional hazards model, this time including an interaction term between exposure.cat and sex. This model is used to investigate whether the association between early smoking initiation and mortality varies between male and female participants.\n\nShow/Hide Code# Effect modification by sex\nfit3 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*sex \n                 + race + year.cat, design = w.design0)\n\n# Publish the results for later processing\nf3 &lt;- publish(fit3)\n#&gt; Stratified 1 - level Cluster Sampling design (with replacement)\n#&gt; With (301) clusters.\n#&gt; subset(w.design, miss == 0 & survey.weight.new &gt; 0)\n#&gt;                                                      Variable     Units HazardRatio       CI.95   p-value \n#&gt;                                                          race     White         Ref                       \n#&gt;                                                                   Black        1.60 [1.47;1.74]   &lt; 0.001 \n#&gt;                                                                Hispanic        1.04 [0.93;1.16]   0.51363 \n#&gt;                                                                  Others        1.16 [0.98;1.37]   0.09252 \n#&gt;                                                      year.cat 1999-2000         Ref                       \n#&gt;                                                               2001-2002        0.96 [0.86;1.08]   0.51741 \n#&gt;                                                               2003-2004        0.84 [0.74;0.94]   0.00291 \n#&gt;                                                               2005-2006        0.75 [0.67;0.84]   &lt; 0.001 \n#&gt;                                                               2007-2008        0.77 [0.66;0.90]   &lt; 0.001 \n#&gt;                                                               2009-2010        0.68 [0.59;0.78]   &lt; 0.001 \n#&gt;                                                               2011-2012        0.62 [0.51;0.76]   &lt; 0.001 \n#&gt;                                                               2013-2014        0.58 [0.48;0.69]   &lt; 0.001 \n#&gt;                                                               2015-2016        0.35 [0.27;0.45]   &lt; 0.001 \n#&gt;                                                               2017-2018        0.20 [0.13;0.29]   &lt; 0.001 \n#&gt;               exposure.cat(Never smoked): sex(Female vs Male)                  0.67 [0.61;0.74]   &lt; 0.001 \n#&gt;          exposure.cat(Started before 10): sex(Female vs Male)                  0.77 [0.30;1.99]   0.58537 \n#&gt;           exposure.cat(Started at 10-14): sex(Female vs Male)                  1.03 [0.81;1.31]   0.80520 \n#&gt;           exposure.cat(Started at 15-17): sex(Female vs Male)                  0.76 [0.66;0.88]   &lt; 0.001 \n#&gt;           exposure.cat(Started at 18-20): sex(Female vs Male)                  0.73 [0.62;0.87]   &lt; 0.001 \n#&gt;           exposure.cat(Started after 20): sex(Female vs Male)                  0.78 [0.67;0.90]   &lt; 0.001 \n#&gt;    sex(Male): exposure.cat(Started before 10 vs Never smoked)                  2.54 [1.86;3.47]   &lt; 0.001 \n#&gt;     sex(Male): exposure.cat(Started at 10-14 vs Never smoked)                  2.05 [1.81;2.32]   &lt; 0.001 \n#&gt;     sex(Male): exposure.cat(Started at 15-17 vs Never smoked)                  1.83 [1.61;2.09]   &lt; 0.001 \n#&gt;     sex(Male): exposure.cat(Started at 18-20 vs Never smoked)                  1.40 [1.22;1.61]   &lt; 0.001 \n#&gt;     sex(Male): exposure.cat(Started after 20 vs Never smoked)                  1.42 [1.22;1.64]   &lt; 0.001 \n#&gt;  sex(Female): exposure.cat(Started before 10 vs Never smoked)                  2.90 [1.21;6.92]   0.01677 \n#&gt;   sex(Female): exposure.cat(Started at 10-14 vs Never smoked)                  3.15 [2.49;3.97]   &lt; 0.001 \n#&gt;   sex(Female): exposure.cat(Started at 15-17 vs Never smoked)                  2.07 [1.81;2.37]   &lt; 0.001 \n#&gt;   sex(Female): exposure.cat(Started at 18-20 vs Never smoked)                  1.53 [1.32;1.78]   &lt; 0.001 \n#&gt;   sex(Female): exposure.cat(Started after 20 vs Never smoked)                  1.63 [1.44;1.85]   &lt; 0.001\n\n\n\n\nR Code Chunk 6: Testing Sex Interaction (Poisson Approximation and AIC)\n\nSimilar to the race interaction, we now formally test the significance of the interaction between smoking initiation and sex. We use the same Poisson approximation approach to compare the model with the interaction term (fit3a) against the baseline model without it (fit1a).\n\n\n\n\n\n\nNote\n\n\n\nThe Akaike Information Criterion (AIC) is calculated for this model and compared with previous models to evaluate overall model fit, as discussed in the paper. A lower AIC value indicates a better model fit. The paper reports that the sex interaction was statistically significant (p=0.001) and that this model provided a superior fit (lower AIC) compared to the others.\n\n\n\nShow/Hide Code# Fit the full Poisson model (with sex interaction)\nfit3a &lt;- svyglm(status_all ~ offset(log(stime.since.birth)) + \n                  exposure.cat*sex + race + year.cat,\n                design = w.design0, family=poisson)\n\n# Compare the sex-interaction model to the baseline model (fit1a)\nanova(fit3a,fit1a) \n#&gt; Working (Rao-Scott+F) LRT for exposure.cat:sex\n#&gt;  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#&gt;     exposure.cat * sex + race + year.cat, design = w.design0, \n#&gt;     family = poisson)\n#&gt; Working 2logLR =  21.44332 p= 0.0014171 \n#&gt; (scale factors:  1.2 1.1 1 0.87 0.76 );  denominator df= 130\n\n# Directly test the interaction term\nregTermTest(fit3a, test.terms = \"exposure.cat:sex\", method = \"LRT\")\n#&gt; Working (Rao-Scott+F) LRT for exposure.cat:sex\n#&gt;  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#&gt;     exposure.cat * sex + race + year.cat, design = w.design0, \n#&gt;     family = poisson)\n#&gt; Working 2logLR =  21.44332 p= 0.0014171 \n#&gt; (scale factors:  1.2 1.1 1 0.87 0.76 );  denominator df= 130\n\n# Compare AIC values across all three models for overall fit\nAIC(fit1a, fit2a, fit3a)\n#&gt;         eff.p      AIC deltabar\n#&gt; [1,] 24.73244 17872.62 1.374024\n#&gt; [2,] 34.63283 17878.17 1.049480\n#&gt; [3,] 30.80173 17858.35 1.339206\n\n\n\n\nR Code Chunk 7: Process Sex-Specific Hazard Ratios for Plotting\n\nThe following code extracts the Hazard Ratios (HRs) and their 95% Confidence Intervals (CIs) for both male and female subgroups from the f3 object (the published output of fit3). These HRs reflect the effect of smoking initiation within each sex level The extracted data is formatted into data frame, f3r.\n\nShow/Hide Code# Extract HRs and CIs for male and female subgroups from the published output\nf3rM &lt;- f3$regressionTable[21:25,c(\"HazardRatio\",\"CI.95\")]\nf3rF &lt;- f3$regressionTable[26:30,c(\"HazardRatio\",\"CI.95\")]\n\n# Assign group labels and combine into a single data frame\nf3rM$group &lt;- \"Male\"\nf3rF$group &lt;- \"Female\"\nf3r &lt;- rbind(f3rM, f3rF)\n\n# Process CIs: Extract lower and upper bounds from the CI string\nci &lt;- str_extract_all(f3r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf3r$CI.l &lt;- as.numeric(as.character(ci[,1]))\nf3r$CI.u &lt;- as.numeric(as.character(ci[,2]))\nnames(f3r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n# Display the final processed data frame\nf3r"
  },
  {
    "objectID": "09-effect-modification.html#visualizing-the-results-figure-2",
    "href": "09-effect-modification.html#visualizing-the-results-figure-2",
    "title": "\n11¬† Effect Modification Analysis\n",
    "section": "\n11.3 Visualizing the Results (Figure 2)",
    "text": "11.3 Visualizing the Results (Figure 2)\n\nR Code Chunk 8: Forest Plot Visualization of Hazard Ratios\n\nThe following code prepares the data for the comprehensive forest plot. It binds together the Hazard Ratios from the crude (f0r), adjusted (f1r), race-specific (f2r), and sex-specific (f3r) models into a single data frame fr. It then converts relevant columns to numeric types and assigns descriptive labels (age.grp).\n\nShow/Hide Code# Bind all processed HR data frames and set as data frame\nfr &lt;- rbind(f0r,f1r,f2r,f3r)\nfr &lt;- as.data.frame(fr)\n\n# Convert to numeric columns\nfr[,c(1,4,5)] &lt;- sapply(fr[,c(1,4,5)], as.numeric)\n\n# Assign 'age.grp' labels\nfr$age.grp &lt;- c('Started before 10', 'Started at 10-14',\n                \"Started at 15-17\", \"Started at 18-20\",\n                \"Started after 20\")\n\n# Save the final plotting dataframe\nsaveRDS(fr, file = \"data/fr.rds\")\n\n\nThe following code uses the ggplot2 package to visualize the comprehensive forest plot with the estimated Hazard Ratios and their 95% Confidence Intervals from all models (crude, adjusted, and subgroup-specific). This corresponds to Figure 2 in the published paper.\n\nShow/Hide Code# Set factor levels for correct ordering in the plot\nfr$age.grp &lt;- factor(fr$age.grp,\n                     levels = c('Started before 10',\n                                'Started at 10-14',\"Started at 15-17\",\n                                \"Started at 18-20\",\"Started after 20\"))\nfr$group &lt;- factor(fr$group,\n                     levels = rev(c(\"Crude\", \"Adjusted\", \n                                \"White\", \"Black\", \"Hispanic\", \n                                \"Male\", \"Female\")))\n\nlevels(fr$group)[levels(fr$group) == \"White\"] &lt;- \"Non-Hispanic White\"\nlevels(fr$group)[levels(fr$group) == \"Black\"] &lt;- \"Non-Hispanic Black\"\nfr$text_label &lt;- sprintf(\"%.2f [%.2f;%.2f]\", fr$mean, fr$lower, fr$upper)\n\n# Create plot\nggplot(fr, \n       aes(x = mean, y = group, colour = age.grp)) + \n  geom_errorbar(aes(xmin = lower, xmax = upper), \n                position = position_dodge(0.9), width = 0.25) + \n  geom_point(position = position_dodge(0.9), shape = 1) + \n  geom_text(aes(label = text_label, x = upper, hjust = -0.05), \n            position = position_dodge(0.9), size = 3) +\n  scale_x_continuous(limits = c(0, 9)) +\n  \n  labs(x = \"Hazard Ratio\", y = \"\", \n       legend=TRUE, col = \"Age group\") +\n  theme_classic() +\n  theme(panel.grid.major.x = element_blank(),\n        panel.border = element_blank(),\n        legend.title=element_text(size=12), \n        legend.text=element_text(size=12),\n        plot.title = element_text(hjust = 0.5),\n        axis.text.x = element_text(size = 10, face = \"bold\"),\n        axis.text.y = element_text(size = 10, face = \"bold\"),\n        legend.position=c(.8, .8)) +\n  geom_vline(xintercept = 1, linetype = \"dashed\", color = \"grey\")+\n  guides(color = guide_legend(override.aes = list(shape = 1, linetype = 1, size = 1)))\n#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n#&gt; 3.5.0.\n#&gt; ‚Ñπ Please use the `legend.position.inside` argument of `theme()` instead.\n\n\n\nForest plot summarizing Hazard Ratios (HRs) for all-cause mortality associated with age of smoking initiation. Results from the crude, main adjusted, and stratified models (by race/ethnicity and sex) are shown. This plot reproduces Figure 2 from the paper.\n\n\nShow/Hide Code# Save\nggsave(\"images/forest.png\")\n#&gt; Saving 7 x 5 in image"
  },
  {
    "objectID": "09-effect-modification.html#quantifying-additive-interaction-reri",
    "href": "09-effect-modification.html#quantifying-additive-interaction-reri",
    "title": "\n11¬† Effect Modification Analysis\n",
    "section": "\n11.4 Quantifying Additive Interaction (RERI)",
    "text": "11.4 Quantifying Additive Interaction (RERI)\n\nR Code Chunk 9: Relative Excess Risk Due to Interaction (RERI) Function\n\nThe following code creates the reri.f function which calculates the relative excess risk due to interaction (RERI). RERI is a common measure of additive interaction, providing insight into whether the combined effect of two factors is greater than the sum of their individual effects. The function computes the RERI estimate and its confidence interval based on the delta method, accounting for the variance and covariance of the estimated coefficients.\n\nShow/Hide Codereri.f &lt;- function(model, coef, conf.level = 0.95){\n  N. &lt;- 1 - ((1 - conf.level)/2)\n  z &lt;- qnorm(N., mean = 0, sd = 1)\n  theta1 &lt;- as.numeric(model$coefficients[coef[1]])\n  theta2 &lt;- as.numeric(model$coefficients[coef[2]])\n  theta3 &lt;- as.numeric(model$coefficients[coef[3]])\n  theta1.se &lt;- summary(model)$coefficients[coef[1],2]\n  theta2.se &lt;- summary(model)$coefficients[coef[2],2]\n  theta3.se &lt;- summary(model)$coefficients[coef[3],2]\n  \n  cov.mat &lt;- vcov(model)\n  h1 &lt;- exp(theta1 + theta2 + theta3) - exp(theta1)\n  h2 &lt;- exp(theta1 + theta2 + theta3) - exp(theta2)\n  h3 &lt;- exp(theta1 + theta2 + theta3)\n     \n  reri.var &lt;- (h1^2 * theta1.se^2) + \n       (h2^2 * theta2.se^2) + \n       (h3^2 * theta3.se^2) + \n       (2 * h1 * h2 * cov.mat[coef[1],coef[2]]) + \n       (2 * h1 * h3 * cov.mat[coef[1],coef[3]]) + \n       (2 * h2 * h3 * cov.mat[coef[2],coef[3]])\n  reri.se &lt;- sqrt(reri.var)\n  \n  reri.p &lt;- exp(theta1 + theta2 + theta3) - exp(theta1) - exp(theta2) + 1\n  reri.l &lt;- reri.p - (z * reri.se)\n  reri.u &lt;- reri.p + (z * reri.se)\n  reri &lt;- data.frame(est = reri.p, lower = reri.l, upper = reri.u)\nreturn(reri)\n}\n\n\n\n\nR Code Chunk 10: Calculate and Report RERI for Sex Interaction\n\nCorresponds to Appendix Table 5\nThe following code calculates the RERI for the interaction between smoking initiation age (exposure.cat) and sex, using the fit3 model. The calculations are performed for each level of exposure.cat relative to its reference level. The results are presented in a table and saved to an Excel file (reriM2.xlsx).\n\nShow/Hide Code# Get the names of the coefficients from the sex-interaction model\ncoef.val &lt;- names(fit3$coefficients)\n\n# Define the active (non-reference) levels for exposure and the moderator (sex)\nexp.active.lev &lt;- paste0(\"exposure.cat\", levels(w.design0$variables$exposure.cat)[-1])\nmod.active.lev &lt;- paste0(\"sex\", levels(w.design0$variables$sex)[-1])\nint.term &lt;- paste(exp.active.lev, mod.active.lev, sep=\":\")\nrr &lt;- NULL\n\n# Loop through each exposure level to calculate RERI\nfor (i in 1:length(exp.active.lev)){\n  coef.val1 &lt;- coef.val[c(which(coef.val==exp.active.lev[i]),\n                          which(coef.val==mod.active.lev[1]),\n                          which(coef.val==int.term[i]))]\n  r1 &lt;- reri.f(model=fit3, coef=coef.val1, conf.level = 0.95)\n  rr &lt;- rbind(rr,r1)\n}\n\n# Assign row names for clarity\nrow.names(rr) &lt;- levels(w.design0$variables$exposure.cat)[-1]\n\n\n\nShow/Hide Codeexpss::xl_write_file(rr, filename = \"data/reriM2.xlsx\", rownames = TRUE)\nkable(rr,\n      booktabs = TRUE, digits = 2,\n      caption=\"Appendix Table 5: Reporting RERI for the Sex Interaction.\",\n      col.names = c(\"Levels\", \"RERI\", \"Lower CI\", \"Upper CI\")) %&gt;%\n  kable_styling(latex_options = \"hold_position\")\n\n\nAppendix Table 5: Reporting RERI for the Sex Interaction.\n\nLevels\nRERI\nLower CI\nUpper CI\n\n\n\nStarted before 10\n-0.26\n-5.80\n5.27\n\n\nStarted at 10-14\n0.39\n-6.24\n7.02\n\n\nStarted at 15-17\n-0.12\n-3.70\n3.47\n\n\nStarted at 18-20\n-0.04\n-2.52\n2.43\n\n\nStarted after 20\n0.01\n-2.69\n2.71\n\n\n\n\n\n\n\nR Code Chunk 11: Calculate and Report RERI for Race/Ethnicity Interaction\n\nCorresponds to Appendix Table 4\nThe following code calculates the RERI for the interaction between smoking initiation age (exposure.cat) and race, using the fit2 model. The calculations are performed for each exposure.cat level and for each non-reference racial/ethnic group. The results are presented in a table and saved to an Excel file (reriM3.xlsx).\n\nShow/Hide Code# Get the names of the coefficients from the race-interaction model\ncoef.val &lt;- names(fit2$coefficients)\n\n# Define the active (non-reference) levels for exposure and the moderator (race)\nexp.active.lev &lt;- paste0(\"exposure.cat\", levels(w.design0$variables$exposure.cat)[-1])\nrmx &lt;- NULL\n\n# Outer loop: iterate through each non-reference race category\nfor (j in 1:length(levels(w.design0$variables$race)[-1])){\n  mod.active.lev.j &lt;- paste0(\"race\", levels(w.design0$variables$race)[-1])[j]\n  int.term &lt;- paste(exp.active.lev, mod.active.lev.j, sep=\":\")\n  \n  # Inner loop: iterate through each non-reference exposure category\n  rr &lt;- NULL\n  for (i in 1:length(exp.active.lev)){\n    coef.val1 &lt;- coef.val[c(which(coef.val==exp.active.lev[i]),\n                          which(coef.val==mod.active.lev[1]),\n                          which(coef.val==int.term[i]))]\n    r1 &lt;- reri.f(model=fit2, coef=coef.val1, conf.level = 0.95)\n    rr &lt;- rbind(rr,r1)\n  }\n  row.names(rr) &lt;- paste(levels(w.design0$variables$exposure.cat)[-1], \n                         levels(w.design0$variables$race)[-1][j])\n  rmx &lt;- rbind(rmx,rr)\n}\n\n\n\nShow/Hide Codeexpss::xl_write_file(rmx, filename = \"data/reriM3.xlsx\", rownames = TRUE)\nkable(rmx,\n      booktabs = TRUE, digits = 2,\n      caption=\"Appendix Table 4: Reporting RERI for the Race/Ethnicity Interaction.\",\n      col.names = c(\"Levels\", \"RERI\", \"Lower CI\", \"Upper CI\")) %&gt;%\n  kable_styling(latex_options = \"hold_position\")\n\n\nAppendix Table 4: Reporting RERI for the Race/Ethnicity Interaction.\n\nLevels\nRERI\nLower CI\nUpper CI\n\n\n\nStarted before 10 Black\n-1.45\n-12.14\n9.24\n\n\nStarted at 10-14 Black\n-0.79\n-6.58\n5.00\n\n\nStarted at 15-17 Black\n-0.60\n-4.58\n3.38\n\n\nStarted at 18-20 Black\n-0.20\n-2.67\n2.27\n\n\nStarted after 20 Black\n-0.53\n-3.45\n2.40\n\n\nStarted before 10 Hispanic\n-2.13\n-16.78\n12.52\n\n\nStarted at 10-14 Hispanic\n-1.10\n-8.02\n5.82\n\n\nStarted at 15-17 Hispanic\n-0.71\n-4.94\n3.52\n\n\nStarted at 18-20 Hispanic\n-0.32\n-2.68\n2.05\n\n\nStarted after 20 Hispanic\n-0.45\n-3.27\n2.37\n\n\nStarted before 10 Others\n0.48\n-9.80\n10.76\n\n\nStarted at 10-14 Others\n-0.04\n-5.88\n5.81\n\n\nStarted at 15-17 Others\n0.18\n-5.17\n5.53\n\n\nStarted at 18-20 Others\n-0.37\n-2.74\n2.00\n\n\nStarted after 20 Others\n-0.64\n-3.78\n2.50\n\n\n\n\n\nThis concludes the main statistical analysis conducted for the published paper."
  },
  {
    "objectID": "09-effect-modification.html#chapter-summary-and-next-steps",
    "href": "09-effect-modification.html#chapter-summary-and-next-steps",
    "title": "\n11¬† Effect Modification Analysis\n",
    "section": "\n11.5 Chapter Summary and Next Steps",
    "text": "11.5 Chapter Summary and Next Steps\nIn this chapter, we delved deeper into the analysis by investigating effect modification. We fitted interaction models and performed statistical tests to assess whether the relationship between smoking initiation and mortality was modified by race/ethnicity and sex. Our findings, particularly the significant interaction by sex, align with the conclusions of the original paper.\nTo ensure the robustness of these findings, we will next perform ‚ÄúSensitivity Analyses‚Äù to test how our results hold up when adjusting for socioeconomic factors and when analyzing a different time period."
  },
  {
    "objectID": "10-sensitivity-analysis.html#sensitivity-analysis-1-adjustment-for-ses-proxies",
    "href": "10-sensitivity-analysis.html#sensitivity-analysis-1-adjustment-for-ses-proxies",
    "title": "\n12¬† Sensitivity Analyses\n",
    "section": "\n12.1 Sensitivity Analysis 1: Adjustment for SES Proxies",
    "text": "12.1 Sensitivity Analysis 1: Adjustment for SES Proxies\n\n12.1.1 Data Reprocessing with SES Variables\nOur primary analysis did not include socioeconomic status (SES) variables because they had a high number of missing values. To ensure these factors were not confounding our results, we performed this sensitivity analysis. This required reprocessing the raw NHANES data to create a new dataset that includes the following 2 variables as well:\nDemographics:\n\n‚ÄúINDFMPIR‚Äù: Ratio of family income to poverty (family SES)\n‚ÄúDMDHREDU‚Äù: Education level of the household head (family SES)\n\n\n\nR Code Chunk 1: Data Reprocessing and Cleaning with SES Variables\n\nThe code steps for data downloading, cleaning, and merging are nearly identical to the process in main analysis. The key new data preparation steps for this sensitivity analysis are the cleaning of the two SES proxy variables, pir and HHedu.\n\nShow/Hide Code# File Names\ndemo &lt;- c(\"DEMO\", \"DEMO_B\", \"DEMO_C\", \"DEMO_D\", \"DEMO_E\", \n          \"DEMO_F\", \"DEMO_G\", \"DEMO_H\", \"DEMO_I\", \"DEMO_J\")\nsmoking &lt;- c(\"SMQ\", \"SMQ_B\", \"SMQ_C\", \"SMQ_D\", \"SMQ_E\",\n             \"SMQ_F\", \"SMQ_G\", \"SMQ_H\", \"SMQ_I\", \"SMQ_J\")\n\n# 10 Data Files\ndemo_data_files &lt;- readRDS(\"data/demo_data_files.rds\")\nsmoking_data_files &lt;- readRDS(\"data/smoking_data_files.rds\")\n\n# Set Columns\ndemo_columns &lt;- c( \"SEQN\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH1\",\n                   \"INDFMPIR\", \"DMDHREDU\", \"DMDHREDZ\", # *** these are new\n                   \"DMDBORN\", \"DMDBORN2\", \"DMDBORN4\", \"SDDSRVYR\", \n                   \"WTINT2YR\", \"WTMEC2YR\", \"SDMVPSU\", \"SDMVSTRA\")\nsmoking_columns &lt;- c(\"SEQN\", \"SMQ020\", \"SMD030\", \"SMQ040\", \"SMD055\")\n\n\n# DEMOGRAPHICS\ndemo_data_files_2 &lt;- lapply(seq_along(demo_data_files), function(i) \n  {\n  current_cycle_data &lt;- demo_data_files[[i]]\n  original &lt;- demo[i] \n  \n  # Select Columns\n  subset_data &lt;- current_cycle_data %&gt;% \n    dplyr::select(dplyr::any_of(demo_columns))\n  # Translate \n  translated_data &lt;- nhanesTranslate(original,\n                                     names(subset_data), \n                                     data = subset_data)\n  # Return\n  return(translated_data) \n})\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN2 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN2 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDU DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 DMDHREDZ DMDBORN4 SDDSRVYR\n\n\n# SMOKING\nsmoking_data_files_2 &lt;- lapply(seq_along(smoking_data_files), function(i) \n  {\n  current_cycle_data &lt;- smoking_data_files[[i]]\n  original &lt;- smoking[i]\n\n  # Select Columns\n  subset_data &lt;- current_cycle_data %&gt;%\n    dplyr::select(dplyr::any_of(smoking_columns))\n  # Translate\n  translated_data &lt;- nhanesTranslate(original, \n                                     names(subset_data), \n                                     data = subset_data)\n  # Return\n  return(translated_data)\n})\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n\n\n# MERGE\ndata_all &lt;- lapply(seq_along(demo_data_files_2), function(i) {\n  demo_df &lt;- demo_data_files_2[[i]]\n  smoking_df &lt;- smoking_data_files_2[[i]]\n  \n  # Merge by SEQN\n  merged_df &lt;- join_all(list(demo_df, smoking_df), \n                        by = \"SEQN\", \n                        type = 'full')\n  return(merged_df)\n})\n\n\n# Rename \ndata_all2 &lt;- data_all\nfor (i in seq_along(data_all2)) {\n  df &lt;- as.data.frame(data_all2[[i]])\n\n  if (\"DMDBORN2\" %in% names(df)) {\n    names(df)[names(df) == \"DMDBORN2\"] &lt;- \"DMDBORN\"\n  } else if (\"DMDBORN4\" %in% names(df)) {\n    names(df)[names(df) == \"DMDBORN4\"] &lt;- \"DMDBORN\"\n  }\n  data_all2[[i]] &lt;- df\n}\n\n\n\nShow/Hide Code\nfor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  ## ID\n  dat2$id &lt;- dat2$SEQN\n  \n  ## Demographic\n    ### Age (for eligibility)\n  dat2$age &lt;- dat2$RIDAGEYR\n  \n    ### Sex\n  dat2$sex &lt;- dat2$RIAGENDR\n  \n    ### Race/Ethnicity\n  dat2$race &lt;- dat2$RIDRETH1\n  dat2$race &lt;- car::recode(dat2$race, recodes = \"\n    'Non-Hispanic White'='White';\n    'Non-Hispanic Black'='Black';\n    c('Mexican American','Other Hispanic')='Hispanic';\n    else='Others'\")\n  dat2$race &lt;- factor(dat2$race, \n                      levels = c(\"White\", \"Black\", \"Hispanic\", \"Others\"))\n  \n    ### Country of birth\n  dat2$born &lt;- dat2$DMDBORN\n  dat2$born &lt;- car::recode(dat2$born, recodes = \"\n    c('Born in Mexico','Born Elsewhere', 'Others') = 'Other place';\n    c('Born in 50 US States or Washington, DC', 'Born in 50 US states or Washington, DC') = 'Born in US';\n    else = NA\")\n  dat2$born &lt;- factor(dat2$born, \n                      levels = c(\"Born in US\", \"Other place\"))\n  \n  data_all2[[i]] &lt;- dat2\n}\n\n\nPoverty Income Ratio: The poverty income ratio (INDFMPIR) is provided as a continuous variable. To make it easier to use in our models, the following code uses the cut() function to categorize the numeric ratio into five distinct, interpretable groups, from ‚ÄúBelow Poverty Line‚Äù to ‚ÄúHigh Income.‚Äù\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Set Poverty Income Ratio\n  dat2$pir &lt;- dat2$INDFMPIR\n  \n  # Cut into five distinct groups\n  dat2$pir &lt;- cut(dat2$pir,\n                  breaks = c(-Inf, 1, 1.99, 3.99, 4.99, Inf),\n                  labels = c(\"Below Poverty Line\",\n                             \"Near Poverty Line\",\n                             \"Low to Middle Income\",\n                             \"Middle to High Income\",\n                             \"High Income\"),\n                  right = FALSE)\n  \n  # Return\n  data_all2[[i]] &lt;- dat2\n}\n\n\nHousehold Head Education Level: The coding for household head education also changes over the survey years, with the 2017-2018 cycle using a different variable name (DMDHREDZ) and different text labels. The code below uses an if-else statement to handle this inconsistency. It applies one set of recoding rules for the first nine cycles and a different set for the final 2017-2018 cycle, ensuring the final HHedu variable is harmonized across all datasets.\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  if (i &lt; 10) {\n  \n  # Set Education Level of the Household Head\n  # Now, use case_when() for robust recoding\n  dat2$HHedu &lt;- case_when(\n    dat2$DMDHREDU %in% c(\"Less Than 9th Grade\", \"9-11th Grade (Includes 12th grade with no diploma)\", \"Less than high school degree\") ~ \"Less than high school\",\n    dat2$DMDHREDU %in% c(\"High School Grad/GED or equivalent\", \"Some College or AA degree\", \"High school grad/GED or some col\") ~ \"High school or college\",\n    dat2$DMDHREDU == \"College Graduate or above\" ~ \"College graduate or above\",\n    TRUE ~ NA_character_ # This handles \"Refused\", \"Don't know\", and any other non-matches\n    )\n  \n  # Convert to a factor with the correct levels\n  dat2$HHedu &lt;- factor(dat2$HHedu, levels = c('Less than high school',\n                                              'High school or college', \n                                              'College graduate or above'))\n  # Return\n  data_all2[[i]] &lt;- dat2\n  }\n  \n  # For the 10th dataset (2017-2018)\n  else { \n    dat2$HHedu &lt;- as.character(dat2$DMDHREDZ)\n    dat2$HHedu &lt;- dplyr::recode(dat2$HHedu,\n                         `Less than high school degree` = 'Less than high school',\n                         `High school grad/GED or some college/AA degree` = 'High school or college',\n                         `College graduate or above` = 'College graduate or above',\n                         .default = NA_character_ \n                         #`Refused` = NA_character_,\n                         #`Don't know` = NA_character_\n                         )\n    dat2$HHedu &lt;- factor(dat2$HHedu, levels = c('Less than high school',\n                                                'High school or college',\n                                                'College graduate or above'))\n    \n    # Return\n    data_all2[[i]] &lt;- dat2\n    }\n}\n\n\n\nShow/Hide Code# Remaining Variables\n\nfor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  ## Smoking\n    ### Status\n  dat2$smoking &lt;- dat2$SMQ020\n  dat2$smoking &lt;- car::recode(dat2$smoking, \" 'Yes' = 'Current smoker'; 'No' = 'Never smoker'; else=NA  \")\n  dat2$smoking &lt;- factor(dat2$smoking, levels = c(\"Never smoker\", \"Previous smoker\", \"Current smoker\"))\n  dat2$smoking[dat2$SMQ040 == \"Not at all?\" | dat2$SMQ040 == \"Not at all\"] &lt;- \"Previous smoker\"\n  \n    ### Age smoking started\n  dat2$smoking.age &lt;- dat2$SMD030\n  dat2$smoking.age[dat2$smoking.age == 777] &lt;- NA\n  dat2$smoking.age[dat2$smoking.age == 999] &lt;- NA\n  dat2$smoking.age[dat2$smoking == \"Never smoker\"] &lt;- 99 # 99 means never smoker\n  \n    ### Whether smoking started age of 15 or before\n  dat2$smoked.while.child &lt;- car::recode(dat2$smoking.age, \" 0 = 'No'; 1:15 = 'Yes'; else = NA \", as.factor = T)\n  \n  ## Survey features\n    ### Weight\n  dat2$survey.weight &lt;- dat2$WTINT2YR #WTMEC2YR # MEC weights\n  \n    ### PSU \n  dat2$psu &lt;- as.factor(dat2$SDMVPSU)\n  \n    ### Strata\n  dat2$strata &lt;- as.factor(dat2$SDMVSTRA)\n  \n  ## Survey year\n  dat2$year &lt;- dat2$SDDSRVYR\n  \n  data_all2[[i]] &lt;- dat2\n}\n\n\nNOTE: The following code chunk recodes the variable, SMD055, which stands for the age cigarettes were last smoked regularly. This variable is not available for the cycle 2017-2018, thus it is set as NA. This part is essential for the plots in section 12.3 Appendix B: Exploratory Analysis of Smoking Duration below.\n\nShow/Hide Codefor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  if (i &lt; 10) {\n    ### Age smoking quit\n    dat2$smoking.quit.age &lt;- dat2$SMD055\n    dat2$smoking.quit.age[dat2$smoking.quit.age == 777] &lt;- NA\n    dat2$smoking.quit.age[dat2$smoking.quit.age == 999] &lt;- NA\n  }\n  else {\n    dat2$smoking.quit.age &lt;- NA\n  }\n  data_all2[[i]] &lt;- dat2\n}\n\n\n\n\nR Code Chunk 2: Save New Files\n\nAfter the same remaining data processing steps are taken, theses 10 new files are also saved with the selected variables saved in vars.\n\nShow/Hide Codenhanes_all &lt;- c(\"nhanes00\", \"nhanes01\", \"nhanes03\", \"nhanes05\", \n                \"nhanes07\", \"nhanes09\", \"nhanes11\", \n                \"nhanes13\", \"nhanes15\", \"nhanes17\")\n\nvars &lt;- c(\"id\", \"age\", \"sex\", \"race\", \"born\", \"pir\", \"HHedu\", \n          \"smoking.age\", \"smoking.quit.age\",\n          \"smoked.while.child\", \"smoking\",\n          \"survey.weight\", \"psu\", \"strata\", \"year\")\n\n\ncycle_years &lt;- c(\"1999-2000\", \"2001-2002\", \"2003-2004\", \"2005-2006\", \"2007-2008\", \n                 \"2009-2010\", \"2011-2012\", \"2013-2014\", \"2015-2016\", \"2017-2018\")\n\nfor (i in seq_along(data_all2)) {\n  dat2 &lt;- data_all2[[i]]\n  \n  nhanes_i &lt;- nhanes_all[i]\n  assign(nhanes_i, dat2[, vars], envir = .GlobalEnv)\n  \n  analytic &lt;- subset(get(nhanes_i), age &gt;= 20)\n  cat(\"Processing:\", nhanes_i, \"\\n\")\n  print(dim(analytic))\n  \n  analytic_i &lt;- paste0(\"analytic\", substr(nhanes_i, 7, 8))\n  assign(analytic_i, analytic, envir = .GlobalEnv)\n  \n  # Create 'data2' directory if it does not exist\n  if (!dir.exists(\"data2\")) {\n    dir.create(\"data2\")\n  }\n\n  # Save\n  save(list = c(nhanes_i, analytic_i),\n       file = file.path(\"data2\", paste0(analytic_i, \".RData\")))\n}\n\n# Bind all\ndat.full &lt;- rbind(nhanes00, nhanes01, nhanes03,\n                  nhanes05, nhanes07, nhanes09,\n                  nhanes11, nhanes13, nhanes15, \n                  nhanes17)\n\n# Corrected weights\ndat.full$survey.weight.new &lt;- dat.full$survey.weight/length(unique(dat.full$year))\ndat.full$survey.weight &lt;- NULL\nnames(dat.full)\ndim(dat.full)\n\n\n\nShow/Hide Code# Mortality Data\nmort2000 &lt;- readRDS(file = \"data/Mortalitydata/mort2000.RData\")\nmort2001 &lt;- readRDS(file = \"data/Mortalitydata/mort2001.RData\")\nmort2003 &lt;- readRDS(file = \"data/Mortalitydata/mort2003.RData\")\nmort2005 &lt;- readRDS(file = \"data/Mortalitydata/mort2005.RData\")\nmort2007 &lt;- readRDS(file = \"data/Mortalitydata/mort2007.RData\")\nmort2009 &lt;- readRDS(file = \"data/Mortalitydata/mort2009.RData\")\nmort2011 &lt;- readRDS(file = \"data/Mortalitydata/mort2011.RData\")\nmort2013 &lt;- readRDS(file = \"data/Mortalitydata/mort2013.RData\")\nmort2015 &lt;- readRDS(file = \"data/Mortalitydata/mort2015.RData\")\nmort2017 &lt;- readRDS(file = \"data/Mortalitydata/mort2017.RData\")\n\n# Merge\ndat.mortality &lt;- rbind(mort2000, mort2001, mort2003,\n                       mort2005, mort2007, mort2009, \n                       mort2011, mort2013, mort2015, \n                       mort2017)\ntable(dat.mortality$mort_eligstat, useNA = \"always\")\n\n# Merging analytic and mortality data\ndat.full.with.mortality &lt;- merge(dat.full, dat.mortality, by = \"id\", all.x = TRUE)\ndim(dat.full.with.mortality)\n\n\n\nShow/Hide Code# Recoding\ndat.full.with.mortality$exposure.cat &lt;- car::recode(dat.full.with.mortality$smoking.age, \" \n                                                    c(0,99) = 'Never smoked'; \n                                                    1:9 = 'Started before 10';\n                                                    10:14 = 'Started at 10-14';\n                                                    15:17 = 'Started at 15-17';\n                                                    18:20 = 'Started at 18-20';\n                                                    21:80 = 'Started after 20';\n                                                    else = NA \", \n                                                    as.factor = TRUE)\ndat.full.with.mortality$exposure.cat &lt;- factor(dat.full.with.mortality$exposure.cat, \n                                               levels = c(\"Never smoked\",\n                                                          'Started before 10',\n                                                          'Started at 10-14',\n                                                          \"Started at 15-17\",\n                                                          \"Started at 18-20\",\n                                                          \"Started after 20\"))\n\n# Survival time - Person-Months of Follow-up from NHANES Interview date\n# changed to \"Number of Person Months of Follow-up from NHANES Mobile Examination Center (MEC) date\" from \"Number of Person Months of Follow-up from NHANES interview date\" as we are using MCQ data (not really changed it again!)\ndat.full.with.mortality$stime.since.interview &lt;- dat.full.with.mortality$mort_permth_int # mort_permth_exm \nsummary(dat.full.with.mortality$stime.since.interview) \n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;     0.0    59.0   113.0   117.9   172.0   250.0   42252\n\n# Age in month\ndat.full.with.mortality$age.month &lt;- dat.full.with.mortality$age * 12\nsummary(dat.full.with.mortality$age.month)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;     0.0   120.0   288.0   373.5   624.0  1020.0\n\n# Survival time - Person-Months of Follow-up from birth = birth to screening + screening to event/censor\ndat.full.with.mortality$stime.since.birth &lt;- with(dat.full.with.mortality, age.month + stime.since.interview)\n# converted back to year so that KM plot is in years / HR results remain the same (added)\ndat.full.with.mortality$stime.since.birth &lt;- dat.full.with.mortality$stime.since.birth/12\ndat.full.with.mortality$stime.since.birth[is.na(dat.full.with.mortality$stime.since.interview)] &lt;- NA\nsummary(dat.full.with.mortality$stime.since.birth)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;   19.08   41.50   57.17   57.56   72.92  105.67   42252\n\n# All-cause mortality status\ndat.full.with.mortality$status_all &lt;- dat.full.with.mortality$mort_stat\ntable(dat.full.with.mortality$status_all, useNA = \"always\")\n#&gt; \n#&gt;     0     1  &lt;NA&gt; \n#&gt; 49815  9249 42252\n\n# Cause-specific mortality\ndat.full.with.mortality$mort_diabetes &lt;- NULL\ndat.full.with.mortality$mort_hyperten &lt;- NULL\ndat.full.with.mortality$mort_permth_int &lt;- NULL\ndat.full.with.mortality$mort_permth_exm &lt;- NULL\ndat.full.with.mortality$mort_ucod_leading &lt;- NULL\ndat.full.with.mortality$mort_eligstat &lt;- NULL\n\n# Recode year variable\ndat.full.with.mortality$year.cat &lt;- dat.full.with.mortality$year\n\nnew_levels &lt;- c(\n  \"1999-2000\", \"2001-2002\", \"2003-2004\", \"2005-2006\", \"2007-2008\",\n  \"2009-2010\", \"2011-2012\", \"2013-2014\", \"2015-2016\", \"2017-2018\"\n)\nlevels(dat.full.with.mortality$year.cat) &lt;- new_levels\n\n# Display the unique levels of year.cat\nlevels(dat.full.with.mortality$year.cat)\n#&gt;  [1] \"1999-2000\" \"2001-2002\" \"2003-2004\" \"2005-2006\" \"2007-2008\" \"2009-2010\"\n#&gt;  [7] \"2011-2012\" \"2013-2014\" \"2015-2016\" \"2017-2018\"\n\n\n\nShow/Hide Code# Create the analytic subset\ndat.full.with.mortality$smoked.while.child &lt;- NULL\n\n### Analytic dataset - age 20 - 79\ndat.analytic &lt;- subset(dat.full.with.mortality, age&gt;=20 & age &lt; 80)\ndim(dat.full.with.mortality)\n#&gt; [1] 101316     21\ndim(dat.analytic)\n#&gt; [1] 50824    21\ndim(dat.full.with.mortality)[1] - dim(dat.analytic)[1] # added\n#&gt; [1] 50492\n\n# Drop variables that are not being used \ndat.analytic$stime.since.interview &lt;- NULL\ndat.analytic$born &lt;- NULL\ndat.analytic$age &lt;- NULL\ndat.analytic$age.month &lt;- NULL\n\n### Create a copy of the data for the smoking duration analysis later in the chapter\ndat.analytic.duration.analysis &lt;- dat.analytic\n\n# Drop quit related variables\ndat.analytic$smoking.quit.age &lt;- NULL\n\n\n\n\nR Code Chunk 3: PIR and HHedu\n\nThe following code gives a summary table of the two variables: poverty income ratio (PIR) and education level of the household head.\n\nShow/Hide Codetable(dat.analytic$pir, useNA = \"always\")\n#&gt; \n#&gt;    Below Poverty Line     Near Poverty Line  Low to Middle Income \n#&gt;                  9720                 11890                 12281 \n#&gt; Middle to High Income           High Income                  &lt;NA&gt; \n#&gt;                  3808                  8378                  4747\ntable(dat.analytic$HHedu, useNA = \"always\")\n#&gt; \n#&gt;     Less than high school    High school or college College graduate or above \n#&gt;                     13009                     21704                     11048 \n#&gt;                      &lt;NA&gt; \n#&gt;                      5063\n\n\n\n\nR Code Chunk 4: Accounting for Missing Data\n\nBefore analysis, we must handle missing data. The following code perform a complete-case analysis by first removing participants with missing exposure (exposure.cat) or outcome (stime.since.birth) information. Then, any remaining missing values in the covariates are handled, and the number of participants dropped at each stage is calculated.\n\nShow/Hide Code# Sequentially remove participants with missing exposure or outcome\ndat.analytic1 &lt;- dat.analytic[complete.cases(dat.analytic$stime.since.birth),]\ndat.analytic2 &lt;- dat.analytic1[complete.cases(dat.analytic1$exposure.cat),]\n\n# Create the final complete-case dataset by removing any other missing values\ndat.complete &lt;- na.omit(dat.analytic2)\ndim(dat.complete)\n#&gt; [1] 41671    16\n\n# Report on participants dropped\ncat(\"Participants dropped due to missing exposure or outcome:\", \n    nrow(dat.analytic) - nrow(dat.analytic2), \"\\n\")\n#&gt; Participants dropped due to missing exposure or outcome: 275\ncat(\"Participants dropped due to missing covariates:\", \n    nrow(dat.analytic2) - nrow(dat.complete), \"\\n\")\n#&gt; Participants dropped due to missing covariates: 8878\ncat(\"Total participants dropped:\",\n    nrow(dat.full.with.mortality) - nrow(dat.complete), \"\\n\")\n#&gt; Total participants dropped: 59645\n\n# Overwrite dat.analytic2 to be the final complete dataset for analysis\ndat.analytic2 &lt;- dat.complete\ndim(dat.analytic2)\n#&gt; [1] 41671    16\n\n# Save\nsave(dat.full.with.mortality, dat.analytic2, file = \"data/SensAnalysis.RData\")\n\n\n\n\nR Code Chunk 5: Descriptive Statistics\n\nThe following code creates a descriptive summary table of the final analytic sample using the CreateTableOne function. The table shows the distribution of the exposure, race, and sex, stratified by mortality status.\n\nShow/Hide Codetab1 &lt;- CreateTableOne(vars = c(\"exposure.cat\", \"race\", \"sex\"), \n                       strata = \"status_all\", \n                       data = dat.analytic2, \n                       addOverall = TRUE, \n                       test = TRUE)\n\ntab1$CatTable\n#&gt;                       Stratified by status_all\n#&gt;                        Overall       0             1            p      test\n#&gt;   n                    41671         36426         5245                    \n#&gt;   exposure.cat (%)                                              &lt;0.001     \n#&gt;      Never smoked      23570 (56.6)  21576 (59.2)  1994 (38.0)             \n#&gt;      Started before 10   280 ( 0.7)    201 ( 0.6)    79 ( 1.5)             \n#&gt;      Started at 10-14   3203 ( 7.7)   2560 ( 7.0)   643 (12.3)             \n#&gt;      Started at 15-17   5949 (14.3)   4924 (13.5)  1025 (19.5)             \n#&gt;      Started at 18-20   5194 (12.5)   4338 (11.9)   856 (16.3)             \n#&gt;      Started after 20   3475 ( 8.3)   2827 ( 7.8)   648 (12.4)             \n#&gt;   race (%)                                                      &lt;0.001     \n#&gt;      White             18234 (43.8)  15462 (42.4)  2772 (52.9)             \n#&gt;      Black              8826 (21.2)   7571 (20.8)  1255 (23.9)             \n#&gt;      Hispanic          10760 (25.8)   9735 (26.7)  1025 (19.5)             \n#&gt;      Others             3851 ( 9.2)   3658 (10.0)   193 ( 3.7)             \n#&gt;   sex = Female (%)     21429 (51.4)  19235 (52.8)  2194 (41.8)  &lt;0.001\n\n\n\n12.1.2 Analysis with SES Adjustment\n\nR Code Chunk 6: Specify the Survey Design\n\nOnce again, to ensure our results are representative, we must account for the complex sampling design of NHANES. The following code creates a survey design object using the svydesign() function, incorporating the survey weights, strata, and PSU variables\n\nShow/Hide Code# Create a flag to identify participants in our final analytic sample\ndat.full.with.mortality$miss &lt;- 1\ndat.full.with.mortality$miss[dat.full.with.mortality$id %in% dat.analytic2$id] &lt;- 0\ntable(dat.full.with.mortality$miss)\n#&gt; \n#&gt;     0     1 \n#&gt; 41671 59645\n\n# Create the survey design object\nw.design &lt;- svydesign(ids = ~psu, strata = ~strata, \n                      weights = ~survey.weight.new, \n                      data = dat.full.with.mortality, nest = T)\n\n# Subset the design object to our analytic sample\nw.design0 &lt;- subset(w.design, miss == 0 & survey.weight.new &gt; 0)\ndim(w.design0)\n#&gt; [1] 41671    22\n\n\n\n\nR Code Chunk 7: Regression and Survival Analysis\n\nThe following section contains the code for core statistical models for the sensitivity analysis, including Kaplan-Meier curves and various Cox proportional hazards models.\nKaplan-Meier Survival Curve\nThe following code generates a survey-weighted Kaplan-Meier survival curve to visualize the probability of survival over time, stratified by the age of smoking initiation.\n\nShow/Hide Codedummy &lt;- length(unique(as.factor(w.design0$variables$exposure.cat)))\nformulax0 &lt;- as.formula(Surv(stime.since.birth, status_all) ~ exposure.cat)\nsA&lt;-svykm(formulax0, design=w.design0)\n\n# Plot\npar(oma=rep(0,4))\npar(mar=c(5,4,0,0) + 0.1)\nplot(sA, pars=list(col=c(1:dummy)),\n     xlab = \"Time\",\n     ylab = \"Proportion surviving\")\nlegend(\"bottomleft\", levels(as.factor(w.design0$variables$exposure.cat)),\n       col = (1:dummy), lty = c(1,1))\n\n\n\nSensitivity Analysis 1: Survey-Weighted Kaplan-Meier Curves\n\n\n\n\nLog-Rank Test\nThe following code performs a weighted log-rank test to see if the differences between the curves are statistically significant.\n\nShow/Hide Code# Weighted logrank test\nlrt &lt;- svylogrank(formulax0,design=subset(w.design0, survey.weight.new&gt;0))\nround(lrt[[2]],2)\n#&gt;  Chisq      p \n#&gt; 271.25   0.00\n\n\n\nCox Proportional Hazards Models\nThe following code fits several survey-weighted Cox models to estimate the Hazard Ratios (HRs) for all-cause mortality associated with smoking initiation age. We fit:\n\n\nAn unadjusted (crude) model.\n\n\nAn adjusted model, controlling for sex, race, survey year, and the SES proxy variables (pir and HHedu).\n\n\nTwo effect modification models to see if the association is different across racial/ethnic groups and by sex.\n\n\n\nShow/Hide Code# Test One\nfit0_ &lt;- coxph(Surv(stime.since.birth, status_all) ~ exposure.cat, data = dat.complete)\nfit0_\n\n\n# Unadjusted model\nfit0 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat, \n                 design = w.design0)\nfit0\n\n# Adjusted model overall with SES proxies as covariates\nfit1 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat + sex + race + year.cat + pir + HHedu,\n                 design = w.design0)\nfit1\n\n# Effect modification by race model + proxies\nfit2 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*race\n                 + sex  + year.cat + pir +HHedu,\n                 design = w.design0)\nfit2\n\n# Effect modification by sex model + proxies\nfit3 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*sex \n                 + race + year.cat + pir + HHedu,\n                 design = w.design0)\nfit3\n\n\n\n\nR Code Chunk 8: Prepare Data for Forest Plot\n\nThe following code extracts the Hazard Ratios and 95% Confidence Intervals from each of the four models above: fit0, fit1, fit2, and fit3. It then combines them into a single data frame (fr) that will be used to create a summary forest plot.\n\nShow/Hide Code# Extract results from crude model (fit0)\nf0 &lt;- publish(fit0)\nf0r &lt;- f0$regressionTable[2:6,c(\"HazardRatio\",\"CI.95\")]\nf0r$group &lt;- \"Crude\"\n\n# Extract results from adjusted model (fit1)\nf1 &lt;- publish(fit1)\nf1r &lt;- f1$regressionTable[2:6,c(\"HazardRatio\",\"CI.95\")]\nf1r$group &lt;- \"Adjusted\"\n\n# Extract results from race interaction model (fit2)\nf2 &lt;- publish(fit2)\nf2rW &lt;- f2$regressionTable[(31:35)+8,c(\"HazardRatio\",\"CI.95\")]\nf2rB &lt;- f2$regressionTable[(36:40)+8,c(\"HazardRatio\",\"CI.95\")]\nf2rH &lt;- f2$regressionTable[(41:45)+8,c(\"HazardRatio\",\"CI.95\")]\nf2rW$group &lt;- \"White\"\nf2rB$group &lt;- \"Black\"\nf2rH$group &lt;- \"Hispanic\"\nf2r &lt;- rbind(f2rW, f2rB, f2rH)\n\n# Extract results from sex interaction model (fit3)\nf3 &lt;- publish(fit3)\nf3rM &lt;- f3$regressionTable[29:33,c(\"HazardRatio\",\"CI.95\")]\nf3rF &lt;- f3$regressionTable[34:38,c(\"HazardRatio\",\"CI.95\")]\nf3rM$group &lt;- \"Male\"\nf3rF$group &lt;- \"Female\"\nf3r &lt;- rbind(f3rM, f3rF)\n\n# Combine all results into one data frame\nfr &lt;- rbind(f0r,f1r,f2r,f3r)\nfr &lt;- as.data.frame(fr)\nfr$age.grp &lt;- c('Started before 10', 'Started at 10-14', \"Started at 15-17\",\n                \"Started at 18-20\", \"Started after 20\")\n\n# Clean up numeric columns\nci &lt;- stringr::str_extract_all(fr$CI.95, '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nfr$mean &lt;- as.numeric(fr$HazardRatio)\nfr$lower &lt;- as.numeric(as.character(ci[,1]))\nfr$upper &lt;- as.numeric(as.character(ci[,2]))\n#fr$CI.95 &lt;- NULL\nfr$HazardRatio &lt;- NULL\n\n# Save the plot data\nfrS &lt;- fr\nsave(frS, file = \"data/SensForest.RData\")\n\n\n\n12.1.3 Visualizing the SES-Adjusted Results\n\nR Code Chunk 9: Plot\n\nThe following code creates the forest plot using ggplot2. The first plot summarizes all the results from this sensitivity analysis. This plot corresponds to Appendix Figure 5 in section C.2 Sensitivity analysis with proxy covariates, part of the supplementary materials published with the paper.\n\nShow/Hide Codefr$age.grp &lt;- factor(fr$age.grp,\n                     levels = c('Started before 10', 'Started at 10-14',\n                                \"Started at 15-17\", \"Started at 18-20\",\n                                \"Started after 20\"))\nfr$group &lt;- factor(fr$group,\n                   levels = rev(c(\"Crude\", \"Adjusted\", \n                                  \"White\", \"Black\", \"Hispanic\", \n                                  \"Male\", \"Female\")))\nlevels(fr$group)[levels(fr$group) == \"White\"] &lt;- \"Non-Hispanic White\"\nlevels(fr$group)[levels(fr$group) == \"Black\"] &lt;- \"Non-Hispanic Black\"\nfr$text_label &lt;- sprintf(\"%.2f [%.2f;%.2f]\", fr$mean, fr$lower, fr$upper)\n\n# Plotting\nggplot(fr, aes(x = mean, y = group, colour = age.grp)) + \n  geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(0.9), width = 0.25) +\n  geom_point(position = position_dodge(0.9), shape = 1) +\n  geom_text(aes(label = text_label, x = upper, hjust = -0.05), position = position_dodge(0.9)) +\n  scale_x_continuous(limits = c(0, 7.7)) +\n  labs(x = \"Hazard Ratio\", y = \"\", legend=TRUE, col = \"Age group\") +\n  theme_classic() +\n  theme(panel.grid.major.x = element_blank(),\n        panel.border = element_blank(),\n        legend.title = element_text(size=12), \n        legend.text = element_text(size=12),\n        plot.title = element_text(hjust = 0.5),\n        axis.text.x = element_text(size = 10, face = \"bold\"),\n        axis.text.y = element_text(size = 10, face = \"bold\"),\n        legend.position = c(.8, .8))+\n  geom_vline(xintercept = 1, linetype = \"dashed\", color = \"grey\")+\n  guides(color = guide_legend(override.aes = list(shape = 1, linetype = 1, size = 1)))\n#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n#&gt; 3.5.0.\n#&gt; ‚Ñπ Please use the `legend.position.inside` argument of `theme()` instead.\n\n\n\nAppendix Figure 5: Forest plot of Hazard Ratios from the SES-adjusted sensitivity analysis.\n\n\nShow/Hide Code# Save Plot\nggsave(\"images/forestSens.png\", width = 10, height = 8)\n\n\n\nThis second plot creates a direct visual comparison between the main analysis results and this sensitivity analysis.\n\nShow/Hide Code# Load the data for both plots\nload(file=\"data/SensForest.RData\")\nload(file=\"data/MainForest.RData\")\n\n# Combine data from fr (main) and frS (sensitivity), with an indicator variable\ncombined_data &lt;- bind_rows(\n  mutate(fr, dataset = 'Main Analysis'),\n  mutate(frS, dataset = 'Sensitivity Analysis')\n)\ncombined_data$group &lt;- factor(combined_data$group, levels = unique(combined_data$group))\n\n# Create the plot\nggplot(combined_data, aes(x = mean, y = group, colour = age.grp, shape = dataset)) +\n  geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.7)) +\n  geom_point(position = position_dodge(width = 0.7), size = 2) +\n  scale_x_continuous(limits = c(0, 7)) +\n  labs(x = \"Hazard Ratio\", y = \"\", colour = \"Age group\", shape = \"Analysis Type\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(size = 10, face = \"bold\"),\n        axis.text.y = element_text(size = 10),\n        legend.position = \"right\") +\n  geom_vline(xintercept = 1, linetype = \"dashed\", color = \"grey\")\n\n\n\nComparison of results: Main vs.¬†SES-adjusted Sensitivity Analysis.\n\n\nShow/Hide Code# Save Plot\nggsave(\"images/combined_forest_plot.png\", width = 10, height = 6)"
  },
  {
    "objectID": "10-sensitivity-analysis.html#sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018",
    "href": "10-sensitivity-analysis.html#sensitivity-analysis-2-effect-modification-by-raceethnicity-2011-2018",
    "title": "\n12¬† Sensitivity Analyses\n",
    "section": "\n12.2 Sensitivity Analysis 2: Effect Modification by Race/Ethnicity (2011-2018)",
    "text": "12.2 Sensitivity Analysis 2: Effect Modification by Race/Ethnicity (2011-2018)\n\n12.2.1 Data Reprocessing for the 2011-2018 Sub-period\nThe paper also notes that starting from the 2011‚àí2012 cycle, NHANES introduced a new category labeled non-Hispanic Asian. To investigate the implications of this change, an additional analysis of effect modification by race/ethnicity was conducted specifically for the survey cycles spanning 2011-2018. The following sections re-run similar data merging and cleaning steps, and the different models as in the main analysis code sections, thus only the important changes are noted.\n\n\nR Code Chunk 1: Redo Data Preparation\n\nThe following code shows the respective data needed from the nhanesA library for the 4 cycles and the steps to prepare the specific dataset required for the 2011-2018 sub-period sensitivity analysis. This again, involves downloading raw data, merging them, and constructing necessary variables, mirroring the steps in the main data preparation but for this specific sub-period. The analysis focuses on the 4 cycles spanning 2011-2018.\nThe same steps are taken, thus only important changes are noted below.\n\nLoad Analytic Data for 2011-2018 Cycles and Merge\nLoad and Merge Mortality Data for Sub-period Analysis\nVariable Construction for Sub-period Data\nConstruct Final Analytic Dataset for Sub-period Analysis\nCreate Survey Design Object for Sub-period Analysis\n\n\nShow/Hide Code# 2011-2012, 2013-2014, 2015-2016, 2017-2018\ndemo &lt;- c(\"DEMO_G\", \"DEMO_H\", \"DEMO_I\", \"DEMO_J\")\nsmoking &lt;- c(\"SMQ_G\", \"SMQ_H\", \"SMQ_I\", \"SMQ_J\")\n\n# DEMOGRAPHICS\ndemo_list_2 &lt;- lapply(demo, nhanes)\ndemo_data_files &lt;- demo_list_2\n\n# SMOKING\nsmoking_list_2 &lt;- lapply(smoking, nhanes)\nsmoking_data_files &lt;- smoking_list_2\n\n\nThe following variables are selected from the data for 4 cycles spanning 2011-2018. The variable RIDRETH3 includes the Race/Hispanic origin w/ NH Asian group. The remaining variables selected are the same as in the main analysis.\n\nShow/Hide Codedemo_columns_2 &lt;- c(\"SEQN\", \"RIDAGEYR\", \"RIAGENDR\",\n                    \"RIDRETH1\", \"RIDRETH3\", \"DMDBORN4\", \n                    \"SDDSRVYR\", \"WTINT2YR\", \"WTMEC2YR\", \n                    \"SDMVPSU\", \"SDMVSTRA\") \n\nsmoking_columns_2 &lt;- c(\"SEQN\", \"SMQ020\", \"SMD030\", \"SMQ040\") \n\n\n\nShow/Hide Code# DEMOGRAPHICS\ndemo_data_files_2 &lt;- lapply(seq_along(demo_data_files), function(i) \n  {\n  current_cycle_data &lt;- demo_data_files[[i]]\n  original &lt;- demo[i] \n  \n  # Select Columns\n  subset_data &lt;- current_cycle_data %&gt;% \n    dplyr::select(dplyr::any_of(demo_columns_2))\n  # Translate \n  translated_data &lt;- nhanesTranslate(original,\n                                     names(subset_data), \n                                     data = subset_data)\n  # Return\n  return(translated_data) \n})\n#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR\n#&gt; Translated columns: RIAGENDR RIDRETH1 RIDRETH3 DMDBORN4 SDDSRVYR\n\n\n# SMOKING\nsmoking_data_files_2 &lt;- lapply(seq_along(smoking_data_files), function(i) \n  {\n  current_cycle_data &lt;- smoking_data_files[[i]]\n  original &lt;- smoking[i]\n\n  # Select Columns\n  subset_data &lt;- current_cycle_data %&gt;%\n    dplyr::select(dplyr::any_of(smoking_columns_2))\n  # Translate\n  translated_data &lt;- nhanesTranslate(original, \n                                     names(subset_data), \n                                     data = subset_data)\n  # Return\n  return(translated_data)\n})\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n#&gt; Translated columns: SMQ020 SMQ040\n\n\n# Merge\ndata_all &lt;- lapply(seq_along(demo_data_files_2), function(i) {\n  demo_df &lt;- demo_data_files_2[[i]]\n  smoking_df &lt;- smoking_data_files_2[[i]]\n  \n  # Merge by SEQN\n  merged_df &lt;- join_all(list(demo_df, smoking_df), \n                        by = \"SEQN\", \n                        type = 'full')\n  return(merged_df)\n})\n\n\n\n\nR Code Chunk 2: Recode\n\nThe following sections of code apply the same recoding except we have another race/ethnicity this time.\nID:\n\nShow/Hide Codedata_all2 &lt;- data_all\n\n# ID\nfor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # ID\n  dat2$id &lt;- dat2$SEQN\n  data_all2[[i]] &lt;- dat2\n}\n\n\nDemographic Variables:\n\nBelow, the demographic variables like age, sex, and importantly, both race (from RIDRETH1) and race2 (from RIDRETH3 to include Asian) are recoded for the sub-period data.\n\n\nShow/Hide Code# Demo\nfor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Age\n  dat2$age &lt;- dat2$RIDAGEYR\n  \n  # Sex\n  dat2$sex &lt;- dat2$RIAGENDR\n  \n  # Race/Ethnicity (RIDRETH1 and RIDRETH3)\n  dat2$race &lt;- dat2$RIDRETH1\n  dat2$race &lt;- car::recode(dat2$race, recodes = \"\n    'Non-Hispanic White'='White';\n    'Non-Hispanic Black'='Black';\n    c('Mexican American','Other Hispanic')='Hispanic';\n    else='Others'\")\n  dat2$race &lt;- factor(dat2$race, \n                      levels = c(\"White\", \"Black\", \"Hispanic\", \"Others\"))\n  \n  \n  dat2$race2 &lt;- dat2$RIDRETH3\n  dat2$race2 &lt;- car::recode(dat2$race2, recodes = \" \n            'Non-Hispanic White'='White';\n            'Non-Hispanic Black'='Black'; \n            'Non-Hispanic Asian'='Asian';\n            c('Mexican American','Other Hispanic')= 'Hispanic'; \n            else='Others' \")  \n  dat2$race2 &lt;- factor(dat2$race2, levels = c(\"White\", \"Black\",\n                                              \"Hispanic\", \"Asian\",\n                                              \"Others\"))\n  \n  \n  \n  # Country of birth / citizenship\n  dat2$born &lt;- dat2$DMDBORN4\n  dat2$born &lt;- car::recode(dat2$born, recodes = \" \n  'Others'='Other place';\n  'Born in 50 US states or Washington, DC'= 'Born in US'; \n  else=NA\")\n  dat2$born &lt;- factor(dat2$born, \n                      levels = c(\"Born in US\", \"Other place\"))\n  \n  data_all2[[i]] &lt;- dat2\n  }\n\n\nSmoking:\n\nBelow, the smoking-related variables, including smoking status, age started smoking and whether smoking started at age 15 or younger for the sub-period data are recoded.\n\n\nShow/Hide Code# Smoking\nfor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Smoking Status\n  dat2$smoking &lt;- dat2$SMQ020\n  dat2$smoking &lt;- car::recode(dat2$smoking, \"\n    'Yes' = 'Current smoker';\n    'No' = 'Never smoker';\n    else = NA\")\n  dat2$smoking &lt;- factor(dat2$smoking, \n                         levels = c(\"Never smoker\", \n                                    \"Previous smoker\", \n                                    \"Current smoker\"))\n  \n  # Ask about variable SMQ040 ***\n  dat2$smoking[dat2$SMQ040 == \"Not at all?\" | \n                 dat2$SMQ040 == \"Not at all\"] &lt;- \"Previous smoker\"\n  \n  # Age Started Smoking\n  dat2$smoking.age &lt;- dat2$SMD030\n  dat2$smoking.age[dat2$smoking.age %in% c(777, 999)] &lt;- NA\n  dat2$smoking.age[is.na(dat2$smoking.age) & \n                     dat2$smoking == \"Never smoker\"] &lt;- 0\n  \n  # Whether Smoking started age ‚â§ 15\n  dat2$smoked.while.child &lt;- car::recode(dat2$smoking.age, \n  \" 0 = 'No'; 6:15 = 'Yes'; else = NA \", as.factor = TRUE)\n  \n  data_all2[[i]] &lt;- dat2\n}\n\n\nSurvey Design:\n\nShow/Hide Code# Survey Design\nfor (i in seq_along(data_all2)) {\n  # Set Data\n  dat2 &lt;- data_all2[[i]]\n  \n  # Weight\n  dat2$survey.weight &lt;- dat2$WTINT2YR\n  \n  # PSU\n  dat2$psu &lt;- as.factor(dat2$SDMVPSU)\n  \n  # Strata\n  dat2$strata &lt;- as.factor(dat2$SDMVSTRA)\n  \n  # Survey year\n  dat2$year &lt;- dat2$SDDSRVYR\n  \n  data_all2[[i]] &lt;- dat2\n}\n\n\n\n\nR Code Chunk 3: Save Analytic Data for Sub-period Analysis (Per Cycle)\n\nThe following code processes the cleaned sub-period dataframes, applies the age filter (&gt;20 years), selects the final set of variables, and saves them as .RData files for each cycle.\n\nShow/Hide Code\nnhanes2_all &lt;- c(\"nhanes2_11\", \"nhanes2_13\", \"nhanes2_15\", \"nhanes2_17\")\nvars_2 &lt;- c(\"id\", \"age\", \"sex\", \"race\", \"race2\", \"born\", \n          \"smoking.age\", \"smoked.while.child\", \"smoking\", \n          \"survey.weight\", \"psu\", \"strata\", \"year\")\n\nfor (i in seq_along(data_all2)) {\n  dat2 &lt;- data_all2[[i]]\n\n  nhanes2_i &lt;- nhanes2_all[i]\n  assign(nhanes2_i, dat2[, vars_2], envir = .GlobalEnv)\n  \n  analytic &lt;- subset(get(nhanes2_i), age &gt;= 20)\n  cat(\"Processing:\", nhanes2_i, \"\\n\")\n  print(dim(analytic))\n  \n  analytic_i &lt;- paste0(\"analytic2_\", substr(nhanes2_i, 9, 10))\n  analytic_i\n  assign(analytic_i, analytic, envir = .GlobalEnv)\n  \n  # Create 'data' directory if it does not exist\n  if (!dir.exists(\"data\")) {\n    dir.create(\"data\")\n  }\n  # Save\n  save(list = c(nhanes2_i, analytic_i),\n       file = file.path(\"data\", paste0(analytic_i, \".RData\")))\n  #print(analytic_i)\n}\n#&gt; Processing: nhanes2_11 \n#&gt; [1] 5560   13\n#&gt; Processing: nhanes2_13 \n#&gt; [1] 5769   13\n#&gt; Processing: nhanes2_15 \n#&gt; [1] 5719   13\n#&gt; Processing: nhanes2_17 \n#&gt; [1] 5569   13\n\n\n\n\nR Code Chunk 4: Combine analytic files\n\nThe following code ensure the individual analytic .RData files for the sub-period are loaded and combines them into a single dat.full.2 dataframe, recalculating weights for the combined period.\n\nShow/Hide Code# Load the 4 new datasets\nload(file=\"data/analytic2_11.RData\")\nload(file=\"data/analytic2_13.RData\")\nload(file=\"data/analytic2_15.RData\")\nload(file=\"data/analytic2_17.RData\")\n\n# Bind\ndat.full.2 &lt;- rbind(nhanes2_11, nhanes2_13, nhanes2_15, nhanes2_17)\n\n# Confirm\nunique(dat.full.2$year)\n#&gt; [1] NHANES 2011-2012 public release NHANES 2013-2014 public release\n#&gt; [3] NHANES 2015-2016 public release NHANES 2017-2018 public release\n#&gt; 4 Levels: NHANES 2011-2012 public release ... NHANES 2017-2018 public release\nlength(unique(dat.full.2$year))\n#&gt; [1] 4\n\n# Corrected weights\ndat.full.2$survey.weight.new &lt;- dat.full.2$survey.weight/length(unique(dat.full.2$year))\ndat.full.2$survey.weight &lt;- NULL\nnames(dat.full.2)\n#&gt;  [1] \"id\"                 \"age\"                \"sex\"               \n#&gt;  [4] \"race\"               \"race2\"              \"born\"              \n#&gt;  [7] \"smoking.age\"        \"smoked.while.child\" \"smoking\"           \n#&gt; [10] \"psu\"                \"strata\"             \"year\"              \n#&gt; [13] \"survey.weight.new\"\ndim(dat.full.2)\n#&gt; [1] 39156    13\n\n\n\n\nR Code Chunk 5: Load and Merge Mortality Data for Sub-period Analysis\n\nThe following code loads the individual mortality datasets for the 4 cycles and combines them. Subsequently, it merges this comprehensive mortality data with the full sub-period analytic dataset (dat.full.2) using the id variable.\n\nShow/Hide Codemort2000 &lt;- readRDS(file = \"data/Mortalitydata/mort2000.RData\")\nmort2001 &lt;- readRDS(file = \"data/Mortalitydata/mort2001.RData\")\nmort2003 &lt;- readRDS(file = \"data/Mortalitydata/mort2003.RData\")\nmort2005 &lt;- readRDS(file = \"data/Mortalitydata/mort2005.RData\")\nmort2007 &lt;- readRDS(file = \"data/Mortalitydata/mort2007.RData\")\nmort2009 &lt;- readRDS(file = \"data/Mortalitydata/mort2009.RData\")\nmort2011 &lt;- readRDS(file = \"data/Mortalitydata/mort2011.RData\")\nmort2013 &lt;- readRDS(file = \"data/Mortalitydata/mort2013.RData\")\nmort2015 &lt;- readRDS(file = \"data/Mortalitydata/mort2015.RData\")\nmort2017 &lt;- readRDS(file = \"data/Mortalitydata/mort2017.RData\")\n\ndat.mortality.2 &lt;- rbind(mort2000, mort2001, mort2003,\n                       mort2005, mort2007, mort2009, \n                       mort2011, mort2013, mort2015, \n                       mort2017)\n\ndat.full.with.mortality.2 &lt;- merge(dat.full.2, dat.mortality.2, \n                                   by = \"id\", all.x = TRUE)\ndim(dat.full.with.mortality.2)\n#&gt; [1] 39156    20\n\n\nThe following code applies recoding which is also similar to main analysis.\n\nShow/Hide Codedat.full.with.mortality.2$exposure.cat &lt;- car::recode(dat.full.with.mortality.2$smoking.age, \" \n                                                    0 = 'Never smoked'; \n                                                    1:9 = 'Started before 10';\n                                                    10:14 = 'Started at 10-14';\n                                                    15:17 = 'Started at 15-17';\n                                                    18:20 = 'Started at 18-20';\n                                                    21:80 = 'Started after 20';\n                                                    else = NA \", \n                                                    as.factor = TRUE)\ndat.full.with.mortality.2$exposure.cat &lt;- factor(dat.full.with.mortality.2$exposure.cat, \n                                               levels = c(\"Never smoked\",\n                                                          'Started before 10',\n                                                          'Started at 10-14',\n                                                          \"Started at 15-17\",\n                                                          \"Started at 18-20\",\n                                                          \"Started after 20\"))\n\n\n# Survival time - Person-Months of Follow-up from NHANES Interview date\n# changed to \"Number of Person Months of Follow-up from NHANES Mobile Examination Center (MEC) date\" from \"Number of Person Months of Follow-up from NHANES interview date\" as we are using MCQ data\ndat.full.with.mortality.2$stime.since.interview &lt;- dat.full.with.mortality.2$mort_permth_int # mort_permth_exm \nsummary(dat.full.with.mortality.2$stime.since.interview) \n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;    1.00   34.00   58.00   58.67   82.00  113.00   15424\n\n# Age in month\ndat.full.with.mortality.2$age.month &lt;- dat.full.with.mortality.2$age * 12\nsummary(dat.full.with.mortality.2$age.month)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;     0.0   120.0   336.0   386.9   648.0   960.0\n\n# Survival time - Person-Months of Follow-up from birth = birth to screening + screening to event/censor\ndat.full.with.mortality.2$stime.since.birth &lt;- with(dat.full.with.mortality.2, age.month + stime.since.interview)\n# converted back to year so that KM plot is in years / HR results remain the same (added)\ndat.full.with.mortality.2$stime.since.birth &lt;- dat.full.with.mortality.2$stime.since.birth/12\ndat.full.with.mortality.2$stime.since.birth[is.na(dat.full.with.mortality.2$stime.since.interview)] &lt;- NA\nsummary(dat.full.with.mortality.2$stime.since.birth)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;   19.08   37.17   53.17   53.08   68.17   89.00   15424\n\n# All-cause mortality status\ndat.full.with.mortality.2$status_all &lt;- dat.full.with.mortality.2$mort_stat\ntable(dat.full.with.mortality.2$status_all, useNA = \"always\")\n#&gt; \n#&gt;     0     1  &lt;NA&gt; \n#&gt; 22216  1516 15424\n\n# Cause-specific mortality\ndat.full.with.mortality.2$mort_diabetes &lt;- NULL\ndat.full.with.mortality.2$mort_hyperten &lt;- NULL\ndat.full.with.mortality.2$mort_permth_int &lt;- NULL\ndat.full.with.mortality.2$mort_permth_exm &lt;- NULL\ndat.full.with.mortality.2$mort_ucod_leading &lt;- NULL\ndat.full.with.mortality.2$mort_eligstat &lt;- NULL\n\n\n\n\nR Code Chunk 6: Variable Construction and Final Analytic Dataset for Sub-period Analysis\n\nThe same variables are constructed as the main analysis, but note, only for the 4 cycles. Below, the year variable is recoded into categorical levels. Then, the final data set is saved.\n\nShow/Hide Code# Recode year variable\ndat.full.with.mortality.2$year.cat &lt;- dat.full.with.mortality.2$year\n\nnew_levels &lt;- c(\"2011-2012\", \"2013-2014\", \"2015-2016\", \"2017-2018\")\nlevels(dat.full.with.mortality.2$year.cat) &lt;- new_levels\n\n# Display the unique levels of year.cat\nlevels(dat.full.with.mortality.2$year.cat)\n#&gt; [1] \"2011-2012\" \"2013-2014\" \"2015-2016\" \"2017-2018\"\n\n\n\nShow/Hide Code# Remove variable, not used\ndat.full.with.mortality.2$smoked.while.child &lt;- NULL\n\n### Analytic dataset - age 20 - 79\ndat.analytic.2 &lt;- subset(dat.full.with.mortality.2, age&gt;=20 & age &lt; 80)\ndim(dat.full.with.mortality.2)[1] - dim(dat.analytic.2)[1] # added\n#&gt; [1] 18057\n\n# Drop variables that are not being used \ndat.analytic.2$born &lt;- NULL\ndat.analytic.2$age &lt;- NULL\ndat.analytic.2$age.month &lt;- NULL\n\n# No missing exposure or outcome\ndim(dat.analytic.2)\n#&gt; [1] 21099    16\ndat.analytic1 &lt;- dat.analytic.2[complete.cases(dat.analytic.2$stime.since.birth),]\ndim(dat.analytic1)\n#&gt; [1] 21011    16\ndat.analytic2 &lt;- dat.analytic1[complete.cases(dat.analytic1$exposure.cat),]\ndim(dat.analytic2)\n#&gt; [1] 20950    16\nprofile_missing(dat.analytic2)\n\n\n\n\n\nProfile of missing data after removing participants with missing outcome or exposure. This table confirms that no missing values remain in the key covariates.\n\nShow/Hide Code\n# No missing values in covariates - complete case dataset \ndat.complete.2 &lt;- na.omit(dat.analytic2)\ndim(dat.complete.2)\n#&gt; [1] 20950    16\n\n# Participants dropped - overall\nnrow(dat.full.with.mortality.2) - nrow(dat.complete.2)\n#&gt; [1] 18206\n\n# Participants dropped - due to missing exposure or outcome\nnrow(dat.analytic.2) - nrow(dat.analytic2)\n#&gt; [1] 149\n\n# Participants dropped - due to missing covariates\nnrow(dat.analytic2) - nrow(dat.complete.2)\n#&gt; [1] 0\n\n# added\ntable(dat.analytic.2$exposure.cat, useNA = \"always\")\n#&gt; \n#&gt;      Never smoked Started before 10  Started at 10-14  Started at 15-17 \n#&gt;             12437               126              1497              2769 \n#&gt;  Started at 18-20  Started after 20              &lt;NA&gt; \n#&gt;              2440              1767                63\n\n\nSave the final analytic data for sensitivity analysis used below.\n\nShow/Hide Codesave(dat.complete.2, file = \"data/dat.complete.2.RData\")\n\n\n\n12.2.2 Analysis of the 2011-2018 Sub-period\n\nR Code Chunk 7: Analysis\n\nThe following code sets up the survey design object (w.design.2.0) specifically for the 2011-2018 sub-period. It uses the psu, strata, and survey.weight.new variables to correctly account for the complex sampling methodology within this subset of the data. This w.design.2.0 object is essential for running survey-weighted models in this sensitivity analysis.\nThe following code sets up the survey design object for the 2011-2018 sub-period as in the main analysis.\n\nShow/Hide Code# Set up the design \ndat.full.with.mortality.2$miss &lt;- 1\ndat.full.with.mortality.2$miss[dat.full.with.mortality.2$id %in% dat.analytic2$id] &lt;- 0\ntable(dat.full.with.mortality.2$miss)\n#&gt; \n#&gt;     0     1 \n#&gt; 20950 18206\n\nw.design.2 &lt;- svydesign(ids = ~psu, strata = ~strata, weights = ~survey.weight.new, \n                      data = dat.full.with.mortality.2, nest = TRUE)\n\n# Subset the design\nw.design.2.0 &lt;- subset(w.design.2, miss == 0 & survey.weight.new &gt; 0)\n\n\n\n\nR Code Chunk 8: Descriptive Statistics for Sub-period (Appendix Table 3)\n\nThe following table reproduces Appendix Table 3 from the paper. It summarizes the demographic characteristics of the cohort from the 2011-2018 NHANES cycles, stratified by smoking initiation categories, to provide context for this sensitivity analysis.\n\nShow/Hide Code# Create the weighted table using the survey design object for the 2011-2018 data\ntab_app_3_weighted &lt;- svyCreateTableOne(vars = c(\"race2\"),\n                                        strata = \"exposure.cat\",\n                                        data = w.design.2.0,\n                                        addOverall = TRUE,\n                                        test = TRUE)\n\n# Print and format the table\ntab_app_3_printed &lt;- print(tab_app_3_weighted,\n                           format = \"p\",\n                           catDigits = 2,\n                           showAllLevels = TRUE,\n                           smd = TRUE)\n\n# Define the desired column order\nnew_order_t3 &lt;- c(\"level\", \"Never smoked\", \"Started before 10\", \n                  \"Started at 10-14\", \"Started at 15-17\", \n                  \"Started at 18-20\", \"Started after 20\", \n                  \"Overall\", \"p\", \"test\", \"SMD\")\n\n# Apply the new order to the table object\ntab_app_3 &lt;- tab_app_3_printed[, new_order_t3]\n\n\n\nShow/Hide Code# Display the formatted table using kable for a clean Quarto output\nkable(tab_app_3, caption = \"Appendix Table 3: Characteristics \n      of the study sample for the 2011-2018 NHANES cycles,\n      stratified by smoking initiation age.\") %&gt;% \n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\nAppendix Table 3: Characteristics of the study sample for the 2011-2018 NHANES cycles, stratified by smoking initiation age.\n\n\nlevel\nNever smoked\nStarted before 10\nStarted at 10-14\nStarted at 15-17\nStarted at 18-20\nStarted after 20\nOverall\np\ntest\nSMD\n\n\n\nn\n\n128386920.10\n1240174.76\n16008335.09\n32086914.62\n26126847.18\n15892076.56\n219741268.30\n\n\n\n\n\nrace2 (%)\nWhite\n59.51\n74.22\n73.86\n73.66\n68.27\n60.61\n63.82\n&lt;0.001\n\n0.284\n\n\n\nBlack\n12.39\n5.51\n7.49\n8.55\n11.03\n16.85\n11.59\n\n\n\n\n\n\nHispanic\n17.72\n11.12\n12.94\n11.46\n12.77\n12.87\n15.48\n\n\n\n\n\n\nAsian\n7.62\n1.33\n1.31\n2.14\n3.40\n5.30\n5.65\n\n\n\n\n\n\nOthers\n2.76\n7.82\n4.40\n4.19\n4.53\n4.36\n3.45\n\n\n\n\n\n\n\n\n\nSub-Period Specific Analyses This subsection presents the Kaplan-Meier curve, unadjusted and adjusted Cox models for the 2011-2018 sub-period data, providing initial insights before delving into effect modification.\n\nR Code Chunk 9 : Kaplan-Meier Curves and Log-Rank Test for Sub-period\n\nThe following code visualizes the survival probabilities for the 2011-2018 sub-period data using Kaplan-Meier curves, stratified by exposure.cat. It also performs a survey-weighted log-rank test to assess statistical differences between the survival curves in this specific subset of the data. The process is the same as the main analysis.\nKaplan-Meier Survival Curves\n\nShow/Hide Codedummy_sub &lt;- length(unique(as.factor(w.design.2.0$variables$exposure.cat)))\n\n# Define the survival formula for Kaplan-Meier plot and log-rank test\nformulax0_sub &lt;- as.formula(Surv(stime.since.birth, status_all) ~ exposure.cat)\n\n# Calculate survey-weighted Kaplan-Meier curves for the sub-period\nsA_sub&lt;-svykm(formulax0_sub, design=w.design.2.0)\n\n# Plot\npar(oma=rep(0,4))\npar(mar=c(5,4,0,0) + 0.1)\nplot(sA_sub, pars=list(col=c(1:dummy_sub)),\n     xlab = \"Time\",\n     ylab = \"Proportion surviving\")\nlegend(\"bottomleft\", levels(as.factor(w.design.2.0$variables$exposure.cat)),\n       col = (1:dummy_sub), lty = c(1,1))\n\n\n\nSensitivity Analysis 2: Survey-Weighted Kaplan-Meier Curves\n\n\n\nLog-Rank Test\n\nShow/Hide Code# Perform the survey-weighted log-rank test\nlrt_sub &lt;- svylogrank(formulax0_sub,design=subset(w.design.2.0, survey.weight.new&gt;0))\nround(lrt_sub[[2]],2)\n#&gt; Chisq     p \n#&gt; 40.71  0.00\n\n\n\nCox Proportional Hazards Models\n\nR Code Chunk 10 : Unadjusted Cox Proportional Hazards Models for Sub-period\n\nThe following code runs both unweighted (coxph) and survey-weighted (svycoxph) unadjusted Cox proportional hazards models on the sub-period data. These models serve as a baseline for comparison within this specific sensitivity analysis.\n\nShow/Hide Code# Unweighted Cox model for sub-period\nfit0 &lt;- coxph(Surv(stime.since.birth, status_all) ~ exposure.cat, \n              data = dat.complete.2) \n\n# Survey-weighted unadjusted Cox model for sub-period\nfit0 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat, \n                 design = w.design.2.0) # Using w.design.2.0\nf0 &lt;- publish(fit0)\n\n# Process unadjusted HRs for sub-period (similar to main analysis f0r)\nf0r &lt;- f0$regressionTable[2:6,c(\"HazardRatio\",\"CI.95\")] \nf0r$group &lt;- \"Crude (Sub-period)\"\nci_f0_sub &lt;- str_extract_all(f0r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf0r$CI.l &lt;- as.numeric(as.character(ci_f0_sub[,1]))\nf0r$CI.u &lt;- as.numeric(as.character(ci_f0_sub[,2]))\nnames(f0r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\nf0r \n\n\n\n\nR Code Chunk 11: Adjusted Cox Proportional Hazards Model for Sub-period\n\nThe following code fits the adjusted Cox proportional hazards model for the sub-period data, controlling for sex, race2, and year.cat.\n\nShow/Hide Code# Survey-weighted adjusted Cox model for sub-period\nfit1 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat + sex + race2 + year.cat,\n                 design = w.design.2.0) \nf1 &lt;- publish(fit1)\n\n# Process adjusted HRs for sub-period (similar to main analysis f1r)\nf1r &lt;- f1$regressionTable[2:6,c(\"HazardRatio\",\"CI.95\")]\nf1r$group &lt;- \"Adjusted (Sub-period)\"\nci_f1_sub &lt;- str_extract_all(f1r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf1r$CI.l &lt;- as.numeric(as.character(ci_f1_sub[,1]))\nf1r$CI.u &lt;- as.numeric(as.character(ci_f1_sub[,2]))\nnames(f1r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\nf1r \n\n\n\n\nR Code Chunk 12: Effect Modification by Race/Ethnicity in Sub-period (Model)\n\nThe following code fits the core model for the sub-period sensitivity analysis: a survey-weighted Cox proportional hazards model with an interaction term between exposure.cat and race2.\n\nShow/Hide Code# Model\nfit2 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*race2 + sex  + year.cat,\n                           design = w.design.2.0) # Using w.design.2.0\n#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :\n#&gt; Loglik converged before variable 24 ; coefficient may be infinite.\nf2 &lt;- publish(fit2)\n\n# Process Race-Specific Hazard Ratios for Sub-period Plotting\nf2rW &lt;- f2$regressionTable[31:35,c(\"HazardRatio\",\"CI.95\")]\nf2rB &lt;- f2$regressionTable[36:40,c(\"HazardRatio\",\"CI.95\")]\nf2rH &lt;- f2$regressionTable[41:45,c(\"HazardRatio\",\"CI.95\")]\nf2rA &lt;- f2$regressionTable[46:50,c(\"HazardRatio\",\"CI.95\")]\n# Assign group labels\nf2rW$group &lt;- \"White (Sub-period)\"\nf2rB$group &lt;- \"Black (Sub-period)\"\nf2rH$group &lt;- \"Hispanic (Sub-period)\"\nf2rA$group &lt;- \"Asian (Sub-period)\"\nf2r &lt;- rbind(f2rW, f2rB, f2rH, f2rA)\nci &lt;- str_extract_all(f2r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf2r$CI.l &lt;- as.numeric(as.character(ci[,1]))\nf2r$CI.u &lt;- as.numeric(as.character(ci[,2]))\nnames(f2r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\nf2r\n\n\n\n\nR Code Chunk 13: Effect Modification by Sex in Sub-period (Model)\n\nThe following code fits a survey-weighted Cox proportional hazards model, including an interaction term between exposure.cat and sex for the sub-period data.\n\nShow/Hide Codefit3 &lt;- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*sex + race2 + year.cat, # Using fit3\n                 design = w.design.2.0) \nf3 &lt;- publish(fit3)\n\n# Process Sex-Specific Hazard Ratios for Sub-period Plotting\nf3rM &lt;- f3$regressionTable[16:20,c(\"HazardRatio\",\"CI.95\")]\nf3rF &lt;- f3$regressionTable[21:25,c(\"HazardRatio\",\"CI.95\")]\n\nf3rM$group &lt;- \"Male (Sub-period)\"\nf3rF$group &lt;- \"Female (Sub-period)\"\nf3r &lt;- rbind(f3rM, f3rF)\nci &lt;- str_extract_all(f3r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf3r$CI.l &lt;- as.numeric(as.character(ci[,1]))\nf3r$CI.u &lt;- as.numeric(as.character(ci[,2]))\nnames(f3r) &lt;- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n\n\n12.2.3 Visualizing the Sub-period Results\n\nR Code Chunk 14: Plot\n\nThe following code creates the plot using ggplot2 and corresponds to Appendix Figure 4 in section C.1, Sensitivity analysis with ‚ÄòAsian‚Äô category, part of the supplementary materials published with the original paper.\n\nShow/Hide Codefr &lt;- rbind(f2r)\nfr &lt;- as.data.frame(fr)\nfr[,c(1,4,5)] &lt;- sapply(fr[,c(1,4,5)], as.numeric)\nfr$age.grp &lt;- c(\"Started before 10\", \"Started at 10-14\", \"Started at 15-17\",\n                \"Started at 18-20\", \"Started after 20\")\n# Change levels\nfr$group &lt;- fct_recode(fr$group,\n  \"Non-Hispanic White\" = \"White (Sub-period)\",\n  \"Non-Hispanic Black\" = \"Black (Sub-period)\",\n  \"Hispanic\"           = \"Hispanic (Sub-period)\",\n  \"Asian\"              = \"Asian (Sub-period)\"\n)\n\n# Re-order\nfr$age.grp &lt;- factor(fr$age.grp,\n                     levels = c(\"Started before 10\",\n                                \"Started at 10-14\",\n                                \"Started at 15-17\",\n                                \"Started at 18-20\",\n                                \"Started after 20\"))\n\nfr$group &lt;- factor(fr$group, levels = c(\"Asian\", \"Hispanic\", \n                                        \"Non-Hispanic Black\", \"Non-Hispanic White\"))\n\n# Plot\nggplot(fr, aes(x = mean, y = group, colour = age.grp)) + \n  geom_vline(xintercept = 1, linetype = \"dashed\", color = \"grey\") +\n  geom_errorbar(aes(xmax = lower, xmin = upper), position = \"dodge\") + \n  geom_point(position = position_dodge(0.9)) + \n  labs(x = \"Hazard Ratio\", y = \"\", \n       legend=TRUE, col = \"Age group\") +\n  theme_classic() +\n  theme(panel.grid.major.x = element_blank(),\n        panel.border = element_blank(),\n        legend.title=element_text(size=12), \n        legend.text=element_text(size=12),\n        plot.title = element_text(hjust = 0),\n        axis.text.x = element_text(size = 10, face = \"bold\"),\n        axis.text.y = element_text(size = 10, face = \"bold\"),\n        legend.position=c(.8, .8))\n\n\n\nAppendix Figure 4: Forest plot of Hazard Ratios from the sensitivity analysis with ‚ÄòAsian‚Äô category.\n\n\nShow/Hide Codeggsave(\"images/forest2.png\")\n#&gt; Saving 7 x 5 in image\n\n\nThis concludes the sensitivity analysis."
  },
  {
    "objectID": "10-sensitivity-analysis.html#appendix-b-exploratory-analysis-of-smoking-duration",
    "href": "10-sensitivity-analysis.html#appendix-b-exploratory-analysis-of-smoking-duration",
    "title": "\n12¬† Sensitivity Analyses\n",
    "section": "\n12.3 Appendix B: Exploratory Analysis of Smoking Duration",
    "text": "12.3 Appendix B: Exploratory Analysis of Smoking Duration\nAs noted in the main paper, the duration of smoking is a potential mediator in the pathway from early smoking initiation to mortality. To investigate this secondary relationship, we create boxplots to visualize smoking duration across the different age-of-initiation categories. The following analysis uses the data we set aside earlier (dat.analytic.duration.analysis). This analysis reproduces Appendix Figures 1, 2, and 3 from the paper.\nNOTE: This analysis is based on participants from 1999-2016, as the variable for age of smoking cessation (SMD055) was not collected in the 2017-2018 cycle.\n\n12.3.1 Data Preparation for Duration Plots\n\nR Code Chunk 1: Prepare Data for Duration Analysis\n\nThe following code processes the data to calculate smoking duration by cleaning the age variables, computing the difference, correcting for data entry errors, and saving the final, plot-ready dataset.\n\nShow/Hide Code# Clean the 'smoking.age' variable before calculation.\n# Recode 0 and 99 (codes for never-smokers) to NA.\ndat.analytic.duration.analysis$smoking.age[dat.analytic.duration.analysis$smoking.age == 0] &lt;- NA\ndat.analytic.duration.analysis$smoking.age[dat.analytic.duration.analysis$smoking.age == 99] &lt;- NA\n\n# Calculate smoking duration.\ndat.analytic.duration.analysis$smoking.duration &lt;- dat.analytic.duration.analysis$smoking.quit.age - dat.analytic.duration.analysis$smoking.age\n\n# Correct any negative durations (from data entry errors) to 0.\ndat.analytic.duration.analysis$smoking.duration[!is.na(dat.analytic.duration.analysis$smoking.duration) & dat.analytic.duration.analysis$smoking.duration &lt; 0] &lt;- 0\n\n# Run the original summary checks to explore the new variable.\ncat(\"Total number of participants with non-missing smoking duration data:\\n\")\n#&gt; Total number of participants with non-missing smoking duration data:\nprint(sum(!is.na(dat.analytic.duration.analysis$smoking.duration)))\n#&gt; [1] 8916\n\ncat(\"\\nSummary of smoking duration for all ever-smokers:\\n\")\n#&gt; \n#&gt; Summary of smoking duration for all ever-smokers:\nprint(summary(dat.analytic.duration.analysis$smoking.duration))\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#&gt;    0.00    8.00   18.00   19.99   30.00   68.00   41908\n\n# Create the final data frame for plotting by filtering out non-smokers.\ndat.analytic.plot &lt;- dat.analytic.duration.analysis %&gt;% \n  filter(!exposure.cat %in% c(\"Never smoked\", NA))\n\n# Save the final plot-ready data.\nsaveRDS(dat.analytic.plot, file = \"data/duration_plot_data.rds\")\n\n\n\n12.3.2 Visualizing Smoking Duration by Initiation Age\n\nR Code Chunk 2: Smoking Duration Plots\n\nNow, the following code uses the dat.analytic.plot data version to calculate the median smoking duration for each exposure category, which will be used to draw a trend line on the plots.\n\nShow/Hide Code# Pre-calculate medians for the trend line\nmedian_data &lt;- dat.analytic.plot %&gt;%\n  group_by(exposure.cat) %&gt;%\n  summarize(median = median(smoking.duration, na.rm = TRUE)) %&gt;%\n  arrange(factor(exposure.cat, levels = c('Started before 10',\n                                         'Started at 10-14',\n                                         \"Started at 15-17\",\n                                         \"Started at 18-20\",\n                                         \"Started after 20\")))\n\n\nThe following code chunks generate the three plots corresponding to Appendix Figures 1, 2, and 3 in the paper‚Äôs supplementary material.\nAppendix Figure 1: Overall Smoking Duration\n\nShow/Hide Codeggplot(dat.analytic.plot, aes(x = exposure.cat, y = smoking.duration, group = exposure.cat)) +\n  geom_boxplot(fill = \"white\") +\n  geom_line(data = median_data, aes(x = exposure.cat, y = median, group = 1), color = \"grey\", size = 2, linetype = 2) +\n  geom_smooth(method = \"loess\", se = TRUE, color = \"blue\", size = 1, span = 0.5, level = 0.8) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(hjust = 0.5),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ) +\n  labs(x = \"\", y = \"Smoking Duration (Years)\",\n       title = \"Boxplot of Smoking Duration by Exposure Category\")\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\nSmoking duration by age of initiation category among ever-smokers.\n\n\n\nAppendix Figure 2: Stratified by Sex\n\nShow/Hide Codeggplot(dat.analytic.plot, aes(x = exposure.cat, y = smoking.duration, group = exposure.cat)) +\n  geom_boxplot(fill = \"white\") +\n  geom_line(data = median_data, aes(x = exposure.cat, y = median, group = 1), color = \"grey\", size = 2, linetype = 2) +\n  geom_smooth(method = \"loess\", se = TRUE, color = \"blue\", size = 1, span = 0.5, level = 0.8) +\n  facet_wrap(~sex) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(hjust = 0.5),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ) +\n  labs(x = \"\", y = \"Smoking Duration (Years)\",\n       title = \"Boxplot of Smoking Duration by Exposure Category\")\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\nSmoking duration by age of initiation, stratified by sex.\n\n\n\nAppendix Figure 3: Stratified by Race/Ethnicity\n\nShow/Hide Codelevels(dat.analytic.plot$race)[levels(dat.analytic.plot$race) == \"White\"] &lt;- \"Non-Hispanic White\"\nlevels(dat.analytic.plot$race)[levels(dat.analytic.plot$race) == \"Black\"] &lt;- \"Non-Hispanic Black\"\n\nggplot(dat.analytic.plot, aes(x = exposure.cat, y = smoking.duration, group = exposure.cat)) +\n  geom_boxplot(fill = \"white\") +\n  geom_line(data = median_data, aes(x = exposure.cat, y = median, group = 1), color = \"grey\", size = 2, linetype = 2) +\n  geom_smooth(method = \"loess\", se = TRUE, color = \"blue\", size = 1, span = 0.5, level = 0.8) +\n  facet_wrap(~race) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(hjust = 0.5),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ) +\n  labs(x = \"\", y = \"Smoking Duration (Years)\",\n       title = \"Boxplot of Smoking Duration by Exposure Category\")\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\nSmoking duration by age of initiation, stratified by race/ethnicity.\n\n\n\n\n12.3.3 Interpretation of Results\nThe boxplots consistently show a clear inverse relationship. The median smoking duration (indicated by the grey dashed line) is highest for those who started smoking before age 10 and steadily decreases for groups that started later in life. This trend holds true when the data is stratified by both sex and race/ethnicity. This visual evidence supports the hypothesis that earlier smoking initiation leads to a longer cumulative exposure to tobacco, which is a likely mediator in the pathway to increased mortality risk."
  },
  {
    "objectID": "10-sensitivity-analysis.html#chapter-summary-and-next-steps",
    "href": "10-sensitivity-analysis.html#chapter-summary-and-next-steps",
    "title": "\n12¬† Sensitivity Analyses\n",
    "section": "\n12.4 Chapter Summary and Next Steps",
    "text": "12.4 Chapter Summary and Next Steps\nWe have now completed two important sensitivity analyses to test the robustness of our primary findings. First, we adjusted for socioeconomic status proxies, and second, we re-ran the effect modification analysis on the 2011-2018 data to include the non-Hispanic Asian category. The results from both analyses were largely consistent with the main findings, strengthening our confidence in the conclusions.\nWe also completed the exploratory analysis which suggested a potential mechanism for our findings, showing that earlier smoking initiation is strongly associated with a longer lifetime smoking duration.\nWith the analytical portion complete, the next chapter, ‚ÄúDiscussion of Results,‚Äù will synthesize the findings from all analyses and interpret their meaning."
  },
  {
    "objectID": "11-discussion.html#synthesizing-the-evidence",
    "href": "11-discussion.html#synthesizing-the-evidence",
    "title": "13¬† Discussion of Results",
    "section": "13.1 Synthesizing the Evidence",
    "text": "13.1 Synthesizing the Evidence\n\n13.1.1 The Main Finding: A Clear Dose-Response Relationship\nThe Main Survival and Effect Modification Analysis formed the core of this investigation. Using data from all 10 NHANES cycles (1999‚Äì2018), it established that the risk of mortality incrementally increased with earlier ages of smoking initiation. Furthermore, this analysis revealed that the association was not uniform across all demographic groups. While the interaction by race/ethnicity was not statistically significant, the interaction by sex was significant (p = 0.001), with females showing slightly higher hazard ratios than males across most initiation categories.\n\n\n13.1.2 Supporting Evidence: The Role of Smoking Duration\nThe Exploratory Analysis of Smoking Duration (1999‚Äì2016) provided important context for our main finding. It revealed a clear trend where an earlier age of initiation was associated with a longer total duration of smoking. This suggests a potential mediating pathway: starting to smoke earlier leads to a longer cumulative exposure to tobacco, which in turn increases the risk of mortality.\n\n\n13.1.3 Confirming Robustness: The Sensitivity Analyses\nTwo sensitivity analyses were conducted to challenge our primary findings and ensure their robustness:\n\nAdjusting for SES Proxies: This analysis confirmed that the association between smoking initiation and mortality held even after adjusting for family income and education level. This strengthens our conclusion that the observed effect is not simply a result of socioeconomic confounding.\nIncluding the Non-Hispanic Asian Category (2011‚Äì2018): By focusing on a more recent subset of data, we were able to conduct a more nuanced effect modification analysis. While the smaller sample size resulted in wider confidence intervals, the overall trends remained consistent with the main analysis."
  },
  {
    "objectID": "11-discussion.html#public-health-implications",
    "href": "11-discussion.html#public-health-implications",
    "title": "13¬† Discussion of Results",
    "section": "13.2 Public Health Implications ‚öïÔ∏è",
    "text": "13.2 Public Health Implications ‚öïÔ∏è\nThe consistency of these findings across multiple analyses underscores a critical public health message: preventing smoking initiation among youth is one of the most effective strategies to reduce premature mortality. The particularly high risk for those who start before age 10 highlights the need for interventions targeted at children and adolescents. The significant differences observed by sex also suggest that prevention and cessation programs may need to be tailored to address gender-specific factors."
  },
  {
    "objectID": "11-discussion.html#chapter-summary-and-next-steps",
    "href": "11-discussion.html#chapter-summary-and-next-steps",
    "title": "13¬† Discussion of Results",
    "section": "13.3 Chapter Summary and Next Steps",
    "text": "13.3 Chapter Summary and Next Steps\nThis chapter synthesized the key findings from the main analysis and the subsequent sensitivity and exploratory analyses. We confirmed a consistent and strong dose-response relationship between earlier smoking initiation and higher all-cause mortality, with this effect being significantly modified by sex.\nWhile the results are compelling, it is crucial to acknowledge the study‚Äôs constraints. The next chapter, ‚ÄúLimitations and Future Directions,‚Äù will discuss the methodological limitations of the analysis and suggest avenues for future research."
  },
  {
    "objectID": "12-limitations-future.html#methodological-limitations",
    "href": "12-limitations-future.html#methodological-limitations",
    "title": "14¬† Limitations and Future Directions",
    "section": "14.1 Methodological Limitations ‚ö†Ô∏è",
    "text": "14.1 Methodological Limitations ‚ö†Ô∏è\n\n14.1.1 Data Harmonization Across Cycles\nA significant challenge in this project was combining data across ten different NHANES cycles (1999‚Äì2018). This required considerable effort to harmonize variables, as names and coding schemes frequently changed over time. For instance:\n\nInconsistent Variable Names: The variable for household head education was named DMDHREDU in early cycles but changed to DMDHREDZ in the 2017‚Äì2018 cycle, requiring conditional logic to process correctly.\nEvolving Definitions: The definition of race/ethnicity evolved, with a distinct variable for the non-Hispanic Asian population (RIDRETH3) only becoming available from 2011 onwards. Our main analysis had to group this population into an ‚ÄúOthers‚Äù category to maintain consistency, which may mask effects specific to this group. This was the primary motivation for the second sensitivity analysis.\n\n\n\n14.1.2 Unmeasured Confounding and Missing Data\nWhile we adjusted for key demographic variables, the main analysis does not account for all potential confounders, such as detailed family medical history, genetic predispositions, or granular socioeconomic status (SES).\n\nOur sensitivity analysis that included SES proxies (pir and HHedu) provided some reassurance, but it came at the cost of a significantly reduced sample size due to missing data. This highlights the classic trade-off between confounding control and statistical power.\n\n\n\n14.1.3 Reliance on Self-Reported Data\nThe primary exposure‚Äîage of smoking initiation‚Äîis based on self-report and may be subject to recall bias, where participants may not accurately remember when they started smoking regularly."
  },
  {
    "objectID": "12-limitations-future.html#future-directions",
    "href": "12-limitations-future.html#future-directions",
    "title": "14¬† Limitations and Future Directions",
    "section": "14.2 Future Directions üöÄ",
    "text": "14.2 Future Directions üöÄ\nThe limitations of this study highlight several exciting avenues for future research:\n\n14.2.1 Investigating Cause-Specific Mortality\nThis analysis focused on all-cause mortality. A valuable next step would be to examine cause-specific mortality (e.g., from cardiovascular disease, cancer, or respiratory illness). This could reveal more specific pathways through which early smoking initiation impacts long-term health.\n\n\n14.2.2 Modeling Time-Dependent Smoking Behavior\nAs noted in the original paper, smoking behavior is dynamic. People‚Äôs smoking habits change over their lifetime. Future research could employ more advanced statistical models (e.g., marginal structural models) to incorporate time-dependent variables like:\n\nSmoking intensity (cigarettes per day)\nPeriods of cessation and relapse\nUse of other tobacco products\n\nThis would provide a more nuanced understanding of smoking‚Äôs cumulative impact, though it would require more detailed longitudinal data than is currently available in the public-use NHANES files."
  },
  {
    "objectID": "12-limitations-future.html#chapter-summary-and-next-steps",
    "href": "12-limitations-future.html#chapter-summary-and-next-steps",
    "title": "14¬† Limitations and Future Directions",
    "section": "14.3 Chapter Summary and Next Steps",
    "text": "14.3 Chapter Summary and Next Steps\nIn this chapter, we have critically examined the limitations of our analysis, from the practical challenges of data harmonization to the methodological considerations of unmeasured confounding. We also proposed several exciting avenues for future research that could build upon this work, such as exploring cause-specific mortality and dynamic smoking behaviors.\nThis concludes the main body of the walkthrough. The final sections of this book include the Appendices, which provide a glossary of key terms, and the References."
  },
  {
    "objectID": "appendices.html#appendix-a-glossary-of-key-terms",
    "href": "appendices.html#appendix-a-glossary-of-key-terms",
    "title": "\n15¬† Appendices\n",
    "section": "\n15.1 Appendix A: Glossary of Key Terms üìñ",
    "text": "15.1 Appendix A: Glossary of Key Terms üìñ\n\nHazard Ratio (HR): A measure of effect in survival analysis. It represents the ratio of the hazard rates corresponding to the conditions described by two levels of an explanatory variable. An HR of 2, for example, means that at any given time, the group of interest is twice as likely to experience the event (e.g., death) as the comparison group. An HR of 1 indicates no difference in risk.\nKaplan-Meier Curve: A non-parametric statistic used to estimate the survival function from lifetime data. The curve is a series of horizontal steps of declining magnitude which, when taken together, approximates the true survival function for that population. It allows for a visual comparison of survival probabilities between different groups over time.\nPrimary Sampling Units (PSUs): The first stage of sampling in a multi-stage survey design like NHANES. PSUs are typically large geographic areas (like counties). The survey first samples a set of PSUs, and then samples smaller units within them. Accounting for PSUs is critical for accurate variance estimation.\nRelative Excess Risk due to Interaction (RERI): A measure used to assess additive interaction between two exposures. RERI &gt; 0 indicates a positive interaction (synergism), meaning the combined effect of the two exposures is greater than the sum of their individual effects. RERI &lt; 0 indicates a negative interaction (antagonism)."
  },
  {
    "objectID": "appendices.html#chapter-summary",
    "href": "appendices.html#chapter-summary",
    "title": "\n15¬† Appendices\n",
    "section": "\n15.2 Chapter Summary",
    "text": "15.2 Chapter Summary\nThis appendix provided supplementary materials to support the analyses. It begins with a glossary of key statistical and epidemiological terms used throughout the book to aid the reader‚Äôs understanding."
  }
]