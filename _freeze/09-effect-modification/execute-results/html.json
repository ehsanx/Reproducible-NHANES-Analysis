{
  "hash": "8c0f9629d51de12a7b823ed550f60130",
  "result": {
    "markdown": "# Effect Modification Analysis\n\n---\n\nThis section explains the effect modification analysis, which investigates whether the association between early smoking initiation and all-cause mortality is changed by key demographic variables like race/ethnicity and sex. Effect modification occurs when the strength or direction of an association differs across levels of another variable.\n\nThis is investigated through 2 ways.\n\n1. Interaction Terms : Including interaction terms in our survey-weighted Cox proportional hazards models and performing statistical tests for these interaction terms.\n2. RERI (Relative Excess Risk due to Interaction) : Calculating this measure to assess additive interaction, which provides a different perspective on how factors combine their effects.\n\nThe key methods are summarized below:\n\n| Analysis | Key R Function(s) | Purpose | Reproduces |\n| :--- | :--- | :--- | :--- |\n| **Effect Modification by Race/Ethnicity** | `svycoxph()` | Estimate stratum-specific HRs for each racial/ethnic group. | **Figure 2** (Race-specific HRs) |\n| **Effect Modification by Sex** | `svycoxph()` | Estimate stratum-specific HRs for males and females. | **Figure 2** (Sex-specific HRs) |\n| **Interaction Tests** | `svyglm()`, `regTermTest()` | Formally test if the effect of smoking initiation differs across groups. | **Paper's p-values** for interaction |\n| **Forest Plot** | `ggplot()` | Visualize and compare all crude, adjusted, and stratum-specific HRs. | **Figure 2** (Complete Plot) |\n| **Additive Interaction (RERI)** | `reri.f()` (custom) | Quantify the excess risk due to the combined presence of two factors. | **Appendix Tables 4 & 5** |\n\n\n\n\n\n::: {.cell hash='09-effect-modification_cache/html/libraries_11ca209eb44abb95e3b319593d4bb22d'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(Publish)\nlibrary(survey)\noptions(survey.want.obsolete=TRUE)\nlibrary(survival)\nrequire(knitr)\nrequire(kableExtra)\nlibrary(ggplot2)\nlibrary(stringr)\nlibrary(expss)\n```\n:::\n\n\n---\n\n* R Code Chunk 1: Load Data and Processed Results\n\nThe following code loads the essential `w.design0` survey design object, which was created and saved in the previous section. This object is important for all subsequent survey-weighted analyses coming up. Additionally, it ensures that `f0r` and `f1r` (the processed Hazard Ratios from previous section) are available for binding and plotting.\n\n\n::: {.cell hash='09-effect-modification_cache/html/load_63f7532f87ff3ed55143340b7b5317a4'}\n\n```{.r .cell-code}\n# Load the subsetted survey design object\nw.design0 <- readRDS(file = \"data/w.design0.rds\")\n\n# Load f0r and f1r from previous section\nf0r <- readRDS(\"data/f0r.rds\")\nf1r <- readRDS(\"data/f1r.rds\")\n```\n:::\n\n\n---\n\n## Investigating Effect Modification by Race/Ethnicity\n\n* R Code Chunk 2: Effect Modification by Race/Ethnicity\n\nThe following code fits a survey-weighted Cox proportional hazards model, including an interaction term between `exposure.cat` (smoking initiation age) and `race`. This model is used to assess if the association between early smoking initiation and mortality differs across various racial/ethnic levels or groups.\n\n\n::: {.cell hash='09-effect-modification_cache/html/EM-race_eeac2b98faff206a3e37771cf9b8fec0'}\n\n```{.r .cell-code}\n# Effect modification by race\nfit2 <- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*race \n                 + sex + year.cat, design = w.design0)\n\n# Publish the results for later processing\nf2 <- publish(fit2)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (301) clusters.\n#> subset(w.design, miss == 0 & survey.weight.new > 0)\n#>                                                         Variable     Units HazardRatio        CI.95   p-value \n#>                                                              sex      Male         Ref                        \n#>                                                                     Female        0.74  [0.70;0.79]   < 0.001 \n#>                                                         year.cat 1999-2000         Ref                        \n#>                                                                  2001-2002        0.96  [0.86;1.08]   0.52079 \n#>                                                                  2003-2004        0.84  [0.74;0.94]   0.00236 \n#>                                                                  2005-2006        0.75  [0.67;0.84]   < 0.001 \n#>                                                                  2007-2008        0.77  [0.66;0.90]   < 0.001 \n#>                                                                  2009-2010        0.68  [0.59;0.78]   < 0.001 \n#>                                                                  2011-2012        0.62  [0.51;0.76]   < 0.001 \n#>                                                                  2013-2014        0.58  [0.48;0.69]   < 0.001 \n#>                                                                  2015-2016        0.34  [0.26;0.45]   < 0.001 \n#>                                                                  2017-2018        0.19  [0.13;0.29]   < 0.001 \n#>                 exposure.cat(Never smoked): race(Black vs White)                  1.82  [1.63;2.04]   < 0.001 \n#>              exposure.cat(Never smoked): race(Hispanic vs White)                  1.24  [1.06;1.45]   0.00596 \n#>                exposure.cat(Never smoked): race(Others vs White)                  1.21  [0.95;1.54]   0.12522 \n#>            exposure.cat(Started before 10): race(Black vs White)                  1.11  [0.54;2.29]   0.77275 \n#>         exposure.cat(Started before 10): race(Hispanic vs White)                  0.40  [0.17;0.90]   0.02774 \n#>           exposure.cat(Started before 10): race(Others vs White)                  1.74  [0.65;4.69]   0.27143 \n#>             exposure.cat(Started at 10-14): race(Black vs White)                  1.44  [1.13;1.83]   0.00303 \n#>          exposure.cat(Started at 10-14): race(Hispanic vs White)                  0.78  [0.55;1.10]   0.14920 \n#>            exposure.cat(Started at 10-14): race(Others vs White)                  1.44  [0.88;2.35]   0.14422 \n#>             exposure.cat(Started at 15-17): race(Black vs White)                  1.43  [1.23;1.67]   < 0.001 \n#>          exposure.cat(Started at 15-17): race(Hispanic vs White)                  0.89  [0.69;1.15]   0.35784 \n#>            exposure.cat(Started at 15-17): race(Others vs White)                  1.57  [1.07;2.30]   0.02207 \n#>             exposure.cat(Started at 18-20): race(Black vs White)                  1.72  [1.40;2.10]   < 0.001 \n#>          exposure.cat(Started at 18-20): race(Hispanic vs White)                  1.05  [0.83;1.32]   0.70369 \n#>            exposure.cat(Started at 18-20): race(Others vs White)                  0.96  [0.62;1.50]   0.86329 \n#>             exposure.cat(Started after 20): race(Black vs White)                  1.32  [1.07;1.61]   0.00811 \n#>          exposure.cat(Started after 20): race(Hispanic vs White)                  0.98  [0.77;1.24]   0.85155 \n#>            exposure.cat(Started after 20): race(Others vs White)                  0.77  [0.54;1.10]   0.14624 \n#>     race(White): exposure.cat(Started before 10 vs Never smoked)                  3.13  [2.27;4.31]   < 0.001 \n#>      race(White): exposure.cat(Started at 10-14 vs Never smoked)                  2.53  [2.16;2.97]   < 0.001 \n#>      race(White): exposure.cat(Started at 15-17 vs Never smoked)                  2.06  [1.84;2.31]   < 0.001 \n#>      race(White): exposure.cat(Started at 18-20 vs Never smoked)                  1.53  [1.35;1.74]   < 0.001 \n#>      race(White): exposure.cat(Started after 20 vs Never smoked)                  1.70  [1.50;1.92]   < 0.001 \n#>     race(Black): exposure.cat(Started before 10 vs Never smoked)                  1.91  [0.99;3.69]   0.05438 \n#>      race(Black): exposure.cat(Started at 10-14 vs Never smoked)                  2.00  [1.65;2.42]   < 0.001 \n#>      race(Black): exposure.cat(Started at 15-17 vs Never smoked)                  1.62  [1.37;1.92]   < 0.001 \n#>      race(Black): exposure.cat(Started at 18-20 vs Never smoked)                  1.45  [1.20;1.75]   < 0.001 \n#>      race(Black): exposure.cat(Started after 20 vs Never smoked)                  1.22  [1.03;1.46]   0.02524 \n#>  race(Hispanic): exposure.cat(Started before 10 vs Never smoked)                  1.00  [0.47;2.15]   0.99907 \n#>   race(Hispanic): exposure.cat(Started at 10-14 vs Never smoked)                  1.58  [1.22;2.05]   < 0.001 \n#>   race(Hispanic): exposure.cat(Started at 15-17 vs Never smoked)                  1.47  [1.08;2.00]   0.01433 \n#>   race(Hispanic): exposure.cat(Started at 18-20 vs Never smoked)                  1.29  [1.00;1.67]   0.04860 \n#>   race(Hispanic): exposure.cat(Started after 20 vs Never smoked)                  1.33  [1.00;1.78]   0.04861 \n#>    race(Others): exposure.cat(Started before 10 vs Never smoked)                  4.51 [1.87;10.87]   < 0.001 \n#>     race(Others): exposure.cat(Started at 10-14 vs Never smoked)                  3.01  [1.81;5.02]   < 0.001 \n#>     race(Others): exposure.cat(Started at 15-17 vs Never smoked)                  2.67  [1.73;4.10]   < 0.001 \n#>     race(Others): exposure.cat(Started at 18-20 vs Never smoked)                  1.22  [0.74;2.00]   0.43325 \n#>     race(Others): exposure.cat(Started after 20 vs Never smoked)                  1.08  [0.70;1.66]   0.73892\n```\n:::\n\n\n---\n\n* R Code Chunk 3: Testing Race/Ethnicity Interaction (Poisson Approximation)\n\nThe following code performs statistical tests to formally assess the significance of the interaction term between `exposure.cat` and `race`. It uses `svyglm` with a Poisson family (as an approximation to the Cox model) to allow for `anova()` comparisons, and `regTermTest()` is used to perform a Likelihood Ratio Test (LRT) directly on the interaction term. This helps determine if the observed variations in association by race are statistically significant.\n\n\n::: {.cell hash='09-effect-modification_cache/html/race-test_aa1c77287e381b9b96758e49f3074199'}\n\n```{.r .cell-code}\n# Fit the baseline Poisson model (no interaction)\nfit1a <- svyglm(status_all ~ offset(log(stime.since.birth)) + \n                  exposure.cat + race + sex  + year.cat,\n                design = w.design0, family=poisson)\n\n# Fit the full Poisson model (with interaction)\nfit2a <- svyglm(status_all ~ offset(log(stime.since.birth)) + \n                  exposure.cat*race + sex  + year.cat,\n                design = w.design0, family=poisson)\n\n# Compare the two models using a Rao-Scott test (via anova)\nanova(fit2a,fit1a)\n#> Working (Rao-Scott+F) LRT for exposure.cat:race\n#>  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#>     exposure.cat * race + sex + year.cat, design = w.design0, \n#>     family = poisson)\n#> Working 2logLR =  21.45753 p= 0.16075 \n#> (scale factors:  2 1.9 1.8 1.5 1.4 0.98 0.93 0.76 0.73 0.62 0.57 0.54 0.45 0.37 0.36 );  denominator df= 120\n\n# Directly test the interaction term using a Likelihood Ratio Test\nregTermTest(fit2a, test.terms = \"exposure.cat:race\", method = \"LRT\")\n#> Working (Rao-Scott+F) LRT for exposure.cat:race\n#>  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#>     exposure.cat * race + sex + year.cat, design = w.design0, \n#>     family = poisson)\n#> Working 2logLR =  21.45753 p= 0.16075 \n#> (scale factors:  2 1.9 1.8 1.5 1.4 0.98 0.93 0.76 0.73 0.62 0.57 0.54 0.45 0.37 0.36 );  denominator df= 120\n```\n:::\n\n\n---\n\n* R Code Chunk 4: Process Race-Specific Hazard Ratios for Plotting\n\nAlthough the overall interaction term was not statistically significant, the original paper still presented the stratum-specific Hazard Ratios (HRs) to visualize the trends within each racial/ethnic group. So the following code extracts stratum-specific Hazard Ratios (HRs) and their 95% Confidence Intervals (CIs) for each racial/ethnic group from the `f2` object (the published output of fit2). These HRs reflect the effect of smoking initiation within each racial/ethnic stratum, allowing for a detailed examination of potential effect modification. The extracted data is formatted into a dataframe, `f2r`.\n\n\n::: {.cell hash='09-effect-modification_cache/html/race-HRs_286a62acfb73a1712026528ac0909f7d'}\n\n```{.r .cell-code}\n# Extract HRs and CIs for each race subgroup from the published output\nf2rW <- f2$regressionTable[31:35,c(\"HazardRatio\",\"CI.95\")]\nf2rB <- f2$regressionTable[36:40,c(\"HazardRatio\",\"CI.95\")]\nf2rH <- f2$regressionTable[41:45,c(\"HazardRatio\",\"CI.95\")]\n\n# Assign group labels and combine into a single data frame\nf2rW$group <- \"White\"\nf2rB$group <- \"Black\"\nf2rH$group <- \"Hispanic\"\nf2r <- rbind(f2rW, f2rB, f2rH)\n\n# Process CIs: Extract lower and upper bounds from the CI string\nci <- str_extract_all(f2r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf2r$CI.l <- as.numeric(as.character(ci[,1]))\nf2r$CI.u <- as.numeric(as.character(ci[,2]))\nnames(f2r) <- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n# Display the final processed data frame\nf2r\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"CI.95\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"group\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"lower\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"upper\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3.13\",\"2\":\"[2.27;4.31]\",\"3\":\"White\",\"4\":\"2.27\",\"5\":\"4.31\",\"_rn_\":\"31\"},{\"1\":\"2.53\",\"2\":\"[2.16;2.97]\",\"3\":\"White\",\"4\":\"2.16\",\"5\":\"2.97\",\"_rn_\":\"32\"},{\"1\":\"2.06\",\"2\":\"[1.84;2.31]\",\"3\":\"White\",\"4\":\"1.84\",\"5\":\"2.31\",\"_rn_\":\"33\"},{\"1\":\"1.53\",\"2\":\"[1.35;1.74]\",\"3\":\"White\",\"4\":\"1.35\",\"5\":\"1.74\",\"_rn_\":\"34\"},{\"1\":\"1.70\",\"2\":\"[1.50;1.92]\",\"3\":\"White\",\"4\":\"1.50\",\"5\":\"1.92\",\"_rn_\":\"35\"},{\"1\":\"1.91\",\"2\":\"[0.99;3.69]\",\"3\":\"Black\",\"4\":\"0.99\",\"5\":\"3.69\",\"_rn_\":\"36\"},{\"1\":\"2.00\",\"2\":\"[1.65;2.42]\",\"3\":\"Black\",\"4\":\"1.65\",\"5\":\"2.42\",\"_rn_\":\"37\"},{\"1\":\"1.62\",\"2\":\"[1.37;1.92]\",\"3\":\"Black\",\"4\":\"1.37\",\"5\":\"1.92\",\"_rn_\":\"38\"},{\"1\":\"1.45\",\"2\":\"[1.20;1.75]\",\"3\":\"Black\",\"4\":\"1.20\",\"5\":\"1.75\",\"_rn_\":\"39\"},{\"1\":\"1.22\",\"2\":\"[1.03;1.46]\",\"3\":\"Black\",\"4\":\"1.03\",\"5\":\"1.46\",\"_rn_\":\"40\"},{\"1\":\"1.00\",\"2\":\"[0.47;2.15]\",\"3\":\"Hispanic\",\"4\":\"0.47\",\"5\":\"2.15\",\"_rn_\":\"41\"},{\"1\":\"1.58\",\"2\":\"[1.22;2.05]\",\"3\":\"Hispanic\",\"4\":\"1.22\",\"5\":\"2.05\",\"_rn_\":\"42\"},{\"1\":\"1.47\",\"2\":\"[1.08;2.00]\",\"3\":\"Hispanic\",\"4\":\"1.08\",\"5\":\"2.00\",\"_rn_\":\"43\"},{\"1\":\"1.29\",\"2\":\"[1.00;1.67]\",\"3\":\"Hispanic\",\"4\":\"1.00\",\"5\":\"1.67\",\"_rn_\":\"44\"},{\"1\":\"1.33\",\"2\":\"[1.00;1.78]\",\"3\":\"Hispanic\",\"4\":\"1.00\",\"5\":\"1.78\",\"_rn_\":\"45\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n---\n\n## Investigating Effect Modification by Sex\n\n* R Code Chunk 5: Effect Modification by Sex\n\nThe following code fits another survey-weighted Cox proportional hazards model, this time including an interaction term between exposure.cat and sex. This model is used to investigate whether the association between early smoking initiation and mortality varies between male and female participants.\n\n\n::: {.cell hash='09-effect-modification_cache/html/EM-sex_7d75cb0b70108778ee35970d48644b30'}\n\n```{.r .cell-code}\n# Effect modification by sex\nfit3 <- svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat*sex \n                 + race + year.cat, design = w.design0)\n\n# Publish the results for later processing\nf3 <- publish(fit3)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (301) clusters.\n#> subset(w.design, miss == 0 & survey.weight.new > 0)\n#>                                                      Variable     Units HazardRatio       CI.95   p-value \n#>                                                          race     White         Ref                       \n#>                                                                   Black        1.60 [1.47;1.74]   < 0.001 \n#>                                                                Hispanic        1.04 [0.93;1.16]   0.51363 \n#>                                                                  Others        1.16 [0.98;1.37]   0.09252 \n#>                                                      year.cat 1999-2000         Ref                       \n#>                                                               2001-2002        0.96 [0.86;1.08]   0.51741 \n#>                                                               2003-2004        0.84 [0.74;0.94]   0.00291 \n#>                                                               2005-2006        0.75 [0.67;0.84]   < 0.001 \n#>                                                               2007-2008        0.77 [0.66;0.90]   < 0.001 \n#>                                                               2009-2010        0.68 [0.59;0.78]   < 0.001 \n#>                                                               2011-2012        0.62 [0.51;0.76]   < 0.001 \n#>                                                               2013-2014        0.58 [0.48;0.69]   < 0.001 \n#>                                                               2015-2016        0.35 [0.27;0.45]   < 0.001 \n#>                                                               2017-2018        0.20 [0.13;0.29]   < 0.001 \n#>               exposure.cat(Never smoked): sex(Female vs Male)                  0.67 [0.61;0.74]   < 0.001 \n#>          exposure.cat(Started before 10): sex(Female vs Male)                  0.77 [0.30;1.99]   0.58537 \n#>           exposure.cat(Started at 10-14): sex(Female vs Male)                  1.03 [0.81;1.31]   0.80520 \n#>           exposure.cat(Started at 15-17): sex(Female vs Male)                  0.76 [0.66;0.88]   < 0.001 \n#>           exposure.cat(Started at 18-20): sex(Female vs Male)                  0.73 [0.62;0.87]   < 0.001 \n#>           exposure.cat(Started after 20): sex(Female vs Male)                  0.78 [0.67;0.90]   < 0.001 \n#>    sex(Male): exposure.cat(Started before 10 vs Never smoked)                  2.54 [1.86;3.47]   < 0.001 \n#>     sex(Male): exposure.cat(Started at 10-14 vs Never smoked)                  2.05 [1.81;2.32]   < 0.001 \n#>     sex(Male): exposure.cat(Started at 15-17 vs Never smoked)                  1.83 [1.61;2.09]   < 0.001 \n#>     sex(Male): exposure.cat(Started at 18-20 vs Never smoked)                  1.40 [1.22;1.61]   < 0.001 \n#>     sex(Male): exposure.cat(Started after 20 vs Never smoked)                  1.42 [1.22;1.64]   < 0.001 \n#>  sex(Female): exposure.cat(Started before 10 vs Never smoked)                  2.90 [1.21;6.92]   0.01677 \n#>   sex(Female): exposure.cat(Started at 10-14 vs Never smoked)                  3.15 [2.49;3.97]   < 0.001 \n#>   sex(Female): exposure.cat(Started at 15-17 vs Never smoked)                  2.07 [1.81;2.37]   < 0.001 \n#>   sex(Female): exposure.cat(Started at 18-20 vs Never smoked)                  1.53 [1.32;1.78]   < 0.001 \n#>   sex(Female): exposure.cat(Started after 20 vs Never smoked)                  1.63 [1.44;1.85]   < 0.001\n```\n:::\n\n\n---\n\n* R Code Chunk 6: Testing Sex Interaction (Poisson Approximation and AIC)\n\nSimilar to the race interaction, we now formally test the significance of the interaction between smoking initiation and sex. We use the same Poisson approximation approach to compare the model with the interaction term (`fit3a`) against the baseline model without it (`fit1a`).\n\n::: {.callout-note}\nThe Akaike Information Criterion (AIC) is calculated for this model and compared with previous models to evaluate overall model fit, as discussed in the paper. A lower AIC value indicates a better model fit. The paper reports that the sex interaction was statistically significant (p=0.001) and that this model provided a superior fit (lower AIC) compared to the others.\n:::\n\n\n::: {.cell hash='09-effect-modification_cache/html/sex-test_936380fa7fd1e21addd0ff0e44095a91'}\n\n```{.r .cell-code}\n# Fit the full Poisson model (with sex interaction)\nfit3a <- svyglm(status_all ~ offset(log(stime.since.birth)) + \n                  exposure.cat*sex + race + year.cat,\n                design = w.design0, family=poisson)\n\n# Compare the sex-interaction model to the baseline model (fit1a)\nanova(fit3a,fit1a) \n#> Working (Rao-Scott+F) LRT for exposure.cat:sex\n#>  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#>     exposure.cat * sex + race + year.cat, design = w.design0, \n#>     family = poisson)\n#> Working 2logLR =  21.44332 p= 0.0014171 \n#> (scale factors:  1.2 1.1 1 0.87 0.76 );  denominator df= 130\n\n# Directly test the interaction term\nregTermTest(fit3a, test.terms = \"exposure.cat:sex\", method = \"LRT\")\n#> Working (Rao-Scott+F) LRT for exposure.cat:sex\n#>  in svyglm(formula = status_all ~ offset(log(stime.since.birth)) + \n#>     exposure.cat * sex + race + year.cat, design = w.design0, \n#>     family = poisson)\n#> Working 2logLR =  21.44332 p= 0.0014171 \n#> (scale factors:  1.2 1.1 1 0.87 0.76 );  denominator df= 130\n\n# Compare AIC values across all three models for overall fit\nAIC(fit1a, fit2a, fit3a)\n#>         eff.p      AIC deltabar\n#> [1,] 24.73244 17872.62 1.374024\n#> [2,] 34.63283 17878.17 1.049480\n#> [3,] 30.80173 17858.35 1.339206\n```\n:::\n\n\n---\n\n* R Code Chunk 7: Process Sex-Specific Hazard Ratios for Plotting\n\nThe following code extracts the Hazard Ratios (HRs) and their 95% Confidence Intervals (CIs) for both male and female subgroups from the `f3` object (the published output of fit3). These HRs reflect the effect of smoking initiation within each sex level The extracted data is formatted into data frame, `f3r`.\n\n\n::: {.cell hash='09-effect-modification_cache/html/sex-HRs_e618d0a6ec49dddc23bc5fdc73a3d771'}\n\n```{.r .cell-code}\n# Extract HRs and CIs for male and female subgroups from the published output\nf3rM <- f3$regressionTable[21:25,c(\"HazardRatio\",\"CI.95\")]\nf3rF <- f3$regressionTable[26:30,c(\"HazardRatio\",\"CI.95\")]\n\n# Assign group labels and combine into a single data frame\nf3rM$group <- \"Male\"\nf3rF$group <- \"Female\"\nf3r <- rbind(f3rM, f3rF)\n\n# Process CIs: Extract lower and upper bounds from the CI string\nci <- str_extract_all(f3r[,2], '\\\\d+([.,]\\\\d+)?', simplify = TRUE)\nf3r$CI.l <- as.numeric(as.character(ci[,1]))\nf3r$CI.u <- as.numeric(as.character(ci[,2]))\nnames(f3r) <- c(\"mean\",\"CI.95\",\"group\",\"lower\",\"upper\")\n\n# Display the final processed data frame\nf3r\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"CI.95\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"group\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"lower\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"upper\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2.54\",\"2\":\"[1.86;3.47]\",\"3\":\"Male\",\"4\":\"1.86\",\"5\":\"3.47\",\"_rn_\":\"21\"},{\"1\":\"2.05\",\"2\":\"[1.81;2.32]\",\"3\":\"Male\",\"4\":\"1.81\",\"5\":\"2.32\",\"_rn_\":\"22\"},{\"1\":\"1.83\",\"2\":\"[1.61;2.09]\",\"3\":\"Male\",\"4\":\"1.61\",\"5\":\"2.09\",\"_rn_\":\"23\"},{\"1\":\"1.40\",\"2\":\"[1.22;1.61]\",\"3\":\"Male\",\"4\":\"1.22\",\"5\":\"1.61\",\"_rn_\":\"24\"},{\"1\":\"1.42\",\"2\":\"[1.22;1.64]\",\"3\":\"Male\",\"4\":\"1.22\",\"5\":\"1.64\",\"_rn_\":\"25\"},{\"1\":\"2.90\",\"2\":\"[1.21;6.92]\",\"3\":\"Female\",\"4\":\"1.21\",\"5\":\"6.92\",\"_rn_\":\"26\"},{\"1\":\"3.15\",\"2\":\"[2.49;3.97]\",\"3\":\"Female\",\"4\":\"2.49\",\"5\":\"3.97\",\"_rn_\":\"27\"},{\"1\":\"2.07\",\"2\":\"[1.81;2.37]\",\"3\":\"Female\",\"4\":\"1.81\",\"5\":\"2.37\",\"_rn_\":\"28\"},{\"1\":\"1.53\",\"2\":\"[1.32;1.78]\",\"3\":\"Female\",\"4\":\"1.32\",\"5\":\"1.78\",\"_rn_\":\"29\"},{\"1\":\"1.63\",\"2\":\"[1.44;1.85]\",\"3\":\"Female\",\"4\":\"1.44\",\"5\":\"1.85\",\"_rn_\":\"30\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n---\n\n## Visualizing the Results (Figure 2)\n\n* R Code Chunk 8: Forest Plot Visualization of Hazard Ratios\n\nThe following code prepares the data for the comprehensive forest plot. It binds together the Hazard Ratios from the crude (`f0r`), adjusted (`f1r`), race-specific (`f2r`), and sex-specific (`f3r`) models into a single data frame fr. It then converts relevant columns to numeric types and assigns descriptive labels (`age.grp`).\n\n\n::: {.cell hash='09-effect-modification_cache/html/all-bind_a870f0155f20ef335b368c0b891cccab'}\n\n```{.r .cell-code}\n# Bind all processed HR data frames and set as data frame\nfr <- rbind(f0r,f1r,f2r,f3r)\nfr <- as.data.frame(fr)\n\n# Convert to numeric columns\nfr[,c(1,4,5)] <- sapply(fr[,c(1,4,5)], as.numeric)\n\n# Assign 'age.grp' labels\nfr$age.grp <- c('Started before 10', 'Started at 10-14',\n                \"Started at 15-17\", \"Started at 18-20\",\n                \"Started after 20\")\n\n# Save the final plotting dataframe\nsaveRDS(fr, file = \"data/fr.rds\")\n```\n:::\n\n\nThe following code uses the `ggplot2` package to visualize the comprehensive forest plot with the estimated Hazard Ratios and their 95% Confidence Intervals from all models (crude, adjusted, and subgroup-specific). This corresponds to Figure 2 in the published paper.\n\n\n::: {.cell hash='09-effect-modification_cache/html/forestplotting_341972e5a4e6fbac1eb12f270504c3b8'}\n\n```{.r .cell-code}\n# Set factor levels for correct ordering in the plot\nfr$age.grp <- factor(fr$age.grp,\n                     levels = c('Started before 10',\n                                'Started at 10-14',\"Started at 15-17\",\n                                \"Started at 18-20\",\"Started after 20\"))\nfr$group <- factor(fr$group,\n                     levels = rev(c(\"Crude\", \"Adjusted\", \n                                \"White\", \"Black\", \"Hispanic\", \n                                \"Male\", \"Female\")))\n\nlevels(fr$group)[levels(fr$group) == \"White\"] <- \"Non-Hispanic White\"\nlevels(fr$group)[levels(fr$group) == \"Black\"] <- \"Non-Hispanic Black\"\nfr$text_label <- sprintf(\"%.2f [%.2f;%.2f]\", fr$mean, fr$lower, fr$upper)\n\n# Create plot\nggplot(fr, \n       aes(x = mean, y = group, colour = age.grp)) + \n  geom_errorbar(aes(xmin = lower, xmax = upper), \n                position = position_dodge(0.9), width = 0.25) + \n  geom_point(position = position_dodge(0.9), shape = 1) + \n  geom_text(aes(label = text_label, x = upper, hjust = -0.05), \n            position = position_dodge(0.9), size = 3) +\n  scale_x_continuous(limits = c(0, 9)) +\n  \n  labs(x = \"Hazard Ratio\", y = \"\", \n       legend=TRUE, col = \"Age group\") +\n  theme_classic() +\n  theme(panel.grid.major.x = element_blank(),\n        panel.border = element_blank(),\n        legend.title=element_text(size=12), \n        legend.text=element_text(size=12),\n        plot.title = element_text(hjust = 0.5),\n        axis.text.x = element_text(size = 10, face = \"bold\"),\n        axis.text.y = element_text(size = 10, face = \"bold\"),\n        legend.position=c(.8, .8)) +\n  geom_vline(xintercept = 1, linetype = \"dashed\", color = \"grey\")+\n  guides(color = guide_legend(override.aes = list(shape = 1, linetype = 1, size = 1)))\n#> Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n#> 3.5.0.\n#> ℹ Please use the `legend.position.inside` argument of `theme()` instead.\n```\n\n::: {.cell-output-display}\n![Forest plot summarizing Hazard Ratios (HRs) for all-cause mortality associated with age of smoking initiation. Results from the crude, main adjusted, and stratified models (by race/ethnicity and sex) are shown. This plot reproduces Figure 2 from the paper.](09-effect-modification_files/figure-html/forestplotting-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Save\nggsave(\"images/forest.png\")\n#> Saving 7 x 5 in image\n```\n:::\n\n\n---\n\n## Quantifying Additive Interaction (RERI)\n\n* R Code Chunk 9: Relative Excess Risk Due to Interaction (RERI) Function\n\nThe following code creates the `reri.f` function which calculates the relative excess risk due to interaction (RERI). RERI is a common measure of additive interaction, providing insight into whether the combined effect of two factors is greater than the sum of their individual effects. The function computes the RERI estimate and its confidence interval based on the delta method, accounting for the variance and covariance of the estimated coefficients.\n\n\n::: {.cell hash='09-effect-modification_cache/html/RERI-function_e6f4eb7411172a2bf33a0f50bd01bc45'}\n\n```{.r .cell-code}\nreri.f <- function(model, coef, conf.level = 0.95){\n  N. <- 1 - ((1 - conf.level)/2)\n  z <- qnorm(N., mean = 0, sd = 1)\n  theta1 <- as.numeric(model$coefficients[coef[1]])\n  theta2 <- as.numeric(model$coefficients[coef[2]])\n  theta3 <- as.numeric(model$coefficients[coef[3]])\n  theta1.se <- summary(model)$coefficients[coef[1],2]\n  theta2.se <- summary(model)$coefficients[coef[2],2]\n  theta3.se <- summary(model)$coefficients[coef[3],2]\n  \n  cov.mat <- vcov(model)\n  h1 <- exp(theta1 + theta2 + theta3) - exp(theta1)\n  h2 <- exp(theta1 + theta2 + theta3) - exp(theta2)\n  h3 <- exp(theta1 + theta2 + theta3)\n     \n  reri.var <- (h1^2 * theta1.se^2) + \n       (h2^2 * theta2.se^2) + \n       (h3^2 * theta3.se^2) + \n       (2 * h1 * h2 * cov.mat[coef[1],coef[2]]) + \n       (2 * h1 * h3 * cov.mat[coef[1],coef[3]]) + \n       (2 * h2 * h3 * cov.mat[coef[2],coef[3]])\n  reri.se <- sqrt(reri.var)\n  \n  reri.p <- exp(theta1 + theta2 + theta3) - exp(theta1) - exp(theta2) + 1\n  reri.l <- reri.p - (z * reri.se)\n  reri.u <- reri.p + (z * reri.se)\n  reri <- data.frame(est = reri.p, lower = reri.l, upper = reri.u)\nreturn(reri)\n}\n```\n:::\n\n\n---\n\n* R Code Chunk 10: Calculate and Report RERI for Sex Interaction\n\n**Corresponds to Appendix Table 5**\n\nThe following code calculates the RERI for the interaction between smoking initiation age (`exposure.cat`) and `sex`, using the `fit3` model. The calculations are performed for each level of exposure.cat relative to its reference level. The results are presented in a table and saved to an Excel file (reriM2.xlsx).\n\n\n::: {.cell hash='09-effect-modification_cache/html/sex-RERI_ac423983d0b72399c3cd028cc298b8df'}\n\n```{.r .cell-code}\n# Get the names of the coefficients from the sex-interaction model\ncoef.val <- names(fit3$coefficients)\n\n# Define the active (non-reference) levels for exposure and the moderator (sex)\nexp.active.lev <- paste0(\"exposure.cat\", levels(w.design0$variables$exposure.cat)[-1])\nmod.active.lev <- paste0(\"sex\", levels(w.design0$variables$sex)[-1])\nint.term <- paste(exp.active.lev, mod.active.lev, sep=\":\")\nrr <- NULL\n\n# Loop through each exposure level to calculate RERI\nfor (i in 1:length(exp.active.lev)){\n  coef.val1 <- coef.val[c(which(coef.val==exp.active.lev[i]),\n                          which(coef.val==mod.active.lev[1]),\n                          which(coef.val==int.term[i]))]\n  r1 <- reri.f(model=fit3, coef=coef.val1, conf.level = 0.95)\n  rr <- rbind(rr,r1)\n}\n\n# Assign row names for clarity\nrow.names(rr) <- levels(w.design0$variables$exposure.cat)[-1]\n```\n:::\n\n::: {.cell hash='09-effect-modification_cache/html/sex-RERI-results_2991ea60158313f50059ad15251b0e8f'}\n\n```{.r .cell-code}\nexpss::xl_write_file(rr, filename = \"data/reriM2.xlsx\", rownames = TRUE)\nkable(rr,\n      booktabs = TRUE, digits = 2,\n      caption=\"Appendix Table 5: Reporting RERI for the Sex Interaction.\",\n      col.names = c(\"Levels\", \"RERI\", \"Lower CI\", \"Upper CI\")) %>%\n  kable_styling(latex_options = \"hold_position\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Appendix Table 5: Reporting RERI for the Sex Interaction.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Levels </th>\n   <th style=\"text-align:right;\"> RERI </th>\n   <th style=\"text-align:right;\"> Lower CI </th>\n   <th style=\"text-align:right;\"> Upper CI </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Started before 10 </td>\n   <td style=\"text-align:right;\"> -0.26 </td>\n   <td style=\"text-align:right;\"> -5.80 </td>\n   <td style=\"text-align:right;\"> 5.27 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 10-14 </td>\n   <td style=\"text-align:right;\"> 0.39 </td>\n   <td style=\"text-align:right;\"> -6.24 </td>\n   <td style=\"text-align:right;\"> 7.02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 15-17 </td>\n   <td style=\"text-align:right;\"> -0.12 </td>\n   <td style=\"text-align:right;\"> -3.70 </td>\n   <td style=\"text-align:right;\"> 3.47 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 18-20 </td>\n   <td style=\"text-align:right;\"> -0.04 </td>\n   <td style=\"text-align:right;\"> -2.52 </td>\n   <td style=\"text-align:right;\"> 2.43 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started after 20 </td>\n   <td style=\"text-align:right;\"> 0.01 </td>\n   <td style=\"text-align:right;\"> -2.69 </td>\n   <td style=\"text-align:right;\"> 2.71 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n---\n\n* R Code Chunk 11: Calculate and Report RERI for Race/Ethnicity Interaction\n\n**Corresponds to Appendix Table 4**\n\nThe following code calculates the RERI for the interaction between smoking initiation age (`exposure.cat`) and `race`, using the `fit2` model. The calculations are performed for each exposure.cat level and for each non-reference racial/ethnic group. The results are presented in a table and saved to an Excel file (reriM3.xlsx).\n\n\n::: {.cell hash='09-effect-modification_cache/html/race-RERI_5aa205edbe24871196b94673db0d634d'}\n\n```{.r .cell-code}\n# Get the names of the coefficients from the race-interaction model\ncoef.val <- names(fit2$coefficients)\n\n# Define the active (non-reference) levels for exposure and the moderator (race)\nexp.active.lev <- paste0(\"exposure.cat\", levels(w.design0$variables$exposure.cat)[-1])\nrmx <- NULL\n\n# Outer loop: iterate through each non-reference race category\nfor (j in 1:length(levels(w.design0$variables$race)[-1])){\n  mod.active.lev.j <- paste0(\"race\", levels(w.design0$variables$race)[-1])[j]\n  int.term <- paste(exp.active.lev, mod.active.lev.j, sep=\":\")\n  \n  # Inner loop: iterate through each non-reference exposure category\n  rr <- NULL\n  for (i in 1:length(exp.active.lev)){\n    coef.val1 <- coef.val[c(which(coef.val==exp.active.lev[i]),\n                          which(coef.val==mod.active.lev[1]),\n                          which(coef.val==int.term[i]))]\n    r1 <- reri.f(model=fit2, coef=coef.val1, conf.level = 0.95)\n    rr <- rbind(rr,r1)\n  }\n  row.names(rr) <- paste(levels(w.design0$variables$exposure.cat)[-1], \n                         levels(w.design0$variables$race)[-1][j])\n  rmx <- rbind(rmx,rr)\n}\n```\n:::\n\n::: {.cell hash='09-effect-modification_cache/html/race-RERI-results_66541193ca267ee9f72508f6bb304820'}\n\n```{.r .cell-code}\nexpss::xl_write_file(rmx, filename = \"data/reriM3.xlsx\", rownames = TRUE)\nkable(rmx,\n      booktabs = TRUE, digits = 2,\n      caption=\"Appendix Table 4: Reporting RERI for the Race/Ethnicity Interaction.\",\n      col.names = c(\"Levels\", \"RERI\", \"Lower CI\", \"Upper CI\")) %>%\n  kable_styling(latex_options = \"hold_position\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Appendix Table 4: Reporting RERI for the Race/Ethnicity Interaction.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Levels </th>\n   <th style=\"text-align:right;\"> RERI </th>\n   <th style=\"text-align:right;\"> Lower CI </th>\n   <th style=\"text-align:right;\"> Upper CI </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Started before 10 Black </td>\n   <td style=\"text-align:right;\"> -1.45 </td>\n   <td style=\"text-align:right;\"> -12.14 </td>\n   <td style=\"text-align:right;\"> 9.24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 10-14 Black </td>\n   <td style=\"text-align:right;\"> -0.79 </td>\n   <td style=\"text-align:right;\"> -6.58 </td>\n   <td style=\"text-align:right;\"> 5.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 15-17 Black </td>\n   <td style=\"text-align:right;\"> -0.60 </td>\n   <td style=\"text-align:right;\"> -4.58 </td>\n   <td style=\"text-align:right;\"> 3.38 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 18-20 Black </td>\n   <td style=\"text-align:right;\"> -0.20 </td>\n   <td style=\"text-align:right;\"> -2.67 </td>\n   <td style=\"text-align:right;\"> 2.27 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started after 20 Black </td>\n   <td style=\"text-align:right;\"> -0.53 </td>\n   <td style=\"text-align:right;\"> -3.45 </td>\n   <td style=\"text-align:right;\"> 2.40 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started before 10 Hispanic </td>\n   <td style=\"text-align:right;\"> -2.13 </td>\n   <td style=\"text-align:right;\"> -16.78 </td>\n   <td style=\"text-align:right;\"> 12.52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 10-14 Hispanic </td>\n   <td style=\"text-align:right;\"> -1.10 </td>\n   <td style=\"text-align:right;\"> -8.02 </td>\n   <td style=\"text-align:right;\"> 5.82 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 15-17 Hispanic </td>\n   <td style=\"text-align:right;\"> -0.71 </td>\n   <td style=\"text-align:right;\"> -4.94 </td>\n   <td style=\"text-align:right;\"> 3.52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 18-20 Hispanic </td>\n   <td style=\"text-align:right;\"> -0.32 </td>\n   <td style=\"text-align:right;\"> -2.68 </td>\n   <td style=\"text-align:right;\"> 2.05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started after 20 Hispanic </td>\n   <td style=\"text-align:right;\"> -0.45 </td>\n   <td style=\"text-align:right;\"> -3.27 </td>\n   <td style=\"text-align:right;\"> 2.37 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started before 10 Others </td>\n   <td style=\"text-align:right;\"> 0.48 </td>\n   <td style=\"text-align:right;\"> -9.80 </td>\n   <td style=\"text-align:right;\"> 10.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 10-14 Others </td>\n   <td style=\"text-align:right;\"> -0.04 </td>\n   <td style=\"text-align:right;\"> -5.88 </td>\n   <td style=\"text-align:right;\"> 5.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 15-17 Others </td>\n   <td style=\"text-align:right;\"> 0.18 </td>\n   <td style=\"text-align:right;\"> -5.17 </td>\n   <td style=\"text-align:right;\"> 5.53 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started at 18-20 Others </td>\n   <td style=\"text-align:right;\"> -0.37 </td>\n   <td style=\"text-align:right;\"> -2.74 </td>\n   <td style=\"text-align:right;\"> 2.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Started after 20 Others </td>\n   <td style=\"text-align:right;\"> -0.64 </td>\n   <td style=\"text-align:right;\"> -3.78 </td>\n   <td style=\"text-align:right;\"> 2.50 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThis concludes the main statistical analysis conducted for the published paper.\n\n## Chapter Summary and Next Steps\n\nIn this chapter, we delved deeper into the analysis by investigating effect modification. We fitted interaction models and performed statistical tests to assess whether the relationship between smoking initiation and mortality was modified by race/ethnicity and sex. Our findings, particularly the significant interaction by sex, align with the conclusions of the original paper.\n\nTo ensure the robustness of these findings, we will next perform \"Sensitivity Analyses\" to test how our results hold up when adjusting for socioeconomic factors and when analyzing a different time period.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}